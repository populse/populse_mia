matrix:
  include:
    - os: osx
      language: generic
      env: TOXENV=py35
    - os: linux
      language: python  
      python:
        - "3.5"

# osx deps
before_install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew update; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew list python &>/dev/null || brew install python; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew list python3 &>/dev/null || brew install python3; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install pyenv-virtualenv; fi

install:
  # - python setup.py install
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then pip install codecov; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then pip2 install codecov; fi
  - cd ..
  - git clone --depth=50 --branch=master https://github.com/populse/populse_db.git
  - cd populse_sandbox
  - export PYTHONPATH="${PYTHONPATH}:/home/travis/build/populse/populse_db/python"
  - export PYTHONPATH="${PYTHONPATH}:/home/travis/build/populse/populse_sandbox/python/populse_mia/src/modules"
  - export PYTHONPATH="${PYTHONPATH}:/home/travis/build/populse/populse_sandbox/python/populse_mia/src/modules/PipelineManager/Processes"
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  - sleep 3 # give xvfb some time to start


script: 
  - python ./python/populse_mia/src/scripts/test.py
  - coverage run ./python/populse_mia/src/scripts/test.py

after_success:
- codecov
