matrix:
  include:
    - os: osx
      language: generic
    - os: linux
      language: python  
      python:
        - "3.5"
    - os: linux
      language: python  
      python:
        - "3.6"

# osx deps
before_install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew uninstall --ignore-dependencies python; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew update; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then mkdir python_3.5.5; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then cd python_3.5.5; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then curl  https://www.python.org/ftp/python/3.5.5/Python-3.5.5.tgz > Python-3.5.5.tgz; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then tar -zxvf Python-3.5.5.tgz; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then cd Python-3.5.5; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then ./configure --prefix=/Users/travis/build/populse/populse_sandbox/python_3.5.5 --enable-optimizations; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then make; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then make install; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then cd ..; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then curl -OL https://pypi.python.org/packages/source/v/virtualenv/virtualenv-15.1.0.tar.gz > virtualenv-15.1.0.tar.gz; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then tar -zxvf virtualenv-15.1.0.tar.gz; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then cd virtualenv-15.1.0; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then cd ..; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then /Users/travis/build/populse/populse_sandbox/python_3.5.5/bin/virtualenv box --python=/Users/travis/build/populse/populse_sandbox/python_3.5.5/bin/python; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then cd ..; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then wget https://bootstrap.pypa.io/get-pip.py; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then which python; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then which python3; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then which python -V; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then which python3 -V; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then python get-pip.py --user; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install pyenv-virtualenv; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install freetype; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then pip install --upgrade pip; fi

install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then pip install numpy; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then pip install --user --upgrade Cython; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then pip install --upgrade Cython; fi
  #- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then pip3 install setuptools; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then python setup.py install; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then python setup.py install; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then pip install codecov; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then pip install codecov; fi
  - cd ..
  - git clone --depth=50 --branch=master https://github.com/populse/populse_db.git
  - cd populse_sandbox
  - export PYTHONPATH="${PYTHONPATH}:/home/travis/build/populse/populse_db/python"
  - export PYTHONPATH="${PYTHONPATH}:/home/travis/build/populse/populse_sandbox/python/populse_mia/src/modules"
  - export PYTHONPATH="${PYTHONPATH}:/home/travis/build/populse/populse_sandbox/python/populse_mia/src/modules/PipelineManager/Processes"
  - "export DISPLAY=:99.0"
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sh -e /etc/init.d/xvfb start; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then ( sudo Xvfb :99 -ac -screen 0 1024x768x8; echo ok )& fi
  - sleep 3 # give xvfb some time to start


script: 
  - python3 -V
  - python3 ./python/populse_mia/src/scripts/test.py
  - coverage run ./python/populse_mia/src/scripts/test.py

after_success:
- codecov
