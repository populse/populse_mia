
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>populse_mia.data_browser.data_browser &#8212; populse_mia 1.0.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../../../index.html">
          <span>populse_mia 1.0.0 documentation</span></a></h1>
        <h2 class="heading"><span>populse_mia.data_browser.data_browser</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="../../../index.html">Contents</a>
        </p>

      </div>
      <div class="content">
        
        
  <h1>Source code for populse_mia.data_browser.data_browser</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*- #</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module to define data browser tab appearance, settings and methods.</span>

<span class="sd">Contains:</span>
<span class="sd">    Class:</span>
<span class="sd">        - DataBrowser</span>
<span class="sd">        - DateFormatDelegate</span>
<span class="sd">        - DateTimeFormatDelegate</span>
<span class="sd">        - NumberFormatDelegate</span>
<span class="sd">        - TableDataBrowser</span>
<span class="sd">        - TimeFormatDelegate</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">##########################################################################</span>
<span class="c1"># Populse_mia - Copyright (C) IRMaGe/CEA, 2018</span>
<span class="c1"># Distributed under the terms of the CeCILL license, as published by</span>
<span class="c1"># the CEA-CNRS-INRIA. Refer to the LICENSE file or to</span>
<span class="c1"># http://www.cecill.info/licences/Licence_CeCILL_V2.1-en.html</span>
<span class="c1"># for details.</span>
<span class="c1">##########################################################################</span>

<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="c1"># from functools import partial</span>
<span class="c1"># from PyQt5.QtCore import QTimer</span>

<span class="c1"># PyQt5 imports</span>
<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="k">import</span> <span class="n">QtWidgets</span><span class="p">,</span> <span class="n">QtCore</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="k">import</span> <span class="n">Qt</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtGui</span> <span class="k">import</span> <span class="n">QColor</span><span class="p">,</span> <span class="n">QIcon</span><span class="p">,</span> <span class="n">QPixmap</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="k">import</span> <span class="n">QTableWidgetItem</span><span class="p">,</span> <span class="n">QMenu</span><span class="p">,</span> <span class="n">QFrame</span><span class="p">,</span> <span class="n">QToolBar</span><span class="p">,</span> \
    <span class="n">QToolButton</span><span class="p">,</span> <span class="n">QAction</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="p">,</span> <span class="n">QPushButton</span><span class="p">,</span> <span class="n">QProgressDialog</span><span class="p">,</span> \
    <span class="n">QDoubleSpinBox</span><span class="p">,</span> <span class="n">QDateTimeEdit</span><span class="p">,</span> <span class="n">QDateEdit</span><span class="p">,</span> <span class="n">QTimeEdit</span><span class="p">,</span> <span class="n">QApplication</span><span class="p">,</span> \
    <span class="n">QWidget</span><span class="p">,</span> <span class="n">QVBoxLayout</span><span class="p">,</span> <span class="n">QTableWidget</span><span class="p">,</span> <span class="n">QHBoxLayout</span><span class="p">,</span> <span class="n">QSplitter</span><span class="p">,</span> <span class="n">QGridLayout</span><span class="p">,</span>\
    <span class="n">QItemDelegate</span><span class="p">,</span> <span class="n">QAbstractItemView</span>

<span class="c1"># Populse_MIA imports</span>
<span class="kn">from</span> <span class="nn">populse_mia.data_browser.rapid_search</span> <span class="k">import</span> <span class="n">RapidSearch</span>
<span class="kn">from</span> <span class="nn">populse_mia.data_browser.advanced_search</span> <span class="k">import</span> <span class="n">AdvancedSearch</span>
<span class="kn">from</span> <span class="nn">populse_mia.data_browser.count_table</span> <span class="k">import</span> <span class="n">CountTable</span>
<span class="kn">from</span> <span class="nn">populse_mia.data_browser.modify_table</span> <span class="k">import</span> <span class="n">ModifyTable</span>
<span class="kn">from</span> <span class="nn">populse_mia.data_browser.mini_viewer</span> <span class="k">import</span> <span class="n">MiniViewer</span>
<span class="kn">from</span> <span class="nn">populse_mia.pop_ups.pop_up_multiple_sort</span> <span class="k">import</span> <span class="n">PopUpMultipleSort</span>
<span class="kn">from</span> <span class="nn">populse_mia.pop_ups.pop_up_properties</span> <span class="k">import</span> <span class="n">PopUpProperties</span>
<span class="kn">from</span> <span class="nn">populse_mia.pop_ups.pop_up_show_brick</span> <span class="k">import</span> <span class="n">PopUpShowBrick</span>
<span class="kn">from</span> <span class="nn">populse_mia.pop_ups.pop_up_add_path</span> <span class="k">import</span> <span class="n">PopUpAddPath</span>
<span class="kn">from</span> <span class="nn">populse_mia.pop_ups.pop_up_add_tag</span> <span class="k">import</span> <span class="n">PopUpAddTag</span>
<span class="kn">from</span> <span class="nn">populse_mia.pop_ups.pop_up_clone_tag</span> <span class="k">import</span> <span class="n">PopUpCloneTag</span>
<span class="kn">from</span> <span class="nn">populse_mia.pop_ups.pop_up_remove_tag</span> <span class="k">import</span> <span class="n">PopUpRemoveTag</span>
<span class="kn">from</span> <span class="nn">populse_mia.pop_ups.pop_up_select_filter</span> <span class="k">import</span> <span class="n">PopUpSelectFilter</span>
<span class="kn">from</span> <span class="nn">populse_mia.pop_ups.pop_up_data_browser_current_selection</span> <span class="k">import</span> \
    <span class="n">PopUpDataBrowserCurrentSelection</span>
<span class="kn">from</span> <span class="nn">populse_mia.utils.tools</span> <span class="k">import</span> <span class="n">ClickableLabel</span>
<span class="kn">from</span> <span class="nn">populse_mia.utils.utils</span> <span class="k">import</span> <span class="n">check_value_type</span><span class="p">,</span> <span class="n">set_item_data</span><span class="p">,</span> \
    <span class="n">table_to_database</span>
<span class="kn">from</span> <span class="nn">populse_mia.project.project</span> <span class="k">import</span> <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> \
    <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">COLLECTION_BRICK</span><span class="p">,</span> <span class="n">TAG_CHECKSUM</span><span class="p">,</span> \
    <span class="n">TAG_FILENAME</span><span class="p">,</span> <span class="n">TAG_BRICKS</span><span class="p">,</span> <span class="n">BRICK_NAME</span>
<span class="kn">from</span> <span class="nn">populse_mia.project.database_mia</span> <span class="k">import</span> <span class="n">TAG_ORIGIN_BUILTIN</span><span class="p">,</span> \
    <span class="n">TAG_ORIGIN_USER</span>
<span class="kn">from</span> <span class="nn">populse_mia.software_properties.config</span> <span class="k">import</span> <span class="n">Config</span>

<span class="c1"># Populse_db imports</span>
<span class="kn">from</span> <span class="nn">populse_db.database</span> <span class="k">import</span> <span class="n">FIELD_TYPE_STRING</span><span class="p">,</span> <span class="n">FIELD_TYPE_FLOAT</span><span class="p">,</span> \
    <span class="n">FIELD_TYPE_DATETIME</span><span class="p">,</span> <span class="n">FIELD_TYPE_DATE</span><span class="p">,</span> <span class="n">FIELD_TYPE_TIME</span><span class="p">,</span> \
    <span class="n">FIELD_TYPE_LIST_DATE</span><span class="p">,</span> <span class="n">FIELD_TYPE_LIST_DATETIME</span><span class="p">,</span> <span class="n">FIELD_TYPE_LIST_TIME</span><span class="p">,</span> \
    <span class="n">FIELD_TYPE_LIST_INTEGER</span><span class="p">,</span> <span class="n">FIELD_TYPE_LIST_STRING</span><span class="p">,</span> <span class="n">FIELD_TYPE_LIST_FLOAT</span><span class="p">,</span> \
    <span class="n">FIELD_TYPE_LIST_BOOLEAN</span><span class="p">,</span> <span class="n">LIST_TYPES</span>

<span class="c1"># Variable shown everywhere when no value for the tag</span>
<span class="n">not_defined_value</span> <span class="o">=</span> <span class="s2">&quot;*Not Defined*&quot;</span>


<div class="viewcode-block" id="DataBrowser"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.DataBrowser">[docs]</a><span class="k">class</span> <span class="nc">DataBrowser</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Widget that contains everything in the Data Browser tab.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        - main_window: main window of the software</span>
<span class="sd">        - project: current project in the software</span>

<span class="sd">    Methods:</span>
<span class="sd">        - add_tag_infos: add the tag after add tag pop-up</span>
<span class="sd">        - add_tag_pop_up: display the add tag pop-up</span>
<span class="sd">        - advanced_search: launch the advanced search</span>
<span class="sd">        - clone_tag_infos: clone the tag after the clone tag pop-up</span>
<span class="sd">        - clone_tag_pop_up: display the clone tag pop-up</span>
<span class="sd">        - connect_viewer: display the selected documents in the viewer</span>
<span class="sd">        - create_actions: create the actions of the tab</span>
<span class="sd">        - create_toolbar_menus: create the toolbar menu at the top of the tab</span>
<span class="sd">        - count_table_pop_up: open the count table</span>
<span class="sd">        - move_splitter: check if the viewer&#39;s splitter is at its lowest</span>
<span class="sd">           position</span>
<span class="sd">        - open_filter: open a project filter that has already been saved</span>
<span class="sd">        - open_filter_infos: apply the current filter</span>
<span class="sd">        - remove_tag_infos: remove user tags after the pop-up</span>
<span class="sd">        - remove_tag_pop_up: display the pop-up to remove user tags</span>
<span class="sd">        - reset_search_bar: reset the rapid search bar</span>
<span class="sd">        - search_str: search a string in the table and updates the</span>
<span class="sd">           visualized documents</span>
<span class="sd">        - send_documents_to_pipeline: send the current list of scans to the</span>
<span class="sd">           Pipeline Manager</span>
<span class="sd">        - update_database: update the database in the software</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DataBrowser.__init__"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.DataBrowser.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">main_window</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialization of the data_browser class</span>

<span class="sd">        :param project: current project in the software</span>
<span class="sd">        :param main_window: main window of the software</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span> <span class="o">=</span> <span class="n">main_window</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">DataBrowser</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_actions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_toolbar_menus</span><span class="p">()</span>

        <span class="c1"># TABLE</span>

        <span class="c1"># Frame behind the table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_table_data</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_table_data</span><span class="o">.</span><span class="n">setFrameShape</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFrame</span><span class="o">.</span><span class="n">StyledPanel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_table_data</span><span class="o">.</span><span class="n">setFrameShadow</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFrame</span><span class="o">.</span><span class="n">Raised</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_table_data</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;frame_table_data&quot;</span><span class="p">)</span>

        <span class="c1"># Main table that will display the tags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span> <span class="o">=</span> <span class="n">TableDataBrowser</span><span class="p">(</span>
            <span class="n">project</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_shown_tags</span><span class="p">(),</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;table_data&quot;</span><span class="p">)</span>

        <span class="c1"># LAYOUTS #</span>

        <span class="n">vbox_table</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">vbox_table</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="p">)</span>

        <span class="c1"># Add path button under the table</span>
        <span class="n">hbox_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>

        <span class="n">sources_images_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))),</span>
            <span class="s2">&quot;sources_images&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addRowLabel</span> <span class="o">=</span> <span class="n">ClickableLabel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addRowLabel</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s1">&#39;plus&#39;</span><span class="p">)</span>
        <span class="n">add_row_picture</span> <span class="o">=</span> <span class="n">QPixmap</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sources_images_dir</span><span class="p">,</span> <span class="s2">&quot;green_plus.png&quot;</span><span class="p">)))</span>
        <span class="n">add_row_picture</span> <span class="o">=</span> <span class="n">add_row_picture</span><span class="o">.</span><span class="n">scaledToHeight</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addRowLabel</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="n">add_row_picture</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addRowLabel</span><span class="o">.</span><span class="n">setFixedWidth</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addRowLabel</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
            <span class="s1">&#39;Add data without using the MRI converter tool (File&gt;Import)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addRowLabel</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">add_path</span><span class="p">)</span>

        <span class="n">hbox_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addRowLabel</span><span class="p">)</span>

        <span class="n">hbox_layout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">send_documents_to_pipeline_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span>
            <span class="s2">&quot;Send documents to the Pipeline Manager&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_documents_to_pipeline_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_documents_to_pipeline</span><span class="p">)</span>
        <span class="n">hbox_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">send_documents_to_pipeline_button</span><span class="p">)</span>

        <span class="n">vbox_table</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">hbox_layout</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frame_table_data</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">vbox_table</span><span class="p">)</span>

        <span class="c1"># VISUALIZATION</span>

        <span class="c1"># Visualization frame, label and text edit (bot.0tom left of the</span>
        <span class="c1"># screen in the application)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_visualization</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_visualization</span><span class="o">.</span><span class="n">setFrameShape</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFrame</span><span class="o">.</span><span class="n">StyledPanel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_visualization</span><span class="o">.</span><span class="n">setFrameShadow</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFrame</span><span class="o">.</span><span class="n">Raised</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_visualization</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;frame_5&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span> <span class="o">=</span> <span class="n">MiniViewer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;viewer&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">adjustSize</span><span class="p">()</span>

        <span class="n">hbox_viewer</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">hbox_viewer</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frame_visualization</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">hbox_viewer</span><span class="p">)</span>

        <span class="c1"># ADVANCED SEARCH</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frame_advanced_search</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_advanced_search</span><span class="o">.</span><span class="n">setFrameShape</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFrame</span><span class="o">.</span><span class="n">StyledPanel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_advanced_search</span><span class="o">.</span><span class="n">setFrameShadow</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFrame</span><span class="o">.</span><span class="n">Raised</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_advanced_search</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;frame_search&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_advanced_search</span><span class="o">.</span><span class="n">setHidden</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span> <span class="o">=</span> <span class="n">AdvancedSearch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">layout_search</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">()</span>
        <span class="n">layout_search</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_advanced_search</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout_search</span><span class="p">)</span>

        <span class="c1"># SPLITTER AND LAYOUT</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">splitter_vertical</span> <span class="o">=</span> <span class="n">QSplitter</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Vertical</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitter_vertical</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_advanced_search</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitter_vertical</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_table_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitter_vertical</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_visualization</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitter_vertical</span><span class="o">.</span><span class="n">splitterMoved</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">move_splitter</span><span class="p">)</span>

        <span class="n">vbox_splitter</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">vbox_splitter</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">menu_toolbar</span><span class="p">)</span>
        <span class="n">vbox_splitter</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splitter_vertical</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">vbox_splitter</span><span class="p">)</span>

        <span class="c1"># Image viewer updated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_viewer</span><span class="p">()</span></div>

<div class="viewcode-block" id="DataBrowser.add_tag_infos"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.DataBrowser.add_tag_infos">[docs]</a>    <span class="k">def</span> <span class="nf">add_tag_infos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_tag_name</span><span class="p">,</span> <span class="n">new_default_value</span><span class="p">,</span> <span class="n">tag_type</span><span class="p">,</span>
                      <span class="n">new_tag_description</span><span class="p">,</span> <span class="n">new_tag_unit</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add the tag after add tag pop-up.</span>

<span class="sd">        :param new_tag_name: New tag name</span>
<span class="sd">        :param new_default_value:  New default value</span>
<span class="sd">        :param tag_type: New tag type</span>
<span class="sd">        :param new_tag_description: New tag description</span>
<span class="sd">        :param new_tag_unit: New tag unit</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># We add the tag and a value for each scan in the Database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">new_tag_name</span><span class="p">,</span>
                                       <span class="n">tag_type</span><span class="p">,</span> <span class="n">new_tag_description</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>
                                       <span class="n">TAG_ORIGIN_USER</span><span class="p">,</span> <span class="n">new_tag_unit</span><span class="p">,</span>
                                       <span class="n">new_default_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span><span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">new_tag_name</span><span class="p">,</span>
                                       <span class="n">tag_type</span><span class="p">,</span> <span class="n">new_tag_description</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>
                                       <span class="n">TAG_ORIGIN_USER</span><span class="p">,</span> <span class="n">new_tag_unit</span><span class="p">,</span>
                                       <span class="n">new_default_value</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_value</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="n">TAG_FILENAME</span><span class="p">),</span>
                <span class="n">new_tag_name</span><span class="p">,</span> <span class="n">table_to_database</span><span class="p">(</span><span class="n">new_default_value</span><span class="p">,</span> <span class="n">tag_type</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_value</span><span class="p">(</span>
                <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="n">TAG_FILENAME</span><span class="p">),</span>
                <span class="n">new_tag_name</span><span class="p">,</span> <span class="n">table_to_database</span><span class="p">(</span><span class="n">new_default_value</span><span class="p">,</span> <span class="n">tag_type</span><span class="p">))</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">getattr</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="n">TAG_FILENAME</span><span class="p">),</span> <span class="n">new_tag_name</span><span class="p">,</span>
                           <span class="n">table_to_database</span><span class="p">(</span><span class="n">new_default_value</span><span class="p">,</span> <span class="n">tag_type</span><span class="p">),</span>
                           <span class="n">table_to_database</span><span class="p">(</span><span class="n">new_default_value</span><span class="p">,</span> <span class="n">tag_type</span><span class="p">)])</span>

        <span class="c1"># For history</span>
        <span class="n">history_maker</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;add_tag&quot;</span><span class="p">,</span> <span class="n">new_tag_name</span><span class="p">,</span> <span class="n">tag_type</span><span class="p">,</span> <span class="n">new_tag_unit</span><span class="p">,</span>
                         <span class="n">new_default_value</span><span class="p">,</span> <span class="n">new_tag_description</span><span class="p">,</span> <span class="n">values</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">undos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">history_maker</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">redos</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1"># New tag added to the table</span>
        <span class="n">column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_index_insertion</span><span class="p">(</span><span class="n">new_tag_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">new_tag_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataBrowser.add_tag_pop_up"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.DataBrowser.add_tag_pop_up">[docs]</a>    <span class="k">def</span> <span class="nf">add_tag_pop_up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Display the add tag pop-up&quot;&quot;&quot;</span>

        <span class="c1"># We first show the add_tag pop up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_up_add_tag</span> <span class="o">=</span> <span class="n">PopUpAddTag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_up_add_tag</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="DataBrowser.advanced_search"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.DataBrowser.advanced_search">[docs]</a>    <span class="k">def</span> <span class="nf">advanced_search</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Launch the advanced search.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_advanced_search</span><span class="o">.</span><span class="n">isHidden</span><span class="p">():</span>
            <span class="c1"># If the advanced search is hidden, we reset it and display it</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">scans_list</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_visualize</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame_advanced_search</span><span class="o">.</span><span class="n">setHidden</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">show_search</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="n">old_scans_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_visualize</span>
            <span class="c1"># If the advanced search is visible, we hide it</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame_advanced_search</span><span class="o">.</span><span class="n">setHidden</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># All the scans are reput in the data_browser</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_visualize</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">scans_list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_search</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">currentFilter</span><span class="o">.</span><span class="n">nots</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">currentFilter</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">currentFilter</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">currentFilter</span><span class="o">.</span><span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">currentFilter</span><span class="o">.</span><span class="n">conditions</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">update_visualized_rows</span><span class="p">(</span><span class="n">old_scans_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataBrowser.clone_tag_infos"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.DataBrowser.clone_tag_infos">[docs]</a>    <span class="k">def</span> <span class="nf">clone_tag_infos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag_to_clone</span><span class="p">,</span> <span class="n">new_tag_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clone the tag after the clone tag pop-up.</span>

<span class="sd">        :param tag_to_clone: Tag to clone</span>
<span class="sd">        :param new_tag_name: New tag name</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># We add the new tag in the Database</span>
        <span class="n">tag_cloned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span><span class="n">tag_to_clone</span><span class="p">)</span>
        <span class="n">tag_cloned_init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span>
            <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">tag_to_clone</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">new_tag_name</span><span class="p">,</span> <span class="n">tag_cloned</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
            <span class="n">tag_cloned</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">TAG_ORIGIN_USER</span><span class="p">,</span> <span class="n">tag_cloned</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span>
            <span class="n">tag_cloned</span><span class="o">.</span><span class="n">default_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span>
            <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">new_tag_name</span><span class="p">,</span> <span class="n">tag_cloned</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
            <span class="n">tag_cloned_init</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">TAG_ORIGIN_USER</span><span class="p">,</span>
            <span class="n">tag_cloned</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">tag_cloned</span><span class="o">.</span><span class="n">default_value</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">):</span>

            <span class="c1"># If the tag to clone has a value, we add this value with the</span>
            <span class="c1"># new tag name in the Database</span>
            <span class="n">cloned_cur_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="n">TAG_FILENAME</span><span class="p">),</span> <span class="n">tag_to_clone</span><span class="p">)</span>
            <span class="n">cloned_init_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="n">TAG_FILENAME</span><span class="p">),</span> <span class="n">tag_to_clone</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cloned_cur_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">cloned_init_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_value</span><span class="p">(</span>
                    <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="n">TAG_FILENAME</span><span class="p">),</span>
                    <span class="n">new_tag_name</span><span class="p">,</span> <span class="n">cloned_cur_value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_value</span><span class="p">(</span>
                    <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="n">TAG_FILENAME</span><span class="p">),</span>
                    <span class="n">new_tag_name</span><span class="p">,</span> <span class="n">cloned_init_value</span><span class="p">)</span>
                <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="n">TAG_FILENAME</span><span class="p">),</span> <span class="n">new_tag_name</span><span class="p">,</span>
                     <span class="n">cloned_cur_value</span><span class="p">,</span> <span class="n">cloned_init_value</span><span class="p">])</span>

        <span class="c1"># For history</span>
        <span class="n">history_maker</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;add_tag&quot;</span><span class="p">,</span> <span class="n">new_tag_name</span><span class="p">,</span> <span class="n">tag_cloned</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
                         <span class="n">tag_cloned</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">tag_cloned</span><span class="o">.</span><span class="n">default_value</span><span class="p">,</span>
                         <span class="n">tag_cloned</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">values</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">undos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">history_maker</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">redos</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1"># New tag added to the table</span>
        <span class="n">column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_index_insertion</span><span class="p">(</span><span class="n">new_tag_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">new_tag_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataBrowser.clone_tag_pop_up"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.DataBrowser.clone_tag_pop_up">[docs]</a>    <span class="k">def</span> <span class="nf">clone_tag_pop_up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Display the clone tag pop-up.&quot;&quot;&quot;</span>

        <span class="c1"># We first show the clone_tag pop up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_up_clone_tag</span> <span class="o">=</span> <span class="n">PopUpCloneTag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_up_clone_tag</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="DataBrowser.connect_viewer"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.DataBrowser.connect_viewer">[docs]</a>    <span class="k">def</span> <span class="nf">connect_viewer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Display the selected documents in the viewer.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitter_vertical</span><span class="o">.</span><span class="n">sizes</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">splitter_vertical</span><span class="o">.</span><span class="n">minimumHeight</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">setHidden</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">setHidden</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()</span>

            <span class="n">full_names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                <span class="n">row</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
                <span class="n">full_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">full_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.nii&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">full_name</span><span class="p">):</span>
                        <span class="n">full_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="n">full_name</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">full_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">full_name</span>
                    <span class="k">if</span> <span class="n">full_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">full_names</span><span class="p">:</span>
                        <span class="n">full_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">full_name</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">verify_slices</span><span class="p">(</span><span class="n">full_names</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataBrowser.count_table_pop_up"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.DataBrowser.count_table_pop_up">[docs]</a>    <span class="k">def</span> <span class="nf">count_table_pop_up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open the count table pop-up&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count_table_pop_up</span> <span class="o">=</span> <span class="n">CountTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count_table_pop_up</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="DataBrowser.create_actions"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.DataBrowser.create_actions">[docs]</a>    <span class="k">def</span> <span class="nf">create_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create the actions of the tab&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_tag_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Add tag&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">shortcut</span><span class="o">=</span><span class="s2">&quot;Ctrl+A&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_tag_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_tag_pop_up</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clone_tag_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Clone tag&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clone_tag_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clone_tag_pop_up</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">remove_tag_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Remove tag&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">shortcut</span><span class="o">=</span><span class="s2">&quot;Ctrl+R&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_tag_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_tag_pop_up</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_filter_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Save current filter&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_filter_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">save_current_filter</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="kc">False</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">open_filter_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span>
            <span class="s2">&quot;Open filter&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">shortcut</span><span class="o">=</span><span class="s2">&quot;Ctrl+F&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open_filter_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">open_filter</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataBrowser.create_toolbar_menus"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.DataBrowser.create_toolbar_menus">[docs]</a>    <span class="k">def</span> <span class="nf">create_toolbar_menus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create the toolbar menu at the top of the tab&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menu_toolbar</span> <span class="o">=</span> <span class="n">QToolBar</span><span class="p">()</span>

        <span class="n">tags_tool_button</span> <span class="o">=</span> <span class="n">QToolButton</span><span class="p">()</span>
        <span class="n">tags_tool_button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Tags&#39;</span><span class="p">)</span>
        <span class="n">tags_tool_button</span><span class="o">.</span><span class="n">setPopupMode</span><span class="p">(</span><span class="n">QToolButton</span><span class="o">.</span><span class="n">MenuButtonPopup</span><span class="p">)</span>
        <span class="n">tags_menu</span> <span class="o">=</span> <span class="n">QMenu</span><span class="p">()</span>
        <span class="n">tags_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_tag_action</span><span class="p">)</span>
        <span class="n">tags_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clone_tag_action</span><span class="p">)</span>
        <span class="n">tags_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_tag_action</span><span class="p">)</span>
        <span class="n">tags_tool_button</span><span class="o">.</span><span class="n">setMenu</span><span class="p">(</span><span class="n">tags_menu</span><span class="p">)</span>

        <span class="n">filters_tool_button</span> <span class="o">=</span> <span class="n">QToolButton</span><span class="p">()</span>
        <span class="n">filters_tool_button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Filters&#39;</span><span class="p">)</span>
        <span class="n">filters_tool_button</span><span class="o">.</span><span class="n">setPopupMode</span><span class="p">(</span><span class="n">QToolButton</span><span class="o">.</span><span class="n">MenuButtonPopup</span><span class="p">)</span>
        <span class="n">filters_menu</span> <span class="o">=</span> <span class="n">QMenu</span><span class="p">()</span>
        <span class="n">filters_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_filter_action</span><span class="p">)</span>
        <span class="n">filters_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">open_filter_action</span><span class="p">)</span>
        <span class="n">filters_tool_button</span><span class="o">.</span><span class="n">setMenu</span><span class="p">(</span><span class="n">filters_menu</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">search_bar</span> <span class="o">=</span> <span class="n">RapidSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_bar</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">search_str</span><span class="p">)</span>
        <span class="c1"># self.search_bar.textChanged.connect(self.delay_event)</span>

        <span class="n">sources_images_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))),</span> <span class="s2">&quot;sources_images&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_cross</span> <span class="o">=</span> <span class="n">QToolButton</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_cross</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s1">&#39;background-color:rgb(255, 255, 255);&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_cross</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span>
            <span class="n">QIcon</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sources_images_dir</span><span class="p">,</span> <span class="s1">&#39;gray_cross.png&#39;</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_cross</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reset_search_bar</span><span class="p">)</span>

        <span class="n">search_bar_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">search_bar_layout</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">search_bar_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">search_bar</span><span class="p">)</span>
        <span class="n">search_bar_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">button_cross</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">advanced_search_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">advanced_search_button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Advanced search&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">advanced_search_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frame_test</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_test</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">search_bar_layout</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">visualized_tags_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visualized_tags_button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Visualized tags&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visualized_tags_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">visualized_tags_pop_up</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">count_table_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count_table_button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Count table&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count_table_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count_table_pop_up</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">menu_toolbar</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">tags_tool_button</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menu_toolbar</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menu_toolbar</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">filters_tool_button</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menu_toolbar</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menu_toolbar</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_test</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menu_toolbar</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menu_toolbar</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">advanced_search_button</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menu_toolbar</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menu_toolbar</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visualized_tags_button</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menu_toolbar</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menu_toolbar</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count_table_button</span><span class="p">)</span></div>

    <span class="c1"># def delay_event(self, str_search):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     Delays the use of the str_search function by 500ms</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     self.timer = QTimer()</span>
    <span class="c1">#     self.timer.setSingleShot(True)</span>
    <span class="c1">#     f = partial(self.search_str, str_search)</span>
    <span class="c1">#     self.timer.timeout.connect(f)</span>
    <span class="c1">#     self.timer.start(500)</span>

<div class="viewcode-block" id="DataBrowser.move_splitter"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.DataBrowser.move_splitter">[docs]</a>    <span class="k">def</span> <span class="nf">move_splitter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if the viewer&#39;s splitter is at its lowest position.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitter_vertical</span><span class="o">.</span><span class="n">sizes</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">splitter_vertical</span><span class="o">.</span><span class="n">minimumHeight</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect_viewer</span><span class="p">()</span></div>

<div class="viewcode-block" id="DataBrowser.open_filter"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.DataBrowser.open_filter">[docs]</a>    <span class="k">def</span> <span class="nf">open_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open a project filter that has already been saved&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">popUp</span> <span class="o">=</span> <span class="n">PopUpSelectFilter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">popUp</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="DataBrowser.open_filter_infos"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.DataBrowser.open_filter_infos">[docs]</a>    <span class="k">def</span> <span class="nf">open_filter_infos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Apply the current filter&quot;&quot;&quot;</span>

        <span class="n">filter_to_apply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">currentFilter</span>

        <span class="c1"># We open the advanced search + search_bar</span>
        <span class="n">old_scans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_visualize</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_visualize</span> <span class="o">=</span> <span class="n">documents</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_search</span> <span class="o">=</span> <span class="n">documents</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">update_visualized_rows</span><span class="p">(</span><span class="n">old_scans</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">search_bar</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">filter_to_apply</span><span class="o">.</span><span class="n">search_bar</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filter_to_apply</span><span class="o">.</span><span class="n">nots</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame_advanced_search</span><span class="o">.</span><span class="n">setHidden</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">scans_list</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_visualize</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">show_search</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">apply_filter</span><span class="p">(</span><span class="n">filter_to_apply</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataBrowser.remove_tag_infos"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.DataBrowser.remove_tag_infos">[docs]</a>    <span class="k">def</span> <span class="nf">remove_tag_infos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag_names_to_remove</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove user tags after the pop-up.</span>

<span class="sd">        :param tag_names_to_remove: list of tags to remove</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

        <span class="c1"># For history</span>
        <span class="n">history_maker</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">history_maker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;remove_tags&quot;</span><span class="p">)</span>
        <span class="n">tags_removed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Each Tag row to remove is put in the history</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tag_names_to_remove</span><span class="p">:</span>
            <span class="n">tag_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                        <span class="n">tag</span><span class="p">)</span>
            <span class="n">tags_removed</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">tag_object</span><span class="p">])</span>
        <span class="n">history_maker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tags_removed</span><span class="p">)</span>

        <span class="c1"># Each value of the tags to remove are stored in the history</span>
        <span class="n">values_removed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tag_names_to_remove</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                    <span class="n">COLLECTION_CURRENT</span><span class="p">):</span>
                <span class="n">current_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                    <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
                <span class="n">initial_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                    <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">current_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">initial_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">values_removed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">scan</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">current_value</span><span class="p">,</span> <span class="n">initial_value</span><span class="p">])</span>
        <span class="n">history_maker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values_removed</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">undos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">history_maker</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">redos</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1"># Tags removed from the Database and table</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tag_names_to_remove</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">remove_field</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">remove_field</span><span class="p">(</span><span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">removeColumn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>

        <span class="c1"># Selection updated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">update_selection</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">selection_changed</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataBrowser.remove_tag_pop_up"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.DataBrowser.remove_tag_pop_up">[docs]</a>    <span class="k">def</span> <span class="nf">remove_tag_pop_up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Display the pop-up to remove user tags.&quot;&quot;&quot;</span>

        <span class="c1"># We first open the remove_tag pop up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_up_remove_tag</span> <span class="o">=</span> <span class="n">PopUpRemoveTag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_up_remove_tag</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="DataBrowser.reset_search_bar"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.DataBrowser.reset_search_bar">[docs]</a>    <span class="k">def</span> <span class="nf">reset_search_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset the rapid search bar.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_bar</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataBrowser.search_str"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.DataBrowser.search_str">[docs]</a>    <span class="k">def</span> <span class="nf">search_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">str_search</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Search a string in the table and updates the visualized documents.</span>

<span class="sd">        :param str_search: string to search</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">old_scan_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_visualize</span>
        <span class="n">return_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Every scan taken if empty search</span>
        <span class="k">if</span> <span class="n">str_search</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">return_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_search</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Scans with at least a not defined value</span>
            <span class="k">if</span> <span class="n">str_search</span> <span class="o">==</span> <span class="n">not_defined_value</span><span class="p">:</span>
                <span class="nb">filter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_bar</span><span class="o">.</span><span class="n">prepare_not_defined_filter</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_shown_tags</span><span class="p">())</span>
            <span class="c1"># Scans matching the search</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">filter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_bar</span><span class="o">.</span><span class="n">prepare_filter</span><span class="p">(</span>
                    <span class="n">str_search</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_shown_tags</span><span class="p">(),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_search</span><span class="p">)</span>

            <span class="n">generator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">filter_documents</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="nb">filter</span><span class="p">)</span>

            <span class="c1"># Creating the list of scans</span>
            <span class="n">return_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="n">TAG_FILENAME</span><span class="p">)</span> <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="n">generator</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_visualize</span> <span class="o">=</span> <span class="n">return_list</span>

        <span class="c1"># Rows updated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">update_visualized_rows</span><span class="p">(</span><span class="n">old_scan_list</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">currentFilter</span><span class="o">.</span><span class="n">search_bar</span> <span class="o">=</span> <span class="n">str_search</span></div>

<div class="viewcode-block" id="DataBrowser.send_documents_to_pipeline"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.DataBrowser.send_documents_to_pipeline">[docs]</a>    <span class="k">def</span> <span class="nf">send_documents_to_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send the current list of scans to the Pipeline Manager.&quot;&quot;&quot;</span>

        <span class="n">current_scans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_current_filter</span><span class="p">()</span>

        <span class="c1"># Displays a popup with the list of scans</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_selection</span> <span class="o">=</span> <span class="n">PopUpDataBrowserCurrentSelection</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_scans</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_selection</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="DataBrowser.update_database"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.DataBrowser.update_database">[docs]</a>    <span class="k">def</span> <span class="nf">update_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the database in the software. Called when switching project</span>
<span class="sd">        (new, open, and save as).</span>

<span class="sd">        :param database: New instance of Database</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Database updated everywhere</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">database</span>

        <span class="c1"># We hide the advanced search when switching project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_advanced_search</span><span class="o">.</span><span class="n">setHidden</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="DateFormatDelegate"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.DateFormatDelegate">[docs]</a><span class="k">class</span> <span class="nc">DateFormatDelegate</span><span class="p">(</span><span class="n">QItemDelegate</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Delegate that is used to handle dates in the TableDataBrowser.&quot;&quot;&quot;</span>
<div class="viewcode-block" id="DateFormatDelegate.__init__"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.DateFormatDelegate.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">QItemDelegate</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span></div>

<div class="viewcode-block" id="DateFormatDelegate.createEditor"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.DateFormatDelegate.createEditor">[docs]</a>    <span class="k">def</span> <span class="nf">createEditor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">option</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Override of the createEditor method, called to generate the widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">editor</span> <span class="o">=</span> <span class="n">QDateEdit</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">editor</span><span class="o">.</span><span class="n">setDisplayFormat</span><span class="p">(</span><span class="s2">&quot;dd/MM/yyyy&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">editor</span></div></div>


<div class="viewcode-block" id="DateTimeFormatDelegate"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.DateTimeFormatDelegate">[docs]</a><span class="k">class</span> <span class="nc">DateTimeFormatDelegate</span><span class="p">(</span><span class="n">QItemDelegate</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Delegate that is used to handle date &amp; time in the TableDataBrowser.&quot;&quot;&quot;</span>
<div class="viewcode-block" id="DateTimeFormatDelegate.__init__"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.DateTimeFormatDelegate.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">QItemDelegate</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span></div>

<div class="viewcode-block" id="DateTimeFormatDelegate.createEditor"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.DateTimeFormatDelegate.createEditor">[docs]</a>    <span class="k">def</span> <span class="nf">createEditor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">option</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Override of the createEditor method, called to generate the widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">editor</span> <span class="o">=</span> <span class="n">QDateTimeEdit</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">editor</span><span class="o">.</span><span class="n">setDisplayFormat</span><span class="p">(</span><span class="s2">&quot;dd/MM/yyyy hh:mm:ss.zzz&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">editor</span></div></div>


<div class="viewcode-block" id="NumberFormatDelegate"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.NumberFormatDelegate">[docs]</a><span class="k">class</span> <span class="nc">NumberFormatDelegate</span><span class="p">(</span><span class="n">QItemDelegate</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Delegate that is used to handle numbers in the TableDataBrowser.&quot;&quot;&quot;</span>
<div class="viewcode-block" id="NumberFormatDelegate.__init__"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.NumberFormatDelegate.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">QItemDelegate</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span></div>

<div class="viewcode-block" id="NumberFormatDelegate.createEditor"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.NumberFormatDelegate.createEditor">[docs]</a>    <span class="k">def</span> <span class="nf">createEditor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">option</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Override of the createEditor method, called to generate the widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">editor</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">EditRole</span><span class="p">)</span>
        <span class="n">decimals_number</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">editor</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">editor</span><span class="o">.</span><span class="n">setDecimals</span><span class="p">(</span><span class="n">decimals_number</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">editor</span></div></div>


<div class="viewcode-block" id="TableDataBrowser"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser">[docs]</a><span class="k">class</span> <span class="nc">TableDataBrowser</span><span class="p">(</span><span class="n">QTableWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Table widget that displays the documents contained in the database and</span>
<span class="sd">    their associated tags.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        :param project: current project in the software</span>
<span class="sd">        :param data_browser: parent data browser widget</span>
<span class="sd">        :param tags_to_display: list of tags to display</span>
<span class="sd">        :param update_values: boolean to specify if edition is enabled</span>
<span class="sd">        :param activate_selection: dictionary containing information about</span>
<span class="sd">           the processes that has been run to generate documents</span>
<span class="sd">        :param link_viewer: boolean to specify if the table is linked to a</span>
<span class="sd">           viewer</span>

<span class="sd">    Methods:</span>
<span class="sd">        - add_column: add a column to the table</span>
<span class="sd">        - add_columns: add columns</span>
<span class="sd">        - add_path: call a pop-up to add any document to the project</span>
<span class="sd">        - add_rows: insert rows if they are not already in the table</span>
<span class="sd">        - change_cell_color: changes the background color and the value of</span>
<span class="sd">           cells when edited by the user</span>
<span class="sd">        - clear_cell: clear the selected cells</span>
<span class="sd">        - context_menu_table: create the context menu of the table</span>
<span class="sd">        - display_unreset_values: display an error message when trying to</span>
<span class="sd">           reset user tags</span>
<span class="sd">        - fill_cells_update_table: initialize and fills the cells of the table</span>
<span class="sd">        - fill_headers: initialize and fill the headers of the table</span>
<span class="sd">        - get_current_filter: get the current data browser selection</span>
<span class="sd">        - get_index_insertion: get index insertion of a new column</span>
<span class="sd">        - get_scan_row: return the row index of the scan</span>
<span class="sd">        - get_tag_column: return the column index of the tag</span>
<span class="sd">        - mouseReleaseEvent: called when clicking released on cells</span>
<span class="sd">        - multiple_sort_infos: sort the table according to the tags specify</span>
<span class="sd">           in list_tags</span>
<span class="sd">        - multiple_sort_pop_up: display the multiple sort pop-up</span>
<span class="sd">        - remove_scan: remove documents from table and project</span>
<span class="sd">        - reset_cell: reset the selected cells to their original values</span>
<span class="sd">        - reset_column: reset the selected columns to their original values</span>
<span class="sd">        - reset_row: reset the selected rows to their original values</span>
<span class="sd">        - section_moved: called when the columns of the data_browser are moved</span>
<span class="sd">        - select_all_column: called when single clicking on the column header</span>
<span class="sd">           to select the whole column</span>
<span class="sd">        - select_all_columns: called from context menu to select the columns</span>
<span class="sd">        - selection_changed: called when the selection is changed</span>
<span class="sd">        - show_brick_history: show brick history pop-up</span>
<span class="sd">        - sort_column: sort the current column</span>
<span class="sd">        - sort_updated: called when the button advanced search is called</span>
<span class="sd">        - update_colors: update the background of all the cells</span>
<span class="sd">        - update_selection: called after searches to update the selection</span>
<span class="sd">        - update_table: fill the table with the project&#39;s data</span>
<span class="sd">        - update_visualized_columns: update the visualized tags</span>
<span class="sd">        - update_visualized_rows: update the list of documents (scans) in</span>
<span class="sd">           the table</span>
<span class="sd">        - visualized_tags_pop_up: display the visualized tags pop-up</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TableDataBrowser.__init__"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">data_browser</span><span class="p">,</span> <span class="n">tags_to_display</span><span class="p">,</span>
                 <span class="n">update_values</span><span class="p">,</span> <span class="n">activate_selection</span><span class="p">,</span> <span class="n">link_viewer</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_browser</span> <span class="o">=</span> <span class="n">data_browser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags_to_display</span> <span class="o">=</span> <span class="n">tags_to_display</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_values</span> <span class="o">=</span> <span class="n">update_values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activate_selection</span> <span class="o">=</span> <span class="n">activate_selection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link_viewer</span> <span class="o">=</span> <span class="n">link_viewer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bricks</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setSelectionMode</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">ExtendedSelection</span><span class="p">)</span>

        <span class="c1"># It allows to move the columns (except the first column name)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">setSectionsMovable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># It allows the automatic sort</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSortingEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Adding a custom context menu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setContextMenuPolicy</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">CustomContextMenu</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activate_selection</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">customContextMenuRequested</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context_menu_table</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_cell_color</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">activate_selection</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selection_changed</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setSelectionMode</span><span class="p">(</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">NoSelection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">sortIndicatorChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sort_updated</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">sectionDoubleClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select_all_column</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">sectionMoved</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">section_moved</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verticalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">setMinimumSectionSize</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_table</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_values</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setEditTriggers</span><span class="p">(</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">NoEditTriggers</span><span class="p">)</span></div>

<div class="viewcode-block" id="TableDataBrowser.add_column"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.add_column">[docs]</a>    <span class="k">def</span> <span class="nf">add_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a column to the table</span>

<span class="sd">        :param column: index of the column to add</span>
<span class="sd">        :param tag: tag name to add</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

        <span class="c1"># Adding the column to the table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insertColumn</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setHorizontalHeaderItem</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="n">tag_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
            <span class="s2">&quot;Description: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tag_object</span><span class="o">.</span><span class="n">description</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Unit: &quot;</span> <span class="o">+</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">tag_object</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Type: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tag_object</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>

        <span class="c1"># Set column type</span>
        <span class="k">if</span> <span class="n">tag_object</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">FIELD_TYPE_FLOAT</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setItemDelegateForColumn</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">NumberFormatDelegate</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">tag_object</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">FIELD_TYPE_DATETIME</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setItemDelegateForColumn</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">DateTimeFormatDelegate</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">tag_object</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">FIELD_TYPE_DATE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setItemDelegateForColumn</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">DateFormatDelegate</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">tag_object</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">FIELD_TYPE_TIME</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setItemDelegateForColumn</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">TimeFormatDelegate</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setItemDelegateForColumn</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
            <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">cur_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cur_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">set_item_data</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">cur_value</span><span class="p">,</span> <span class="n">tag_object</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">set_item_data</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">not_defined_value</span><span class="p">,</span> <span class="n">FIELD_TYPE_STRING</span><span class="p">)</span>
                <span class="n">font</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">font</span><span class="p">()</span>
                <span class="n">font</span><span class="o">.</span><span class="n">setItalic</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">font</span><span class="o">.</span><span class="n">setBold</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">item</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span>  <span class="c1"># New column re-sized</span>

        <span class="c1"># Selection updated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_selection</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_colors</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selection_changed</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_cell_color</span><span class="p">)</span></div>

<div class="viewcode-block" id="TableDataBrowser.add_columns"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.add_columns">[docs]</a>    <span class="k">def</span> <span class="nf">add_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add columns.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

        <span class="n">tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">)</span>
        <span class="n">tags</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">TAG_CHECKSUM</span><span class="p">)</span>
        <span class="n">tags</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">TAG_FILENAME</span><span class="p">)</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
        <span class="n">tags</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">TAG_FILENAME</span><span class="p">)</span>

        <span class="n">visibles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_shown_tags</span><span class="p">()</span>

        <span class="c1"># Adding missing columns</span>

        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>

            <span class="c1"># Tag added only if it&#39;s not already in the table</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tag_column</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

                <span class="n">column_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_index_insertion</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">insertColumn</span><span class="p">(</span><span class="n">column_index</span><span class="p">)</span>

                <span class="n">item</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setHorizontalHeaderItem</span><span class="p">(</span><span class="n">column_index</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
                <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
                <span class="n">tag_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span>
                    <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">tag_object</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Description: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                        <span class="n">tag_object</span><span class="o">.</span><span class="n">description</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Unit: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                        <span class="n">tag_object</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Type: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tag_object</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>

                <span class="c1"># Set column type</span>

                <span class="k">if</span> <span class="n">tag_object</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">FIELD_TYPE_FLOAT</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setItemDelegateForColumn</span><span class="p">(</span><span class="n">column_index</span><span class="p">,</span>
                                                  <span class="n">NumberFormatDelegate</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">tag_object</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">FIELD_TYPE_DATETIME</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setItemDelegateForColumn</span><span class="p">(</span><span class="n">column_index</span><span class="p">,</span>
                                                  <span class="n">DateTimeFormatDelegate</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">tag_object</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">FIELD_TYPE_DATE</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setItemDelegateForColumn</span><span class="p">(</span><span class="n">column_index</span><span class="p">,</span>
                                                  <span class="n">DateFormatDelegate</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">tag_object</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">FIELD_TYPE_TIME</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setItemDelegateForColumn</span><span class="p">(</span><span class="n">column_index</span><span class="p">,</span>
                                                  <span class="n">TimeFormatDelegate</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

                <span class="c1"># Hide the column if not visible</span>

                <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">visibles</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setColumnHidden</span><span class="p">(</span><span class="n">column_index</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

                <span class="c1"># Rows filled for the column being added</span>

                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">column_index</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
                    <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                    <span class="n">cur_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                        <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">cur_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">set_item_data</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">cur_value</span><span class="p">,</span> <span class="n">tag_object</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">set_item_data</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">not_defined_value</span><span class="p">,</span>
                                      <span class="n">FIELD_TYPE_STRING</span><span class="p">)</span>
                        <span class="n">font</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">font</span><span class="p">()</span>
                        <span class="n">font</span><span class="o">.</span><span class="n">setItalic</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">font</span><span class="o">.</span><span class="n">setBold</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">item</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>

                <span class="c1"># Removing useless columns</span>
                <span class="n">tags_to_remove</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()):</span>
                    <span class="n">tag_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">tag_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                            <span class="n">COLLECTION_CURRENT</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tag_name</span> <span class="o">!=</span> <span class="n">TAG_FILENAME</span><span class="p">:</span>
                        <span class="n">tags_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag_name</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags_to_remove</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">removeColumn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_tag_column</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span>

        <span class="c1"># Selection updated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_selection</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_colors</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selection_changed</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_cell_color</span><span class="p">)</span></div>

<div class="viewcode-block" id="TableDataBrowser.add_path"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.add_path">[docs]</a>    <span class="k">def</span> <span class="nf">add_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call a pop-up to add any document to the project.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pop_up_add_path</span> <span class="o">=</span> <span class="n">PopUpAddPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_browser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_up_add_path</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="TableDataBrowser.add_rows"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.add_rows">[docs]</a>    <span class="k">def</span> <span class="nf">add_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rows</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Insert rows if they are not already in the table.</span>

<span class="sd">        :param rows: list of all scans</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setSortingEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

        <span class="n">cells_number</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="n">QProgressDialog</span><span class="p">(</span><span class="s2">&quot;Please wait while the paths are &quot;</span>
                                        <span class="s2">&quot;being added...&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                        <span class="n">cells_number</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">setMinimumDuration</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Adding the paths&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">setWindowFlags</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Window</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">WindowTitleHint</span> <span class="o">|</span>
                                     <span class="n">Qt</span><span class="o">.</span><span class="n">CustomizeWindowHint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">setModal</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">WA_DeleteOnClose</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="c1"># Scan added only if it&#39;s not already in the table</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scan_row</span><span class="p">(</span><span class="n">scan</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">rowCount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">insertRow</span><span class="p">(</span><span class="n">rowCount</span><span class="p">)</span>

                <span class="c1"># Columns filled for the row being added</span>
                <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()):</span>

                    <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                    <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>

                    <span class="n">item</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">()</span>
                    <span class="n">tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># name tag, not editable</span>
                        <span class="n">item</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEditable</span><span class="p">)</span>
                        <span class="n">set_item_data</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="n">FIELD_TYPE_STRING</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cur_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">cur_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">tag</span> <span class="o">!=</span> <span class="n">TAG_BRICKS</span><span class="p">:</span>
                                <span class="n">set_item_data</span><span class="p">(</span>
                                    <span class="n">item</span><span class="p">,</span> <span class="n">cur_value</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span>
                                        <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c1"># Tag bricks, display list with buttons</span>
                                <span class="n">widget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
                                <span class="n">widget</span><span class="o">.</span><span class="n">moveToThread</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">(</span>
                                <span class="p">)</span><span class="o">.</span><span class="n">thread</span><span class="p">())</span>
                                <span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
                                <span class="k">for</span> <span class="n">brick_number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cur_value</span><span class="p">)):</span>
                                    <span class="n">brick_uuid</span> <span class="o">=</span> <span class="n">cur_value</span><span class="p">[</span><span class="n">brick_number</span><span class="p">]</span>
                                    <span class="n">brick_name</span> <span class="o">=</span> \
                                        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                            <span class="n">COLLECTION_BRICK</span><span class="p">,</span> <span class="n">brick_uuid</span><span class="p">,</span>
                                            <span class="n">BRICK_NAME</span><span class="p">)</span>
                                    <span class="n">brick_name_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="n">brick_name</span><span class="p">)</span>
                                    <span class="n">brick_name_button</span><span class="o">.</span><span class="n">moveToThread</span><span class="p">(</span>
                                        <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">thread</span><span class="p">())</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">bricks</span><span class="p">[</span><span class="n">brick_name_button</span><span class="p">]</span> <span class="o">=</span> <span class="n">brick_uuid</span>
                                    <span class="n">brick_name_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">show_brick_history</span><span class="p">)</span>
                                    <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">brick_name_button</span><span class="p">)</span>
                                <span class="n">widget</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">rowCount</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">widget</span><span class="p">)</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">tag</span> <span class="o">!=</span> <span class="n">TAG_BRICKS</span><span class="p">:</span>
                                <span class="n">set_item_data</span><span class="p">(</span>
                                    <span class="n">item</span><span class="p">,</span> <span class="n">not_defined_value</span><span class="p">,</span> <span class="n">FIELD_TYPE_STRING</span><span class="p">)</span>
                                <span class="n">font</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">font</span><span class="p">()</span>
                                <span class="n">font</span><span class="o">.</span><span class="n">setItalic</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                                <span class="n">font</span><span class="o">.</span><span class="n">setBold</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                                <span class="n">item</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">set_item_data</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">FIELD_TYPE_STRING</span><span class="p">)</span>
                                <span class="c1"># bricks not editable</span>
                                <span class="n">item</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span>
                                    <span class="n">item</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEditable</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">rowCount</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

        <span class="c1"># Crash if self.setSortingEnabled(True) because it calls sortByColumn()</span>
        <span class="c1"># self.setSortingEnabled(False)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resizeRowsToContents</span><span class="p">()</span>

        <span class="c1"># Selection updated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_selection</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_colors</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selection_changed</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_cell_color</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="TableDataBrowser.change_cell_color"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.change_cell_color">[docs]</a>    <span class="k">def</span> <span class="nf">change_cell_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item_origin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Change the background color and the value of cells when edited by</span>
<span class="sd">        the user.</span>
<span class="sd">        Handle the multi-selection case.</span>

<span class="sd">        :param item_origin: item from where the call comes from</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="n">new_value</span> <span class="o">=</span> <span class="n">item_origin</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">EditRole</span><span class="p">)</span>

        <span class="n">cells_types</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Will contain the type list of the selection</span>

        <span class="c1"># To reset the first cell already changed</span>
        <span class="c1"># self.fill_cells_update_table()</span>

        <span class="c1"># For each item selected, we check the validity of the types</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">():</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
            <span class="n">tag_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">tag_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">)</span>
            <span class="n">tag_type</span> <span class="o">=</span> <span class="n">tag_object</span><span class="o">.</span><span class="n">type</span>

            <span class="k">if</span> <span class="n">tag_name</span> <span class="o">==</span> <span class="n">TAG_BRICKS</span> <span class="ow">or</span> <span class="n">tag_name</span> <span class="o">==</span> <span class="n">TAG_FILENAME</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_colors</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_cell_color</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="c1"># Type added to types list</span>
            <span class="k">if</span> <span class="n">tag_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cells_types</span><span class="p">:</span>
                <span class="n">cells_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag_type</span><span class="p">)</span>

        <span class="c1"># Error if list with other types</span>
        <span class="k">if</span> <span class="n">FIELD_TYPE_LIST_DATE</span> <span class="ow">in</span> <span class="n">cells_types</span> <span class="ow">or</span> <span class="n">FIELD_TYPE_LIST_DATETIME</span> \
                <span class="ow">in</span> <span class="n">cells_types</span> <span class="ow">or</span> <span class="n">FIELD_TYPE_LIST_TIME</span> <span class="ow">in</span> <span class="n">cells_types</span> <span class="ow">or</span> \
                <span class="n">FIELD_TYPE_LIST_INTEGER</span> <span class="ow">in</span> <span class="n">cells_types</span> <span class="ow">or</span> \
                <span class="n">FIELD_TYPE_LIST_STRING</span> <span class="ow">in</span> <span class="n">cells_types</span> <span class="ow">or</span> \
                <span class="n">FIELD_TYPE_LIST_FLOAT</span> <span class="ow">in</span> <span class="n">cells_types</span> <span class="ow">or</span> \
                <span class="n">FIELD_TYPE_LIST_BOOLEAN</span> <span class="ow">in</span> <span class="n">cells_types</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">cells_types</span><span class="p">)</span> \
                <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Incompatible types&quot;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setInformativeText</span><span class="p">(</span>
                <span class="s2">&quot;The following types in the selection are not compatible: &quot;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">cells_types</span><span class="p">))</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Warning&quot;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_cell_color</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Nothing to do if list</span>
        <span class="k">if</span> <span class="n">FIELD_TYPE_LIST_DATE</span> <span class="ow">in</span> <span class="n">cells_types</span> <span class="ow">or</span> <span class="n">FIELD_TYPE_LIST_DATETIME</span> \
                <span class="ow">in</span> <span class="n">cells_types</span> <span class="ow">or</span> <span class="n">FIELD_TYPE_LIST_TIME</span> <span class="ow">in</span> <span class="n">cells_types</span> <span class="ow">or</span> \
                <span class="n">FIELD_TYPE_LIST_INTEGER</span> <span class="ow">in</span> <span class="n">cells_types</span> <span class="ow">or</span> \
                <span class="n">FIELD_TYPE_LIST_STRING</span> <span class="ow">in</span> <span class="n">cells_types</span> <span class="ow">or</span> \
                <span class="n">FIELD_TYPE_LIST_FLOAT</span> <span class="ow">in</span> <span class="n">cells_types</span> <span class="ow">or</span> \
                <span class="n">FIELD_TYPE_LIST_BOOLEAN</span> <span class="ow">in</span> <span class="n">cells_types</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_cell_color</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># We check that the value is compatible with all the types</span>
        <span class="n">types_compatibles</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="n">cells_types</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">check_value_type</span><span class="p">(</span><span class="n">new_value</span><span class="p">,</span> <span class="n">cell_type</span><span class="p">):</span>
                <span class="n">types_compatibles</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">type_problem</span> <span class="o">=</span> <span class="n">cell_type</span>
                <span class="k">break</span>

        <span class="c1"># Error if invalid value</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">types_compatibles</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Invalid value&quot;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setInformativeText</span><span class="p">(</span>
                <span class="s2">&quot;The value &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_value</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; is invalid with the type &quot;</span> <span class="o">+</span>
                <span class="n">type_problem</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Warning&quot;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

        <span class="c1"># Otherwise we update the values</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="c1"># For history</span>
            <span class="n">history_maker</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="n">history_maker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;modified_values&quot;</span><span class="p">)</span>
            <span class="n">modified_values</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">():</span>
                <span class="n">row</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
                <span class="n">scan_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                <span class="n">tag_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                <span class="n">database_value</span> <span class="o">=</span> <span class="n">table_to_database</span><span class="p">(</span>
                    <span class="n">new_value</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span>
                        <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">)</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>

                <span class="c1"># We only set the cell if it&#39;s not the tag name</span>
                <span class="k">if</span> <span class="n">tag_name</span> <span class="o">!=</span> <span class="n">TAG_FILENAME</span><span class="p">:</span>

                    <span class="n">old_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                        <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_path</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">)</span>
                    <span class="c1"># The scan already has a value for the tag: we update it</span>
                    <span class="k">if</span> <span class="n">old_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">modified_values</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">scan_path</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">,</span>
                                                <span class="n">old_value</span><span class="p">,</span> <span class="n">database_value</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_path</span><span class="p">,</span>
                            <span class="n">tag_name</span><span class="p">,</span> <span class="n">database_value</span><span class="p">)</span>
                    <span class="c1"># The scan does not have a value for the tag yet: we add it</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">modified_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">scan_path</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">database_value</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_value</span><span class="p">(</span>
                            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_path</span><span class="p">,</span>
                            <span class="n">tag_name</span><span class="p">,</span> <span class="n">database_value</span><span class="p">)</span>

                        <span class="c1"># Font reset in case it was a not defined cell</span>
                        <span class="n">font</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">font</span><span class="p">()</span>
                        <span class="n">font</span><span class="o">.</span><span class="n">setItalic</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                        <span class="n">font</span><span class="o">.</span><span class="n">setBold</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                        <span class="n">item</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>

                    <span class="n">set_item_data</span><span class="p">(</span>
                        <span class="n">item</span><span class="p">,</span> <span class="n">new_value</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span>
                            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">)</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>

            <span class="c1"># For history</span>
            <span class="n">history_maker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modified_values</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">undos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">history_maker</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">redos</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span>  <span class="c1"># Columns re-sized</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_colors</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_cell_color</span><span class="p">)</span></div>

<div class="viewcode-block" id="TableDataBrowser.clear_cell"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.clear_cell">[docs]</a>    <span class="k">def</span> <span class="nf">clear_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear the selected cells.&quot;&quot;&quot;</span>

        <span class="c1"># For history</span>
        <span class="n">history_maker</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">history_maker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;modified_values&quot;</span><span class="p">)</span>
        <span class="n">modified_values</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndexes</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
            <span class="n">tag_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="c1"># We get the FileName of the scan from the first row</span>
            <span class="n">current_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">)</span>
            <span class="c1"># For history</span>
            <span class="n">modified_values</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">scan_name</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">,</span> <span class="n">current_value</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">remove_value</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span>
                                              <span class="n">tag_name</span><span class="p">)</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
            <span class="n">set_item_data</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">not_defined_value</span><span class="p">,</span> <span class="n">FIELD_TYPE_STRING</span><span class="p">)</span>
            <span class="n">font</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">font</span><span class="p">()</span>
            <span class="n">font</span><span class="o">.</span><span class="n">setItalic</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">font</span><span class="o">.</span><span class="n">setBold</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>

        <span class="c1"># For history</span>
        <span class="n">history_maker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modified_values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">undos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">history_maker</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">redos</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

<div class="viewcode-block" id="TableDataBrowser.context_menu_table"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.context_menu_table">[docs]</a>    <span class="k">def</span> <span class="nf">context_menu_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create the context menu of the table.</span>

<span class="sd">        :param position: position of the mouse cursor</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">menu</span> <span class="o">=</span> <span class="n">QMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">action_reset_cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s2">&quot;Reset cell(s)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_reset_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s2">&quot;Reset column(s)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_reset_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s2">&quot;Reset row(s)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_clear_cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s2">&quot;Clear cell(s)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_add_scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s2">&quot;Add document&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_remove_scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s2">&quot;Remove document(s)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_sort_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s2">&quot;Sort column&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_sort_column_descending</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span>
            <span class="s2">&quot;Sort column (descending)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_visualized_tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s2">&quot;Visualized tags&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_select_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s2">&quot;Select column(s)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_multiple_sort</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s2">&quot;Multiple sort&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_send_documents_to_pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span>
            <span class="s2">&quot;Send documents to the Pipeline Manager&quot;</span><span class="p">)</span>

        <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">exec_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapToGlobal</span><span class="p">(</span><span class="n">position</span><span class="p">))</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Warning&quot;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_reset_cell</span><span class="p">:</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;You are about to reset cells.&quot;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">buttons</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reset_cell</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_reset_column</span><span class="p">:</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;You are about to reset columns.&quot;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">buttons</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reset_column</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_reset_row</span><span class="p">:</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;You are about to reset rows.&quot;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">buttons</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reset_row</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_clear_cell</span><span class="p">:</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;You are about to clear cells.&quot;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">buttons</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clear_cell</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_add_scan</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_cell_color</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_path</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_remove_scan</span><span class="p">:</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;You are about to remove a scan from the project.&quot;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">buttons</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_scan</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_sort_column</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sort_column</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_sort_column_descending</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sort_column</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_visualized_tags</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visualized_tags_pop_up</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_select_column</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select_all_columns</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_multiple_sort</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">multiple_sort_pop_up</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_send_documents_to_pipeline</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">send_documents_to_pipeline</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_colors</span><span class="p">()</span>

        <span class="c1"># Signals reconnected</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_cell_color</span><span class="p">)</span></div>

<div class="viewcode-block" id="TableDataBrowser.display_unreset_values"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.display_unreset_values">[docs]</a>    <span class="k">def</span> <span class="nf">display_unreset_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Display an error message when trying to reset user tags.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Some values do not have a raw value&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">setInformativeText</span><span class="p">(</span>
            <span class="s2">&quot;Some values have not been reset because they do not have a raw &quot;</span>
            <span class="s2">&quot;value.</span><span class="se">\n</span><span class="s2">It is the case for the user tags, FileName and the &quot;</span>
            <span class="s2">&quot;cells not defined.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Warning&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="TableDataBrowser.fill_cells_update_table"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.fill_cells_update_table">[docs]</a>    <span class="k">def</span> <span class="nf">fill_cells_update_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize and fill the cells of the table&quot;&quot;&quot;</span>
        <span class="n">cells_number</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scans_to_visualize</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="n">QProgressDialog</span><span class="p">(</span>
            <span class="s2">&quot;Please wait while the cells are being filled...&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">cells_number</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">setMinimumDuration</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Filling the cells&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">setWindowFlags</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Window</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">WindowTitleHint</span> <span class="o">|</span>
                                     <span class="n">Qt</span><span class="o">.</span><span class="n">CustomizeWindowHint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">setModal</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">WA_DeleteOnClose</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">row</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scans_to_visualize</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">())):</span>

                <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>

                <span class="n">current_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

                <span class="n">item</span> <span class="o">=</span> <span class="n">QTableWidgetItem</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># name tag</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEditable</span><span class="p">)</span>
                    <span class="c1"># name not editable</span>
                    <span class="n">set_item_data</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="n">FIELD_TYPE_STRING</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Other tags</span>
                    <span class="n">current_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                        <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="n">current_tag</span><span class="p">)</span>
                    <span class="c1"># The scan has a value for the tag</span>
                    <span class="k">if</span> <span class="n">current_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">current_tag</span> <span class="o">!=</span> <span class="n">TAG_BRICKS</span><span class="p">:</span>
                            <span class="n">set_item_data</span><span class="p">(</span>
                                <span class="n">item</span><span class="p">,</span> <span class="n">current_value</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span>
                                    <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">current_tag</span><span class="p">)</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># Tag bricks, display list with buttons</span>
                            <span class="c1"># Initialization of a widget, it is necessary</span>
                            <span class="c1"># to remove it after a sort</span>
                            <span class="n">widget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
                            <span class="n">widget</span><span class="o">.</span><span class="n">moveToThread</span><span class="p">(</span>
                                <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">thread</span><span class="p">())</span>
                            <span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
                            <span class="k">for</span> <span class="n">brick_number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_value</span><span class="p">)):</span>
                                <span class="n">brick_uuid</span> <span class="o">=</span> <span class="n">current_value</span><span class="p">[</span><span class="n">brick_number</span><span class="p">]</span>

                                <span class="n">brick_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                    <span class="n">COLLECTION_BRICK</span><span class="p">,</span> <span class="n">brick_uuid</span><span class="p">,</span> <span class="n">BRICK_NAME</span><span class="p">)</span>

                                <span class="n">brick_name_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="n">brick_name</span><span class="p">)</span>
                                <span class="n">brick_name_button</span><span class="o">.</span><span class="n">moveToThread</span><span class="p">(</span>
                                    <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">thread</span><span class="p">())</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">bricks</span><span class="p">[</span><span class="n">brick_name_button</span><span class="p">]</span> <span class="o">=</span> <span class="n">brick_uuid</span>
                                <span class="n">brick_name_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">show_brick_history</span><span class="p">)</span>
                                <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">brick_name_button</span><span class="p">)</span>
                            <span class="n">widget</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">widget</span><span class="p">)</span>

                    <span class="c1"># The scan does not have a value for the tag</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">current_tag</span> <span class="o">!=</span> <span class="n">TAG_BRICKS</span><span class="p">:</span>
                            <span class="n">set_item_data</span><span class="p">(</span>
                                <span class="n">item</span><span class="p">,</span> <span class="n">not_defined_value</span><span class="p">,</span> <span class="n">FIELD_TYPE_STRING</span><span class="p">)</span>
                            <span class="n">font</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">font</span><span class="p">()</span>
                            <span class="n">font</span><span class="o">.</span><span class="n">setItalic</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                            <span class="n">font</span><span class="o">.</span><span class="n">setBold</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                            <span class="n">item</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># The scan does not have a brick</span>
                            <span class="c1"># Remove previous initialization of QWidget in cell</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                            <span class="n">set_item_data</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">FIELD_TYPE_STRING</span><span class="p">)</span>
                            <span class="n">item</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEditable</span><span class="p">)</span>
                            <span class="c1"># bricks not editable</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># We apply the saved sort when the project is opened or after the</span>
        <span class="c1"># tab is changed</span>
        <span class="c1"># Saved sort applied if it exists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSortingEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">tag_to_sort</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getSortedTag</span><span class="p">()</span>
        <span class="n">column_to_sort</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tag_column</span><span class="p">(</span><span class="n">tag_to_sort</span><span class="p">)</span>
        <span class="n">sort_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getSortOrder</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_cell_color</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">column_to_sort</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">setSortIndicator</span><span class="p">(</span>
                <span class="n">column_to_sort</span><span class="p">,</span> <span class="n">sort_order</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">setSortIndicator</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">resizeRowsToContents</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="TableDataBrowser.fill_headers"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.fill_headers">[docs]</a>    <span class="k">def</span> <span class="nf">fill_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">take_tags_to_update</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize and fill the headers of the table.</span>

<span class="sd">        :param take_tags_to_update: boolean to hide or show tags</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Sorting the list of tags in alphabetical order,</span>
        <span class="c1"># but keeping FileName first</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">)</span>
        <span class="n">tags</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">TAG_CHECKSUM</span><span class="p">)</span>
        <span class="n">tags</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">TAG_FILENAME</span><span class="p">)</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
        <span class="n">tags</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">TAG_FILENAME</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setColumnCount</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tags</span><span class="p">))</span>

        <span class="n">column</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Filling the headers</span>
        <span class="k">for</span> <span class="n">tag_name</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setHorizontalHeaderItem</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">tag_name</span><span class="p">)</span>

            <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">element</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">item</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                    <span class="s2">&quot;Description: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">description</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Unit: &quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Type: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>

                <span class="c1"># Set column type</span>
                <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">FIELD_TYPE_FLOAT</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setItemDelegateForColumn</span><span class="p">(</span>
                        <span class="n">column</span><span class="p">,</span> <span class="n">NumberFormatDelegate</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">element</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">FIELD_TYPE_DATETIME</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setItemDelegateForColumn</span><span class="p">(</span>
                        <span class="n">column</span><span class="p">,</span> <span class="n">DateTimeFormatDelegate</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">element</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">FIELD_TYPE_DATE</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setItemDelegateForColumn</span><span class="p">(</span>
                        <span class="n">column</span><span class="p">,</span> <span class="n">DateFormatDelegate</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">element</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">FIELD_TYPE_TIME</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setItemDelegateForColumn</span><span class="p">(</span>
                        <span class="n">column</span><span class="p">,</span> <span class="n">TimeFormatDelegate</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

                <span class="c1"># Hide the column if not visible</span>
                <span class="k">if</span> <span class="n">take_tags_to_update</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">tag_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags_to_display</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">setColumnHidden</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">setColumnHidden</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">visibility</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">setColumnHidden</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">setColumnHidden</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">setHorizontalHeaderItem</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

            <span class="n">column</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="TableDataBrowser.get_current_filter"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.get_current_filter">[docs]</a>    <span class="k">def</span> <span class="nf">get_current_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the current data browser selection (list of paths).</span>
<span class="sd">        If there is a current selection, the list of selected scans is returned</span>
<span class="sd">        otherwise the list of the visible paths in the data browser is returned</span>

<span class="sd">        :return: the list of scans corresponding to the current selection in</span>
<span class="sd">           the data browser</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">return_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activate_selection</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">:</span>
                <span class="n">return_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">return_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scans_to_visualize</span>
        <span class="k">return</span> <span class="n">return_list</span></div>

<div class="viewcode-block" id="TableDataBrowser.get_index_insertion"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.get_index_insertion">[docs]</a>    <span class="k">def</span> <span class="nf">get_index_insertion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_insert</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get index insertion of a new column, since it&#39;s already sorted in</span>
<span class="sd">        alphabetical order.</span>

<span class="sd">        :param to_insert: tag to insert</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">())):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">to_insert</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">column</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()</span></div>

<div class="viewcode-block" id="TableDataBrowser.get_scan_row"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.get_scan_row">[docs]</a>    <span class="k">def</span> <span class="nf">get_scan_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scan</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the row index of the scan.</span>

<span class="sd">        :param scan: scan filename</span>
<span class="sd">        :return: index of the row of the scan</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
        <span class="c1">#for row in range(0, len(self.scans_to_visualize)):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">scan_name</span> <span class="o">==</span> <span class="n">scan</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">row</span></div>

<div class="viewcode-block" id="TableDataBrowser.get_tag_column"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.get_tag_column">[docs]</a>    <span class="k">def</span> <span class="nf">get_tag_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the column index of the tag.</span>

<span class="sd">        :param tag: tag name</span>
<span class="sd">        :return: index of the column of the tag</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
            <span class="n">tag_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">tag_name</span> <span class="o">==</span> <span class="n">tag</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">column</span></div>

<div class="viewcode-block" id="TableDataBrowser.mouseReleaseEvent"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.mouseReleaseEvent">[docs]</a>    <span class="k">def</span> <span class="nf">mouseReleaseEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update table after mouse release.</span>

<span class="sd">        :param e: event</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">TableDataBrowser</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">mouseReleaseEvent</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setMouseTracking</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Coordinates of selected cells stored</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_database_values</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Old database values stored</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_table_values</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Old table values stored</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">types</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List of types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lengths</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List of lengths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scans_list</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List of table scans</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List of table tags</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">():</span>
                <span class="n">column</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
                <span class="n">row</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">])</span>
                <span class="n">tag_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                <span class="n">tag_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span>
                    <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">)</span>
                <span class="n">tag_type</span> <span class="o">=</span> <span class="n">tag_object</span><span class="o">.</span><span class="n">type</span>
                <span class="n">scan_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">tag_name</span> <span class="o">==</span> <span class="n">TAG_BRICKS</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setMouseTracking</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">return</span>

                <span class="c1"># Scan and tag added</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scans_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_name</span><span class="p">)</span>

                <span class="c1"># Type checked</span>
                <span class="k">if</span> <span class="n">tag_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag_type</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">tag_type</span> <span class="ow">in</span> <span class="n">LIST_TYPES</span><span class="p">:</span>

                    <span class="n">database_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                        <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">old_database_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">database_value</span><span class="p">)</span>

                    <span class="n">table_value</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">EditRole</span><span class="p">)</span>
                    <span class="n">table_value</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">table_value</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">old_table_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table_value</span><span class="p">)</span>

                    <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">database_value</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">size</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lengths</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setMouseTracking</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">return</span>

            <span class="c1"># Error if lists of different lengths</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lengths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Incompatible list lengths&quot;</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setInformativeText</span><span class="p">(</span><span class="s2">&quot;The lists can&#39;t have several lengths&quot;</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Warning&quot;</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

            <span class="c1"># Ok</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">old_table_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                        <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_table_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="c1"># Window to change list values displayed</span>
                <span class="n">pop_up</span> <span class="o">=</span> <span class="n">ModifyTable</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scans_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span>
                <span class="n">pop_up</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">pop_up</span><span class="o">.</span><span class="n">exec_</span><span class="p">():</span>
                    <span class="k">pass</span>

                <span class="c1"># For history</span>
                <span class="n">history_maker</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">history_maker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;modified_values&quot;</span><span class="p">)</span>
                <span class="n">modified_values</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

                <span class="c1"># Lists updated</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)):</span>
                    <span class="n">new_item</span> <span class="o">=</span> <span class="n">QTableWidgetItem</span><span class="p">()</span>
                    <span class="n">old_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_database_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">new_cur_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                        <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scans_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">modified_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">scans_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                         <span class="n">old_value</span><span class="p">,</span> <span class="n">new_cur_value</span><span class="p">])</span>
                    <span class="n">set_item_data</span><span class="p">(</span>
                        <span class="n">new_item</span><span class="p">,</span> <span class="n">new_cur_value</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span>
                            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">new_item</span><span class="p">)</span>

                <span class="c1"># For history</span>
                <span class="n">history_maker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modified_values</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">undos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">history_maker</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">redos</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">update_colors</span><span class="p">()</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_cell_color</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">setMouseTracking</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span>  <span class="c1"># Columns re-sized</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setMouseTracking</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="TableDataBrowser.multiple_sort_infos"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.multiple_sort_infos">[docs]</a>    <span class="k">def</span> <span class="nf">multiple_sort_infos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_tags</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sort the table according to the tags specify in list_tags.</span>

<span class="sd">        :param list_tags: list of the tags on which to sort the documents</span>
<span class="sd">        :param order: &quot;Ascending&quot; or &quot;Descending&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

        <span class="n">list_tags_name</span> <span class="o">=</span> <span class="n">list_tags</span>
        <span class="n">list_tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">tag_name</span> <span class="ow">in</span> <span class="n">list_tags_name</span><span class="p">:</span>
            <span class="n">list_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">))</span>
        <span class="n">list_sort</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scans_to_visualize</span><span class="p">:</span>
            <span class="n">tags_value</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">list_tags</span><span class="p">:</span>
                <span class="n">current_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                    <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="n">tag</span><span class="o">.</span><span class="n">field_name</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">current_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">tags_value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tags_value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">not_defined_value</span><span class="p">)</span>
            <span class="n">list_sort</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tags_value</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">order</span> <span class="o">==</span> <span class="s2">&quot;Descending&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scans_to_visualize</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span>
                <span class="n">list_sort</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scans_to_visualize</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scans_to_visualize</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span>
                <span class="n">list_sort</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scans_to_visualize</span><span class="p">))]</span>

        <span class="c1"># Table updated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSortingEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scans_to_visualize</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
            <span class="n">old_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scan_row</span><span class="p">(</span><span class="n">scan</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">old_row</span> <span class="o">!=</span> <span class="n">row</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()):</span>
                    <span class="n">item_to_move</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">takeItem</span><span class="p">(</span><span class="n">old_row</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span>
                    <span class="n">item_wrong_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">takeItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">item_to_move</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">old_row</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">item_wrong_row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_cell_color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">setSortIndicator</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSortingEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_cell_color</span><span class="p">)</span></div>

<div class="viewcode-block" id="TableDataBrowser.multiple_sort_pop_up"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.multiple_sort_pop_up">[docs]</a>    <span class="k">def</span> <span class="nf">multiple_sort_pop_up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Display the multiple sort pop-up.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_up</span> <span class="o">=</span> <span class="n">PopUpMultipleSort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_up</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="TableDataBrowser.remove_scan"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.remove_scan">[docs]</a>    <span class="k">def</span> <span class="nf">remove_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove documents from table and project.&quot;&quot;&quot;</span>

        <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndexes</span><span class="p">()</span>

        <span class="n">history_maker</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">history_maker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;remove_scans&quot;</span><span class="p">)</span>
        <span class="n">scans_removed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">values_removed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="n">scan_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="n">scan_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_document</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_path</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">scan_object</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">scans_removed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_object</span><span class="p">)</span>

                <span class="c1"># Adding removed values to history</span>
                <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                        <span class="n">COLLECTION_CURRENT</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">tag</span> <span class="o">!=</span> <span class="n">TAG_FILENAME</span><span class="p">:</span>
                        <span class="n">current_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_path</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
                        <span class="n">initial_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                            <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">scan_path</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">current_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> \
                                <span class="ow">or</span> <span class="n">initial_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">values_removed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="p">[</span><span class="n">scan_path</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">current_value</span><span class="p">,</span> <span class="n">initial_value</span><span class="p">])</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">scans_to_visualize</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">scan_path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">remove_document</span><span class="p">(</span>
                    <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">remove_document</span><span class="p">(</span>
                    <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">scan_path</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="n">scans_removed</span><span class="p">:</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="n">TAG_FILENAME</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">removeRow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_scan_row</span><span class="p">(</span><span class="n">scan_name</span><span class="p">))</span>

        <span class="n">history_maker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scans_removed</span><span class="p">)</span>
        <span class="n">history_maker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values_removed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">undos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">history_maker</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">redos</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span></div>

<div class="viewcode-block" id="TableDataBrowser.reset_cell"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.reset_cell">[docs]</a>    <span class="k">def</span> <span class="nf">reset_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset the selected cells to their original values.&quot;&quot;&quot;</span>

        <span class="c1"># For history</span>
        <span class="n">history_maker</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">history_maker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;modified_values&quot;</span><span class="p">)</span>
        <span class="n">modified_values</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndexes</span><span class="p">()</span>

        <span class="c1"># To know if some values do not have raw values (user tags)</span>
        <span class="n">has_unreset_values</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
            <span class="n">tag_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="c1"># We get the FileName of the scan from the first row</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="n">current_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">)</span>
            <span class="n">initial_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">initial_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                        <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">,</span> <span class="n">initial_value</span><span class="p">)</span>
                    <span class="n">set_item_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">),</span> <span class="n">initial_value</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span>
                                      <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">)</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
                    <span class="c1"># For history</span>
                    <span class="n">modified_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">scan_name</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">,</span> <span class="n">current_value</span><span class="p">,</span> <span class="n">initial_value</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">has_unreset_values</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">has_unreset_values</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># For history</span>
        <span class="n">history_maker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modified_values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">undos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">history_maker</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">redos</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1"># Warning message if unreset values</span>
        <span class="k">if</span> <span class="n">has_unreset_values</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display_unreset_values</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span></div>

<div class="viewcode-block" id="TableDataBrowser.reset_column"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.reset_column">[docs]</a>    <span class="k">def</span> <span class="nf">reset_column</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset the selected columns to their original values.&quot;&quot;&quot;</span>

        <span class="c1"># For history</span>
        <span class="n">history_maker</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">history_maker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;modified_values&quot;</span><span class="p">)</span>
        <span class="n">modified_values</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndexes</span><span class="p">()</span>

        <span class="c1"># To know if some values do not have raw values (user tags)</span>
        <span class="n">has_unreset_values</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
            <span class="n">tag_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">row_iter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scans_to_visualize</span><span class="p">)):</span>
                <span class="c1"># We get the FileName of the scan from the first column</span>
                <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row_iter</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                <span class="n">initial_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                    <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">)</span>
                <span class="n">current_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                    <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">initial_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">,</span> <span class="n">initial_value</span><span class="p">)</span>
                        <span class="n">set_item_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row_iter</span><span class="p">,</span> <span class="n">col</span><span class="p">),</span> <span class="n">initial_value</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span>
                                          <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">)</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
                        <span class="c1"># For history</span>
                        <span class="n">modified_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">scan</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">,</span> <span class="n">current_value</span><span class="p">,</span> <span class="n">initial_value</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">has_unreset_values</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">has_unreset_values</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># For history</span>
        <span class="n">history_maker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modified_values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">undos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">history_maker</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">redos</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1"># Warning message if unreset values</span>
        <span class="k">if</span> <span class="n">has_unreset_values</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display_unreset_values</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span></div>

<div class="viewcode-block" id="TableDataBrowser.reset_row"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.reset_row">[docs]</a>    <span class="k">def</span> <span class="nf">reset_row</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset the selected rows to their original values.&quot;&quot;&quot;</span>

        <span class="c1"># For history</span>
        <span class="n">history_maker</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">history_maker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;modified_values&quot;</span><span class="p">)</span>
        <span class="n">modified_values</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndexes</span><span class="p">()</span>

        <span class="c1"># To know if some values do not have raw values (user tags)</span>
        <span class="n">has_unreset_values</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># For each selected cell</span>
        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="c1"># FileName is always the first column</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">())):</span>
                <span class="c1"># We get the tag name from the header</span>
                <span class="n">tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                <span class="n">current_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                    <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
                <span class="n">initial_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                    <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">initial_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># We reset the value only if it exists</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">initial_value</span><span class="p">)</span>
                        <span class="n">set_item_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">),</span> <span class="n">initial_value</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span>
                                          <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
                        <span class="c1"># For history</span>
                        <span class="n">modified_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">scan_name</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">current_value</span><span class="p">,</span> <span class="n">initial_value</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">has_unreset_values</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">has_unreset_values</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># For history</span>
        <span class="n">history_maker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modified_values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">undos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">history_maker</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">redos</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1"># Warning message if unreset values</span>
        <span class="k">if</span> <span class="n">has_unreset_values</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display_unreset_values</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span></div>

<div class="viewcode-block" id="TableDataBrowser.section_moved"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.section_moved">[docs]</a>    <span class="k">def</span> <span class="nf">section_moved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logical_index</span><span class="p">,</span> <span class="n">old_index</span><span class="p">,</span> <span class="n">new_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the visual index and forbid to move the first column when</span>
<span class="sd">        the user try to move columns.</span>

<span class="sd">        :param logical_index: int of the column logical index</span>
<span class="sd">        :param old_index: int of the column old visual index</span>
<span class="sd">        :param new_index: int of the column new visual index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># The logical index is not used in this method but it is returned by</span>
        <span class="c1"># the event we&#39;re connected to.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

        <span class="c1"># We need to disconnect the sectionMoved signal, otherwise infinite</span>
        <span class="c1"># call to this function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">sectionMoved</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

        <span class="c1"># We have to ensure FileName column stays at index 0</span>
        <span class="k">if</span> <span class="n">old_index</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">new_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># FileName column is moved, to revert because it has to stay the</span>
            <span class="c1"># first column</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">moveSection</span><span class="p">(</span><span class="n">new_index</span><span class="p">,</span> <span class="n">old_index</span><span class="p">)</span>

        <span class="c1"># We reconnect the signal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">sectionMoved</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">section_moved</span><span class="p">)</span>

        <span class="c1"># Selection updated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_selection</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selection_changed</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>

<div class="viewcode-block" id="TableDataBrowser.select_all_column"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.select_all_column">[docs]</a>    <span class="k">def</span> <span class="nf">select_all_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Select all column when the header is double clicked</span>

<span class="sd">        :param col: column to select</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearSelection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectColumn</span><span class="p">(</span><span class="n">col</span><span class="p">)</span></div>

<div class="viewcode-block" id="TableDataBrowser.select_all_columns"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.select_all_columns">[docs]</a>    <span class="k">def</span> <span class="nf">select_all_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Select one or several column(s). Called from the context menu.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSelectionMode</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">MultiSelection</span><span class="p">)</span>
        <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndexes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearSelection</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selectColumn</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSelectionMode</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">ExtendedSelection</span><span class="p">)</span></div>

<div class="viewcode-block" id="TableDataBrowser.selection_changed"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.selection_changed">[docs]</a>    <span class="k">def</span> <span class="nf">selection_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the tab view when the selection changes&quot;&quot;&quot;</span>

        <span class="c1"># List of selected scans updated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">():</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="n">column</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">tag_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">scan_already_in_list</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">scan</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">scan_name</span><span class="p">:</span>
                    <span class="c1"># Scan already in the list, we append the column</span>
                    <span class="n">scan</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag_name</span><span class="p">)</span>
                    <span class="n">scan_already_in_list</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">scan_already_in_list</span><span class="p">:</span>
                <span class="c1"># Scan not in the list, we add it</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">scan_name</span><span class="p">,</span> <span class="p">[</span><span class="n">tag_name</span><span class="p">]])</span>

        <span class="c1"># image_viewer updated</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_viewer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">connect_viewer</span><span class="p">()</span></div>

<div class="viewcode-block" id="TableDataBrowser.show_brick_history"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.show_brick_history">[docs]</a>    <span class="k">def</span> <span class="nf">show_brick_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Show brick history pop-up.&quot;&quot;&quot;</span>

        <span class="n">brick_uuid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bricks</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_brick_popup</span> <span class="o">=</span> <span class="n">PopUpShowBrick</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">brick_uuid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_browser</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_brick_popup</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="TableDataBrowser.sort_column"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.sort_column">[docs]</a>    <span class="k">def</span> <span class="nf">sort_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sort the current column.</span>

<span class="sd">        :param order: order of sort (0 for ascending, 1 for descending)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_cell_color</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">setSortIndicator</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span><span class="o">.</span><span class="n">column</span><span class="p">(),</span> <span class="n">order</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span></div>

<div class="viewcode-block" id="TableDataBrowser.sort_updated"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.sort_updated">[docs]</a>    <span class="k">def</span> <span class="nf">sort_updated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update project and tab parameters after a sort.</span>

<span class="sd">        :param column: index of that was sorted</span>
<span class="sd">        :param order: boolean of the new order</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">column</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">setSortOrder</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">order</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">setSortedTag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sortItems</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">update_colors</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resizeRowsToContents</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_cell_color</span><span class="p">)</span></div>

<div class="viewcode-block" id="TableDataBrowser.update_colors"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.update_colors">[docs]</a>    <span class="k">def</span> <span class="nf">update_colors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the background of all the cells.&quot;&quot;&quot;</span>

        <span class="c1"># itemChanged signal is always disconnected when calling this method</span>

        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isColumnHidden</span><span class="p">(</span><span class="n">column</span><span class="p">):</span>
                <span class="n">tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                <span class="n">row_number</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                        <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

                        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span>

                        <span class="n">color</span> <span class="o">=</span> <span class="n">QColor</span><span class="p">()</span>

                        <span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">row_number</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">color</span><span class="o">.</span><span class="n">setRgb</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>  <span class="c1"># White</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">color</span><span class="o">.</span><span class="n">setRgb</span><span class="p">(</span><span class="mi">230</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">230</span><span class="p">)</span>  <span class="c1"># Grey</span>

                        <span class="c1"># Raw tag</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span>
                                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span><span class="o">.</span><span class="n">origin</span> <span class="o">==</span> \
                                <span class="n">TAG_ORIGIN_BUILTIN</span><span class="p">:</span>
                            <span class="n">current_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
                            <span class="n">initial_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">current_value</span> <span class="o">!=</span> <span class="n">initial_value</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">row_number</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="n">color</span><span class="o">.</span><span class="n">setRgb</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">245</span><span class="p">)</span>  <span class="c1"># Cyan</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">color</span><span class="o">.</span><span class="n">setRgb</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">230</span><span class="p">)</span>  <span class="c1"># Blue</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">row_number</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="n">color</span><span class="o">.</span><span class="n">setRgb</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>  <span class="c1"># White</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">color</span><span class="o">.</span><span class="n">setRgb</span><span class="p">(</span><span class="mi">230</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">230</span><span class="p">)</span>  <span class="c1"># Grey</span>

                        <span class="c1"># User tag</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">row_number</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">color</span><span class="o">.</span><span class="n">setRgb</span><span class="p">(</span><span class="mi">245</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">215</span><span class="p">)</span>  <span class="c1"># Pink</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">color</span><span class="o">.</span><span class="n">setRgb</span><span class="p">(</span><span class="mi">245</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span> <span class="mi">175</span><span class="p">)</span>  <span class="c1"># Red</span>

                        <span class="n">row_number</span> <span class="o">+=</span> <span class="mi">1</span>

                        <span class="n">item</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">BackgroundRole</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QVariant</span><span class="p">(</span><span class="n">color</span><span class="p">))</span>

        <span class="c1"># Auto-save</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">isAutoSave</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">saveModifications</span><span class="p">()</span></div>

<div class="viewcode-block" id="TableDataBrowser.update_selection"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.update_selection">[docs]</a>    <span class="k">def</span> <span class="nf">update_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the selection after a search&quot;&quot;&quot;</span>

        <span class="c1"># Selection updated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearSelection</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">:</span>
            <span class="n">scan_selected</span> <span class="o">=</span> <span class="n">scan</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scan_row</span><span class="p">(</span><span class="n">scan_selected</span><span class="p">)</span>
            <span class="c1"># We select the columns of the row if it was selected</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="n">scan</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tag_column</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
                    <span class="n">item_to_select</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tag_column</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
                    <span class="n">item_to_select</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="TableDataBrowser.update_table"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.update_table">[docs]</a>    <span class="k">def</span> <span class="nf">update_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">take_tags_to_update</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fill the table with the project&#39;s data.</span>
<span class="sd">        Only called when switching project to completely reset the table</span>

<span class="sd">        :param take_tags_to_update: boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setSortingEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clearSelection</span><span class="p">()</span>  <span class="c1"># Selection cleared when switching project</span>

        <span class="c1"># The list of scans to visualize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scans_to_visualize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scans_to_search</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span><span class="p">)</span>

        <span class="c1"># The list of selected scans</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activate_selection</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scans</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scans_to_visualize</span><span class="p">))</span>

        <span class="c1"># Sort visual management</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill_headers</span><span class="p">(</span><span class="n">take_tags_to_update</span><span class="p">)</span>

        <span class="c1"># Cells filled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill_cells_update_table</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

        <span class="c1"># Columns and rows resized</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resizeRowsToContents</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_colors</span><span class="p">()</span>

        <span class="c1"># When the user changes one item of the table, the background</span>
        <span class="c1"># will change</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_cell_color</span><span class="p">)</span></div>

<div class="viewcode-block" id="TableDataBrowser.update_visualized_columns"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.update_visualized_columns">[docs]</a>    <span class="k">def</span> <span class="nf">update_visualized_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_tags</span><span class="p">,</span> <span class="n">showed</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the tags shown in the table.</span>

<span class="sd">        :param old_tags: old list of visualized tags</span>
<span class="sd">        :param showed: list of tags to display</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activate_selection</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

        <span class="c1"># Tags that are not visible anymore are hidden</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">old_tags</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">showed</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setColumnHidden</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_tag_column</span><span class="p">(</span><span class="n">tag</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Tags that became visible must be visible</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">showed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setColumnHidden</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_tag_column</span><span class="p">(</span><span class="n">tag</span><span class="p">),</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Update the list of tags in the advanced search if it&#39;s opened</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_browser</span><span class="p">,</span> <span class="s2">&quot;frame_advanced_search&quot;</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">frame_advanced_search</span><span class="o">.</span><span class="n">isHidden</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">visible_tag</span> <span class="ow">in</span> <span class="n">showed</span><span class="p">:</span>
                    <span class="n">fields</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">visible_tag</span><span class="p">)</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s2">&quot;All visualized tags&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_colors</span><span class="p">()</span>

        <span class="c1"># Selection updated</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activate_selection</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_selection</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selection_changed</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_cell_color</span><span class="p">)</span></div>

<div class="viewcode-block" id="TableDataBrowser.update_visualized_rows"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.update_visualized_rows">[docs]</a>    <span class="k">def</span> <span class="nf">update_visualized_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_scans</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the list of documents (scans) in the table.</span>

<span class="sd">        :param old_scans: old list of scans</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activate_selection</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

        <span class="c1"># Scans that are not visible anymore are hidden</span>
        <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="n">old_scans</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">scan</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scans_to_visualize</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setRowHidden</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_scan_row</span><span class="p">(</span><span class="n">scan</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Scans that became visible must be visible</span>
        <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scans_to_visualize</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setRowHidden</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_scan_row</span><span class="p">(</span><span class="n">scan</span><span class="p">),</span> <span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span>  <span class="c1"># Columns resized</span>

        <span class="c1"># Selection updated</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activate_selection</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_selection</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_colors</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activate_selection</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selection_changed</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_cell_color</span><span class="p">)</span></div>

<div class="viewcode-block" id="TableDataBrowser.visualized_tags_pop_up"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TableDataBrowser.visualized_tags_pop_up">[docs]</a>    <span class="k">def</span> <span class="nf">visualized_tags_pop_up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Display the visualized tags pop-up.&quot;&quot;&quot;</span>

        <span class="c1"># Old list of columns</span>
        <span class="n">old_tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_shown_tags</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_up</span> <span class="o">=</span> <span class="n">PopUpProperties</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_browser</span><span class="p">,</span> <span class="n">old_tags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_up</span><span class="o">.</span><span class="n">tab_widget</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">screen_resolution</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">desktop</span><span class="p">()</span><span class="o">.</span><span class="n">screenGeometry</span><span class="p">()</span>
        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">screen_resolution</span><span class="o">.</span><span class="n">width</span><span class="p">(),</span> <span class="n">screen_resolution</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_up</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_up</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mf">0.8</span> <span class="o">*</span> <span class="n">height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_up</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="TimeFormatDelegate"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TimeFormatDelegate">[docs]</a><span class="k">class</span> <span class="nc">TimeFormatDelegate</span><span class="p">(</span><span class="n">QItemDelegate</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Delegate that is used to handle times in the TableDataBrowser.</span>

<span class="sd">    # TODO : Update params</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="TimeFormatDelegate.__init__"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TimeFormatDelegate.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">QItemDelegate</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span></div>

<div class="viewcode-block" id="TimeFormatDelegate.createEditor"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.data_browser.TimeFormatDelegate.createEditor">[docs]</a>    <span class="k">def</span> <span class="nf">createEditor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">option</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Override of the createEditor method, called to generate the widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">editor</span> <span class="o">=</span> <span class="n">QTimeEdit</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">editor</span><span class="o">.</span><span class="n">setDisplayFormat</span><span class="p">(</span><span class="s2">&quot;hh:mm:ss.zzz&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">editor</span></div></div>

</pre></div>

      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="../../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, populse.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.1.
    </div>
  </body>
</html>