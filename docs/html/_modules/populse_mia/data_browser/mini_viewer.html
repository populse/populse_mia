
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>populse_mia.data_browser.mini_viewer &#8212; populse_mia 1.0.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../../../index.html">
          <span>populse_mia 1.0.0 documentation</span></a></h1>
        <h2 class="heading"><span>populse_mia.data_browser.mini_viewer</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="../../../index.html">Contents</a>
        </p>

      </div>
      <div class="content">
        
        
  <h1>Source code for populse_mia.data_browser.mini_viewer</h1><div class="highlight"><pre>
<span></span><span class="c1">##########################################################################</span>
<span class="c1"># Populse_mia - Copyright (C) IRMaGe/CEA, 2018</span>
<span class="c1"># Distributed under the terms of the CeCILL license, as published by</span>
<span class="c1"># the CEA-CNRS-INRIA. Refer to the LICENSE file or to</span>
<span class="c1"># http://www.cecill.info/licences/Licence_CeCILL_V2.1-en.html</span>
<span class="c1"># for details.</span>
<span class="c1">##########################################################################</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">nibabel</span> <span class="k">as</span> <span class="nn">nib</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="k">import</span> <span class="n">rotate</span>  <span class="c1"># to work with NumPy arrays</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>  <span class="c1"># a N-dimensional array object</span>
<span class="kn">from</span> <span class="nn">skimage.transform</span> <span class="k">import</span> <span class="n">resize</span>
<span class="kn">import</span> <span class="nn">skimage</span> <span class="k">as</span> <span class="nn">sk</span>

<span class="c1"># PyQt5 imports</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="k">import</span> <span class="n">Qt</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="k">import</span> <span class="n">QWidget</span><span class="p">,</span> <span class="n">QVBoxLayout</span><span class="p">,</span> <span class="n">QHBoxLayout</span>
<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="k">import</span> <span class="n">QtCore</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtGui</span> <span class="k">import</span> <span class="n">QImage</span><span class="p">,</span> <span class="n">QPixmap</span><span class="p">,</span> <span class="n">QFont</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="k">import</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QScrollArea</span><span class="p">,</span> <span class="n">QFrame</span><span class="p">,</span> <span class="n">QSlider</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="p">,</span> <span class="n">QCheckBox</span>

<span class="c1"># Populse_MIA imports</span>
<span class="kn">from</span> <span class="nn">populse_mia.utils.tools</span> <span class="k">import</span> <span class="n">ClickableLabel</span>
<span class="kn">from</span> <span class="nn">populse_mia.utils.utils</span> <span class="k">import</span> <span class="n">verCmp</span>
<span class="kn">from</span> <span class="nn">populse_mia.pop_ups.pop_up_select_tag</span> <span class="k">import</span> <span class="n">PopUpSelectTag</span>
<span class="kn">from</span> <span class="nn">populse_mia.software_properties.config</span> <span class="k">import</span> <span class="n">Config</span>
<span class="kn">from</span> <span class="nn">populse_mia.data_browser</span> <span class="k">import</span> <span class="n">data_browser</span>
<span class="kn">from</span> <span class="nn">populse_mia.project.project</span> <span class="k">import</span> <span class="n">COLLECTION_CURRENT</span>


<div class="viewcode-block" id="MiniViewer"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.mini_viewer.MiniViewer">[docs]</a><span class="k">class</span> <span class="nc">MiniViewer</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;MiniViewer that allows to rapidly visualize scans either with a single</span>
<span class="sd">    image per scan with cursors to move in five dimensions or with all images</span>
<span class="sd">    of the greater dimension of the scan.</span>

<span class="sd">    When the latter is selected, the displayed images depends on their</span>
<span class="sd">    dimension:</span>

<span class="sd">        - 3D: display all the slices.</span>
<span class="sd">        - 4D: display the middle slice of the third dimension for each time</span>
<span class="sd">           of the fourth dimension.</span>
<span class="sd">        - 5D: display the middle slice of the third dimension for the first</span>
<span class="sd">           time of the fourth dimension for each time of the fifth dimension.</span>

<span class="sd">    Note:</span>
<span class="sd">        - idx corresponds to the index of the displayed image</span>
<span class="sd">        - idx in [0, self.max_scans]</span>
<span class="sd">        - most of the class&#39;s attributes are lists of 0 to self.max_scans</span>
<span class="sd">           elements</span>

<span class="sd">    Methods:</span>
<span class="sd">        - __init__: initialise the MiniViewer object</span>
<span class="sd">        - boxSlider: create sliders, their connections and thumbnail labels</span>
<span class="sd">          for a selected index</span>
<span class="sd">        - changePosValue: change the value of a cursor for the selected index</span>
<span class="sd">        - check_box_cursors_state_changed: updates the config file</span>
<span class="sd">        - clearLayouts: clear the final layout</span>
<span class="sd">        - create_slider: create a slider</span>
<span class="sd">        - createDimensionLabels: create the dimension labels for the</span>
<span class="sd">          selected index</span>
<span class="sd">        - createFieldValue: create a field where will be displayed the</span>
<span class="sd">          position of a cursor</span>
<span class="sd">        - createLayouts: create the layouts</span>
<span class="sd">        - displayPosValue: display the position of each cursor for the</span>
<span class="sd">          selected index</span>
<span class="sd">        - enableSliders: enable each slider of the selected index</span>
<span class="sd">        - image_to_pixmap: create a 2D pixmap from a N-D Nifti image</span>
<span class="sd">        - image2DModifications: apply modifications to the image to</span>
<span class="sd">          display it correctly</span>
<span class="sd">        - indexImage: update the sliders values depending on the size of</span>
<span class="sd">          the selected image</span>
<span class="sd">        - navigImage: display the 2D image for the selected index</span>
<span class="sd">        - openTagsPopUp: opens a pop-up to select the legend of the thumbnails</span>
<span class="sd">        - setThumbnail: set the thumbnail tag value under the image frame</span>
<span class="sd">        - show_slices: create the thumbnails from the selected file paths</span>
<span class="sd">        - update_nb_slices: update the config file and the thumbnails</span>
<span class="sd">        - update_visualization_method: update the config file and the</span>
<span class="sd">          thumbnails</span>
<span class="sd">        - verify_slices: verify the number of selected documents</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MiniViewer.__init__"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.mini_viewer.MiniViewer.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialise the MiniViewer object</span>

<span class="sd">        :param project: current project in the software</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first_time</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># The MiniViewer is set hidden to give more space to the data_browser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setHidden</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># When multiple selection, limiting the number of thumbnails to</span>
        <span class="c1"># max_scans</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_scans</span> <span class="o">=</span> <span class="mi">4</span>

        <span class="c1"># Config that allows to read the software preferences</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

        <span class="c1"># Initializing some components of the MiniViewer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span> <span class="o">=</span> <span class="n">QScrollArea</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_final</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_nb_slices</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_nb_slices</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Maximum number of slices: &quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_nb_slices</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_nb_slices</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getNbAllSlicesMax</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_nb_slices</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_nb_slices</span><span class="p">)</span>

        <span class="c1"># All these objects are depending on the number of scans to visualize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_3D</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_4D</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_5D</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txt_slider_3D</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txt_slider_4D</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txt_slider_5D</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label3D</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label4D</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label5D</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imageLabel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_description</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Layouts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createLayouts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_box_final</span><span class="p">)</span>

        <span class="c1"># Checkboxes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_box_slices</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="s1">&#39;Show all slices (no cursors)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getShowAllSlices</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_box_slices</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_box_slices</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_box_slices</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_visualization_method</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check_box_cursors</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="s1">&#39;Chain cursors&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_box_cursors</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Allows to connect all cursors &quot;</span>
                                          <span class="s2">&quot;when selecting multiple documents&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getChainCursors</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_box_cursors</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_box_cursors</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_box_cursors</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_box_cursors_state_changed</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span></div>

<div class="viewcode-block" id="MiniViewer.boxSlider"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.mini_viewer.MiniViewer.boxSlider">[docs]</a>    <span class="k">def</span> <span class="nf">boxSlider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Define horizontal sliders connections and thumbnail labels.</span>

<span class="sd">        :param idx: the selected index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_3D</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_slider</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_4D</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_slider</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_5D</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_slider</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">slider_3D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changePosValue</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_4D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changePosValue</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_5D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changePosValue</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">txt_slider_3D</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">createFieldValue</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txt_slider_4D</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">createFieldValue</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txt_slider_5D</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">createFieldValue</span><span class="p">())</span></div>

<div class="viewcode-block" id="MiniViewer.check_box_cursors_state_changed"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.mini_viewer.MiniViewer.check_box_cursors_state_changed">[docs]</a>    <span class="k">def</span> <span class="nf">check_box_cursors_state_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the config file.</span>

<span class="sd">        Called when the state of the checkbox to chain the cursors changes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_box_cursors</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setChainCursors</span><span class="p">(</span><span class="s1">&#39;yes&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_box_cursors</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setChainCursors</span><span class="p">(</span><span class="s1">&#39;no&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MiniViewer.clearLayouts"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.mini_viewer.MiniViewer.clearLayouts">[docs]</a>    <span class="k">def</span> <span class="nf">clearLayouts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear the final layout&quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_box_final</span><span class="o">.</span><span class="n">count</span><span class="p">())):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_box_final</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">v_box_final</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="MiniViewer.changePosValue"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.mini_viewer.MiniViewer.changePosValue">[docs]</a>    <span class="k">def</span> <span class="nf">changePosValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">cursor_to_change</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change the value of a cursor for the selected index.</span>

<span class="sd">        :param idx: the selected index</span>
<span class="sd">        :param cursor_to_change: the cursor to change (1, 2 or 3)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If the &quot;Chain cursors&quot; mode is not selected, there is nothing to do</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_box_cursors</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">navigImage</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Checking with cursor has been modified</span>
            <span class="k">if</span> <span class="n">cursor_to_change</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slider_3D</span>
            <span class="k">elif</span> <span class="n">cursor_to_change</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slider_4D</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slider_5D</span>

            <span class="c1"># Loop on the thumbnails</span>
            <span class="k">for</span> <span class="n">idx_loop</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_scans</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="p">))):</span>
                <span class="c1"># Disconnecting the connection when changing other cursors values</span>
                <span class="n">cursor</span><span class="p">[</span><span class="n">idx_loop</span><span class="p">]</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
                <span class="c1"># Do something only when the cursor is not the one that has been changed by the user</span>
                <span class="k">if</span> <span class="n">idx_loop</span> <span class="o">!=</span> <span class="n">idx</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cursor</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">==</span> <span class="n">cursor</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">maximum</span><span class="p">():</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">cursor</span><span class="p">[</span><span class="n">idx_loop</span><span class="p">]</span><span class="o">.</span><span class="n">maximum</span><span class="p">()</span>

                    <span class="k">elif</span> <span class="n">cursor</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">==</span> <span class="n">cursor</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">minimum</span><span class="p">():</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">cursor</span><span class="p">[</span><span class="n">idx_loop</span><span class="p">]</span><span class="o">.</span><span class="n">minimum</span><span class="p">()</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Updating the new value as the value of the cursor that has been changed by the user</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">cursor</span><span class="p">[</span><span class="n">idx_loop</span><span class="p">]</span><span class="o">.</span><span class="n">maximum</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">cursor</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span>
                                      <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cursor</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">maximum</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">cursor</span><span class="p">[</span><span class="n">idx_loop</span><span class="p">]</span><span class="o">.</span><span class="n">maximum</span><span class="p">(),</span> <span class="n">value</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                    <span class="n">cursor</span><span class="p">[</span><span class="n">idx_loop</span><span class="p">]</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

                <span class="c1"># Changing the image to show</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">navigImage</span><span class="p">(</span><span class="n">idx_loop</span><span class="p">)</span>
                <span class="c1"># Reconnecting</span>
                <span class="n">cursor</span><span class="p">[</span><span class="n">idx_loop</span><span class="p">]</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changePosValue</span><span class="p">,</span> <span class="n">idx_loop</span><span class="p">,</span> <span class="n">cursor_to_change</span><span class="p">))</span></div>

<div class="viewcode-block" id="MiniViewer.createDimensionLabels"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.mini_viewer.MiniViewer.createDimensionLabels">[docs]</a>    <span class="k">def</span> <span class="nf">createDimensionLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create the dimension labels for the selected index.</span>

<span class="sd">        :param idx: the selected index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">font</span> <span class="o">=</span> <span class="n">QFont</span><span class="p">()</span>
        <span class="n">font</span><span class="o">.</span><span class="n">setPointSize</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label3D</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label4D</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label5D</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label3D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label4D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label5D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label3D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;3D: &#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label4D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;4D: &#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label5D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;5D: &#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MiniViewer.createFieldValue"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.mini_viewer.MiniViewer.createFieldValue">[docs]</a>    <span class="k">def</span> <span class="nf">createFieldValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a field where will be displayed the position of a cursor.</span>

<span class="sd">        :return: the corresponding field</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fieldValue</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
        <span class="n">fieldValue</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">fieldValue</span><span class="o">.</span><span class="n">setFixedWidth</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">fieldValue</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
        <span class="n">fieldValue</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
        <span class="n">font</span> <span class="o">=</span> <span class="n">QFont</span><span class="p">()</span>
        <span class="n">font</span><span class="o">.</span><span class="n">setPointSize</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
        <span class="n">fieldValue</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fieldValue</span></div>

<div class="viewcode-block" id="MiniViewer.createLayouts"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.mini_viewer.MiniViewer.createLayouts">[docs]</a>    <span class="k">def</span> <span class="nf">createLayouts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create the layouts.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">h_box_images</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_box_images</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_box</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_box_final</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_3D</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_4D</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_5D</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_box_sliders</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_box</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_box_check_box</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_box_thumb</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_box_thumb</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span></div>

<div class="viewcode-block" id="MiniViewer.create_slider"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.mini_viewer.MiniViewer.create_slider">[docs]</a>    <span class="k">def</span> <span class="nf">create_slider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxm</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minm</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate an horizontal slider.</span>

<span class="sd">        :param maxm: slider&#39;s maximum</span>
<span class="sd">        :param minm: slider&#39;s minimum</span>
<span class="sd">        :param pos: slider&#39;s initial value</span>
<span class="sd">        :return: the slider object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">slider</span> <span class="o">=</span> <span class="n">QSlider</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span>
        <span class="n">slider</span><span class="o">.</span><span class="n">setFocusPolicy</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">StrongFocus</span><span class="p">)</span>
        <span class="n">slider</span><span class="o">.</span><span class="n">setTickInterval</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">slider</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="n">maxm</span><span class="p">)</span>
        <span class="n">slider</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="n">minm</span><span class="p">)</span>
        <span class="n">slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="n">slider</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">slider</span></div>

<div class="viewcode-block" id="MiniViewer.displayPosValue"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.mini_viewer.MiniViewer.displayPosValue">[docs]</a>    <span class="k">def</span> <span class="nf">displayPosValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Display the position of each cursor for the selected index.</span>

<span class="sd">        :param idx: the selected index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txt_slider_3D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slider_3D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; / &#39;</span> <span class="o">+</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slider_3D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">maximum</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txt_slider_4D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slider_4D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; / &#39;</span> <span class="o">+</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slider_4D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">maximum</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txt_slider_5D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slider_5D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; / &#39;</span> <span class="o">+</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slider_5D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">maximum</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span></div>

<div class="viewcode-block" id="MiniViewer.enableSliders"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.mini_viewer.MiniViewer.enableSliders">[docs]</a>    <span class="k">def</span> <span class="nf">enableSliders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enable all the horizontal slider.</span>

<span class="sd">        :param idx: the slider&#39;s index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_3D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_4D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_5D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="MiniViewer.image_to_pixmap"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.mini_viewer.MiniViewer.image_to_pixmap">[docs]</a>    <span class="k">def</span> <span class="nf">image_to_pixmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">im</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a 2D pixmap from a N-D Nifti image.</span>

<span class="sd">        :param im: Nifti image</span>
<span class="sd">        :param i: index of the slide</span>
<span class="sd">        :return: the corresponding pixmap</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># The image to display depends on the dimension of the image</span>
        <span class="c1"># In the 3D case, each slice is displayed</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">im_2D</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># In the 4D case, each middle slice of the 3D dimension is displayed</span>
        <span class="c1"># for each time in the 4D dimension</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">im_3D</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">middle_slice</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_3D</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">im_2D</span> <span class="o">=</span> <span class="n">im_3D</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">middle_slice</span><span class="p">]</span>

        <span class="c1"># In the 5D case, each first time of the 4D dimension and</span>
        <span class="c1"># its middle slice of the 3D dimension is displayed</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">im_4D</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">im_3D</span> <span class="o">=</span> <span class="n">im_4D</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">middle_slice</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_3D</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">im_2D</span> <span class="o">=</span> <span class="n">im_3D</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">middle_slice</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">im_2D</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Making some pixel modification to display the image correctly</span>
        <span class="n">im_2D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image2DModifications</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">im_2D</span><span class="p">)</span>

        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">im_2D</span><span class="o">.</span><span class="n">shape</span>

        <span class="n">im_Qt</span> <span class="o">=</span> <span class="n">QImage</span><span class="p">(</span><span class="n">im_2D</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">QImage</span><span class="o">.</span><span class="n">Format_Indexed8</span><span class="p">)</span>
        <span class="n">pixm</span> <span class="o">=</span> <span class="n">QPixmap</span><span class="o">.</span><span class="n">fromImage</span><span class="p">(</span><span class="n">im_Qt</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pixm</span></div>

<div class="viewcode-block" id="MiniViewer.image2DModifications"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.mini_viewer.MiniViewer.image2DModifications">[docs]</a>    <span class="k">def</span> <span class="nf">image2DModifications</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">im2D</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Apply modifications to display the image correctly.</span>

<span class="sd">        :param idx: the selected index</span>
<span class="sd">        :param im2D: image to modify</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">im2D</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">im2D</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">im2D</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">reshape</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">im2D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">((</span><span class="n">im2D</span> <span class="o">-</span> <span class="n">im2D</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="n">im2D</span><span class="o">.</span><span class="n">ptp</span><span class="p">()</span> <span class="o">*</span> <span class="mf">255.0</span><span class="p">)</span>

            <span class="c1"># anti_aliasing keyword is defined in skimage since version 0.14.0</span>
            <span class="k">if</span> <span class="n">verCmp</span><span class="p">(</span><span class="n">sk</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span> <span class="s1">&#39;0.14.0&#39;</span><span class="p">,</span> <span class="s1">&#39;sup&#39;</span><span class="p">):</span>
                <span class="n">im2D</span> <span class="o">=</span> <span class="n">resize</span><span class="p">(</span><span class="n">im2D</span><span class="p">,</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span>
                              <span class="n">anti_aliasing</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">im2D</span> <span class="o">=</span> <span class="n">resize</span><span class="p">(</span><span class="n">im2D</span><span class="p">,</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">)</span>

            <span class="n">im2D</span> <span class="o">=</span> <span class="p">(</span><span class="n">im2D</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">im2D</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">reshape</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
                <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">ptp</span><span class="p">()</span> <span class="o">*</span> <span class="mf">255.0</span><span class="p">)</span>

            <span class="c1"># anti_aliasing keyword is defined in skimage since version 0.14.0</span>
            <span class="k">if</span> <span class="n">verCmp</span><span class="p">(</span><span class="n">sk</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span> <span class="s1">&#39;0.14.0&#39;</span><span class="p">,</span> <span class="s1">&#39;sup&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">resize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span>
                                         <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span>
                                         <span class="n">anti_aliasing</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">resize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span>
                                         <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span></div>

<div class="viewcode-block" id="MiniViewer.indexImage"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.mini_viewer.MiniViewer.indexImage">[docs]</a>    <span class="k">def</span> <span class="nf">indexImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update all slider values according to the size of the current image.</span>

<span class="sd">        :param idx: the selected index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Getting the sliders value</span>
        <span class="n">sl3D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slider_3D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">sl4D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slider_4D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">sl5D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slider_5D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

        <span class="c1"># Depending on the dimension, reading the image data and</span>
        <span class="c1"># changing the cursors maximum</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[:,</span> <span class="p">:,</span> <span class="n">sl3D</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider_3D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider_4D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider_5D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[:,</span> <span class="p">:,</span> <span class="n">sl3D</span><span class="p">,</span> <span class="n">sl4D</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider_3D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider_4D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider_5D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[:,</span> <span class="p">:,</span> <span class="n">sl3D</span><span class="p">,</span> <span class="n">sl4D</span><span class="p">,</span> <span class="n">sl5D</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider_3D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider_4D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider_5D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="MiniViewer.navigImage"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.mini_viewer.MiniViewer.navigImage">[docs]</a>    <span class="k">def</span> <span class="nf">navigImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Display the 2D image for the selected index.</span>

<span class="sd">        :param idx: the selected index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indexImage</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displayPosValue</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image2DModifications</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>

        <span class="n">image</span> <span class="o">=</span> <span class="n">QImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">QImage</span><span class="o">.</span><span class="n">Format_Indexed8</span><span class="p">)</span>
        <span class="n">pixm</span> <span class="o">=</span> <span class="n">QPixmap</span><span class="o">.</span><span class="n">fromImage</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imageLabel</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="n">pixm</span><span class="p">)</span></div>

<div class="viewcode-block" id="MiniViewer.openTagsPopUp"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.mini_viewer.MiniViewer.openTagsPopUp">[docs]</a>    <span class="k">def</span> <span class="nf">openTagsPopUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open a pop-up to select the legend of the thumbnails.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">popUp</span> <span class="o">=</span> <span class="n">PopUpSelectTag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">popUp</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Select the image viewer tag&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">popUp</span><span class="o">.</span><span class="n">exec_</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verify_slices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="p">)</span></div>

<div class="viewcode-block" id="MiniViewer.setThumbnail"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.mini_viewer.MiniViewer.setThumbnail">[docs]</a>    <span class="k">def</span> <span class="nf">setThumbnail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path_base_name</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the thumbnail tag value under the image frame.</span>

<span class="sd">        :param file_path_base_name: basename of the selected path</span>
<span class="sd">        :param idx: index of the image</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Looking for the tag value to display as a legend of the thumbnail</span>
        <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">scan</span> <span class="o">==</span> <span class="n">file_path_base_name</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                    <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getThumbnailTag</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">label_description</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)[:</span><span class="bp">self</span><span class="o">.</span><span class="n">nb_char_max</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">label_description</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                        <span class="n">data_browser</span><span class="o">.</span><span class="n">not_defined_value</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">nb_char_max</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label_description</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getThumbnailTag</span><span class="p">()))</span></div>

<div class="viewcode-block" id="MiniViewer.show_slices"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.mini_viewer.MiniViewer.show_slices">[docs]</a>    <span class="k">def</span> <span class="nf">show_slices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_paths</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates the thumbnails from the selected file paths.</span>

<span class="sd">        :param file_paths: the selected file paths</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># If it&#39;s the first time that this function is called, the MiniViewer</span>
        <span class="c1"># has to be shown</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_time</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setHidden</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_time</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># If the user has willingly hidden the MiniViewer, the Processes are</span>
        <span class="c1"># not made</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isHidden</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_nothing</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span> <span class="o">=</span> <span class="n">file_paths</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_scans</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">220</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">clearLayouts</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame_final</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="c1"># Limiting the legend of the thumbnails</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nb_char_max</span> <span class="o">=</span> <span class="mi">60</span>

            <span class="n">font</span> <span class="o">=</span> <span class="n">QFont</span><span class="p">()</span>
            <span class="n">font</span><span class="o">.</span><span class="n">setPointSize</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>

            <span class="c1"># Reading the images from the file paths</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="o">.</span><span class="n">copy</span><span class="p">()):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
                <span class="k">except</span> <span class="n">nib</span><span class="o">.</span><span class="n">filebasedimages</span><span class="o">.</span><span class="n">ImageFileError</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error while trying to display the image &quot;</span> <span class="o">+</span> <span class="n">file_path</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File &quot;</span> <span class="o">+</span> <span class="n">file_path</span> <span class="o">+</span> <span class="s2">&quot; not existing&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

            <span class="c1"># If we are in the &quot;cursors&quot; display mode</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_box_slices</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">:</span>

                <span class="c1"># Layout to aligne each thumbnail (image + cursors)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">h_box_thumb</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>

                <span class="c1"># idx represents the index of the selected image</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_scans</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="p">))):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_nothing</span><span class="p">[</span><span class="n">idx</span><span class="p">]:</span>

                        <span class="c1"># Creating sliders and labels</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">boxSlider</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">enableSliders</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">createDimensionLabels</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

                        <span class="c1"># Getting the sliders value and reading the image data</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">indexImage</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

                        <span class="c1"># Making some pixel modification to display the image</span>
                        <span class="c1"># correctly</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">image2DModifications</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">displayPosValue</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

                    <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>

                    <span class="n">im_Qt</span> <span class="o">=</span> <span class="n">QImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span>
                                   <span class="n">QImage</span><span class="o">.</span><span class="n">Format_Indexed8</span><span class="p">)</span>
                    <span class="n">pixm</span> <span class="o">=</span> <span class="n">QPixmap</span><span class="o">.</span><span class="n">fromImage</span><span class="p">(</span><span class="n">im_Qt</span><span class="p">)</span>

                    <span class="n">file_path_base_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

                    <span class="c1"># imageLabel is the label where the image is displayed</span>
                    <span class="c1"># (as a pixmap)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">imageLabel</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">imageLabel</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="n">pixm</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">imageLabel</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="n">file_path_base_name</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">label_description</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">ClickableLabel</span><span class="p">())</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">label_description</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">label_description</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">openTagsPopUp</span><span class="p">)</span>

                    <span class="c1"># Looking for the tag value to display as a</span>
                    <span class="c1"># legend of the thumbnail</span>
                    <span class="n">file_path_base_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setThumbnail</span><span class="p">(</span><span class="n">file_path_base_name</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>

                    <span class="c1"># Layout that corresponds to the 3D dimension</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_3D</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_3D</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label3D</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_3D</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">txt_slider_3D</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_3D</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slider_3D</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

                    <span class="c1"># Layout that corresponds to the 4D dimension</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_4D</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_4D</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label4D</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_4D</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">txt_slider_4D</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_4D</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slider_4D</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

                    <span class="c1"># Layout that corresponds to the 5D dimension</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_5D</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_5D</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label5D</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_5D</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">txt_slider_5D</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_5D</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slider_5D</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

                    <span class="c1"># Layout for the three sliders</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">v_box_sliders</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">v_box_sliders</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_3D</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">v_box_sliders</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_4D</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">v_box_sliders</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_5D</span><span class="p">)</span>

                    <span class="c1"># Layout that corresponds to the image + the sliders</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imageLabel</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_box_sliders</span><span class="p">)</span>

                    <span class="c1"># Layout that corresponds to the image and sliders +</span>
                    <span class="c1"># the description</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">v_box_thumb</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">v_box_thumb</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_box</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">v_box_thumb</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_description</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

                    <span class="c1"># Layout that will contain all the thumbnails</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box_thumb</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_box_thumb</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_box_thumb</span><span class="p">)</span>

            <span class="c1"># If we are in the &quot;all slices&quot; display mode</span>
            <span class="k">else</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">h_box_images</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">h_box_images</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">v_box_scans</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>

                <span class="c1"># idx represents the index of the selected image</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="p">)):</span>
                    <span class="n">file_path_base_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">label_description</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">ClickableLabel</span><span class="p">())</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">label_description</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">label_description</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">openTagsPopUp</span><span class="p">)</span>

                    <span class="c1"># Looking for the tag value to display as a legend</span>
                    <span class="c1"># of the thumbnail</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setThumbnail</span><span class="p">(</span><span class="n">file_path_base_name</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>

                    <span class="c1"># Depending of the dimension of the image,</span>
                    <span class="c1"># the legend of each image and the number of images to</span>
                    <span class="c1"># display will change</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_nothing</span><span class="p">[</span><span class="n">idx</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                            <span class="n">nb_slices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                            <span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;Slice n°&quot;</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                            <span class="n">nb_slices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                            <span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;Time n°&quot;</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                            <span class="n">nb_slices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                            <span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;Study n°&quot;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">nb_slices</span> <span class="o">=</span> <span class="mi">0</span>

                        <span class="c1"># Limiting the number of images to the number</span>
                        <span class="c1"># chosen by the user</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">nb_slices</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_nb_slices</span><span class="o">.</span><span class="n">text</span><span class="p">()))):</span>
                            <span class="n">pixm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_to_pixmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">i</span><span class="p">)</span>

                            <span class="bp">self</span><span class="o">.</span><span class="n">v_box</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>

                            <span class="c1"># label corresponds to the label where one image</span>
                            <span class="c1"># is displayed</span>
                            <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                            <span class="n">label</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="n">pixm</span><span class="p">)</span>
                            <span class="n">label</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">]))</span>

                            <span class="c1"># Legend of the image (depends on the number</span>
                            <span class="c1"># of dimensions)</span>
                            <span class="n">label_info</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">()</span>
                            <span class="n">label_info</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
                            <span class="n">label_info</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">txt</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                            <span class="n">label_info</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>

                            <span class="bp">self</span><span class="o">.</span><span class="n">v_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">v_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">label_info</span><span class="p">)</span>

                            <span class="c1"># This layout allows to chain each image</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">h_box_images</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_box</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">v_box_scans</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_box_images</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">v_box_scans</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_description</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_box_scans</span><span class="p">)</span>

            <span class="c1"># Adding a scroll area if the thumbnails are too large</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span> <span class="o">=</span> <span class="n">QScrollArea</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">h_box_check_box</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_box_slices</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">h_box_check_box</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label_nb_slices</span><span class="o">.</span><span class="n">setHidden</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_nb_slices</span><span class="o">.</span><span class="n">setHidden</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">h_box_check_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_nb_slices</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">h_box_check_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_edit_nb_slices</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_box_cursors</span><span class="o">.</span><span class="n">setHidden</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_box_cursors</span><span class="o">.</span><span class="n">setHidden</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">h_box_check_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_box_cursors</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">h_box_check_box</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label_nb_slices</span><span class="o">.</span><span class="n">setHidden</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_nb_slices</span><span class="o">.</span><span class="n">setHidden</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">h_box_check_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_box_slices</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">v_box_final</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_box_check_box</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v_box_final</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span><span class="p">)</span></div>

<div class="viewcode-block" id="MiniViewer.update_nb_slices"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.mini_viewer.MiniViewer.update_nb_slices">[docs]</a>    <span class="k">def</span> <span class="nf">update_nb_slices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the config file and the thumbnails.</span>

<span class="sd">        Called when the number of slices to visualize changes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nb_slices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_nb_slices</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setNbAllSlicesMax</span><span class="p">(</span><span class="n">nb_slices</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_slices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="p">)</span></div>

<div class="viewcode-block" id="MiniViewer.update_visualization_method"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.mini_viewer.MiniViewer.update_visualization_method">[docs]</a>    <span class="k">def</span> <span class="nf">update_visualization_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the config file and the thumbnails.</span>

<span class="sd">        Called when the state of the checkbox to show all slices changes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_box_slices</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setShowAllSlices</span><span class="p">(</span><span class="s1">&#39;yes&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_box_slices</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setShowAllSlices</span><span class="p">(</span><span class="s1">&#39;no&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_slices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="p">)</span></div>

<div class="viewcode-block" id="MiniViewer.verify_slices"><a class="viewcode-back" href="../../../populse_mia.data_browser.html#populse_mia.data_browser.mini_viewer.MiniViewer.verify_slices">[docs]</a>    <span class="k">def</span> <span class="nf">verify_slices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_paths</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make &#39;Show all slices&#39; checkbox unclickable if len(file_paths) &gt; 1.</span>

<span class="sd">        :param file_paths: the selected documents</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Updating the config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setShowAllSlices</span><span class="p">(</span><span class="s1">&#39;no&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_box_slices</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_box_slices</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_box_slices</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_slices</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span></div></div>

    <span class="c1"># def check_differences(self, file_paths):</span>
    <span class="c1">#     old_to_new = []</span>
    <span class="c1">#     self.do_nothing = [False, False, False]</span>
    <span class="c1">#     for idx_old, file_path in enumerate(self.file_paths):</span>
    <span class="c1">#         if file_path in file_paths:</span>
    <span class="c1">#             idx_new = file_paths.index(file_path)</span>
    <span class="c1">#             old_to_new.append((idx_old, idx_new))</span>
    <span class="c1">#             #if idx_new == idx_old:</span>
    <span class="c1">#             self.do_nothing[idx_new] = True</span>
    <span class="c1">#</span>
    <span class="c1">#     for tp in old_to_new:</span>
    <span class="c1">#         idx_old = tp[0]</span>
    <span class="c1">#         idx_new = tp[1]</span>
    <span class="c1">#         self.shift_thumbnail(idx_old, idx_new)</span>
    <span class="c1">#</span>
    <span class="c1"># def shift_thumbnail(self, idx_old, idx_new):</span>
    <span class="c1">#</span>
    <span class="c1">#     self.im_2D[idx_new] = self.im_2D[idx_old]</span>
    <span class="c1">#</span>
    <span class="c1">#     self.slider_3D[idx_new].setMaximum(self.slider_3D[idx_old].maximum())</span>
    <span class="c1">#     self.slider_4D[idx_new].setMaximum(self.slider_4D[idx_old].maximum())</span>
    <span class="c1">#     self.slider_5D[idx_new].setMaximum(self.slider_5D[idx_old].maximum())</span>
    <span class="c1">#</span>
    <span class="c1">#     self.slider_3D[idx_new].setValue(self.slider_3D[idx_old].value())</span>
    <span class="c1">#     self.slider_4D[idx_new].setValue(self.slider_4D[idx_old].value())</span>
    <span class="c1">#     self.slider_5D[idx_new].setValue(self.slider_5D[idx_old].value())&quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1"># def clear_layout(self, layout):</span>
    <span class="c1">#     while layout.count() &gt; 0:</span>
    <span class="c1">#         item = layout.takeAt(0)</span>
    <span class="c1">#         if not item:</span>
    <span class="c1">#             continue</span>
    <span class="c1">#</span>
    <span class="c1">#         w = item.widget()</span>
    <span class="c1">#         if w:</span>
    <span class="c1">#             w.deleteLater()&quot;&quot;&quot;</span>

</pre></div>

      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="../../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, populse.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.1.
    </div>
  </body>
</html>