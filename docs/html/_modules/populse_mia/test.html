
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>populse_mia.test &#8212; populse_mia 2.2.1-dev+8b928176 documentation</title>
    <link rel="stylesheet" href="../../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../../index.html">
          <span>populse_mia 2.2.1-dev+8b928176 documentation</span></a></h1>
        <h2 class="heading"><span>populse_mia.test</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="../../index.html">Contents</a>
        </p>

      </div>
      <div class="content" role="main">
        
        
  <h1>Source code for populse_mia.test</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Unitary tests.</span>

<span class="sd">:Contains:</span>
<span class="sd">    :Class:</span>
<span class="sd">        - TestMIADataBrowser</span>
<span class="sd">        - TestMIAPipelineManager</span>
<span class="sd">        - TestMIAPipelineManagerTab</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">##########################################################################</span>
<span class="c1"># Populse_mia - Copyright (C) IRMaGe/CEA, 2018</span>
<span class="c1"># Distributed under the terms of the CeCILL license, as published by</span>
<span class="c1"># the CEA-CNRS-INRIA. Refer to the LICENSE file or to</span>
<span class="c1"># http://www.cecill.info/licences/Licence_CeCILL_V2.1-en.html</span>
<span class="c1"># for details.</span>
<span class="c1">##########################################################################</span>

<span class="c1">### General imports:</span>

<span class="c1">#  PyQt5 import</span>

<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="kn">import</span> <span class="n">QtGui</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QCoreApplication</span><span class="p">,</span> <span class="n">QEvent</span><span class="p">,</span> <span class="n">QPoint</span><span class="p">,</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">QTimer</span><span class="p">,</span>
                          <span class="n">QT_VERSION_STR</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtTest</span> <span class="kn">import</span> <span class="n">QTest</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QApplication</span><span class="p">,</span> <span class="n">QDialog</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="p">,</span>
                             <span class="n">QTableWidgetItem</span><span class="p">)</span>

<span class="c1"># Nipype import</span>
<span class="kn">from</span> <span class="nn">nipype.interfaces</span> <span class="kn">import</span> <span class="n">Rename</span><span class="p">,</span> <span class="n">Select</span>
<span class="kn">from</span> <span class="nn">nipype.interfaces.base.traits_extension</span> <span class="kn">import</span> <span class="n">InputMultiObject</span>
<span class="kn">from</span> <span class="nn">nipype.interfaces.spm</span> <span class="kn">import</span> <span class="n">Smooth</span><span class="p">,</span> <span class="n">Threshold</span>

<span class="c1"># other import</span>
<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">packaging</span> <span class="kn">import</span> <span class="n">version</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">traits.api</span> <span class="kn">import</span> <span class="n">Undefined</span><span class="p">,</span> <span class="n">TraitListObject</span>
<span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">Mock</span><span class="p">,</span> <span class="n">MagicMock</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
    <span class="c1"># &quot;developer&quot; mode</span>
    <span class="n">root_dev_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))))</span>

    <span class="c1"># Adding populse_mia</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">- Mia in &quot;developer&quot; mode</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dev_dir</span><span class="p">,</span> <span class="s1">&#39;populse-mia&#39;</span><span class="p">)):</span>
        <span class="n">mia_dev_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dev_dir</span><span class="p">,</span> <span class="s1">&#39;populse-mia&#39;</span><span class="p">,</span> <span class="s1">&#39;python&#39;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">mia_dev_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dev_dir</span><span class="p">,</span> <span class="s1">&#39;populse_mia&#39;</span><span class="p">,</span> <span class="s1">&#39;python&#39;</span><span class="p">)</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mia_dev_dir</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">mia_dev_dir</span>

    <span class="c1"># Adding mia_processes:</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dev_dir</span><span class="p">,</span> <span class="s1">&#39;mia_processes&#39;</span><span class="p">)):</span>
        <span class="n">mia_processes_dev_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dev_dir</span><span class="p">,</span> <span class="s1">&#39;mia_processes&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;python&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;- Using mia_processes package from </span><span class="si">{}</span><span class="s1"> &#39;</span>
              <span class="s1">&#39;...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mia_processes_dev_dir</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">mia_processes_dev_dir</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">mia_processes_dev_dir</span>

    <span class="c1"># Adding populse_db:</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dev_dir</span><span class="p">,</span> <span class="s1">&#39;populse_db&#39;</span><span class="p">)):</span>
        <span class="n">populse_db_dev_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dev_dir</span><span class="p">,</span> <span class="s1">&#39;populse_db&#39;</span><span class="p">,</span> <span class="s1">&#39;python&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;- Using populse_db package from </span><span class="si">{}</span><span class="s1"> &#39;</span>
              <span class="s1">&#39;...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">populse_db_dev_dir</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">populse_db_dev_dir</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">populse_db_dev_dir</span>

    <span class="c1"># Adding capsul:</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dev_dir</span><span class="p">,</span> <span class="s1">&#39;capsul&#39;</span><span class="p">)):</span>
        <span class="n">capsul_dev_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dev_dir</span><span class="p">,</span> <span class="s1">&#39;capsul&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;- Using capsul package from </span><span class="si">{}</span><span class="s1"> &#39;</span>
              <span class="s1">&#39;...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">capsul_dev_dir</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">capsul_dev_dir</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">capsul_dev_dir</span>

    <span class="c1"># Adding soma-base:</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dev_dir</span><span class="p">,</span> <span class="s1">&#39;soma-base&#39;</span><span class="p">)):</span>
        <span class="n">soma_base_dev_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dev_dir</span><span class="p">,</span> <span class="s1">&#39;soma-base&#39;</span><span class="p">,</span> <span class="s1">&#39;python&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;- Using soma-base package from </span><span class="si">{}</span><span class="s1"> &#39;</span>
              <span class="s1">&#39;...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">soma_base_dev_dir</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">soma_base_dev_dir</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">soma_base_dev_dir</span>

    <span class="c1"># Adding soma-workflow:</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dev_dir</span><span class="p">,</span> <span class="s1">&#39;soma-workflow&#39;</span><span class="p">)):</span>
        <span class="n">soma_workflow_dev_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dev_dir</span><span class="p">,</span> <span class="s1">&#39;soma-workflow&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;python&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;- Using soma-workflow package from </span><span class="si">{}</span><span class="s1"> &#39;</span>
              <span class="s1">&#39;...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">soma_workflow_dev_dir</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">soma_workflow_dev_dir</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">soma_workflow_dev_dir</span>

<span class="c1">### Imports after defining the location of populse packages in the case of a</span>
<span class="c1"># developer configuration:</span>

<span class="c1"># capsul import</span>
<span class="kn">from</span> <span class="nn">capsul.api</span> <span class="kn">import</span> <span class="p">(</span><span class="n">get_process_instance</span><span class="p">,</span> <span class="n">Process</span><span class="p">,</span> <span class="n">ProcessNode</span><span class="p">,</span>
                        <span class="n">PipelineNode</span><span class="p">,</span> <span class="n">Switch</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">capsul.attributes.completion_engine</span> <span class="kn">import</span> <span class="n">ProcessCompletionEngine</span>
<span class="kn">from</span> <span class="nn">capsul.engine</span> <span class="kn">import</span> <span class="n">CapsulEngine</span>
<span class="kn">from</span> <span class="nn">capsul.pipeline.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">capsul.pipeline.pipeline_workflow</span> <span class="kn">import</span> <span class="n">workflow_from_pipeline</span>
<span class="kn">from</span> <span class="nn">capsul.pipeline.process_iteration</span> <span class="kn">import</span> <span class="n">ProcessIteration</span>
<span class="kn">from</span> <span class="nn">capsul.process.process</span> <span class="kn">import</span> <span class="n">NipypeProcess</span>

<span class="c1"># mia_processes import</span>
<span class="kn">from</span> <span class="nn">mia_processes.bricks.tools</span> <span class="kn">import</span> <span class="n">Input_Filter</span>

<span class="c1"># populse_mia import</span>
<span class="kn">from</span> <span class="nn">populse_mia.data_manager.project</span> <span class="kn">import</span> <span class="p">(</span><span class="n">COLLECTION_BRICK</span><span class="p">,</span>
                                              <span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                              <span class="n">COLLECTION_HISTORY</span><span class="p">,</span>
                                              <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">Project</span><span class="p">,</span>
                                              <span class="n">TAG_BRICKS</span><span class="p">,</span> <span class="n">TAG_CHECKSUM</span><span class="p">,</span>
                                              <span class="n">TAG_EXP_TYPE</span><span class="p">,</span> <span class="n">TAG_FILENAME</span><span class="p">,</span>
                                              <span class="n">TAG_HISTORY</span><span class="p">,</span> <span class="n">TAG_ORIGIN_USER</span><span class="p">,</span>
                                              <span class="n">TAG_TYPE</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">populse_mia.data_manager.project_properties</span> <span class="kn">import</span> <span class="n">SavedProjects</span>
<span class="kn">from</span> <span class="nn">populse_mia.software_properties</span> <span class="kn">import</span> <span class="n">Config</span><span class="p">,</span> <span class="n">verCmp</span>
<span class="kn">from</span> <span class="nn">populse_mia.user_interface.data_browser.modify_table</span> <span class="kn">import</span> <span class="n">ModifyTable</span>
<span class="kn">from</span> <span class="nn">populse_mia.user_interface.main_window</span> <span class="kn">import</span> <span class="n">MainWindow</span>
<span class="kn">from</span> <span class="nn">populse_mia.user_interface.pipeline_manager.pipeline_editor</span> <span class="kn">import</span> <span class="p">(</span>
                                                                  <span class="n">save_pipeline</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">populse_mia.user_interface.pipeline_manager.pipeline_manager_tab</span> <span class="kn">import</span> <span class="p">(</span>
                                                                    <span class="n">RunProgress</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">populse_mia.user_interface.pipeline_manager.process_library</span> <span class="kn">import</span> <span class="p">(</span>
                                                           <span class="n">InstallProcesses</span><span class="p">,</span>
                                                           <span class="n">PackageLibraryDialog</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">populse_mia.user_interface.pop_ups</span> <span class="kn">import</span> <span class="p">(</span><span class="n">PopUpNewProject</span><span class="p">,</span>
                                                <span class="n">PopUpOpenProject</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">populse_mia.utils.utils</span> <span class="kn">import</span> <span class="n">check_value_type</span><span class="p">,</span> <span class="n">table_to_database</span>

<span class="c1"># populse_db import</span>
<span class="kn">from</span> <span class="nn">populse_db.database</span> <span class="kn">import</span> <span class="p">(</span><span class="n">FIELD_TYPE_BOOLEAN</span><span class="p">,</span> <span class="n">FIELD_TYPE_DATE</span><span class="p">,</span>
                                 <span class="n">FIELD_TYPE_DATETIME</span><span class="p">,</span> <span class="n">FIELD_TYPE_INTEGER</span><span class="p">,</span>
                                 <span class="n">FIELD_TYPE_STRING</span><span class="p">,</span> <span class="n">FIELD_TYPE_TIME</span><span class="p">)</span>

<span class="c1"># soma_workflow import</span>
<span class="kn">from</span> <span class="nn">soma_workflow</span> <span class="kn">import</span> <span class="n">constants</span> <span class="k">as</span> <span class="n">swconstants</span>


<span class="c1"># Working from the scripts directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span>

<span class="c1"># Disables any etelemetry check.</span>
<span class="k">if</span> <span class="s1">&#39;NO_ET&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;NO_ET&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>


<div class="viewcode-block" id="TestMIADataBrowser"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser">[docs]</a><span class="k">class</span> <span class="nc">TestMIADataBrowser</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tests for the data browser tab</span>

<span class="sd">    :Contains:</span>
<span class="sd">        :Method:</span>
<span class="sd">            - edit_databrowser_list: change value to [25000] for a tag in</span>
<span class="sd">              DataBrowser</span>
<span class="sd">            - execute_QMessageBox_clickClose: press the Close button of a</span>
<span class="sd">              QMessageBox instance</span>
<span class="sd">            - execute_QMessageBox_clickOk: press the Ok button of a QMessageBox</span>
<span class="sd">              instance</span>
<span class="sd">            - get_new_test_project: create a temporary project that can be</span>
<span class="sd">              safely modified</span>
<span class="sd">            - setUp: called automatically before each test method</span>
<span class="sd">            - tearDown: cleans up after each test method</span>
<span class="sd">            - setUpClass: called before tests in the individual class</span>
<span class="sd">            - tearDownClass: called after tests in the individual class</span>
<span class="sd">            - test_add_path: tests the popup to add a path</span>
<span class="sd">            - test_add_tag: tests the pop up adding a tag</span>
<span class="sd">            - test_advanced_search: tests the advanced search widget</span>
<span class="sd">            - test_brick_history: tests the brick history popup</span>
<span class="sd">            - test_clear_cell: tests the method clearing cells</span>
<span class="sd">            - test_clone_tag: tests the pop up cloning a tag</span>
<span class="sd">            - test_count_table: tests the count table popup</span>
<span class="sd">            - test_mia_preferences: tests the Mia preferences popup</span>
<span class="sd">            - test_modify_table: tests the modify table module</span>
<span class="sd">            - test_multiple_sort: tests the multiple sort popup</span>
<span class="sd">            - test_open_project: tests project opening</span>
<span class="sd">            - test_open_project_filter: tests project filter opening</span>
<span class="sd">            - test_project_properties: tests saved projects addition and removal</span>
<span class="sd">            - test_proj_remov_from_cur_proj: tests that the projects are</span>
<span class="sd">              removed from the list of current projects</span>
<span class="sd">            - test_rapid_search: tests the rapid search bar</span>
<span class="sd">            - test_remove_scan: tests scans removal in the DataBrowser</span>
<span class="sd">            - test_remove_tag: tests the popup removing user tags</span>
<span class="sd">            - test_reset_cell: tests the method resetting the selected cells</span>
<span class="sd">            - test_reset_column: tests the method resetting the columns</span>
<span class="sd">              selected</span>
<span class="sd">            - test_reset_row: test row reset</span>
<span class="sd">            - test_save_project: test opening &amp; saving of a project</span>
<span class="sd">            - test_send_doc_to_pip: tests the popup sending the documents</span>
<span class="sd">              to the pipeline manager</span>
<span class="sd">            - test_set_value: tests the values modifications</span>
<span class="sd">            - test_sort: tests the sorting in the DataBrowser</span>
<span class="sd">            - test_tab_change: tests the tab change from data browser to</span>
<span class="sd">              pipeline manager</span>
<span class="sd">            - test_undo_redo_databrowser: tests the DataBrowser undo/redo</span>
<span class="sd">            - test_unnamed_proj_soft_open: tests unnamed project creation at</span>
<span class="sd">              software opening</span>
<span class="sd">            - test_utils: test the utils functions</span>
<span class="sd">            - test_visualized_tags: tests the popup modifying the visualized</span>
<span class="sd">              tags</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestMIADataBrowser.edit_databrowser_list"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.edit_databrowser_list">[docs]</a>    <span class="k">def</span> <span class="nf">edit_databrowser_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Change value for a tag in DataBrowser</span>

<span class="sd">        :param value: the new value</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">activeWindow</span><span class="p">()</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">update_table_values</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.execute_QMessageBox_clickClose"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.execute_QMessageBox_clickClose">[docs]</a>    <span class="k">def</span> <span class="nf">execute_QMessageBox_clickClose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Press the Close button of a QMessageBox instance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">activeWindow</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="p">):</span>
            <span class="n">close_button</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Close</span><span class="p">)</span>
            <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">close_button</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.execute_QMessageBox_clickOk"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.execute_QMessageBox_clickOk">[docs]</a>    <span class="k">def</span> <span class="nf">execute_QMessageBox_clickOk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Press the Ok button of a QMessageBox instance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">activeWindow</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="p">):</span>
            <span class="n">close_button</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
            <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">close_button</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.get_new_test_project"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.get_new_test_project">[docs]</a>    <span class="k">def</span> <span class="nf">get_new_test_project</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy the test project in a location we can modify safely</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">project_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;project_8&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">project_path</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">project_path</span><span class="p">)</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">mia_path</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">()</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mia_path</span><span class="p">,</span> <span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="s1">&#39;mia&#39;</span><span class="p">,</span>
                                      <span class="s1">&#39;project_8&#39;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="n">project_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">project_path</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.setUp"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called before each test</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># All the tests are run in admin mode</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_user_mode</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span> <span class="o">=</span> <span class="n">MainWindow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.tearDown"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called after each test</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c1"># Removing the opened projects (in CI, the tests are run twice)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_opened_projects</span><span class="p">([])</span>
        <span class="n">config</span><span class="o">.</span><span class="n">saveConfig</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.setUpClass"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.setUpClass">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called once at the beginning of the class</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">config_path</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;mia_tests&#39;</span><span class="p">)</span>
        <span class="c1"># hack the Config class to get config_path, because some Config</span>
        <span class="c1"># instances are created out of our control in the code</span>
        <span class="n">Config</span><span class="o">.</span><span class="n">config_path</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">config_path</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.tearDownClass"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.tearDownClass">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">tearDownClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called once at the end of the class</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">config_path</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_add_path"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_add_path">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the popup to add a path</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">addRowLabel</span><span class="p">,</span>
                         <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">add_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">pop_up_add_path</span>

        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">add_path</span><span class="o">.</span><span class="n">ok_button</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">add_path</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;Invalid arguments&quot;</span><span class="p">)</span>

        <span class="n">add_path</span><span class="o">.</span><span class="n">file_line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
                                                     <span class="s2">&quot;test_not_existing.py&quot;</span><span class="p">))</span>
        <span class="n">add_path</span><span class="o">.</span><span class="n">type_line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Python&quot;</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">add_path</span><span class="o">.</span><span class="n">ok_button</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">add_path</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;Invalid arguments&quot;</span><span class="p">)</span>

        <span class="n">add_path</span><span class="o">.</span><span class="n">file_line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;test.py&quot;</span><span class="p">))</span>
        <span class="n">add_path</span><span class="o">.</span><span class="n">type_line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Python&quot;</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">add_path</span><span class="o">.</span><span class="n">ok_button</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_CURRENT</span><span class="p">),</span>
                         <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;downloaded_data&#39;</span><span class="p">,</span> <span class="s1">&#39;test.py&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_INITIAL</span><span class="p">),</span>
                         <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;downloaded_data&#39;</span><span class="p">,</span> <span class="s1">&#39;test.py&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">(),</span>
                         <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
                                                                       <span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
                         <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;downloaded_data&#39;</span><span class="p">,</span> <span class="s1">&#39;test.py&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_add_tag"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_add_tag">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the pop-up adding a tag</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="c1"># Testing without tag name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">add_tag_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">add_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">pop_up_add_tag</span>
        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_QMessageBox_clickClose</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">add_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">add_tag</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;The tag name cannot be empty&quot;</span><span class="p">)</span>

        <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>

        <span class="c1"># Testing with tag name already existing</span>
        <span class="n">add_tag</span><span class="o">.</span><span class="n">text_edit_tag_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Type&quot;</span><span class="p">)</span>
        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_QMessageBox_clickClose</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">add_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">add_tag</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;This tag name already exists&quot;</span><span class="p">)</span>

        <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>

        <span class="c1"># Testing with wrong type</span>
        <span class="n">add_tag</span><span class="o">.</span><span class="n">text_edit_tag_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="n">add_tag</span><span class="o">.</span><span class="n">combo_box_type</span><span class="o">.</span><span class="n">setCurrentText</span><span class="p">(</span><span class="n">FIELD_TYPE_INTEGER</span><span class="p">)</span>
        <span class="n">add_tag</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">FIELD_TYPE_INTEGER</span>
        <span class="n">add_tag</span><span class="o">.</span><span class="n">text_edit_default_value</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Should be integer&quot;</span><span class="p">)</span>
        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_QMessageBox_clickClose</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">add_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">add_tag</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;Invalid default value&quot;</span><span class="p">)</span>

        <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>

        <span class="c1"># Testing when everything is ok</span>
        <span class="n">add_tag</span><span class="o">.</span><span class="n">text_edit_tag_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="n">add_tag</span><span class="o">.</span><span class="n">text_edit_default_value</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;def_value&quot;</span><span class="p">)</span>
        <span class="n">add_tag</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">FIELD_TYPE_STRING</span>

        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">add_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">in</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_CURRENT</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">in</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_INITIAL</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_CURRENT</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                          <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="s2">&quot;Test&quot;</span><span class="p">),</span>
                             <span class="s2">&quot;def_value&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_INITIAL</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                          <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="s2">&quot;Test&quot;</span><span class="p">),</span>
                             <span class="s2">&quot;def_value&quot;</span><span class="p">)</span>

        <span class="n">test_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span><span class="p">(</span>
                                                                         <span class="s2">&quot;Test&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span>
                                                                 <span class="n">test_column</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;def_value&quot;</span><span class="p">)</span>

        <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>

        <span class="c1"># Testing with list type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">add_tag_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">add_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">pop_up_add_tag</span>
        <span class="n">add_tag</span><span class="o">.</span><span class="n">text_edit_tag_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Test_list&quot;</span><span class="p">)</span>

        <span class="n">combo_box_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;String&quot;</span><span class="p">,</span> <span class="s2">&quot;Integer&quot;</span><span class="p">,</span> <span class="s2">&quot;Float&quot;</span><span class="p">,</span> <span class="s2">&quot;Boolean&quot;</span><span class="p">,</span> <span class="s2">&quot;Date&quot;</span><span class="p">,</span>
                           <span class="s2">&quot;Datetime&quot;</span><span class="p">,</span> <span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="s2">&quot;String List&quot;</span><span class="p">,</span> <span class="s2">&quot;Integer List&quot;</span><span class="p">,</span>
                           <span class="s2">&quot;Float List&quot;</span><span class="p">,</span> <span class="s2">&quot;Boolean List&quot;</span><span class="p">,</span> <span class="s2">&quot;Date List&quot;</span><span class="p">,</span>
                           <span class="s2">&quot;Datetime List&quot;</span><span class="p">,</span> <span class="s2">&quot;Time List&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">data_type</span> <span class="ow">in</span> <span class="n">combo_box_types</span><span class="p">:</span>
            <span class="n">add_tag</span><span class="o">.</span><span class="n">combo_box_type</span><span class="o">.</span><span class="n">setCurrentText</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span>

        <span class="n">add_tag</span><span class="o">.</span><span class="n">combo_box_type</span><span class="o">.</span><span class="n">setCurrentText</span><span class="p">(</span><span class="s2">&quot;Integer List&quot;</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">add_tag</span><span class="o">.</span><span class="n">text_edit_default_value</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span>
                <span class="n">add_tag</span><span class="o">.</span><span class="n">text_edit_default_value</span><span class="o">.</span><span class="n">list_creation</span><span class="o">.</span><span class="n">add_element_label</span><span class="p">,</span>
                <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">add_tag</span><span class="o">.</span><span class="n">text_edit_default_value</span><span class="o">.</span><span class="n">list_creation</span><span class="o">.</span><span class="n">table</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">QTableWidgetItem</span><span class="p">()</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">QTableWidgetItem</span><span class="p">()</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">QTableWidgetItem</span><span class="p">()</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span>
                        <span class="n">add_tag</span><span class="o">.</span><span class="n">text_edit_default_value</span><span class="o">.</span><span class="n">list_creation</span><span class="o">.</span><span class="n">ok_button</span><span class="p">,</span>
                        <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">add_tag</span><span class="o">.</span><span class="n">text_edit_default_value</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;[1, 2, 3]&quot;</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">add_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>

        <span class="n">test_list_column</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span>
                            <span class="n">get_tag_column</span><span class="p">(</span><span class="s2">&quot;Test_list&quot;</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
                                                               <span class="n">row</span><span class="p">,</span>
                                                               <span class="n">test_list_column</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;[1, 2, 3]&quot;</span><span class="p">)</span>

        <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_advanced_search"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_advanced_search">[docs]</a>    <span class="k">def</span> <span class="nf">test_advanced_search</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the advanced search widget</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="n">scans_displayed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">scans_displayed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scans_displayed</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-04-G3_Guerbet_MDEFT-MDEFT&quot;</span>
                        <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-05-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-06-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-08-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-09-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-10-G3_Guerbet_MDEFT-MDEFT&quot;</span>
                        <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-11-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/derived_data/sGuerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>

        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">advanced_search_button</span><span class="p">,</span>
                         <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>

        <span class="c1"># Testing - and + buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">rows</span><span class="p">))</span>
        <span class="n">first_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">first_row</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">rows</span><span class="p">))</span>
        <span class="n">second_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">second_row</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">rows</span><span class="p">))</span>
        <span class="n">first_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">first_row</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">rows</span><span class="p">))</span>

        <span class="n">field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">field_filename_index</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="n">TAG_FILENAME</span><span class="p">)</span>
        <span class="n">field</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">field_filename_index</span><span class="p">)</span>
        <span class="n">condition_contains_index</span> <span class="o">=</span> <span class="n">condition</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="s2">&quot;CONTAINS&quot;</span><span class="p">)</span>
        <span class="n">condition</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">condition_contains_index</span><span class="p">)</span>
        <span class="n">value</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;G1&quot;</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">search</span><span class="p">,</span>
                         <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>

        <span class="c1"># Testing that only G1 scans are displayed with the filter applied</span>
        <span class="n">scans_displayed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">scans_displayed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scans_displayed</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/derived_data/sGuerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>

        <span class="c1"># Testing that every scan is back when clicking again on advanced search</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">advanced_search_button</span><span class="p">,</span>
                         <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">scans_displayed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">scans_displayed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scans_displayed</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-04-G3_Guerbet_MDEFT-MDEFT&quot;</span>
                        <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-05-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-06-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-08-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-09-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-10-G3_Guerbet_MDEFT-MDEFT&quot;</span>
                        <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-11-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/derived_data/sGuerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_brick_history"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_brick_history">[docs]</a>    <span class="k">def</span> <span class="nf">test_brick_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the brick history popup</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="n">bricks_column</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span>
                         <span class="n">get_tag_column</span><span class="p">)(</span><span class="s2">&quot;History&quot;</span><span class="p">)</span>
        <span class="n">bricks_widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span>
                                                                  <span class="mi">0</span><span class="p">,</span>
                                                                  <span class="n">bricks_column</span><span class="p">)</span>
        <span class="n">smooth_button</span> <span class="o">=</span> <span class="n">bricks_widget</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">smooth_button</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;smooth_1&quot;</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">smooth_button</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">brick_history</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span>
                         <span class="n">brick_history_popup</span><span class="p">)</span>
        <span class="n">brick_table</span> <span class="o">=</span> <span class="n">brick_history</span><span class="o">.</span><span class="n">table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">brick_table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;Name&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">brick_table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;Init&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">brick_table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
                         <span class="s2">&quot;Init Time&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">brick_table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;Exec&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">brick_table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
                         <span class="s2">&quot;Exec Time&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">brick_table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
                         <span class="s2">&quot;data_type&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">brick_table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;fwhm&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">brick_table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
                         <span class="s2">&quot;implicit_masking&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">brick_table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
                         <span class="s2">&quot;in_files&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">brick_table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
                         <span class="s2">&quot;matlab_cmd&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">brick_table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;mfile&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">brick_table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;smooth_1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">brick_table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;Done&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">brick_table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
                         <span class="s2">&quot;2022-04-05 14:22:30.298043&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">brick_table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;Done&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">brick_table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
                         <span class="s2">&quot;2022-04-05 14:22:30.298043&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">brick_table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">brick_table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;[6.0, 6.0, 6.0]&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">brick_table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;False&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">brick_table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
                         <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                         <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                         <span class="s2">&quot;pvm-000220_000.nii&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">brick_table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
                         <span class="s2">&quot;/usr/local/SPM/spm12_standalone/run_spm12.sh &quot;</span>
                         <span class="s2">&quot;/usr/local/MATLAB/MATLAB_Runtime/v95 script&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">brick_table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;True&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_clear_cell"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_clear_cell">[docs]</a>    <span class="k">def</span> <span class="nf">test_clear_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the method clearing cells</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="c1"># Selecting a cell</span>
        <span class="n">bw_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span><span class="p">(</span>
                                                                    <span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
        <span class="n">bw_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bw_column</span><span class="p">)</span>
        <span class="n">bw_item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bw_item</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="mf">50000.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                             <span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                             <span class="s2">&quot;data/derived_data/sGuerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                             <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                             <span class="s2">&quot;pvm-000220_000.nii&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">),</span>
                         <span class="p">[</span><span class="mf">50000.0</span><span class="p">])</span>

        <span class="c1"># Clearing the cell</span>
        <span class="n">bw_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bw_column</span><span class="p">)</span>
        <span class="n">bw_item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">clear_cell</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">change_cell_color</span><span class="p">)</span>

        <span class="c1"># Checking that it&#39;s empty</span>
        <span class="n">bw_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bw_column</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">bw_item</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;*Not Defined*&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                             <span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                             <span class="s2">&quot;data/derived_data/sGuerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                             <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                             <span class="s2">&quot;pvm-000220_000.nii&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_clone_tag"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_clone_tag">[docs]</a>    <span class="k">def</span> <span class="nf">test_clone_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the pop up cloning a tag</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="c1"># Testing without new tag name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">clone_tag_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">clone_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">pop_up_clone_tag</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">clone_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">clone_tag</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;The tag name can&#39;t be empty&quot;</span><span class="p">)</span>

        <span class="c1"># Testing without any tag selected to clone</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">clone_tag_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">clone_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">pop_up_clone_tag</span>
        <span class="n">clone_tag</span><span class="o">.</span><span class="n">line_edit_new_tag_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">clone_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">clone_tag</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
                         <span class="s2">&quot;The tag to clone must be selected&quot;</span><span class="p">)</span>

        <span class="c1"># Testing with tag name already existing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">clone_tag_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">clone_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">pop_up_clone_tag</span>
        <span class="n">clone_tag</span><span class="o">.</span><span class="n">line_edit_new_tag_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Type&quot;</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">clone_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">clone_tag</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;This tag name already exists&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">clone_tag_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">clone_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">pop_up_clone_tag</span>
        <span class="n">clone_tag</span><span class="o">.</span><span class="n">line_edit_new_tag_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="n">clone_tag</span><span class="o">.</span><span class="n">search_bar</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
        <span class="n">clone_tag</span><span class="o">.</span><span class="n">list_widget_tags</span><span class="o">.</span><span class="n">setCurrentRow</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># BandWidth tag selected</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">clone_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">in</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_CURRENT</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">in</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_INITIAL</span><span class="p">))</span>
        <span class="n">test_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                             <span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="n">bandwidth_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_row</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">bandwidth_row</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_row</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">bandwidth_row</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_row</span><span class="o">.</span><span class="n">default_value</span><span class="p">,</span> <span class="n">bandwidth_row</span><span class="o">.</span><span class="n">default_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_row</span><span class="o">.</span><span class="n">field_type</span><span class="p">,</span> <span class="n">bandwidth_row</span><span class="o">.</span><span class="n">field_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_row</span><span class="o">.</span><span class="n">origin</span><span class="p">,</span> <span class="n">TAG_ORIGIN_USER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_row</span><span class="o">.</span><span class="n">visibility</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">test_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_INITIAL</span><span class="p">,</span>
                                                             <span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="n">bandwidth_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_INITIAL</span><span class="p">,</span>
                                                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_row</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">bandwidth_row</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_row</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">bandwidth_row</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_row</span><span class="o">.</span><span class="n">default_value</span><span class="p">,</span> <span class="n">bandwidth_row</span><span class="o">.</span><span class="n">default_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_row</span><span class="o">.</span><span class="n">field_type</span><span class="p">,</span> <span class="n">bandwidth_row</span><span class="o">.</span><span class="n">field_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_row</span><span class="o">.</span><span class="n">origin</span><span class="p">,</span> <span class="n">TAG_ORIGIN_USER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_row</span><span class="o">.</span><span class="n">visibility</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_CURRENT</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                             <span class="n">document</span><span class="p">,</span>
                                                             <span class="s2">&quot;Test&quot;</span><span class="p">),</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                             <span class="n">document</span><span class="p">,</span>
                                                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_INITIAL</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_INITIAL</span><span class="p">,</span>
                                                             <span class="n">document</span><span class="p">,</span>
                                                             <span class="s2">&quot;Test&quot;</span><span class="p">),</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_INITIAL</span><span class="p">,</span>
                                                             <span class="n">document</span><span class="p">,</span>
                                                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">))</span>

        <span class="n">test_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span><span class="p">(</span>
                                                                         <span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="n">bw_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span><span class="p">(</span>
                                                                    <span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">item_bw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span>
                                                                    <span class="n">bw_column</span><span class="p">)</span>
            <span class="n">item_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
                                                                    <span class="n">row</span><span class="p">,</span>
                                                                    <span class="n">test_column</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">item_bw</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="n">item_test</span><span class="o">.</span><span class="n">text</span><span class="p">())</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_count_table"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_count_table">[docs]</a>    <span class="k">def</span> <span class="nf">test_count_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the count table popup</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">count_table_button</span><span class="p">,</span>
                         <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">count_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">count_table_pop_up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">push_buttons</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">count_table</span><span class="o">.</span><span class="n">push_buttons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
        <span class="n">count_table</span><span class="o">.</span><span class="n">fill_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">count_table</span><span class="o">.</span><span class="n">push_buttons</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;EchoTime&quot;</span><span class="p">)</span>
        <span class="n">count_table</span><span class="o">.</span><span class="n">fill_values</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">push_button_count</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>

        <span class="c1"># Trying to add and remove tag buttons</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">add_tag_label</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">push_buttons</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">remove_tag_label</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">push_buttons</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">push_buttons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">push_buttons</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;EchoTime&quot;</span><span class="p">)</span>

        <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
                         <span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                         <span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                         <span class="s2">&quot;75.0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">2</span>
                                                                <span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
                               <span class="mf">5.8239923</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                         <span class="s2">&quot;5.0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">verticalHeaderItem</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
                         <span class="s2">&quot;Total&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;50000.0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;25000.0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
                               <span class="mf">65789.48</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;3&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;5&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;5&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_mia_preferences"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_mia_preferences">[docs]</a>    <span class="k">def</span> <span class="nf">test_mia_preferences</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the MIA preferences popup</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">old_auto_save</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">isAutoSave</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">old_auto_save</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Auto save activated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">action_software_preferences</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pop_up_preferences</span>
        <span class="n">properties</span><span class="o">.</span><span class="n">projects_save_path_line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                                                       <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span>
                                                       <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;projects_tests&#39;</span><span class="p">))</span>
        <span class="n">properties</span><span class="o">.</span><span class="n">tab_widget</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">properties</span><span class="o">.</span><span class="n">save_checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">properties</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execute_QMessageBox_clickOk</span><span class="p">()</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">new_auto_save</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">isAutoSave</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_auto_save</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Auto save disabled again</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">action_software_preferences</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pop_up_preferences</span>
        <span class="n">properties</span><span class="o">.</span><span class="n">tab_widget</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">properties</span><span class="o">.</span><span class="n">save_checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">properties</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execute_QMessageBox_clickOk</span><span class="p">()</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">reput_auto_save</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">isAutoSave</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reput_auto_save</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Checking that the changes are not effective if cancel is clicked</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">action_software_preferences</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pop_up_preferences</span>
        <span class="n">properties</span><span class="o">.</span><span class="n">tab_widget</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">properties</span><span class="o">.</span><span class="n">save_checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">properties</span><span class="o">.</span><span class="n">push_button_cancel</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execute_QMessageBox_clickOk</span><span class="p">()</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="c1"># clear config -&gt; user_mode become True !</span>
        <span class="n">config</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">auto_save</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">isAutoSave</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">auto_save</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Checking that the values for the &quot;Projects preferences&quot; are well set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_max_projects</span><span class="p">(),</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_max_projects</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_max_projects</span><span class="p">(),</span> <span class="mi">7</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_max_projects</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">mia_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span>
                                <span class="s2">&quot;properties&quot;</span><span class="p">,</span> <span class="s2">&quot;config.yml&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">mia_path</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_user_mode</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_user_mode</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_user_mode</span><span class="p">(),</span> <span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mri_conv_path</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_matlab_command</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_matlab_path</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_matlab_standalone_path</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_spm_path</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_spm_standalone_path</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_use_matlab</span><span class="p">(),</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_use_spm</span><span class="p">(),</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_use_spm_standalone</span><span class="p">(),</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">getBackgroundColor</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">getChainCursors</span><span class="p">(),</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">getNbAllSlicesMax</span><span class="p">(),</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">getShowAllSlices</span><span class="p">(),</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">getTextColor</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">getThumbnailTag</span><span class="p">(),</span> <span class="s2">&quot;SequenceName&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span>
                                                                         <span class="s2">&quot;9.1&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span>
                                                                         <span class="s2">&quot;9.1&quot;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_projects_save_path</span><span class="p">(),</span> <span class="s1">&#39;&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_modify_table"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_modify_table">[docs]</a>    <span class="k">def</span> <span class="nf">test_modify_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the modify table module</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>
        <span class="n">scans_displayed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1"># Test values of a list of floats</span>
        <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]</span>
        <span class="n">tag_name</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;FOV&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">scans_displayed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_name</span><span class="p">)</span>

        <span class="c1"># Test that the value will not change if the tag&#39;s type is incorrect</span>
        <span class="n">old_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                             <span class="n">scans_displayed</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                             <span class="s2">&quot;FOV&quot;</span><span class="p">)</span>

        <span class="n">mod</span> <span class="o">=</span> <span class="n">ModifyTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)],</span>
                          <span class="n">scans_displayed</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">)</span>
        <span class="n">mod</span><span class="o">.</span><span class="n">update_table_values</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">new_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                             <span class="n">scans_displayed</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                             <span class="s2">&quot;FOV&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">old_value</span><span class="p">,</span> <span class="n">new_value</span><span class="p">)</span>

        <span class="c1"># Test that the value will change when all parameters are correct</span>
        <span class="n">tag_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                             <span class="s2">&quot;FOV&quot;</span><span class="p">)</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="n">ModifyTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span>
                          <span class="p">[</span><span class="n">tag_object</span><span class="o">.</span><span class="n">field_type</span><span class="p">],</span> <span class="n">scans_displayed</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">)</span>
        <span class="n">mod</span><span class="o">.</span><span class="n">update_table_values</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">new_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                             <span class="n">scans_displayed</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                             <span class="s2">&quot;FOV&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">columnCount</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">new_value</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_multiple_sort"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_multiple_sort">[docs]</a>    <span class="k">def</span> <span class="nf">test_multiple_sort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the multiple sort popup</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">multiple_sort_pop_up</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">change_cell_color</span><span class="p">)</span>
        <span class="n">multiple_sort</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">pop_up</span>

        <span class="n">multiple_sort</span><span class="o">.</span><span class="n">push_buttons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
        <span class="n">multiple_sort</span><span class="o">.</span><span class="n">fill_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">multiple_sort</span><span class="o">.</span><span class="n">push_buttons</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Exp Type&quot;</span><span class="p">)</span>
        <span class="n">multiple_sort</span><span class="o">.</span><span class="n">fill_values</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">multiple_sort</span><span class="o">.</span><span class="n">push_button_sort</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>

        <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span>
                         <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27-2014&quot;</span>
                         <span class="s2">&quot;-02-14102317-10-G3_Guerbet_MDEFT-MDEFTpvm-000940&quot;</span>
                         <span class="s2">&quot;_800.nii&quot;</span><span class="p">)</span>
        <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span>
                         <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27-2014&quot;</span>
                         <span class="s2">&quot;-02-14102317-04-G3_Guerbet_MDEFT-MDEFTpvm-000940&quot;</span>
                         <span class="s2">&quot;_800.nii&quot;</span><span class="p">)</span>
        <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span>
                         <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                         <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RAREpvm&quot;</span>
                         <span class="s2">&quot;-000220_000.nii&quot;</span><span class="p">)</span>
        <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span>
                         <span class="s2">&quot;data/derived_data/sGuerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                         <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RAREpvm&quot;</span>
                         <span class="s2">&quot;-000220_000.nii&quot;</span><span class="p">)</span>
        <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span>
                         <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                         <span class="s2">&quot;-2014-02-14102317-11-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
                         <span class="s2">&quot;-000142_400.nii&quot;</span><span class="p">)</span>
        <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span>
                         <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                         <span class="s2">&quot;-2014-02-14102317-09-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
                         <span class="s2">&quot;-000142_400.nii&quot;</span><span class="p">)</span>
        <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span>
                         <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                         <span class="s2">&quot;-2014-02-14102317-08-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
                         <span class="s2">&quot;-000142_400.nii&quot;</span><span class="p">)</span>
        <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span>
                         <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                         <span class="s2">&quot;-2014-02-14102317-06-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
                         <span class="s2">&quot;-000142_400.nii&quot;</span><span class="p">)</span>
        <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span>
                         <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                         <span class="s2">&quot;-2014-02-14102317-05-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
                         <span class="s2">&quot;-000142_400.nii&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_open_project"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_open_project">[docs]</a>    <span class="k">def</span> <span class="nf">test_open_project</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests project opening</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">windowTitle</span><span class="p">(),</span>
                         <span class="s2">&quot;MIA - Multiparametric Image Analysis&quot;</span>
                         <span class="s2">&quot; (Admin mode) - project_8&quot;</span><span class="p">)</span>

        <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_CURRENT</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-04-G3_Guerbet_MDEFT-MDEFT&quot;</span>
                        <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-05-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-06-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-08-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-09-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-10-G3_Guerbet_MDEFT-MDEFT&quot;</span>
                        <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-11-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/derived_data/sGuerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">)</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_INITIAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-04-G3_Guerbet_MDEFT-MDEFT&quot;</span>
                        <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-05-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-06-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-08-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-09-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-10-G3_Guerbet_MDEFT-MDEFT&quot;</span>
                        <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-11-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/derived_data/sGuerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_open_project_filter"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_open_project_filter">[docs]</a>    <span class="k">def</span> <span class="nf">test_open_project_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests project filter opening</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">open_filter_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">open_popup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">popUp</span>
        <span class="n">open_popup</span><span class="o">.</span><span class="n">list_widget_filters</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">open_popup</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>

        <span class="n">scans_displayed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">scans_displayed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scans_displayed</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/derived_data/sGuerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_project_properties"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_project_properties">[docs]</a>    <span class="k">def</span> <span class="nf">test_project_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests saved projects addition and removal</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">saved_projects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">saved_projects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">saved_projects</span><span class="o">.</span><span class="n">pathsList</span><span class="p">,</span> <span class="p">[])</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>

        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_config_path</span><span class="p">(),</span> <span class="s1">&#39;saved_projects.yml&#39;</span><span class="p">))</span>

        <span class="n">saved_projects</span> <span class="o">=</span> <span class="n">SavedProjects</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">saved_projects</span><span class="o">.</span><span class="n">pathsList</span><span class="p">,</span> <span class="p">[])</span>

        <span class="n">saved_projects</span><span class="o">.</span><span class="n">addSavedProject</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">saved_projects</span><span class="o">.</span><span class="n">pathsList</span><span class="p">,</span> <span class="p">[</span><span class="n">project_8_path</span><span class="p">])</span>

        <span class="n">saved_projects</span><span class="o">.</span><span class="n">addSavedProject</span><span class="p">(</span><span class="s1">&#39;/home&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">saved_projects</span><span class="o">.</span><span class="n">pathsList</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;/home&#39;</span><span class="p">,</span> <span class="n">project_8_path</span><span class="p">])</span>

        <span class="n">saved_projects</span><span class="o">.</span><span class="n">addSavedProject</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">saved_projects</span><span class="o">.</span><span class="n">pathsList</span><span class="p">,</span> <span class="p">[</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;/home&quot;</span><span class="p">])</span>

        <span class="n">saved_projects</span><span class="o">.</span><span class="n">removeSavedProject</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">)</span>
        <span class="n">saved_projects</span><span class="o">.</span><span class="n">removeSavedProject</span><span class="p">(</span><span class="s2">&quot;/home&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">saved_projects</span><span class="o">.</span><span class="n">pathsList</span><span class="p">,</span> <span class="p">[])</span>

        <span class="n">SavedProjects</span><span class="o">.</span><span class="n">loadSavedProjects</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="kc">True</span>
        <span class="n">saved_projects</span> <span class="o">=</span> <span class="n">SavedProjects</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">saved_projects</span><span class="o">.</span><span class="n">pathsList</span><span class="p">,</span> <span class="p">[])</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_proj_remov_from_cur_proj"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_proj_remov_from_cur_proj">[docs]</a>    <span class="k">def</span> <span class="nf">test_proj_remov_from_cur_proj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests that the projects are removed from the list of current projects</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">projects</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_opened_projects</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">projects</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span> <span class="ow">in</span> <span class="n">projects</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_rapid_search"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_rapid_search">[docs]</a>    <span class="k">def</span> <span class="nf">test_rapid_search</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the rapid search bar</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="c1"># Checking that the 9 scans are shown in the DataBrowser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">(),</span>
                         <span class="mi">9</span><span class="p">)</span>
        <span class="n">scans_displayed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">scans_displayed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scans_displayed</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-04-G3_Guerbet_MDEFT-MDEFT&quot;</span>
                        <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-05-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-06-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-08-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-09-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-10-G3_Guerbet_MDEFT-MDEFT&quot;</span>
                        <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-11-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/derived_data/sGuerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>

        <span class="c1"># Testing G1 rapid search</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">search_bar</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;G1&quot;</span><span class="p">)</span>
        <span class="n">scans_displayed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">scans_displayed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scans_displayed</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/derived_data/sGuerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>

        <span class="c1"># Testing that all the scans are back when clicking on the cross</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">button_cross</span><span class="p">,</span>
                         <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">scans_displayed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">scans_displayed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scans_displayed</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RAREpvm&quot;</span>
                        <span class="s2">&quot;-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-04-G3_Guerbet_MDEFT-MDEFT&quot;</span>
                        <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-05-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-06-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-08-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-09-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-10-G3_Guerbet_MDEFT-MDEFTpvm&quot;</span>
                        <span class="s2">&quot;-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-11-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
                        <span class="s2">&quot;-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/derived_data/sGuerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RAREpvm&quot;</span>
                        <span class="s2">&quot;-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>

        <span class="c1"># Testing not defined values</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">button_cross</span><span class="p">,</span>
                         <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">search_bar</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;*Not Defined*&quot;</span><span class="p">)</span>
        <span class="n">scans_displayed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">scans_displayed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">scans_displayed</span><span class="p">,</span>
                         <span class="p">[</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                          <span class="s2">&quot;-2014-02-14102317-11-G4_Guerbet_T1SE_800-RARE&quot;</span>
                          <span class="s2">&quot;pvm-000142_400.nii&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_remove_scan"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_remove_scan">[docs]</a>    <span class="k">def</span> <span class="nf">test_remove_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests scans removal in the DataBrowser</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="n">scans_displayed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">scans_displayed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scans_displayed</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RAREpvm&quot;</span>
                        <span class="s2">&quot;-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-04-G3_Guerbet_MDEFT-MDEFTpvm&quot;</span>
                        <span class="s2">&quot;-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-05-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
                        <span class="s2">&quot;-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-06-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
                        <span class="s2">&quot;-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-08-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
                        <span class="s2">&quot;-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-09-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
                        <span class="s2">&quot;-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-10-G3_Guerbet_MDEFT-MDEFTpvm&quot;</span>
                        <span class="s2">&quot;-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-11-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
                        <span class="s2">&quot;-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/derived_data/sGuerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RAREpvm&quot;</span>
                        <span class="s2">&quot;-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>

        <span class="c1"># Trying to remove a scan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">remove_scan</span><span class="p">()</span>
        <span class="n">scans_displayed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">scans_displayed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scans_displayed</span><span class="p">),</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-04-G3_Guerbet_MDEFT-MDEFTpvm&quot;</span>
                        <span class="s2">&quot;-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-05-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
                        <span class="s2">&quot;-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-06-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
                        <span class="s2">&quot;-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-08-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
                        <span class="s2">&quot;-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-09-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
                        <span class="s2">&quot;-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-10-G3_Guerbet_MDEFT-MDEFTpvm&quot;</span>
                        <span class="s2">&quot;-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-11-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
                        <span class="s2">&quot;-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RAREpvm&quot;</span>
                        <span class="s2">&quot;-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_remove_tag"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_remove_tag">[docs]</a>    <span class="k">def</span> <span class="nf">test_remove_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the popup removing user tags</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Adding a tag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">add_tag_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">add_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">pop_up_add_tag</span>
        <span class="n">add_tag</span><span class="o">.</span><span class="n">text_edit_tag_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">add_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>

        <span class="n">old_tags_current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_CURRENT</span><span class="p">)</span>
        <span class="n">old_tags_initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_INITIAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">remove_tag_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">remove_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">pop_up_remove_tag</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">remove_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">new_tags_current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_CURRENT</span><span class="p">)</span>
        <span class="n">new_tags_initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_INITIAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">old_tags_current</span> <span class="o">==</span> <span class="n">new_tags_current</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">old_tags_initial</span> <span class="o">==</span> <span class="n">new_tags_initial</span><span class="p">)</span>

        <span class="n">old_tags_current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_CURRENT</span><span class="p">)</span>
        <span class="n">old_tags_initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_INITIAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">in</span> <span class="n">old_tags_current</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">in</span> <span class="n">old_tags_initial</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">remove_tag_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">remove_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">pop_up_remove_tag</span>
        <span class="n">remove_tag</span><span class="o">.</span><span class="n">list_widget_tags</span><span class="o">.</span><span class="n">setCurrentRow</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Test tag selected</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">remove_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">new_tags_current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_CURRENT</span><span class="p">)</span>
        <span class="n">new_tags_initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_INITIAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_tags_current</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_tags_initial</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_reset_cell"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_reset_cell">[docs]</a>    <span class="k">def</span> <span class="nf">test_reset_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the method resetting the selected cells</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="c1"># scan name</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1">### Test for a list:</span>
        <span class="c1"># values in the db</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                             <span class="n">scan_name</span><span class="p">,</span>
                                                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_INITIAL</span><span class="p">,</span>
                                                             <span class="n">scan_name</span><span class="p">,</span>
                                                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># value in the DataBrowser</span>
        <span class="n">bandwidth_column</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span>
                                                    <span class="n">get_tag_column</span><span class="p">)(</span><span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                                                             <span class="n">bandwidth_column</span><span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># we test equality between DataBrowser and db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">50000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value_initial</span><span class="p">)</span>

        <span class="c1"># we change the value</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                        <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edit_databrowser_list</span><span class="p">,</span> <span class="s1">&#39;25000&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">edit_table_data_values</span><span class="p">()</span>

        <span class="c1"># we test again the equality between DataBrowser and db</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                             <span class="n">scan_name</span><span class="p">,</span>
                                                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_INITIAL</span><span class="p">,</span>
                                                             <span class="n">scan_name</span><span class="p">,</span>
                                                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                                                             <span class="n">bandwidth_column</span><span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">25000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value_initial</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">50000</span><span class="p">))</span>

        <span class="c1"># we reset the current value to the initial value</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                                                             <span class="n">bandwidth_column</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">reset_cell</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">change_cell_color</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># we test whether the data has been reset</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                             <span class="n">scan_name</span><span class="p">,</span>
                                                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_INITIAL</span><span class="p">,</span>
                                                             <span class="n">scan_name</span><span class="p">,</span>
                                                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                                                             <span class="n">bandwidth_column</span><span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">50000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value_initial</span><span class="p">)</span>

        <span class="c1">### Test for a string:</span>
        <span class="c1"># values in the db</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                           <span class="n">scan_name</span><span class="p">,</span>
                                                           <span class="s2">&quot;Type&quot;</span><span class="p">)</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_INITIAL</span><span class="p">,</span>
                                                             <span class="n">scan_name</span><span class="p">,</span>
                                                             <span class="s2">&quot;Type&quot;</span><span class="p">)</span>

        <span class="c1"># value in the DataBrowser</span>
        <span class="n">type_column</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span>
                                                         <span class="n">get_tag_column</span><span class="p">)(</span><span class="s2">&quot;Type&quot;</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">type_column</span><span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1"># we test equality between DataBrowser and db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;Scan&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value_initial</span><span class="p">)</span>

        <span class="c1"># we change the value</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># we test again the equality between DataBrowser and db</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                           <span class="n">scan_name</span><span class="p">,</span>
                                                           <span class="s2">&quot;Type&quot;</span><span class="p">)</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_INITIAL</span><span class="p">,</span>
                                                             <span class="n">scan_name</span><span class="p">,</span>
                                                             <span class="s2">&quot;Type&quot;</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">type_column</span><span class="p">)</span>

        <span class="n">databrowser</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value_initial</span><span class="p">,</span> <span class="s2">&quot;Scan&quot;</span><span class="p">)</span>

        <span class="c1"># we reset the current value to the initial value</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">type_column</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">reset_cell</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">change_cell_color</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># we test whether the data has been reset</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                           <span class="n">scan_name</span><span class="p">,</span>
                                                           <span class="s2">&quot;Type&quot;</span><span class="p">)</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_INITIAL</span><span class="p">,</span>
                                                             <span class="n">scan_name</span><span class="p">,</span>
                                                             <span class="s2">&quot;Type&quot;</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">type_column</span><span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;Scan&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value_initial</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_reset_column"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_reset_column">[docs]</a>    <span class="k">def</span> <span class="nf">test_reset_column</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the method resetting the columns selected</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="c1"># second document; scan name</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">scan_name2</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1"># second document; values in the db</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                             <span class="n">scan_name2</span><span class="p">,</span>
                                                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_INITIAL</span><span class="p">,</span>
                                                             <span class="n">scan_name2</span><span class="p">,</span>
                                                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># second document; value in the DataBrowser</span>
        <span class="n">bandwidth_column</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span>
                                                    <span class="n">get_tag_column</span><span class="p">)(</span><span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
        <span class="n">item2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                                                              <span class="n">bandwidth_column</span><span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item2</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># we test equality between DataBrowser and db for second document</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">50000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value_initial</span><span class="p">)</span>
        <span class="n">item2</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># third document; scan name</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">scan_name3</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1"># third document; values in the db</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                             <span class="n">scan_name3</span><span class="p">,</span>
                                                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_INITIAL</span><span class="p">,</span>
                                                             <span class="n">scan_name3</span><span class="p">,</span>
                                                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># third document; value in the DataBrowser</span>
        <span class="n">item3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                                                              <span class="n">bandwidth_column</span><span class="p">)</span>

        <span class="c1"># we test equality between DataBrowser and db for third document</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item3</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">25000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value_initial</span><span class="p">)</span>
        <span class="n">item3</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># we change the value to [70000] for the third and second documents</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                        <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edit_databrowser_list</span><span class="p">,</span> <span class="s1">&#39;70000&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">edit_table_data_values</span><span class="p">()</span>

        <span class="c1"># second document; values in the db</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                             <span class="n">scan_name2</span><span class="p">,</span>
                                                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_INITIAL</span><span class="p">,</span>
                                                             <span class="n">scan_name2</span><span class="p">,</span>
                                                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># second document; value in the DataBrowser</span>
        <span class="n">item2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                                                              <span class="n">bandwidth_column</span><span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item2</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># we test equality between DataBrowser and db for second document</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">70000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mi">50000</span><span class="p">),</span> <span class="n">value_initial</span><span class="p">)</span>
        <span class="n">item2</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># third document; values in the db</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                             <span class="n">scan_name3</span><span class="p">,</span>
                                                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_INITIAL</span><span class="p">,</span>
                                                             <span class="n">scan_name3</span><span class="p">,</span>
                                                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># third document; value in the DataBrowser</span>
        <span class="n">item3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                                                              <span class="n">bandwidth_column</span><span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item3</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># we test value in database for the third document</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">70000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value_initial</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">25000</span><span class="p">))</span>
        <span class="n">item3</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># we reset the current value to the initial value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">reset_column</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">change_cell_color</span><span class="p">)</span>

        <span class="c1"># we test the value in the db and DataBrowser for the second document</span>
        <span class="c1"># has been reset</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                             <span class="n">scan_name2</span><span class="p">,</span>
                                                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_INITIAL</span><span class="p">,</span>
                                                             <span class="n">scan_name2</span><span class="p">,</span>
                                                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">item2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                                                              <span class="n">bandwidth_column</span><span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item2</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">50000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value_initial</span><span class="p">)</span>

        <span class="c1"># we test the value in the db and DataBrowser for the third document</span>
        <span class="c1"># has been reset</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                             <span class="n">scan_name3</span><span class="p">,</span>
                                                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_INITIAL</span><span class="p">,</span>
                                                             <span class="n">scan_name3</span><span class="p">,</span>
                                                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">item3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                                                              <span class="n">bandwidth_column</span><span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item3</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">25000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value_initial</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_reset_row"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_reset_row">[docs]</a>    <span class="k">def</span> <span class="nf">test_reset_row</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests row reset</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="c1"># value in DataBrowser for the second document</span>
        <span class="n">type_column</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span>
                                                         <span class="n">get_tag_column</span><span class="p">)(</span><span class="s2">&quot;Type&quot;</span><span class="p">)</span>
        <span class="n">type_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                                                                  <span class="n">type_column</span><span class="p">)</span>
        <span class="n">old_type</span> <span class="o">=</span> <span class="n">type_item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1"># we test value in DataBrowser for the second document</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">old_type</span><span class="p">,</span> <span class="s2">&quot;Scan&quot;</span><span class="p">)</span>

        <span class="c1"># we change the value</span>
        <span class="n">type_item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">type_item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>

        <span class="c1"># we test if value in DataBrowser as been changed</span>
        <span class="n">set_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                                                                 <span class="n">type_column</span><span class="p">)</span>
        <span class="n">set_type</span> <span class="o">=</span> <span class="n">set_item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">set_type</span><span class="p">,</span> <span class="s2">&quot;Test&quot;</span><span class="p">)</span>

        <span class="c1"># we reset row for second document</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">clearSelection</span><span class="p">()</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">reset_row</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">change_cell_color</span><span class="p">)</span>

        <span class="c1"># we test if value in DataBrowser as been reset</span>
        <span class="n">type_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                                                                  <span class="n">type_column</span><span class="p">)</span>
        <span class="n">new_type</span> <span class="o">=</span> <span class="n">type_item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_type</span><span class="p">,</span> <span class="s2">&quot;Scan&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_save_project"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_save_project">[docs]</a>    <span class="k">def</span> <span class="nf">test_save_project</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test opening &amp; saving of a project</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">projects_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span>
                                                       <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;projects_tests&#39;</span><span class="p">))</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_projects_save_path</span><span class="p">(</span><span class="n">projects_dir</span><span class="p">)</span>
        <span class="n">something_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">projects_dir</span><span class="p">,</span> <span class="s1">&#39;something&#39;</span><span class="p">)</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">saveChoice</span><span class="p">()</span>  <span class="c1"># Saves the project &#39;something&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span> <span class="s2">&quot;something&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">something_path</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">saveChoice</span><span class="p">()</span>  <span class="c1"># Updates the project &#39;project_8&#39;</span>

        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">something_path</span><span class="p">)</span>

        <span class="n">PopUpNewProject</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">True</span>
        <span class="n">PopUpNewProject</span><span class="o">.</span><span class="n">selectedFiles</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">True</span>
        <span class="n">PopUpNewProject</span><span class="o">.</span><span class="n">get_filename</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="kc">True</span>
        <span class="n">PopUpNewProject</span><span class="o">.</span><span class="n">relative_path</span> <span class="o">=</span> <span class="n">something_path</span>

        <span class="n">PopUpOpenProject</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">True</span>
        <span class="n">PopUpOpenProject</span><span class="o">.</span><span class="n">selectedFiles</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">True</span>
        <span class="n">PopUpOpenProject</span><span class="o">.</span><span class="n">get_filename</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="kc">True</span>
        <span class="n">PopUpOpenProject</span><span class="o">.</span><span class="n">relative_path</span> <span class="o">=</span> <span class="n">something_path</span>
        <span class="n">PopUpOpenProject</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">PopUpOpenProject</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
                                                                 <span class="n">something_path</span><span class="p">)</span>
        <span class="c1"># Saves the project &#39;something&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">create_project_pop_up</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span> <span class="s2">&quot;something&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">something_path</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">open_project_pop_up</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span> <span class="s2">&quot;something&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">something_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_send_doc_to_pip"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_send_doc_to_pip">[docs]</a>    <span class="k">def</span> <span class="nf">test_send_doc_to_pip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the popup sending the documents to the pipeline manager</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="c1"># Checking that the pipeline manager has an empty list at the beginning</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">scan_list</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c1"># Sending the selection (all scans), but closing the popup</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">send_documents_to_pipeline_button</span><span class="p">,</span>
                <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">send_popup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">show_selection</span>

        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

        <span class="n">send_popup</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Checking that the list is stil empty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">scan_list</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c1"># Sending the selection (all scans)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">send_documents_to_pipeline_button</span><span class="p">,</span>
                <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">send_popup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">show_selection</span>

        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

        <span class="n">send_popup</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="c1"># Checking that all scans have been sent to the pipeline manager</span>
        <span class="n">scans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">scan_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scans</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-04-G3_Guerbet_MDEFT-MDEFT&quot;</span>
                        <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-05-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-06-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-08-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-09-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-10-G3_Guerbet_MDEFT-MDEFT&quot;</span>
                        <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-11-G4_Guerbet_T1SE_800-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/derived_data/sGuerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                        <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans</span><span class="p">)</span>

        <span class="c1"># Selecting the first 2 scans</span>
        <span class="n">item1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">item1</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">scan1</span> <span class="o">=</span> <span class="n">item1</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">item2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">scan2</span> <span class="o">=</span> <span class="n">item2</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">item2</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Sending the selection (first 2 scans)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">send_documents_to_pipeline_button</span><span class="p">,</span>
                <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">send_popup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">show_selection</span>

        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

        <span class="n">send_popup</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="c1"># Checking that the first 2 scans have been sent to the pipeline manager</span>
        <span class="n">scans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">scan_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scans</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">scan1</span> <span class="ow">in</span> <span class="n">scans</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">scan2</span> <span class="ow">in</span> <span class="n">scans</span><span class="p">)</span>

        <span class="c1"># Testing with the rapid search</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">clearSelection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">search_bar</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;G3&quot;</span><span class="p">)</span>

        <span class="c1"># Sending the selection (G3 scans)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">send_documents_to_pipeline_button</span><span class="p">,</span>
                <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">send_popup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">show_selection</span>

        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

        <span class="n">send_popup</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="c1"># Checking that G3 scans have been sent to the pipeline manager</span>
        <span class="n">scans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">scan_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scans</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-04-G3_Guerbet_MDEFT-MDEFT&quot;</span>
                        <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                        <span class="s2">&quot;-2014-02-14102317-10-G3_Guerbet_MDEFT-MDEFT&quot;</span>
                        <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_set_value"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_set_value">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the values modifications</span>

<span class="sd">        This test is redundant with the first part of test_reset_cell.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="c1"># scan name for the second document</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1">### Test for a list:</span>
        <span class="c1"># values in the db</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                             <span class="n">scan_name</span><span class="p">,</span>
                                                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_INITIAL</span><span class="p">,</span>
                                                             <span class="n">scan_name</span><span class="p">,</span>
                                                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># value in the DataBrowser</span>
        <span class="n">bandwidth_column</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span>
                                                    <span class="n">get_tag_column</span><span class="p">)(</span><span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                                                             <span class="n">bandwidth_column</span><span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">50000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value_initial</span><span class="p">)</span>

        <span class="c1"># we change the value</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                        <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edit_databrowser_list</span><span class="p">,</span> <span class="s1">&#39;25000&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">edit_table_data_values</span><span class="p">()</span>

        <span class="c1"># we test if value was changed in db and DataBrowser</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                             <span class="n">scan_name</span><span class="p">,</span>
                                                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_INITIAL</span><span class="p">,</span>
                                                             <span class="n">scan_name</span><span class="p">,</span>
                                                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                                                             <span class="n">bandwidth_column</span><span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">25000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value_initial</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">50000</span><span class="p">))</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1">### Test for a string:</span>
        <span class="c1"># values in the db</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                           <span class="n">scan_name</span><span class="p">,</span>
                                                           <span class="s2">&quot;Type&quot;</span><span class="p">)</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_INITIAL</span><span class="p">,</span>
                                                             <span class="n">scan_name</span><span class="p">,</span>
                                                             <span class="s2">&quot;Type&quot;</span><span class="p">)</span>

        <span class="c1"># value in the DataBrowser</span>
        <span class="n">type_column</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span>
                                                         <span class="n">get_tag_column</span><span class="p">)(</span><span class="s2">&quot;Type&quot;</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">type_column</span><span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1"># we test equality between DataBrowser and db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;Scan&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value_initial</span><span class="p">)</span>

        <span class="c1"># we change the value</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># we test if value in DataBrowser and db as been changed</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                           <span class="n">scan_name</span><span class="p">,</span>
                                                           <span class="s2">&quot;Type&quot;</span><span class="p">)</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_INITIAL</span><span class="p">,</span>
                                                             <span class="n">scan_name</span><span class="p">,</span>
                                                             <span class="s2">&quot;Type&quot;</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">type_column</span><span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value_initial</span><span class="p">,</span> <span class="s2">&quot;Scan&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_sort"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_sort">[docs]</a>    <span class="k">def</span> <span class="nf">test_sort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the sorting in the databrowser</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="n">mixed_bandwidths</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">bandwidth_column</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span>
                                                    <span class="n">get_tag_column</span><span class="p">)(</span><span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
                                                               <span class="n">row</span><span class="p">,</span>
                                                               <span class="n">bandwidth_column</span><span class="p">)</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">mixed_bandwidths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_name</span><span class="p">)</span>

        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span>
                          <span class="n">horizontalHeader</span><span class="p">)()</span><span class="o">.</span><span class="n">setSortIndicator</span><span class="p">(</span><span class="n">bandwidth_column</span><span class="p">,</span>
                                                               <span class="mi">0</span><span class="p">)</span>
        <span class="n">up_bandwidths</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">bandwidth_column</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span>
                                                    <span class="n">get_tag_column</span><span class="p">)(</span><span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
                                                               <span class="n">row</span><span class="p">,</span>
                                                               <span class="n">bandwidth_column</span><span class="p">)</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">up_bandwidths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">mixed_bandwidths</span><span class="p">,</span> <span class="n">up_bandwidths</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">mixed_bandwidths</span><span class="p">),</span> <span class="n">up_bandwidths</span><span class="p">)</span>

        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span>
                          <span class="n">horizontalHeader</span><span class="p">)()</span><span class="o">.</span><span class="n">setSortIndicator</span><span class="p">(</span><span class="n">bandwidth_column</span><span class="p">,</span>
                                                               <span class="mi">1</span><span class="p">)</span>
        <span class="n">down_bandwidths</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">bandwidth_column</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span>
                                                    <span class="n">get_tag_column</span><span class="p">)(</span><span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
                                                               <span class="n">row</span><span class="p">,</span>
                                                               <span class="n">bandwidth_column</span><span class="p">)</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">down_bandwidths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">mixed_bandwidths</span><span class="p">,</span> <span class="n">down_bandwidths</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">mixed_bandwidths</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                         <span class="n">down_bandwidths</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_tab_change"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_tab_change">[docs]</a>    <span class="k">def</span> <span class="nf">test_tab_change</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the tab change from data browser to pipeline manager</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="n">scans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_CURRENT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">scans</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">scan_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s2">&quot;Pipeline Manager&quot;</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">tabText</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">tabText</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="s2">&quot;Data Browser&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_undo_redo_databrowser"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_undo_redo_databrowser">[docs]</a>    <span class="k">def</span> <span class="nf">test_undo_redo_databrowser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the databrowser undo/redo</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="c1"># 1. Tag value (list)</span>
        <span class="c1"># we test undos and redos are empty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">undos</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">redos</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c1"># DataBrowser value for second document</span>
        <span class="n">bw_column</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span>
                                                    <span class="n">get_tag_column</span><span class="p">)(</span><span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
        <span class="n">bw_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">bw_column</span><span class="p">)</span>
        <span class="n">bw_old</span> <span class="o">=</span> <span class="n">bw_item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1"># we test the value is really 50000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bw_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">50000</span><span class="p">)</span>

        <span class="c1"># we change the value</span>
        <span class="n">bw_item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edit_databrowser_list</span><span class="p">,</span> <span class="s1">&#39;0.0&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">edit_table_data_values</span><span class="p">()</span>

        <span class="c1"># we test undos and redos have the right values.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">undos</span><span class="p">,</span>
                         <span class="p">[[</span><span class="s2">&quot;modified_values&quot;</span><span class="p">,</span>
                           <span class="p">[[</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                             <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                             <span class="s2">&quot;pvm-000220_000.nii&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">,</span>
                             <span class="p">[</span><span class="mf">50000.0</span><span class="p">],</span>
                             <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
                             <span class="p">]]</span>
                           <span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">redos</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c1"># we test the value has really been changed to 0.0.</span>
        <span class="n">bw_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">bw_column</span><span class="p">)</span>
        <span class="n">bw_set</span> <span class="o">=</span> <span class="n">bw_item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bw_set</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># we undo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">action_undo</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>

        <span class="c1"># we test the value has really been reset to 50000</span>
        <span class="n">bw_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">bw_column</span><span class="p">)</span>
        <span class="n">bw_undo</span> <span class="o">=</span> <span class="n">bw_item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bw_undo</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">50000</span><span class="p">)</span>

        <span class="c1"># we test undos / redos have the right values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">redos</span><span class="p">,</span>
                         <span class="p">[[</span><span class="s2">&quot;modified_values&quot;</span><span class="p">,</span>
                           <span class="p">[[</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                             <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                             <span class="s2">&quot;pvm-000220_000.nii&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">,</span>
                             <span class="p">[</span><span class="mf">50000.0</span><span class="p">],</span>
                             <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
                             <span class="p">]]</span>
                           <span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">undos</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c1"># we redo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">action_redo</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>

        <span class="c1"># we test the value has really been reset to 0.0</span>
        <span class="n">bw_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">bw_column</span><span class="p">)</span>
        <span class="n">bw_redo</span> <span class="o">=</span> <span class="n">bw_item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bw_redo</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># we test undos / redos have the right values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">undos</span><span class="p">,</span>
                         <span class="p">[[</span><span class="s2">&quot;modified_values&quot;</span><span class="p">,</span>
                           <span class="p">[[</span><span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                             <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                             <span class="s2">&quot;pvm-000220_000.nii&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;BandWidth&quot;</span><span class="p">,</span>
                             <span class="p">[</span><span class="mf">50000.0</span><span class="p">],</span>
                             <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
                             <span class="p">]]</span>
                           <span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">redos</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c1"># 2. Remove a can (document)</span>
        <span class="c1"># we test there are 9 documents in db (current and initial)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                       <span class="mi">9</span><span class="p">,</span>
                       <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                                                           <span class="n">COLLECTION_CURRENT</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                       <span class="mi">9</span><span class="p">,</span>
                       <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                                                           <span class="n">COLLECTION_INITIAL</span><span class="p">)))</span>

        <span class="c1"># we remove the eighth document</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">remove_scan</span><span class="p">()</span>

        <span class="c1"># we test if there are now 8 documents in db (current and initial)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                       <span class="mi">8</span><span class="p">,</span>
                       <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                                                           <span class="n">COLLECTION_CURRENT</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                       <span class="mi">8</span><span class="p">,</span>
                       <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                                                           <span class="n">COLLECTION_INITIAL</span><span class="p">)))</span>

        <span class="c1"># we undo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">action_undo</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>

        <span class="c1"># we test there are still only 8 documents in the database</span>
        <span class="c1"># (current and initial). In fact the document has been permanently</span>
        <span class="c1"># deleted and we cannot recover it in this case</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                       <span class="mi">8</span><span class="p">,</span>
                       <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                                                           <span class="n">COLLECTION_CURRENT</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                       <span class="mi">8</span><span class="p">,</span>
                       <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                                                           <span class="n">COLLECTION_INITIAL</span><span class="p">)))</span>

        <span class="c1"># 3. Add a tag</span>
        <span class="c1"># we test we don&#39;t have &#39;Test&#39; tag in the db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">in</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_CURRENT</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">in</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_INITIAL</span><span class="p">))</span>

        <span class="c1"># we add the Test tag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">add_tag_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">add_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">pop_up_add_tag</span>
        <span class="n">add_tag</span><span class="o">.</span><span class="n">text_edit_tag_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">add_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>

        <span class="c1"># we test we have the &#39;Test&#39; tag in the db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">in</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_CURRENT</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">in</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_INITIAL</span><span class="p">))</span>

        <span class="c1"># we undo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">action_undo</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>

        <span class="c1"># we test we don&#39;t have &#39;Test&#39; tag in the db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">in</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_CURRENT</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">in</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_INITIAL</span><span class="p">))</span>

        <span class="c1"># we redo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">action_redo</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>

        <span class="c1"># we test we have the &#39;Test&#39; tag in the db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">in</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_CURRENT</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">in</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_INITIAL</span><span class="p">))</span>

        <span class="c1"># 4. remove tag</span>
        <span class="c1"># we remove the &#39;Test&#39; tag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">remove_tag_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">remove_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">pop_up_remove_tag</span>
        <span class="n">remove_tag</span><span class="o">.</span><span class="n">list_widget_tags</span><span class="o">.</span><span class="n">setCurrentRow</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># &#39;Test&#39; tag selected</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">remove_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>

        <span class="c1"># we test we don&#39;t have &#39;Test&#39; tag in the db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">in</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_CURRENT</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">in</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_INITIAL</span><span class="p">))</span>

        <span class="c1"># we undo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">action_undo</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>

        <span class="c1"># we test we have the &#39;Test&#39; tag in the db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">in</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_CURRENT</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">in</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_INITIAL</span><span class="p">))</span>

        <span class="c1"># we redo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">action_redo</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>

        <span class="c1"># we test we don&#39;t have &#39;Test&#39; tag in the db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">in</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_CURRENT</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">in</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_INITIAL</span><span class="p">))</span>

        <span class="c1"># 4. clone tag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">clone_tag_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">clone_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">pop_up_clone_tag</span>

        <span class="k">for</span> <span class="n">fov_column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">clone_tag</span><span class="o">.</span><span class="n">list_widget_tags</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>

            <span class="k">if</span> <span class="n">clone_tag</span><span class="o">.</span><span class="n">list_widget_tags</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">fov_column</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;FOV&#39;</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="c1"># &#39;FOV&#39; tag selected</span>
        <span class="n">clone_tag</span><span class="o">.</span><span class="n">list_widget_tags</span><span class="o">.</span><span class="n">setCurrentRow</span><span class="p">(</span><span class="n">fov_column</span><span class="p">)</span>
        <span class="n">clone_tag</span><span class="o">.</span><span class="n">line_edit_new_tag_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Test&#39;</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">clone_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>

        <span class="c1"># we test we have the &#39;Test&#39; tag in the db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">in</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_CURRENT</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">in</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_INITIAL</span><span class="p">))</span>

        <span class="c1"># value in the db</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                           <span class="n">scan_name</span><span class="p">,</span>
                                                           <span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_INITIAL</span><span class="p">,</span>
                                                             <span class="n">scan_name</span><span class="p">,</span>
                                                             <span class="s2">&quot;Test&quot;</span><span class="p">)</span>

        <span class="c1"># value in the DataBrowser</span>
        <span class="n">test_column</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span>
                                                         <span class="n">get_tag_column</span><span class="p">)(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">test_column</span><span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1"># we test equality between DataBrowser and db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">databrowser</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value_initial</span><span class="p">)</span>

        <span class="c1"># we undo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">action_undo</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>

        <span class="c1"># we test we don&#39;t have the &#39;Test&#39; tag in the db and in the DataBrowser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">in</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_CURRENT</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">in</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_INITIAL</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span>
                                                        <span class="n">get_tag_column</span><span class="p">)(</span><span class="s2">&quot;Test&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_unnamed_proj_soft_open"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_unnamed_proj_soft_open">[docs]</a>    <span class="k">def</span> <span class="nf">test_unnamed_proj_soft_open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests unnamed project creation at software opening</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">Project</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span>
                         <span class="s2">&quot;Unnamed project&quot;</span><span class="p">)</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                                                             <span class="n">COLLECTION_CURRENT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tags</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_CHECKSUM</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_FILENAME</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_TYPE</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_EXP_TYPE</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_BRICKS</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_HISTORY</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_CURRENT</span><span class="p">),</span>
                         <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                                                            <span class="n">COLLECTION_INITIAL</span><span class="p">),</span>
                         <span class="p">[])</span>
        <span class="n">collections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_collections_names</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">collections</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">COLLECTION_INITIAL</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">COLLECTION_BRICK</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">COLLECTION_HISTORY</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">windowTitle</span><span class="p">(),</span>
                         <span class="s2">&quot;MIA - Multiparametric Image Analysis &quot;</span>
                         <span class="s2">&quot;(Admin mode) - Unnamed project&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_utils"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_utils">[docs]</a>    <span class="k">def</span> <span class="nf">test_utils</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the utils functions</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">table_to_database</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">FIELD_TYPE_BOOLEAN</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">table_to_database</span><span class="p">(</span><span class="s2">&quot;False&quot;</span><span class="p">,</span> <span class="n">FIELD_TYPE_BOOLEAN</span><span class="p">),</span> <span class="kc">False</span><span class="p">)</span>

        <span class="nb">format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;01/01/2019&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">check_value_type</span><span class="p">(</span><span class="s2">&quot;01/01/2019&quot;</span><span class="p">,</span> <span class="n">FIELD_TYPE_DATE</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">table_to_database</span><span class="p">(</span><span class="s2">&quot;01/01/2019&quot;</span><span class="p">,</span> <span class="n">FIELD_TYPE_DATE</span><span class="p">),</span>
                         <span class="n">value</span><span class="p">)</span>

        <span class="nb">format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y %H:%M:%S.</span><span class="si">%f</span><span class="s2">&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;15/7/2019 16:16:55.789643&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">check_value_type</span><span class="p">(</span><span class="s2">&quot;15/7/2019 16:16:55.789643&quot;</span><span class="p">,</span>
                                          <span class="n">FIELD_TYPE_DATETIME</span><span class="p">),</span>
                         <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">table_to_database</span><span class="p">(</span><span class="s2">&quot;15/7/2019 16:16:55.789643&quot;</span><span class="p">,</span>
                                           <span class="n">FIELD_TYPE_DATETIME</span><span class="p">),</span>
                         <span class="n">value</span><span class="p">)</span>

        <span class="nb">format</span> <span class="o">=</span> <span class="s2">&quot;%H:%M:%S.</span><span class="si">%f</span><span class="s2">&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;16:16:55.789643&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">check_value_type</span><span class="p">(</span><span class="s2">&quot;16:16:55.789643&quot;</span><span class="p">,</span> <span class="n">FIELD_TYPE_TIME</span><span class="p">),</span>
                         <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">table_to_database</span><span class="p">(</span><span class="s2">&quot;16:16:55.789643&quot;</span><span class="p">,</span> <span class="n">FIELD_TYPE_TIME</span><span class="p">),</span>
                         <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIADataBrowser.test_visualized_tags"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_visualized_tags">[docs]</a>    <span class="k">def</span> <span class="nf">test_visualized_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the popup modifying the visualized tags</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Testing default tags visibility</span>
        <span class="n">visibles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_shown_tags</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">visibles</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_FILENAME</span> <span class="ow">in</span> <span class="n">visibles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_BRICKS</span> <span class="ow">in</span> <span class="n">visibles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_TYPE</span> <span class="ow">in</span> <span class="n">visibles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_EXP_TYPE</span> <span class="ow">in</span> <span class="n">visibles</span><span class="p">)</span>

        <span class="c1"># Testing columns displayed in the databrowser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">columnCount</span><span class="p">())</span>
        <span class="n">columns_displayed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                        <span class="mi">0</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()):</span>
            <span class="n">tag_displayed</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span>
                                            <span class="n">horizontalHeaderItem</span><span class="p">)(</span><span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isColumnHidden</span><span class="p">(</span>
                                                                        <span class="n">column</span><span class="p">):</span>
                <span class="n">columns_displayed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag_displayed</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">visibles</span><span class="p">),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">columns_displayed</span><span class="p">))</span>

        <span class="c1"># Testing that FileName tag is the first column</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                  <span class="n">TAG_FILENAME</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span>
                                                                      <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

        <span class="c1"># Trying to set the visibles tags</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">visualized_tags_button</span><span class="p">,</span>
                         <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">pop_up</span>

        <span class="c1"># Testing that checksum tag isn&#39;t displayed</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">search_bar</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">TAG_CHECKSUM</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">list_widget_tags</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Testing that history uuid tag isn&#39;t displayed</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">search_bar</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">TAG_HISTORY</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">list_widget_tags</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Testing that FileName is not displayed in the list of visible tags</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">search_bar</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">visible_tags</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">list_widget_selected_tags</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">list_widget_selected_tags</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">visible_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">visible_tags</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_BRICKS</span> <span class="ow">in</span> <span class="n">visible_tags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_EXP_TYPE</span> <span class="ow">in</span> <span class="n">visible_tags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_TYPE</span> <span class="ow">in</span> <span class="n">visible_tags</span><span class="p">)</span>

        <span class="c1">### Testing when hiding a tag</span>
        <span class="c1"># Bricks tag selected</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">list_widget_selected_tags</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">push_button_unselect_tag</span><span class="p">,</span>
                         <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">visible_tags</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">list_widget_selected_tags</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">list_widget_selected_tags</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">visible_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">visible_tags</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_TYPE</span> <span class="ow">in</span> <span class="n">visible_tags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_EXP_TYPE</span> <span class="ow">in</span> <span class="n">visible_tags</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>

        <span class="n">new_visibles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_shown_tags</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_visibles</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_FILENAME</span> <span class="ow">in</span> <span class="n">new_visibles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_EXP_TYPE</span> <span class="ow">in</span> <span class="n">new_visibles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_TYPE</span> <span class="ow">in</span> <span class="n">new_visibles</span><span class="p">)</span>

        <span class="n">columns_displayed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                        <span class="mi">0</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span>
                                                   <span class="n">horizontalHeaderItem</span><span class="p">)(</span><span class="n">column</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isColumnHidden</span><span class="p">(</span>
                                                                        <span class="n">column</span><span class="p">):</span>
                <span class="n">columns_displayed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">columns_displayed</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_FILENAME</span> <span class="ow">in</span> <span class="n">columns_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_EXP_TYPE</span> <span class="ow">in</span> <span class="n">columns_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_TYPE</span> <span class="ow">in</span> <span class="n">columns_displayed</span><span class="p">)</span>

        <span class="c1"># Testing when showing a new tag</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">visualized_tags_button</span><span class="p">,</span>
                         <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">pop_up</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">search_bar</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">TAG_BRICKS</span><span class="p">)</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">list_widget_tags</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">push_button_select_tag</span><span class="p">,</span>
                         <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>

        <span class="n">new_visibles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_shown_tags</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_visibles</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_FILENAME</span> <span class="ow">in</span> <span class="n">new_visibles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_EXP_TYPE</span> <span class="ow">in</span> <span class="n">new_visibles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_TYPE</span> <span class="ow">in</span> <span class="n">new_visibles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_BRICKS</span> <span class="ow">in</span> <span class="n">new_visibles</span><span class="p">)</span>

        <span class="n">columns_displayed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                        <span class="mi">0</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span>
                                                   <span class="n">horizontalHeaderItem</span><span class="p">)(</span><span class="n">column</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isColumnHidden</span><span class="p">(</span>
                                                                        <span class="n">column</span><span class="p">):</span>
                <span class="n">columns_displayed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">columns_displayed</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_FILENAME</span> <span class="ow">in</span> <span class="n">columns_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_EXP_TYPE</span> <span class="ow">in</span> <span class="n">columns_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_TYPE</span> <span class="ow">in</span> <span class="n">columns_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_BRICKS</span> <span class="ow">in</span> <span class="n">columns_displayed</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="TestMIAPipelineManager"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager">[docs]</a><span class="k">class</span> <span class="nc">TestMIAPipelineManager</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tests for the pipeline manager tab.</span>

<span class="sd">    :Contains:</span>
<span class="sd">        :Method:</span>
<span class="sd">            - add_visualized_tag: selects a tag to display with the</span>
<span class="sd">              &quot;Visualized tags&quot; pop-up</span>
<span class="sd">            - execute_QDialogAccept: accept (close) a QDialog window</span>
<span class="sd">            - get_new_test_project: create a temporary project that can</span>
<span class="sd">              be safely modified</span>
<span class="sd">            - restart_MIA: restarts MIA within a unit test.</span>
<span class="sd">            - setUp: called automatically before each test method</span>
<span class="sd">            - setUpClass: called before tests in the individual class</span>
<span class="sd">            - tearDown: cleans up after each test method</span>
<span class="sd">            - tearDownClass: called after tests in the individual class</span>
<span class="sd">            - test_add_tab: adds tabs to the PipelineEditorTabs</span>
<span class="sd">            - test_attributes_filter: displays an attributes filter and </span>
<span class="sd">              modifies it</span>
<span class="sd">            - test_capsul_node_controller: adds, changes and deletes </span>
<span class="sd">              processes using the capsul node controller</span>
<span class="sd">            - test_close_tab: closes a tab in the PipelineEditorTabs</span>
<span class="sd">            - test_display_filter: displays node parameters and a plug </span>
<span class="sd">              filter</span>
<span class="sd">            - test_drop_process: adds a Nipype SPM Smooth process to the</span>
<span class="sd">              pipeline editor</span>
<span class="sd">            - test_filter_widget: opens up the &quot;FilterWidget()&quot; to </span>
<span class="sd">              modify its parameters</span>
<span class="sd">            - test_iteration_table: plays with the iteration table</span>
<span class="sd">            - test_node_controller: adds, changes and deletes processes </span>
<span class="sd">              to the node controller</span>
<span class="sd">            - test_plug_filter: displays a plug filter and modifies it</span>
<span class="sd">            - test_process_library: install the brick_test and then </span>
<span class="sd">              remove it</span>
<span class="sd">            - test_update_node_name: displays node parameters and </span>
<span class="sd">              updates its name</span>
<span class="sd">            - test_update_plug_value: displays node parameters and </span>
<span class="sd">              updates a plug value</span>
<span class="sd">            - test_z_get_editor: gets the instance of an editor</span>
<span class="sd">            - test_z_get_filename: gets the relative path to a </span>
<span class="sd">              previously saved pipeline file</span>
<span class="sd">            - test_z_get_index: gets the index of an editor</span>
<span class="sd">            - test_z_get_tab_name: gets the tab name of the editor</span>
<span class="sd">            - test_z_load_pipeline: loads a pipeline</span>
<span class="sd">            - test_z_open_sub_pipeline: opens a sub_pipeline</span>
<span class="sd">            - test_z_set_current_editor: sets the current editor</span>
<span class="sd">            - test_zz_check_modif: opens a pipeline, opens it as a </span>
<span class="sd">              process in another tab, modifies it and check the </span>
<span class="sd">              modifications</span>
<span class="sd">            - test_zz_del_pack(self): deletion of the brick created during UTs</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestMIAPipelineManager.add_visualized_tag"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.add_visualized_tag">[docs]</a>    <span class="k">def</span> <span class="nf">add_visualized_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        With the &quot;Visualized tags&quot; pop-up open, selects a tag to display.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tag: string</span>
<span class="sd">          The tag to be displayed</span>

<span class="sd">        Usage</span>
<span class="sd">        -----</span>
<span class="sd">        Should be called, with a delay, before opening the &quot;Visualized tags&quot;</span>
<span class="sd">        pop-up:</span>
<span class="sd">        QTimer.singleShot(1000,</span>
<span class="sd">                          lambda:self.add_visualized_tag(&#39;AcquisitionDate&#39;))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">activeWindow</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">QDialog</span><span class="p">):</span>
            <span class="n">visualized_tags</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span>
            <span class="n">tags_list</span> <span class="o">=</span> <span class="n">visualized_tags</span><span class="o">.</span><span class="n">list_widget_tags</span>

            <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">QT_VERSION_STR</span><span class="p">)</span> <span class="o">==</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;5.9.2&#39;</span><span class="p">):</span>
                <span class="n">found_item</span> <span class="o">=</span> <span class="n">tags_list</span><span class="o">.</span><span class="n">findItems</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">MatchExactly</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">found_item</span> <span class="o">=</span> <span class="n">tags_list</span><span class="o">.</span><span class="n">findItems</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span>
                                                 <span class="n">Qt</span><span class="o">.</span><span class="n">MatchFlag</span><span class="o">.</span><span class="n">MatchExactly</span><span class="p">)</span>

            <span class="n">tags_list</span><span class="o">.</span><span class="n">setCurrentItem</span><span class="p">(</span><span class="n">found_item</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">visualized_tags</span><span class="o">.</span><span class="n">click_select_tag</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestMIAPipelineManager.execute_QDialogAccept"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.execute_QDialogAccept">[docs]</a>    <span class="k">def</span> <span class="nf">execute_QDialogAccept</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Accept (close) a QDialog window</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">activeWindow</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">QDialog</span><span class="p">):</span>
            <span class="n">w</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestMIAPipelineManager.execute_QMessageBox_clickYes"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.execute_QMessageBox_clickYes">[docs]</a>    <span class="k">def</span> <span class="nf">execute_QMessageBox_clickYes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is supposed to allow to press the Yes button if a pipeline is </span>
<span class="sd">        overwritten in the test_zz_check_modifications method</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">activeWindow</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="p">):</span>
            <span class="n">close_button</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">)</span>
            <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">close_button</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIAPipelineManager.execute_QDialogClose"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.execute_QDialogClose">[docs]</a>    <span class="k">def</span> <span class="nf">execute_QDialogClose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is supposed to abort( close) a QDialog window</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">activeWindow</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">QDialog</span><span class="p">):</span>
            <span class="n">w</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="TestMIAPipelineManager.get_new_test_project"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.get_new_test_project">[docs]</a>    <span class="k">def</span> <span class="nf">get_new_test_project</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy the test project in a location we can modify safely</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">project_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;project_8&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">project_path</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">project_path</span><span class="p">)</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">mia_path</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">()</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mia_path</span><span class="p">,</span> <span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="s1">&#39;mia&#39;</span><span class="p">,</span>
                                      <span class="s1">&#39;project_8&#39;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="n">project_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">project_path</span></div>

<div class="viewcode-block" id="TestMIAPipelineManager.restart_MIA"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.restart_MIA">[docs]</a>    <span class="k">def</span> <span class="nf">restart_MIA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restarts MIA within a unit test.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Can be used to restart MIA after changing the controller version in MIA</span>
<span class="sd">        preferences.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Removing the opened projects (in CI, the tests are run twice)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_opened_projects</span><span class="p">([])</span>
        <span class="n">config</span><span class="o">.</span><span class="n">saveConfig</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_user_mode</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span> <span class="o">=</span> <span class="n">MainWindow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIAPipelineManager.setUp"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called before each test</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># All the tests are run in admin mode</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_user_mode</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span> <span class="o">=</span> <span class="n">MainWindow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIAPipelineManager.setUpClass"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.setUpClass">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called once at the beginning of the class</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">config_path</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;mia_tests&#39;</span><span class="p">)</span>
        <span class="c1"># hack the Config class to get config_path, because some Config</span>
        <span class="c1"># instances are created out of our control in the code</span>
        <span class="n">Config</span><span class="o">.</span><span class="n">config_path</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">config_path</span></div>

<div class="viewcode-block" id="TestMIAPipelineManager.tearDown"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called after each test</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Removing the opened projects (in CI, the tests are run twice)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_opened_projects</span><span class="p">([])</span>
        <span class="n">config</span><span class="o">.</span><span class="n">saveConfig</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestMIAPipelineManager.tearDownClass"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.tearDownClass">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">tearDownClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called once at the end of the class</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">config_path</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIAPipelineManager.test_add_tab"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.test_add_tab">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds tabs to the PipelineEditorTabs</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span>
                                                             <span class="n">pipelineEditorTabs</span><span class="p">)</span>

        <span class="c1"># Adding two new tabs</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">new_tab</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">tabText</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;New Pipeline 1&quot;</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">new_tab</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">tabText</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;New Pipeline 2&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIAPipelineManager.test_attributes_filter"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.test_attributes_filter">[docs]</a>    <span class="k">def</span> <span class="nf">test_attributes_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Displays the parameters of a node, displays an attributes filter</span>
<span class="sd">        and modifies it.</span>

<span class="sd">        Notes:</span>
<span class="sd">        -----</span>
<span class="sd">        Tests AttributesFilter within the Node Controller V2</span>
<span class="sd">        (CapsulNodeController()).</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Opens project 8 and switches to it</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">node_controller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">nodeController</span>

        <span class="c1"># Adds the process Smooth, creates a node called &quot;smooth_1&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Smooth</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Exports the input plugs</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s1">&#39;smooth_1&#39;</span>
        <span class="p">(</span><span class="n">ppl_edt_tabs</span><span class="o">.</span>
                 <span class="n">get_current_editor</span><span class="p">)()</span><span class="o">.</span><span class="n">export_node_unconnected_mandatory_plugs</span><span class="p">()</span>

        <span class="c1"># Displays parameters of &#39;inputs&#39; node</span>
        <span class="n">input_process</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">displayNodeParameters</span><span class="p">(</span><span class="s1">&#39;inputs&#39;</span><span class="p">,</span>
                                                                <span class="n">input_process</span><span class="p">)</span>

        <span class="c1"># Opens the attributes filter, selects item and closes it</span>
        <span class="n">node_controller</span><span class="o">.</span><span class="n">filter_attributes</span><span class="p">()</span>
        <span class="n">attributes_filter</span> <span class="o">=</span> <span class="n">node_controller</span><span class="o">.</span><span class="n">pop_up</span>
        <span class="n">attributes_filter</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">attributes_filter</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="c1"># Opens the attributes filter, does not select an item and closes it</span>
        <span class="n">node_controller</span><span class="o">.</span><span class="n">filter_attributes</span><span class="p">()</span>
        <span class="n">attributes_filter</span> <span class="o">=</span> <span class="n">node_controller</span><span class="o">.</span><span class="n">pop_up</span>
        <span class="n">attributes_filter</span><span class="o">.</span><span class="n">search_str</span><span class="p">(</span><span class="s1">&#39;!@#&#39;</span><span class="p">)</span>
        <span class="n">attributes_filter</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestMIAPipelineManager.test_capsul_node_controller"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.test_capsul_node_controller">[docs]</a>    <span class="k">def</span> <span class="nf">test_capsul_node_controller</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds, changes and deletes processes using the capsul node</span>
<span class="sd">        controller, displays the attributes filter.</span>

<span class="sd">        Notes:</span>
<span class="sd">        ------</span>
<span class="sd">        Tests the class CapsulNodeController().</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Opens project 8 and switches to it</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span>
                                              <span class="n">get_documents_names</span><span class="p">)(</span><span class="s2">&quot;current&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">node_ctrler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">nodeController</span>

        <span class="c1"># Adds 2 processes Rename, creates 2 nodes called &quot;rename_1&quot; and</span>
        <span class="c1"># &quot;rename_2&quot;:</span>
        <span class="n">process_class</span> <span class="o">=</span> <span class="n">Rename</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">process_class</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">process_class</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Displays parameters of &quot;rename_2&quot; node</span>
        <span class="n">rename_process</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;rename_2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">displayNodeParameters</span><span class="p">(</span><span class="s1">&#39;rename_2&#39;</span><span class="p">,</span>
                                                                <span class="n">rename_process</span><span class="p">)</span>

        <span class="c1"># Tries changing its name to &quot;rename_2&quot; and then to &quot;rename_3&quot;</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">update_node_name</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">node_ctrler</span><span class="o">.</span><span class="n">node_name</span><span class="p">,</span> <span class="s1">&#39;rename_2&#39;</span><span class="p">)</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">update_node_name</span><span class="p">(</span><span class="n">new_node_name</span><span class="o">=</span><span class="s1">&#39;rename_1&#39;</span><span class="p">,</span>
                                     <span class="n">old_node_name</span><span class="o">=</span><span class="s1">&#39;rename_2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">node_ctrler</span><span class="o">.</span><span class="n">node_name</span><span class="p">,</span> <span class="s1">&#39;rename_2&#39;</span><span class="p">)</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">update_node_name</span><span class="p">(</span><span class="n">new_node_name</span><span class="o">=</span><span class="s1">&#39;rename_3&#39;</span><span class="p">,</span>
                                     <span class="n">old_node_name</span><span class="o">=</span><span class="s1">&#39;rename_2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">node_ctrler</span><span class="o">.</span><span class="n">node_name</span><span class="p">,</span> <span class="s1">&#39;rename_3&#39;</span><span class="p">)</span>

        <span class="c1"># Deletes node &quot;rename_3&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">del_node</span><span class="p">(</span><span class="s2">&quot;rename_3&quot;</span><span class="p">)</span>

        <span class="c1"># Display parameters of the &quot;inputs&quot; node</span>
        <span class="n">input_process</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">display_parameters</span><span class="p">(</span><span class="s1">&#39;inputs&#39;</span><span class="p">,</span>
                                       <span class="n">get_process_instance</span><span class="p">(</span><span class="n">input_process</span><span class="p">),</span>
                                       <span class="n">pipeline</span><span class="p">)</span>

        <span class="c1"># Displays parameters of &quot;rename_1&quot; node</span>
        <span class="n">rename_process</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;rename_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">displayNodeParameters</span><span class="p">(</span><span class="s1">&#39;rename_1&#39;</span><span class="p">,</span>
                                                                <span class="n">rename_process</span><span class="p">)</span>

        <span class="c1"># Exports the input plugs for &quot;rename_1&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s1">&#39;rename_1&#39;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;rename_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s1">&#39;in_file&#39;</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;rename_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s1">&#39;format_string&#39;</span><span class="p">,</span>
                                                  <span class="s1">&#39;new_name.nii&#39;</span><span class="p">)</span>

        <span class="c1"># Runs pipeline and expects an error</span>
        <span class="c1"># self.main_window.pipeline_manager.runPipeline()</span>
        <span class="c1"># FIXME: running the pipeline gives the error &quot;wrapped C/C++ object of</span>
        <span class="c1">#        type PipelineEditorTabs has been deleted&quot;.</span>

        <span class="c1"># Displays attributes filter</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">filter_attributes</span><span class="p">()</span>
        <span class="n">attributes_filter</span> <span class="o">=</span> <span class="n">node_ctrler</span><span class="o">.</span><span class="n">pop_up</span>
        <span class="n">attributes_filter</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">attributes_filter</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="c1"># Releases the process</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">release_process</span><span class="p">()</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">update_parameters</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestMIAPipelineManager.test_close_tab"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.test_close_tab">[docs]</a>    <span class="k">def</span> <span class="nf">test_close_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Closes a tab in the PipelineEditorTabs</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span>
                                                             <span class="n">pipelineEditorTabs</span><span class="p">)</span>

        <span class="c1"># Adding a new tab and closing the first one</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">new_tab</span><span class="p">()</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">close_tab</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">tabText</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;New Pipeline 1&quot;</span><span class="p">)</span>

        <span class="c1"># When the last editor is closed, one is automatically opened</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">close_tab</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">tabText</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;New Pipeline&quot;</span><span class="p">)</span>

        <span class="c1"># Modifying the pipeline editor</span>
        <span class="n">process_class</span> <span class="o">=</span> <span class="n">Smooth</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
                                                                  <span class="n">process_class</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">tabText</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span> <span class="s2">&quot; *&quot;</span><span class="p">)</span></div>

        <span class="c1"># # Still some bug with the pop-up execution</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="c1"># # Closing the modified pipeline editor and clicking on &quot;Cancel&quot;</span>
        <span class="c1"># pipeline_editor_tabs.close_tab(0)</span>
        <span class="c1"># pop_up_close = pipeline_editor_tabs.pop_up_close</span>
        <span class="c1"># # QTest.mouseClick(pop_up_close.push_button_cancel, Qt.LeftButton)</span>
        <span class="c1"># # QTimer.singleShot(0, pop_up_close.push_button_cancel.clicked)</span>
        <span class="c1"># pop_up_close.cancel_clicked()</span>
        <span class="c1"># self.assertEqual(pipeline_editor_tabs.count(), 2)</span>
        <span class="c1">#</span>
        <span class="c1"># # Closing the modified pipeline editor and clicking on &quot;Do not save&quot;</span>
        <span class="c1"># pipeline_editor_tabs.close_tab(0)</span>
        <span class="c1"># pop_up_close = pipeline_editor_tabs.pop_up_close</span>
        <span class="c1"># # QTest.mouseClick(pop_up_close.push_button_do_not_save, Qt.LeftButton)</span>
        <span class="c1"># # QTimer.singleShot(0, pop_up_close.push_button_cancel.clicked)</span>
        <span class="c1"># pop_up_close.do_not_save_clicked()</span>
        <span class="c1"># self.assertEqual(pipeline_editor_tabs.count(), 1)</span>

        <span class="c1"># TODO: HOW TO TEST &quot;SAVE AS&quot; ACTION ?</span>

<div class="viewcode-block" id="TestMIAPipelineManager.test_display_filter"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.test_display_filter">[docs]</a>    <span class="k">def</span> <span class="nf">test_display_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays parameters of a node and displays a plug filter</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span>
                                                             <span class="n">pipelineEditorTabs</span><span class="p">)</span>
        <span class="n">node_controller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">nodeController</span>

        <span class="c1"># Adding a process</span>
        <span class="n">process_class</span> <span class="o">=</span> <span class="n">Threshold</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="c1"># Creates a node called &quot;threshold_1&quot;</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
                                                                  <span class="n">process_class</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Exporting the input plugs and modifying the &quot;synchronize&quot; input plug</span>
        <span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span>
                         <span class="n">get_current_editor</span><span class="p">)()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s2">&quot;threshold_1&quot;</span>
        <span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span>
                      <span class="n">get_current_editor</span><span class="p">)()</span><span class="o">.</span><span class="n">export_node_all_unconnected_inputs</span><span class="p">()</span>

        <span class="n">input_process</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="n">node_controller</span><span class="o">.</span><span class="n">display_parameters</span><span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">,</span>
                                           <span class="n">get_process_instance</span><span class="p">(</span><span class="n">input_process</span><span class="p">),</span>
                                           <span class="n">pipeline</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node_controller</span><span class="p">,</span> <span class="s1">&#39;get_index_from_plug_name&#39;</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">node_controller</span><span class="o">.</span><span class="n">get_index_from_plug_name</span><span class="p">(</span><span class="s2">&quot;synchronize&quot;</span><span class="p">,</span>
                                                             <span class="s2">&quot;in&quot;</span><span class="p">)</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_input</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>
            <span class="c1"># This calls &quot;update_plug_value&quot; method</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_input</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

            <span class="c1"># Calling the display_filter method</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">display_filter</span><span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;synchronize&quot;</span><span class="p">,</span> <span class="p">(),</span>
                                           <span class="n">input_process</span><span class="p">)</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">pop_up</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                             <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;threshold_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_plug_value</span><span class="p">(</span>
                                                                 <span class="s2">&quot;synchronize&quot;</span><span class="p">))</span></div>
        <span class="c1"># TODO 1: currently we do not enter in the last if statement (controller</span>
        <span class="c1">#         v2). Implement the switch to V1 controller to enable the</span>
        <span class="c1">#         last if</span>
        <span class="c1"># TODO 2: open a project and modify the filter pop-up</span>

<div class="viewcode-block" id="TestMIAPipelineManager.test_drop_process"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.test_drop_process">[docs]</a>    <span class="k">def</span> <span class="nf">test_drop_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a Nipype SPM&#39;s Smooth process to the pipeline editor</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span>
                                                             <span class="n">pipelineEditorTabs</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">drop_process</span><span class="p">(</span>
                                                 <span class="s1">&#39;nipype.interfaces.spm.Smooth&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s1">&#39;smooth_1&#39;</span> <span class="ow">in</span>
                        <span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span>
                                           <span class="n">get_current_pipeline</span><span class="p">)()</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

<div class="viewcode-block" id="TestMIAPipelineManager.test_filter_widget"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.test_filter_widget">[docs]</a>    <span class="k">def</span> <span class="nf">test_filter_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Places a node of the &quot;Input_Filter&quot; process, feeds in documents</span>
<span class="sd">        and opens up the &quot;FilterWidget()&quot; to modify its parameters.</span>

<span class="sd">        Notes:</span>
<span class="sd">        -----</span>
<span class="sd">        Tests the class FilterWidget() within the Node Controller V1</span>
<span class="sd">        (class NodeController()). The class FilterWidget() is</span>
<span class="sd">        independent on the Node</span>
<span class="sd">        Controller version (V1 or V2) and can be used in both of them.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Switches to node controller V1</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">setControlV1</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">restart_MIA</span><span class="p">()</span>

        <span class="c1"># Opens project 8 and switches to it</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="n">DOCUMENT_2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span>
                                              <span class="n">get_documents_names</span><span class="p">)(</span><span class="s2">&quot;current&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">node_ctrler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">nodeController</span>

        <span class="c1"># Adds the process Smooth, creates the node &quot;input_filter_1&quot;</span>
        <span class="n">process_class</span> <span class="o">=</span> <span class="n">Input_Filter</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">process_class</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Exports the input plugs for &quot;input_filter_1&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s1">&#39;input_filter_1&#39;</span>
        <span class="p">(</span><span class="n">ppl_edt_tabs</span><span class="o">.</span>
                 <span class="n">get_current_editor</span><span class="p">)()</span><span class="o">.</span><span class="n">export_node_unconnected_mandatory_plugs</span><span class="p">()</span>

        <span class="c1"># Displays parameters of the &quot;inputs&quot; node</span>
        <span class="n">input_process</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">display_parameters</span><span class="p">(</span><span class="s1">&#39;inputs&#39;</span><span class="p">,</span>
                                       <span class="n">get_process_instance</span><span class="p">(</span><span class="n">input_process</span><span class="p">),</span>
                                       <span class="n">pipeline</span><span class="p">)</span>

        <span class="c1"># Opens a filter for the plug &quot;input&quot; of the &quot;inputs&quot; node</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">Undefined</span><span class="p">))</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">display_filter</span><span class="p">(</span><span class="s1">&#39;inputs&#39;</span><span class="p">,</span> <span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span>
                                   <span class="n">input_process</span><span class="p">)</span>

        <span class="c1"># Selects all records in the &quot;input&quot; node</span>
        <span class="n">plug_filter</span> <span class="o">=</span> <span class="n">node_ctrler</span><span class="o">.</span><span class="n">pop_up</span>
        <span class="n">plug_filter</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="c1"># Opens the filter widget for the node &quot;input_filter_1&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">open_filter</span><span class="p">(</span><span class="s1">&#39;input_filter_1&#39;</span><span class="p">)</span>
        <span class="n">input_filter</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">filter_widget</span>

        <span class="c1">#index_DOCUMENT_1 = input_filter.table_data.get_scan_row(DOCUMENT_1)</span>
        <span class="c1">#index_DOCUMENT_2 = input_filter.table_data.get_scan_row(DOCUMENT_2)</span>

        <span class="c1"># Tries to search for an empty string and asserts that none of the</span>
        <span class="c1"># documents are not hidden</span>
        <span class="n">input_filter</span><span class="o">.</span><span class="n">search_str</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="c1"># self.assertFalse(input_filter.table_data.isRowHidden(index_DOCUMENT_1)) # if &quot;DOCUMENT_1&quot; is not hidden</span>
        <span class="c1"># self.assertFalse(input_filter.table_data.isRowHidden(index_DOCUMENT_2)) # if &quot;DOCUMENT_1&quot; is not hidden</span>

        <span class="c1"># Searches for &quot;DOCUMENT_2&quot; and verifies that &quot;DOCUMENT_1&quot; is hidden</span>
        <span class="n">input_filter</span><span class="o">.</span><span class="n">search_str</span><span class="p">(</span><span class="n">DOCUMENT_2</span><span class="p">)</span>
        <span class="c1"># self.assertTrue(input_filter.table_data.isRowHidden(index_DOCUMENT_1))</span>

        <span class="c1"># Resets the search bar and assert that none of the documents are not hidden</span>
        <span class="n">input_filter</span><span class="o">.</span><span class="n">reset_search_bar</span><span class="p">()</span>
        <span class="c1"># self.assertFalse(input_filter.table_data.isRowHidden(index_DOCUMENT_1)) # if &quot;DOCUMENT_1&quot; is not hidden</span>
        <span class="c1"># self.assertFalse(input_filter.table_data.isRowHidden(index_DOCUMENT_2)) # if &quot;DOCUMENT_1&quot; is not hidden</span>
        <span class="c1"># FIXME: input_filter.table_data.isRowHidden() does not work as expected</span>

        <span class="c1"># Opens the &quot;Visualized tags&quot; pop up and adds the &quot;AcquisitionDate&quot; tag</span>
        <span class="n">input_filter</span><span class="o">.</span><span class="n">update_tags</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_visualized_tag</span><span class="p">(</span><span class="s1">&#39;AcquisitionDate&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">input_filter</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span>
                                      <span class="n">get_tag_column</span><span class="p">(</span><span class="s1">&#39;AcquisitionDate&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="nb">int</span><span class="p">)</span>

        <span class="c1"># Updates the tag to filter with</span>
        <span class="n">input_filter</span><span class="o">.</span><span class="n">update_tag_to_filter</span><span class="p">()</span>
        <span class="n">input_filter</span><span class="o">.</span><span class="n">push_button_tag_filter</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;FileName&#39;</span><span class="p">)</span>
        <span class="c1"># TODO: select tag to filter with</span>

        <span class="c1"># Closes the filter</span>
        <span class="n">input_filter</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="c1"># Switches back to node controller V2</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">setControlV1</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

    <span class="c1"># def test_init_MIA_processes(self):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     Adds all the tools processes, initializes and runs the pipeline</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#     # Forcing the exit</span>
    <span class="c1">#     self.main_window.force_exit = True</span>
    <span class="c1">#</span>
    <span class="c1">#     # Adding the processes path to the system path</span>
    <span class="c1">#     import sys</span>
    <span class="c1">#     sys.path.append(os.path.join(&#39;..&#39;, &#39;..&#39;, &#39;processes&#39;))</span>
    <span class="c1">#</span>
    <span class="c1">#     pipeline_editor_tabs = self.main_window.pipeline_manager.pipelineEditorTabs</span>
    <span class="c1">#</span>
    <span class="c1">#     pipeline_editor_tabs.get_current_editor().click_pos = QPoint(450, 500)</span>
    <span class="c1">#</span>
    <span class="c1">#     # Importing the package</span>
    <span class="c1">#     package_name = &#39;MIA_processes.IRMaGe.Tools&#39;</span>
    <span class="c1">#     __import__(package_name)</span>
    <span class="c1">#     pkg = sys.modules[package_name]</span>
    <span class="c1">#     process_class = None</span>
    <span class="c1">#     for name, cls in sorted(list(pkg.__dict__.items())):</span>
    <span class="c1">#         if name != &quot;Input_Filter&quot;:</span>
    <span class="c1">#             try:</span>
    <span class="c1">#                 proc_instance = get_process_instance(cls)</span>
    <span class="c1">#             except:</span>
    <span class="c1">#                 pass</span>
    <span class="c1">#             else:</span>
    <span class="c1">#                 print(&quot;class&quot;, cls)</span>
    <span class="c1">#                 process_class = cls</span>
    <span class="c1">#                 pipeline_editor_tabs.get_current_editor().add_process(process_class)</span>
    <span class="c1">#</span>
    <span class="c1">#     pipeline = pipeline_editor_tabs.get_current_pipeline()</span>
    <span class="c1">#</span>
    <span class="c1">#     # Verifying that all the processes are here</span>
    <span class="c1">#     self.assertTrue(&#39;duplicate_file1&#39; in pipeline.nodes.keys())</span>
    <span class="c1">#     self.assertTrue(&#39;find_in_list1&#39; in pipeline.nodes.keys())</span>
    <span class="c1">#     self.assertTrue(&#39;files_to_list1&#39; in pipeline.nodes.keys())</span>
    <span class="c1">#     self.assertTrue(&#39;list_to_file1&#39; in pipeline.nodes.keys())</span>
    <span class="c1">#     self.assertTrue(&#39;list_duplicate1&#39; in pipeline.nodes.keys())</span>
    <span class="c1">#     self.assertTrue(&#39;roi_list_generator1&#39; in pipeline.nodes.keys())</span>
    <span class="c1">#</span>
    <span class="c1">#     # Setting values to verify that the initialization works well</span>
    <span class="c1">#     pipeline.nodes[&#39;duplicate_file1&#39;].set_plug_value(&#39;file1&#39;, &#39;test_file.txt&#39;)</span>
    <span class="c1">#     pipeline.nodes[&#39;find_in_list1&#39;].set_plug_value(&#39;in_list&#39;, [&#39;test1.txt&#39;, &#39;test2.txt&#39;])</span>
    <span class="c1">#     pipeline.nodes[&#39;find_in_list1&#39;].set_plug_value(&#39;pattern&#39;, &#39;1&#39;)</span>
    <span class="c1">#     pipeline.nodes[&#39;files_to_list1&#39;].set_plug_value(&#39;file1&#39;, &#39;test1.txt&#39;)</span>
    <span class="c1">#     pipeline.nodes[&#39;files_to_list1&#39;].set_plug_value(&#39;file2&#39;, &#39;test2.txt&#39;)</span>
    <span class="c1">#     pipeline.nodes[&#39;list_to_file1&#39;].set_plug_value(&#39;file_list&#39;, [&#39;test1.txt&#39;, &#39;test2.txt&#39;])</span>
    <span class="c1">#     pipeline.nodes[&#39;list_duplicate1&#39;].set_plug_value(&#39;file_name&#39;, &#39;test_file.txt&#39;)</span>
    <span class="c1">#     pipeline.nodes[&#39;roi_list_generator1&#39;].set_plug_value(&#39;pos&#39;, [&#39;TEST1&#39;, &#39;TEST2&#39;])</span>
    <span class="c1">#</span>
    <span class="c1">#     # Initialization/run of the pipeline</span>
    <span class="c1">#     self.main_window.pipeline_manager.init_pipeline()</span>
    <span class="c1">#     self.main_window.pipeline_manager.runPipeline()</span>
    <span class="c1">#</span>
    <span class="c1">#     # Verifying the results</span>
    <span class="c1">#     self.assertEqual(pipeline.nodes[&#39;duplicate_file1&#39;].get_plug_value(&#39;out_file1&#39;), &#39;test_file.txt&#39;)</span>
    <span class="c1">#     self.assertEqual(pipeline.nodes[&#39;duplicate_file1&#39;].get_plug_value(&#39;out_file2&#39;), &#39;test_file.txt&#39;)</span>
    <span class="c1">#     self.assertEqual(pipeline.nodes[&#39;find_in_list1&#39;].get_plug_value(&#39;out_file&#39;), &#39;test1.txt&#39;)</span>
    <span class="c1">#     self.assertEqual(pipeline.nodes[&#39;files_to_list1&#39;].get_plug_value(&#39;file_list&#39;), [&#39;test1.txt&#39;, &#39;test2.txt&#39;])</span>
    <span class="c1">#     self.assertEqual(pipeline.nodes[&#39;list_to_file1&#39;].get_plug_value(&#39;file&#39;), &#39;test1.txt&#39;)</span>
    <span class="c1">#     self.assertEqual(pipeline.nodes[&#39;list_duplicate1&#39;].get_plug_value(&#39;out_list&#39;), [&#39;test_file.txt&#39;])</span>
    <span class="c1">#     self.assertEqual(pipeline.nodes[&#39;list_duplicate1&#39;].get_plug_value(&#39;out_file&#39;), &#39;test_file.txt&#39;)</span>
    <span class="c1">#     self.assertEqual(pipeline.nodes[&#39;roi_list_generator1&#39;].get_plug_value(&#39;roi_list&#39;), [[&#39;TEST1&#39;, &#39;_L&#39;],</span>
    <span class="c1">#                                                                                         [&#39;TEST1&#39;, &#39;_R&#39;],</span>
    <span class="c1">#                                                                                         [&#39;TEST2&#39;, &#39;_L&#39;],</span>
    <span class="c1">#                                                                                         [&#39;TEST2&#39;, &#39;_R&#39;]])</span>
    <span class="c1">#</span>
    <span class="c1"># def test_init_SPM_pre_processes(self):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     Adds all SPM pre-processes and initializes the pipeline</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#     # Forcing the exit</span>
    <span class="c1">#     self.main_window.force_exit = True</span>
    <span class="c1">#</span>
    <span class="c1">#     # Adding the processes path to the system path</span>
    <span class="c1">#     import sys</span>
    <span class="c1">#     sys.path.append(os.path.join(&#39;..&#39;, &#39;..&#39;, &#39;processes&#39;))</span>
    <span class="c1">#</span>
    <span class="c1">#     pipeline_editor_tabs = self.main_window.pipeline_manager.pipelineEditorTabs</span>
    <span class="c1">#</span>
    <span class="c1">#     pipeline_editor_tabs.get_current_editor().click_pos = QPoint(450, 500)</span>
    <span class="c1">#</span>
    <span class="c1">#     # Importing the package</span>
    <span class="c1">#     package_name = &#39;MIA_processes.SPM&#39;</span>
    <span class="c1">#     __import__(package_name)</span>
    <span class="c1">#     pkg = sys.modules[package_name]</span>
    <span class="c1">#     process_class = None</span>
    <span class="c1">#     preproc_list = [&#39;Smooth&#39;, &#39;NewSegment&#39;, &#39;Normalize&#39;, &#39;Realign&#39;, &#39;Coregister&#39;]</span>
    <span class="c1">#     for name, cls in sorted(list(pkg.__dict__.items())):</span>
    <span class="c1">#         if name in preproc_list:</span>
    <span class="c1">#             try:</span>
    <span class="c1">#                 proc_instance = get_process_instance(cls)</span>
    <span class="c1">#             except:</span>
    <span class="c1">#                 pass</span>
    <span class="c1">#             else:</span>
    <span class="c1">#                 process_class = cls</span>
    <span class="c1">#                 pipeline_editor_tabs.get_current_editor().add_process(process_class)</span>
    <span class="c1">#</span>
    <span class="c1">#     pipeline = pipeline_editor_tabs.get_current_pipeline()</span>
    <span class="c1">#</span>
    <span class="c1">#     # Verifying that all the processes are here</span>
    <span class="c1">#     self.assertTrue(&#39;smooth1&#39; in pipeline.nodes.keys())</span>
    <span class="c1">#     self.assertTrue(&#39;newsegment1&#39; in pipeline.nodes.keys())</span>
    <span class="c1">#     self.assertTrue(&#39;normalize1&#39; in pipeline.nodes.keys())</span>
    <span class="c1">#     self.assertTrue(&#39;realign1&#39; in pipeline.nodes.keys())</span>
    <span class="c1">#     self.assertTrue(&#39;coregister1&#39; in pipeline.nodes.keys())</span>
    <span class="c1">#</span>
    <span class="c1">#     # Choosing a nii file from the project_8&#39;s raw_data folder</span>
    <span class="c1">#     folder = os.path.join(&#39;project_8&#39;, &#39;data&#39;, &#39;raw_data&#39;)</span>
    <span class="c1">#     nii_file = &#39;Guerbet-C6-2014-Rat-K52-Tube27-2014-02-14102317-01-G1_Guerbet_Anat-RAREpvm-000220_000.nii&#39;</span>
    <span class="c1">#     nii_no_ext = &#39;Guerbet-C6-2014-Rat-K52-Tube27-2014-02-14102317-01-G1_Guerbet_Anat-RAREpvm-000220_000&#39;</span>
    <span class="c1">#     nii_path = os.path.abspath(os.path.join(folder, nii_file))</span>
    <span class="c1">#</span>
    <span class="c1">#     # Setting values to verify that the initialization works well</span>
    <span class="c1">#     pipeline.nodes[&#39;smooth1&#39;].set_plug_value(&#39;in_files&#39;, nii_path)</span>
    <span class="c1">#     pipeline.nodes[&#39;newsegment1&#39;].set_plug_value(&#39;channel_files&#39;, nii_path)</span>
    <span class="c1">#     pipeline.nodes[&#39;normalize1&#39;].set_plug_value(&#39;apply_to_files&#39;, nii_path)</span>
    <span class="c1">#     if os.path.isfile(os.path.join(folder, &#39;y_&#39; + nii_file)):</span>
    <span class="c1">#         pipeline.nodes[&#39;normalize1&#39;].set_plug_value(&#39;deformation_file&#39;,</span>
    <span class="c1">#                                                     os.path.abspath(os.path.join(folder, &#39;y_&#39; + nii_file)))</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         # This makes no sense but for the moment, we only check the initialization</span>
    <span class="c1">#         # and we just need to put a file in this plug</span>
    <span class="c1">#         pipeline.nodes[&#39;normalize1&#39;].set_plug_value(&#39;deformation_file&#39;,</span>
    <span class="c1">#                                                     os.path.abspath(os.path.join(folder, nii_file)))</span>
    <span class="c1">#</span>
    <span class="c1">#     pipeline.nodes[&#39;realign1&#39;].set_plug_value(&#39;in_files&#39;, nii_path)</span>
    <span class="c1">#</span>
    <span class="c1">#     # This makes no sense but for the moment, we only check the initialization</span>
    <span class="c1">#     # and we just need to put a file in this plug</span>
    <span class="c1">#     pipeline.nodes[&#39;coregister1&#39;].set_plug_value(&#39;apply_to_files&#39;, nii_path)</span>
    <span class="c1">#     pipeline.nodes[&#39;coregister1&#39;].set_plug_value(&#39;target&#39;, nii_path)</span>
    <span class="c1">#     pipeline.nodes[&#39;coregister1&#39;].set_plug_value(&#39;source&#39;, nii_path)</span>
    <span class="c1">#</span>
    <span class="c1">#     # Initialization/run of the pipeline</span>
    <span class="c1">#     self.main_window.pipeline_manager.init_pipeline()</span>
    <span class="c1">#</span>
    <span class="c1">#     # Verifying the results</span>
    <span class="c1">#     self.assertEqual(pipeline.nodes[&#39;smooth1&#39;].get_plug_value(&#39;smoothed_files&#39;),</span>
    <span class="c1">#                      os.path.abspath(os.path.join(folder, &#39;s&#39; + nii_file)))</span>
    <span class="c1">#     self.assertTrue(pipeline.nodes[&#39;newsegment1&#39;].get_plug_value(&#39;native_class_images&#39;),</span>
    <span class="c1">#                     os.path.abspath(os.path.join(folder, &#39;c1&#39; + nii_file)))</span>
    <span class="c1">#     self.assertTrue(pipeline.nodes[&#39;newsegment1&#39;].get_plug_value(&#39;native_class_images&#39;),</span>
    <span class="c1">#                     os.path.abspath(os.path.join(folder, &#39;c2&#39; + nii_file)))</span>
    <span class="c1">#     self.assertTrue(pipeline.nodes[&#39;newsegment1&#39;].get_plug_value(&#39;native_class_images&#39;),</span>
    <span class="c1">#                     os.path.abspath(os.path.join(folder, &#39;c3&#39; + nii_file)))</span>
    <span class="c1">#     self.assertTrue(pipeline.nodes[&#39;newsegment1&#39;].get_plug_value(&#39;native_class_images&#39;),</span>
    <span class="c1">#                     os.path.abspath(os.path.join(folder, &#39;c4&#39; + nii_file)))</span>
    <span class="c1">#     self.assertTrue(pipeline.nodes[&#39;newsegment1&#39;].get_plug_value(&#39;native_class_images&#39;),</span>
    <span class="c1">#                     os.path.abspath(os.path.join(folder, &#39;c5&#39; + nii_file)))</span>
    <span class="c1">#     self.assertTrue(pipeline.nodes[&#39;newsegment1&#39;].get_plug_value(&#39;native_class_images&#39;),</span>
    <span class="c1">#                     os.path.abspath(os.path.join(folder, &#39;c6&#39; + nii_file)))</span>
    <span class="c1">#     self.assertEqual(pipeline.nodes[&#39;newsegment1&#39;].get_plug_value(&#39;bias_field_images&#39;),</span>
    <span class="c1">#                      os.path.abspath(os.path.join(folder, &#39;BiasField_&#39; + nii_file)))</span>
    <span class="c1">#     self.assertEqual(pipeline.nodes[&#39;newsegment1&#39;].get_plug_value(&#39;forward_deformation_field&#39;),</span>
    <span class="c1">#                      os.path.abspath(os.path.join(folder, &#39;y_&#39; + nii_file)))</span>
    <span class="c1">#     self.assertEqual(pipeline.nodes[&#39;normalize1&#39;].get_plug_value(&#39;normalized_files&#39;),</span>
    <span class="c1">#                      os.path.abspath(os.path.join(folder, &#39;w&#39; + nii_file)))</span>
    <span class="c1">#     self.assertEqual(pipeline.nodes[&#39;realign1&#39;].get_plug_value(&#39;realigned_files&#39;),</span>
    <span class="c1">#                      os.path.abspath(os.path.join(folder, &#39;r&#39; + nii_file)))</span>
    <span class="c1">#     self.assertEqual(pipeline.nodes[&#39;realign1&#39;].get_plug_value(&#39;mean_image&#39;),</span>
    <span class="c1">#                      os.path.abspath(os.path.join(folder, &#39;mean&#39; + nii_file)))</span>
    <span class="c1">#     self.assertEqual(pipeline.nodes[&#39;realign1&#39;].get_plug_value(&#39;realignment_parameters&#39;),</span>
    <span class="c1">#                      os.path.abspath(os.path.join(folder, &#39;rp_&#39; + nii_no_ext + &#39;.txt&#39;)))</span>
    <span class="c1">#     self.assertEqual(pipeline.nodes[&#39;coregister1&#39;].get_plug_value(&#39;coregistered_files&#39;),</span>
    <span class="c1">#                      os.path.abspath(os.path.join(folder, nii_file)))</span>

<div class="viewcode-block" id="TestMIAPipelineManager.test_iteration_table"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.test_iteration_table">[docs]</a>    <span class="k">def</span> <span class="nf">test_iteration_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plays with the iteration table</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="n">iteration_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">iterationTable</span>
        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_QDialogAccept</span><span class="p">)</span>
        <span class="n">iteration_table</span><span class="o">.</span><span class="n">check_box_iterate</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">iteration_table</span><span class="o">.</span><span class="n">update_selected_tag</span><span class="p">(</span><span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
        <span class="n">iteration_table</span><span class="o">.</span><span class="n">update_iterated_tag</span><span class="p">(</span><span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">iteration_table</span><span class="o">.</span><span class="n">iterated_tag_label</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
                         <span class="s2">&quot;BandWidth:&quot;</span><span class="p">)</span>
        <span class="n">iteration_table</span><span class="o">.</span><span class="n">add_tag</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iteration_table</span><span class="o">.</span><span class="n">push_buttons</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">iteration_table</span><span class="o">.</span><span class="n">remove_tag</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iteration_table</span><span class="o">.</span><span class="n">push_buttons</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">iteration_table</span><span class="o">.</span><span class="n">add_tag</span><span class="p">()</span>
        <span class="n">iteration_table</span><span class="o">.</span><span class="n">push_buttons</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;AcquisitionTime&quot;</span><span class="p">)</span>
        <span class="n">iteration_table</span><span class="o">.</span><span class="n">fill_values</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">iteration_table</span><span class="o">.</span><span class="n">update_table</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">iteration_table</span><span class="o">.</span><span class="n">combo_box</span><span class="o">.</span><span class="n">currentText</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span>
                                                                     <span class="s2">&quot;65789.48&quot;</span><span class="p">,</span>
                                                                     <span class="s2">&quot;25000.0&quot;</span><span class="p">,</span>
                                                                     <span class="s2">&quot;50000.0&quot;</span><span class="p">])</span></div>

    <span class="sd">&#39;&#39;&#39;def test_open_filter(self):</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        Opens an input filter</span>
<span class="sd">        &quot;&quot;&quot;</span>

<span class="sd">        # Adding the processes path to the system path</span>
<span class="sd">        import sys</span>
<span class="sd">        sys.path.append(os.path.join(&#39;..&#39;, &#39;..&#39;, &#39;processes&#39;))</span>

<span class="sd">        # Importing the package</span>
<span class="sd">        package_name = &#39;MIA_processes.IRMaGe.Tools&#39;</span>
<span class="sd">        __import__(package_name)</span>
<span class="sd">        pkg = sys.modules[package_name]</span>
<span class="sd">        process_class = None</span>
<span class="sd">        for name, cls in sorted(list(pkg.__dict__.items())):</span>
<span class="sd">            if name == &#39;Input_Filter&#39;:</span>
<span class="sd">                process_class = cls</span>

<span class="sd">        if not process_class:</span>
<span class="sd">            print(&#39;No Input_Filer class found&#39;)</span>
<span class="sd">            return</span>

<span class="sd">        pipeline_editor_tabs = self.main_window.pipeline_manager.pipelineEditorTabs</span>
<span class="sd">        pipeline = pipeline_editor_tabs.get_current_pipeline()</span>

<span class="sd">        pipeline_editor_tabs.get_current_editor().click_pos = QPoint(450, 500)</span>
<span class="sd">        pipeline_editor_tabs.get_current_editor().add_process(process_class)  # Creates a node called &quot;input_filter1&quot;</span>
<span class="sd">        pipeline_editor_tabs.open_filter(&quot;input_filter1&quot;)</span>
<span class="sd">        pipeline_editor_tabs.filter_widget.close()</span>
<span class="sd">        self.assertFalse(pipeline.nodes[&quot;input_filter1&quot;].get_plug_value(&quot;output&quot;))</span>

<span class="sd">        # TODO: open a project and modify the filter pop-up</span>
<span class="sd">    &#39;&#39;&#39;</span>

<div class="viewcode-block" id="TestMIAPipelineManager.test_node_controller"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.test_node_controller">[docs]</a>    <span class="k">def</span> <span class="nf">test_node_controller</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds, changes and deletes processes to the node controller,</span>
<span class="sd">        display the attributes filter.</span>

<span class="sd">        Notes:</span>
<span class="sd">        ------</span>
<span class="sd">        Tests the class NodeController().</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Switches to node controller V1</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">setControlV1</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">restart_MIA</span><span class="p">()</span>

        <span class="c1"># Opens project 8 and switches to it</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span>
                                              <span class="n">get_documents_names</span><span class="p">)(</span><span class="s2">&quot;current&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">node_ctrler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">nodeController</span>

        <span class="c1"># Adds the process Rename, creates the &quot;rename_1&quot; nodes</span>
        <span class="n">process_class</span> <span class="o">=</span> <span class="n">Rename</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">process_class</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">process_class</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Displays parameters of &quot;rename_2&quot; node</span>
        <span class="n">rename_process</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;rename_2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">displayNodeParameters</span><span class="p">(</span><span class="s1">&#39;rename_2&#39;</span><span class="p">,</span>
                                                                <span class="n">rename_process</span><span class="p">)</span>

        <span class="c1"># Tries to changes its name to &quot;rename_2&quot; and then to &quot;rename_3&quot;</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">update_node_name</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">node_ctrler</span><span class="o">.</span><span class="n">node_name</span><span class="p">,</span> <span class="s1">&#39;rename_2&#39;</span><span class="p">)</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">update_node_name</span><span class="p">(</span><span class="n">new_node_name</span><span class="o">=</span><span class="s1">&#39;rename_1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">node_ctrler</span><span class="o">.</span><span class="n">node_name</span><span class="p">,</span> <span class="s1">&#39;rename_2&#39;</span><span class="p">)</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">update_node_name</span><span class="p">(</span><span class="n">new_node_name</span><span class="o">=</span><span class="s1">&#39;rename_3&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">node_ctrler</span><span class="o">.</span><span class="n">node_name</span><span class="p">,</span> <span class="s1">&#39;rename_3&#39;</span><span class="p">)</span>

        <span class="c1"># Deletes node &quot;rename_2&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">del_node</span><span class="p">(</span><span class="s2">&quot;rename_3&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;rename_3&#39;</span><span class="p">])</span>

        <span class="c1"># Exports the input plugs for &quot;rename_1&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s1">&#39;rename_1&#39;</span>
        <span class="p">(</span><span class="n">ppl_edt_tabs</span><span class="o">.</span>
                     <span class="n">get_current_editor</span><span class="p">)()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="c1"># Display parameters of the &quot;inputs&quot; node</span>
        <span class="n">input_process</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">display_parameters</span><span class="p">(</span><span class="s1">&#39;inputs&#39;</span><span class="p">,</span>
                                       <span class="n">get_process_instance</span><span class="p">(</span><span class="n">input_process</span><span class="p">),</span>
                                       <span class="n">pipeline</span><span class="p">)</span>

        <span class="c1"># Display the filter of the &#39;in_file&#39; plug, &quot;inputs&quot; node</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">display_filter</span><span class="p">(</span><span class="s1">&#39;inputs&#39;</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">,</span>
                                   <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">Undefined</span><span class="p">)),</span>
                                   <span class="n">input_process</span><span class="p">)</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">pop_up</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Sets the values of the mandatory plugs</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s1">&#39;in_file&#39;</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s1">&#39;format_string&#39;</span><span class="p">,</span> <span class="s1">&#39;new_file.nii&#39;</span><span class="p">)</span>

        <span class="c1"># Checks the indexed of input and output plug labels</span>
        <span class="n">in_plug_index</span> <span class="o">=</span> <span class="n">node_ctrler</span><span class="o">.</span><span class="n">get_index_from_plug_name</span><span class="p">(</span><span class="s1">&#39;in_file&#39;</span><span class="p">,</span><span class="s1">&#39;in&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">in_plug_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">out_plug_index</span> <span class="o">=</span> <span class="n">node_ctrler</span><span class="o">.</span><span class="n">get_index_from_plug_name</span><span class="p">(</span><span class="s1">&#39;_out_file&#39;</span><span class="p">,</span>
                                                              <span class="s1">&#39;out&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">out_plug_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Tries to updates the plug value without a new value</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">update_plug_value</span><span class="p">(</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span>
                                      <span class="nb">type</span><span class="p">(</span><span class="n">Undefined</span><span class="p">))</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">update_plug_value</span><span class="p">(</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="s1">&#39;_out_file&#39;</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span>
                                      <span class="nb">type</span><span class="p">(</span><span class="n">Undefined</span><span class="p">))</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">update_plug_value</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span>
                                      <span class="nb">type</span><span class="p">(</span><span class="n">Undefined</span><span class="p">))</span>

        <span class="c1"># Tries to updates the plug value with a new value</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">update_plug_value</span><span class="p">(</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span>
                                      <span class="n">new_value</span><span class="o">=</span><span class="s1">&#39;new_value.nii&#39;</span><span class="p">)</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">update_plug_value</span><span class="p">(</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="s1">&#39;_out_file&#39;</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span>
                                      <span class="n">new_value</span><span class="o">=</span><span class="s1">&#39;new_value.nii&#39;</span><span class="p">)</span>

        <span class="c1"># Releases the process</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">release_process</span><span class="p">()</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">update_parameters</span><span class="p">()</span>

        <span class="c1"># Switches back to node controller V2</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">setControlV1</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIAPipelineManager.test_plug_filter"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.test_plug_filter">[docs]</a>    <span class="k">def</span> <span class="nf">test_plug_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays the parameters of a node, displays a plug filter</span>
<span class="sd">        and modifies it.</span>

<span class="sd">        Notes:</span>
<span class="sd">        -----</span>
<span class="sd">        Tests the class PlugFilter() within the Node Controller V1</span>
<span class="sd">        (class NodeController()).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Switches to node controller V1</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">setControlV1</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">restart_MIA</span><span class="p">()</span>

        <span class="c1"># Opens project 8 and switches to it</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="c1"># Get the 2 first documents/records</span>
        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span>
                                              <span class="n">get_documents_names</span><span class="p">)(</span><span class="s2">&quot;current&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">DOCUMENT_2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span>
                                              <span class="n">get_documents_names</span><span class="p">)(</span><span class="s2">&quot;current&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span>
                                                             <span class="n">pipelineEditorTabs</span><span class="p">)</span>
        <span class="n">node_controller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">nodeController</span>

        <span class="c1"># Add the &quot;Smooth&quot; process</span>
        <span class="n">process_class</span> <span class="o">=</span> <span class="n">Smooth</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>

        <span class="c1"># Creates a node called &quot;smooth_1&quot;</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
                                                                  <span class="n">process_class</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Exports the mandatory plugs</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s2">&quot;smooth_1&quot;</span>
        <span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span>
                 <span class="n">get_current_editor</span><span class="p">)()</span><span class="o">.</span><span class="n">export_node_unconnected_mandatory_plugs</span><span class="p">()</span>

        <span class="c1"># Display parameters of &quot;smooth_1&quot; node</span>
        <span class="n">input_process</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>

        <span class="n">node_controller</span><span class="o">.</span><span class="n">display_parameters</span><span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">,</span>
                                           <span class="n">get_process_instance</span><span class="p">(</span><span class="n">input_process</span><span class="p">),</span>
                                           <span class="n">pipeline</span><span class="p">)</span>

        <span class="c1"># Opens a filter for the plug &quot;in_files&quot;,</span>
        <span class="c1"># without &quot;node_controller.scans_list&quot;</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">Undefined</span><span class="p">))</span>
        <span class="n">node_controller</span><span class="o">.</span><span class="n">display_filter</span><span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;in_files&quot;</span><span class="p">,</span>
                                       <span class="n">parameters</span><span class="p">,</span> <span class="n">input_process</span><span class="p">)</span>

        <span class="c1"># Asserts its default value</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Undefined</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">get_plug_value</span><span class="p">(</span><span class="s2">&quot;in_files&quot;</span><span class="p">))</span>

        <span class="c1"># Searchs for &quot;DOCUMENT_2&quot; the input documents</span>
        <span class="n">plug_filter</span> <span class="o">=</span> <span class="n">node_controller</span><span class="o">.</span><span class="n">pop_up</span>
        <span class="n">plug_filter</span><span class="o">.</span><span class="n">search_str</span><span class="p">(</span><span class="n">DOCUMENT_2</span><span class="p">)</span>
        <span class="n">index_DOCUMENT_1</span> <span class="o">=</span> <span class="n">plug_filter</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_scan_row</span><span class="p">(</span><span class="n">DOCUMENT_1</span><span class="p">)</span>

        <span class="c1"># if &quot;DOCUMENT_1&quot; is hidden</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">plug_filter</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">index_DOCUMENT_1</span><span class="p">))</span>

        <span class="c1"># Resets the search bar</span>
        <span class="n">plug_filter</span><span class="o">.</span><span class="n">reset_search_bar</span><span class="p">()</span>

        <span class="c1"># if &quot;DOCUMENT_1&quot; is not hidden</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">plug_filter</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">index_DOCUMENT_1</span><span class="p">))</span>

        <span class="c1"># Tries search for an empty string</span>
        <span class="n">plug_filter</span><span class="o">.</span><span class="n">search_str</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># Search for &quot;DOCUMENT_2&quot; and changes tags</span>
        <span class="n">plug_filter</span><span class="o">.</span><span class="n">search_str</span><span class="p">(</span><span class="n">DOCUMENT_2</span><span class="p">)</span>

        <span class="n">index_DOCUMENT_2</span> <span class="o">=</span> <span class="n">plug_filter</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_scan_row</span><span class="p">(</span><span class="n">DOCUMENT_2</span><span class="p">)</span>
        <span class="n">plug_filter</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="n">index_DOCUMENT_2</span><span class="p">)</span>

        <span class="c1"># FIXME: we need to find a better way to interact with the plug_filter</span>
        <span class="c1">#        objects. At the moment, QTimer.singleShoot does not give a</span>
        <span class="c1">#        good result because it is an asynchronous action and we can</span>
        <span class="c1">#        observe mixtures of QT signals. Since we are not</span>
        <span class="c1">#        instantiating exactly the right objects, this results in a</span>
        <span class="c1">#        mixture of signals that can crash the execution. Currently</span>
        <span class="c1">#        the QTimer.singleShoot is removed (this should not change</span>
        <span class="c1">#        much the test coverage because the objects are still used</span>
        <span class="c1">#        (update_tags, update_tag_to_filter)</span>

        <span class="n">plug_filter</span><span class="o">.</span><span class="n">update_tags</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span>
               <span class="n">plug_filter</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span><span class="p">(</span><span class="s1">&#39;AcquisitionDate&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="nb">int</span><span class="p">)</span>

        <span class="n">plug_filter</span><span class="o">.</span><span class="n">update_tag_to_filter</span><span class="p">()</span>
        <span class="n">plug_filter</span><span class="o">.</span><span class="n">push_button_tag_filter</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;FileName&#39;</span><span class="p">)</span>
        <span class="c1"># TODO: select tag to filter with</span>

        <span class="c1"># Closes the filter for the plug &quot;in_files&quot;</span>
        <span class="n">plug_filter</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="c1"># Assert the modified value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">DOCUMENT_2</span><span class="p">)),</span>
                      <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">get_plug_value</span><span class="p">(</span><span class="s2">&quot;in_files&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])))</span>

        <span class="c1"># Opens a filter for the plug &quot;in_files&quot;, now with a &quot;scans_list&quot;</span>
        <span class="n">node_controller</span><span class="o">.</span><span class="n">scan_list</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span>
                                     <span class="n">get_documents_names</span><span class="p">)(</span><span class="s2">&quot;current&quot;</span><span class="p">)</span>
        <span class="n">node_controller</span><span class="o">.</span><span class="n">display_filter</span><span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;in_files&quot;</span><span class="p">,</span>
                                       <span class="n">parameters</span><span class="p">,</span> <span class="n">input_process</span><span class="p">)</span>

        <span class="c1"># Searchs for something that does not give any match</span>
        <span class="n">plug_filter</span><span class="o">.</span><span class="n">search_str</span><span class="p">(</span><span class="s1">&#39;!@#&#39;</span><span class="p">)</span>
        <span class="c1"># this will empty the &quot;plug_filter.table_data.selectedIndexes()&quot;</span>
        <span class="c1"># and trigger a uncovered part of &quot;set_plug_value(self)&quot;</span>

        <span class="n">plug_filter</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="c1"># Switches back to node controller V2</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">setControlV1</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIAPipelineManager.test_process_library"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.test_process_library">[docs]</a>    <span class="k">def</span> <span class="nf">test_process_library</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Install the brick_test and then remove it</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">True</span>

        <span class="n">pkg</span> <span class="o">=</span> <span class="n">InstallProcesses</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">brick</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;resources&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;mia&#39;</span><span class="p">,</span> <span class="s1">&#39;brick_test.zip&#39;</span><span class="p">)</span>
        <span class="n">pkg</span><span class="o">.</span><span class="n">path_edit</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">brick</span>
        <span class="n">pkg</span><span class="o">.</span><span class="n">install</span><span class="p">()</span>

        <span class="n">pkg</span> <span class="o">=</span> <span class="n">PackageLibraryDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="p">)</span>
        <span class="n">pkg</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;properties&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;process_config.yml&#39;</span><span class="p">),</span>
                  <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">verCmp</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span> <span class="s1">&#39;5.1&#39;</span><span class="p">,</span> <span class="s1">&#39;sup&#39;</span><span class="p">):</span>
                <span class="n">pro_dic</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">pro_dic</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;brick_test&quot;</span><span class="p">,</span> <span class="n">pro_dic</span><span class="p">[</span><span class="s2">&quot;Packages&quot;</span><span class="p">])</span>

        <span class="n">pkg</span><span class="o">.</span><span class="n">remove_package</span><span class="p">(</span><span class="s2">&quot;brick_test&quot;</span><span class="p">)</span>
        <span class="n">pkg</span><span class="o">.</span><span class="n">save_config</span><span class="p">()</span>

        <span class="n">process</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;processes&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;brick_test&#39;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">process</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;properties&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;process_config.yml&#39;</span><span class="p">),</span>
                  <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">verCmp</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span> <span class="s1">&#39;5.1&#39;</span><span class="p">,</span> <span class="s1">&#39;sup&#39;</span><span class="p">):</span>
                <span class="n">pro_dic</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">pro_dic</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s2">&quot;brick_test&quot;</span><span class="p">,</span> <span class="n">pro_dic</span><span class="p">[</span><span class="s2">&quot;Packages&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestMIAPipelineManager.test_save_pipeline"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.test_save_pipeline">[docs]</a>    <span class="k">def</span> <span class="nf">test_save_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a simple pipeline</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span>
                                                             <span class="n">pipelineEditorTabs</span><span class="p">)</span>
        <span class="n">node_controller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">nodeController</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>

        <span class="c1"># Adding a process</span>
        <span class="n">process_class</span> <span class="o">=</span> <span class="n">Smooth</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>

        <span class="c1"># Creates a node called &quot;smooth_1&quot;</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
                                                                  <span class="n">process_class</span><span class="p">)</span>

        <span class="c1"># Displaying the node parameters</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        <span class="n">node_controller</span><span class="o">.</span><span class="n">display_parameters</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">,</span>
                                           <span class="n">get_process_instance</span><span class="p">(</span><span class="n">process_class</span><span class="p">),</span>
                                           <span class="n">pipeline</span><span class="p">)</span>

        <span class="c1"># Exporting the input plugs</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s2">&quot;smooth_1&quot;</span>
        <span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span>
                 <span class="n">get_current_editor</span><span class="p">)()</span><span class="o">.</span><span class="n">export_node_unconnected_mandatory_plugs</span><span class="p">()</span>
        <span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span>
                     <span class="n">get_current_editor</span><span class="p">)()</span><span class="o">.</span><span class="n">export_node_all_unconnected_outputs</span><span class="p">()</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;processes&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;User_processes&#39;</span><span class="p">,</span> <span class="s1">&#39;test_pipeline.py&#39;</span><span class="p">)</span>
        <span class="n">save_pipeline</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">updateProcessLibrary</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span>
                                                    <span class="s1">&#39;processes&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;User_processes&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;test_pipeline.py&#39;</span><span class="p">)))</span></div>

<div class="viewcode-block" id="TestMIAPipelineManager.test_update_node_name"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.test_update_node_name">[docs]</a>    <span class="k">def</span> <span class="nf">test_update_node_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays parameters of a node and updates its name</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>

        <span class="c1"># Adding a process =&gt; creates a node called &quot;smooth_1&quot;</span>
        <span class="n">process_class</span> <span class="o">=</span> <span class="n">Smooth</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
                                                                  <span class="n">process_class</span><span class="p">)</span>

        <span class="c1"># Displaying the smooth_1 node parameters</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;smooth_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">displayNodeParameters</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">,</span> <span class="n">process</span><span class="p">)</span>
        <span class="n">node_controller</span> <span class="o">=</span> <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">nodeController</span>

        <span class="c1"># Change the node name from smooth_1 to smooth_test, test if it&#39;s ok</span>
        <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;smooth_test&quot;</span><span class="p">)</span>
        <span class="n">keyEvent</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QKeyEvent</span><span class="p">(</span><span class="n">QEvent</span><span class="o">.</span><span class="n">KeyPress</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key_Return</span><span class="p">,</span>
                                   <span class="n">Qt</span><span class="o">.</span><span class="n">NoModifier</span><span class="p">)</span>
        <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">postEvent</span><span class="p">(</span><span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="p">,</span>
                                   <span class="n">keyEvent</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_test&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Add 2 another Smooth process =&gt; Creates nodes called</span>
        <span class="c1"># smooth_1 and smooth_2</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
                                                                  <span class="n">process_class</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
                                                                  <span class="n">process_class</span><span class="p">)</span>

        <span class="c1"># Adding link between smooth_test and smooth_1 nodes</span>
        <span class="n">source</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;smooth_test&#39;</span><span class="p">,</span> <span class="s1">&#39;_smoothed_files&#39;</span><span class="p">)</span>
        <span class="n">dest</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;smooth_1&#39;</span><span class="p">,</span> <span class="s1">&#39;in_files&#39;</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>
                                                           <span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Adding link between smooth_2 and smooth_1 nodes</span>
        <span class="n">source</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;smooth_1&#39;</span><span class="p">,</span> <span class="s1">&#39;_smoothed_files&#39;</span><span class="p">)</span>
        <span class="n">dest</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;smooth_2&#39;</span><span class="p">,</span> <span class="s1">&#39;in_files&#39;</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>
                                                           <span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Displaying the smooth_1 node parameters</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;smooth_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">displayNodeParameters</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">,</span> <span class="n">process</span><span class="p">)</span>
        <span class="n">node_controller</span> <span class="o">=</span> <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">nodeController</span>

        <span class="c1"># Change node name from smooth_1 to smooth_test.</span>
        <span class="c1"># This should not change the node name because there is already a</span>
        <span class="c1"># &quot;smooth_test&quot; process in the pipeline.</span>
        <span class="c1"># Test if smooth_1 is still in the pipeline</span>
        <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;smooth_test&quot;</span><span class="p">)</span>
        <span class="n">keyEvent</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QKeyEvent</span><span class="p">(</span><span class="n">QEvent</span><span class="o">.</span><span class="n">KeyPress</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key_Return</span><span class="p">,</span>
                                   <span class="n">Qt</span><span class="o">.</span><span class="n">NoModifier</span><span class="p">)</span>
        <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">postEvent</span><span class="p">(</span><span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="p">,</span>
                                   <span class="n">keyEvent</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;smooth_test_2&quot;</span><span class="p">)</span>
        <span class="n">keyEvent</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QKeyEvent</span><span class="p">(</span><span class="n">QEvent</span><span class="o">.</span><span class="n">KeyPress</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key_Return</span><span class="p">,</span>
                                   <span class="n">Qt</span><span class="o">.</span><span class="n">NoModifier</span><span class="p">)</span>
        <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">postEvent</span><span class="p">(</span><span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="p">,</span>
                                   <span class="n">keyEvent</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_test_2&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Verifying that the updated node has the same links</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_test_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                        <span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_test_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                   <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestMIAPipelineManager.test_update_plug_value"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.test_update_plug_value">[docs]</a>    <span class="k">def</span> <span class="nf">test_update_plug_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays parameters of a node and updates a plug value</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span>
                                                             <span class="n">pipelineEditorTabs</span><span class="p">)</span>
        <span class="n">node_controller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">nodeController</span>

        <span class="c1"># Adding a process</span>
        <span class="n">process_class</span> <span class="o">=</span> <span class="n">Threshold</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>

        <span class="c1"># Creates a node called &quot;threshold_1&quot;:</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
                                                                  <span class="n">process_class</span><span class="p">)</span>

        <span class="c1"># Displaying the node parameters</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        <span class="n">node_controller</span><span class="o">.</span><span class="n">display_parameters</span><span class="p">(</span><span class="s2">&quot;threshold_1&quot;</span><span class="p">,</span>
                                           <span class="n">get_process_instance</span><span class="p">(</span><span class="n">process_class</span><span class="p">),</span>
                                           <span class="n">pipeline</span><span class="p">)</span>

        <span class="c1"># Updating the value of the &quot;synchronize&quot; plug</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node_controller</span><span class="p">,</span> <span class="s1">&#39;get_index_from_plug_name&#39;</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">node_controller</span><span class="o">.</span><span class="n">get_index_from_plug_name</span><span class="p">(</span><span class="s2">&quot;synchronize&quot;</span><span class="p">,</span>
                                                             <span class="s2">&quot;in&quot;</span><span class="p">)</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_input</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>

            <span class="c1"># This calls &quot;update_plug_value&quot; method:</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_input</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                             <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;threshold_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_plug_value</span><span class="p">(</span>
                                                                 <span class="s2">&quot;synchronize&quot;</span><span class="p">))</span>

            <span class="c1"># Updating the value of the &quot;_activation_forced&quot; plug</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">node_controller</span><span class="o">.</span><span class="n">get_index_from_plug_name</span><span class="p">(</span>
                                                           <span class="s2">&quot;_activation_forced&quot;</span><span class="p">,</span>
                                                           <span class="s2">&quot;out&quot;</span><span class="p">)</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_output</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;True&quot;</span><span class="p">)</span>

            <span class="c1"># This calls &quot;update_plug_value&quot; method:</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_output</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span>
                             <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;threshold_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_plug_value</span><span class="p">(</span>
                                                          <span class="s2">&quot;_activation_forced&quot;</span><span class="p">))</span>

        <span class="c1"># Exporting the input plugs and modifying the &quot;synchronize&quot; input plug</span>
        <span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span>
                         <span class="n">get_current_editor</span><span class="p">)()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s2">&quot;threshold_1&quot;</span>
        <span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span>
                      <span class="n">get_current_editor</span><span class="p">)()</span><span class="o">.</span><span class="n">export_node_all_unconnected_inputs</span><span class="p">()</span>

        <span class="n">input_process</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="n">node_controller</span><span class="o">.</span><span class="n">display_parameters</span><span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">,</span>
                                           <span class="n">get_process_instance</span><span class="p">(</span><span class="n">input_process</span><span class="p">),</span>
                                           <span class="n">pipeline</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node_controller</span><span class="p">,</span> <span class="s1">&#39;get_index_from_plug_name&#39;</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">node_controller</span><span class="o">.</span><span class="n">get_index_from_plug_name</span><span class="p">(</span><span class="s2">&quot;synchronize&quot;</span><span class="p">,</span>
                                                             <span class="s2">&quot;in&quot;</span><span class="p">)</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_input</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>

            <span class="c1"># This calls &quot;update_plug_value&quot; method:</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_input</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                             <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;threshold_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_plug_value</span><span class="p">(</span>
                                                                 <span class="s2">&quot;synchronize&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestMIAPipelineManager.test_z_get_editor"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.test_z_get_editor">[docs]</a>    <span class="k">def</span> <span class="nf">test_z_get_editor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the instance of an editor (z to run at the end)</span>

<span class="sd">        This tests:</span>
<span class="sd">         - PipelineEditorTabs.get_editor_by_index</span>
<span class="sd">         - PipelineEditorTabs.get_current_editor</span>
<span class="sd">         - PipelineEditorTabs.get_editor_by_tab_name</span>
<span class="sd">         - PipelineEditorTabs.get_editor_by_filename</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span>
                                                             <span class="n">pipelineEditorTabs</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;processes&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;User_processes&#39;</span><span class="p">,</span> <span class="s1">&#39;test_pipeline.py&#39;</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">load_pipeline</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="n">editor0</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span>
        <span class="c1"># create new tab with new editor and make it current:</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">new_tab</span><span class="p">()</span>
        <span class="n">editor1</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_editor_by_index</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">editor0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_editor_by_index</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">editor1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">(),</span> <span class="n">editor1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">editor0</span><span class="p">,</span>
                         <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_editor_by_tab_name</span><span class="p">(</span>
                                                            <span class="s2">&quot;test_pipeline.py&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">editor1</span><span class="p">,</span>
                         <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_editor_by_tab_name</span><span class="p">(</span>
                                                              <span class="s2">&quot;New Pipeline 1&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_editor_by_tab_name</span><span class="p">(</span><span class="s2">&quot;dummy&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">editor0</span><span class="p">,</span>
                         <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_editor_by_file_name</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_editor_by_file_name</span><span class="p">(</span><span class="s2">&quot;dummy&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestMIAPipelineManager.test_z_get_filename"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.test_z_get_filename">[docs]</a>    <span class="k">def</span> <span class="nf">test_z_get_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the relative path to a previously saved pipeline file</span>
<span class="sd">        (z to run at the end).</span>

<span class="sd">        This tests:</span>
<span class="sd">         - PipelineEditorTabs.get_filename_by_index</span>
<span class="sd">         - PipelineEditorTabs.get_current_filename</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span>
                                                             <span class="n">pipelineEditorTabs</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;processes&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;User_processes&#39;</span><span class="p">,</span> <span class="s1">&#39;test_pipeline.py&#39;</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">load_pipeline</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span>
                         <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
                             <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_filename_by_index</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_filename_by_index</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span>
                         <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
                             <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_filename</span><span class="p">()))</span></div>

<div class="viewcode-block" id="TestMIAPipelineManager.test_z_get_index"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.test_z_get_index">[docs]</a>    <span class="k">def</span> <span class="nf">test_z_get_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the index of an editor. (z to run at the end)</span>

<span class="sd">        This tests:</span>
<span class="sd">         - PipelineEditorTabs.get_index_by_tab_name</span>
<span class="sd">         - PipelineEditorTabs.get_index_by_filename</span>
<span class="sd">         - PipelineEditorTabs.get_index_by_editor</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span>
                                                             <span class="n">pipelineEditorTabs</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;processes&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;User_processes&#39;</span><span class="p">,</span> <span class="s1">&#39;test_pipeline.py&#39;</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">load_pipeline</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">editor0</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span>

        <span class="c1"># create new tab with new editor and make it current</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">new_tab</span><span class="p">()</span>
        <span class="n">editor1</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_index_by_tab_name</span><span class="p">(</span>
                                                            <span class="s2">&quot;test_pipeline.py&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_index_by_tab_name</span><span class="p">(</span>
                                                              <span class="s2">&quot;New Pipeline 1&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_index_by_tab_name</span><span class="p">(</span><span class="s2">&quot;dummy&quot;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_index_by_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_index_by_filename</span><span class="p">(</span><span class="s2">&quot;dummy&quot;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_index_by_editor</span><span class="p">(</span><span class="n">editor0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_index_by_editor</span><span class="p">(</span><span class="n">editor1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_index_by_editor</span><span class="p">(</span><span class="s2">&quot;dummy&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestMIAPipelineManager.test_z_get_tab_name"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.test_z_get_tab_name">[docs]</a>    <span class="k">def</span> <span class="nf">test_z_get_tab_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the tab name of the editor. (z to run at the end)</span>

<span class="sd">        This tests:</span>
<span class="sd">         - PipelineEditorTabs.get_tab_name_by_index</span>
<span class="sd">         - PipelineEditorTabs.get_current_tab_name</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span>
                                                             <span class="n">pipelineEditorTabs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s2">&quot;New Pipeline&quot;</span><span class="p">,</span>
                         <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_tab_name_by_index</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_tab_name_by_index</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s2">&quot;New Pipeline&quot;</span><span class="p">,</span>
                         <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_tab_name</span><span class="p">())</span></div>

<div class="viewcode-block" id="TestMIAPipelineManager.test_z_load_pipeline"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.test_z_load_pipeline">[docs]</a>    <span class="k">def</span> <span class="nf">test_z_load_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads a pipeline (z to run at the end)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span>
                                                             <span class="n">pipelineEditorTabs</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;processes&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;User_processes&#39;</span><span class="p">,</span> <span class="s1">&#39;test_pipeline.py&#39;</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">load_pipeline</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

<div class="viewcode-block" id="TestMIAPipelineManager.test_z_open_sub_pipeline"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.test_z_open_sub_pipeline">[docs]</a>    <span class="k">def</span> <span class="nf">test_z_open_sub_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens a sub_pipeline (z to run at the end)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span>
                                                             <span class="n">pipelineEditorTabs</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>

        <span class="c1"># Adding the processes path to the system path</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;processes&#39;</span><span class="p">))</span>

        <span class="c1"># Importing the package</span>
        <span class="n">package_name</span> <span class="o">=</span> <span class="s1">&#39;User_processes&#39;</span>
        <span class="nb">__import__</span><span class="p">(</span><span class="n">package_name</span><span class="p">)</span>
        <span class="n">pkg</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">package_name</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">pkg</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">())):</span>

            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Test_pipeline&#39;</span><span class="p">:</span>
                <span class="n">process_class</span> <span class="o">=</span> <span class="bp">cls</span>

        <span class="c1"># Adding the &quot;test_pipeline&quot; as a process</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
                                                                  <span class="n">process_class</span><span class="p">)</span>

        <span class="c1"># Opening the sub-pipeline in a new editor</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        <span class="n">process_instance</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;test_pipeline_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">open_sub_pipeline</span><span class="p">(</span><span class="n">process_instance</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s2">&quot;test_pipeline.py&quot;</span><span class="p">,</span>
                         <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span>
                             <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_filename_by_index</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span></div>

<div class="viewcode-block" id="TestMIAPipelineManager.test_z_set_current_editor"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.test_z_set_current_editor">[docs]</a>    <span class="k">def</span> <span class="nf">test_z_set_current_editor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the current editor (z to run at the end)</span>

<span class="sd">        This tests:</span>
<span class="sd">         - PipelineEditorTabs.set_current_editor_by_tab_name</span>
<span class="sd">         - PipelineEditorTabs.set_current_editor_by_file_name</span>
<span class="sd">         - PipelineEditorTabs.set_current_editor_by_editor</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span>
                                                             <span class="n">pipelineEditorTabs</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;processes&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;User_processes&#39;</span><span class="p">,</span> <span class="s1">&#39;test_pipeline.py&#39;</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">load_pipeline</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">editor0</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span>

        <span class="c1"># create new tab with new editor and make it current:</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">new_tab</span><span class="p">()</span>
        <span class="n">editor1</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span>

        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">set_current_editor_by_tab_name</span><span class="p">(</span><span class="s2">&quot;test_pipeline.py&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">set_current_editor_by_tab_name</span><span class="p">(</span><span class="s2">&quot;New Pipeline 1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">set_current_editor_by_file_name</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">set_current_editor_by_editor</span><span class="p">(</span><span class="n">editor1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">set_current_editor_by_editor</span><span class="p">(</span><span class="n">editor0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIAPipelineManager.test_zz_check_modif"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.test_zz_check_modif">[docs]</a>    <span class="k">def</span> <span class="nf">test_zz_check_modif</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens a pipeline, opens it as a process in another tab, modifies it</span>
<span class="sd">        and check the modifications</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span>
                                                             <span class="n">pipelineEditorTabs</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;processes&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;User_processes&#39;</span><span class="p">,</span> <span class="s1">&#39;test_pipeline.py&#39;</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">load_pipeline</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">new_tab</span><span class="p">()</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">set_current_editor_by_tab_name</span><span class="p">(</span><span class="s2">&quot;New Pipeline 1&quot;</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>

        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">drop_process</span><span class="p">(</span>
                                                 <span class="s2">&quot;User_processes.Test_pipeline&quot;</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;test_pipeline_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">drop_process</span><span class="p">(</span>
                                                 <span class="s2">&quot;nipype.interfaces.spm.Smooth&quot;</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">drop_process</span><span class="p">(</span>
                                                 <span class="s2">&quot;nipype.interfaces.spm.Smooth&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span>
                                                <span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">,</span> <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">),</span>
                                                <span class="p">(</span><span class="s2">&quot;test_pipeline_1&quot;</span><span class="p">,</span> <span class="s2">&quot;in_files&quot;</span><span class="p">),</span>
                                                <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">weak</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;test_pipeline_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                        <span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                   <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">))</span>

        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span>
                                         <span class="p">(</span><span class="s2">&quot;test_pipeline_1&quot;</span><span class="p">,</span> <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">),</span>
                                         <span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">,</span> <span class="s2">&quot;in_files&quot;</span><span class="p">),</span>
                                         <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">weak</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                        <span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;test_pipeline_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                   <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">))</span>

        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">set_current_editor_by_tab_name</span><span class="p">(</span><span class="s2">&quot;test_pipeline.py&quot;</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>

        <span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span>
                          <span class="n">get_current_editor</span><span class="p">)()</span><span class="o">.</span><span class="n">export_node_plugs</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">,</span>
                                                                  <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">savePipeline</span><span class="p">(</span><span class="n">uncheck</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">set_current_editor_by_tab_name</span><span class="p">(</span><span class="s2">&quot;New Pipeline 1&quot;</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span>
                                           <span class="s2">&quot;test_pipeline_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">check_modifications</span><span class="p">()</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;fwhm&quot;</span> <span class="ow">in</span>
                                 <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;test_pipeline_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

<div class="viewcode-block" id="TestMIAPipelineManager.test_zz_del_pack"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManager.test_zz_del_pack">[docs]</a>    <span class="k">def</span> <span class="nf">test_zz_del_pack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; We remove the brick created during the unit tests, and we take</span>
<span class="sd">        advantage of this to cover the part of the code used to remove the</span>
<span class="sd">        packages &quot;&quot;&quot;</span>
         
        <span class="n">pkg</span> <span class="o">=</span> <span class="n">PackageLibraryDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="p">)</span>

        <span class="c1"># The Test_pipeline brick was added in the package library</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;Test_pipeline&quot;</span> <span class="ow">in</span>
                             <span class="n">pkg</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">package_tree</span><span class="p">[</span><span class="s1">&#39;User_processes&#39;</span><span class="p">])</span>

        <span class="n">pkg</span><span class="o">.</span><span class="n">delete_package</span><span class="p">(</span><span class="n">to_delete</span><span class="o">=</span><span class="s2">&quot;User_processes.Test_pipeline&quot;</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># The Test_pipeline brick has been removed from the package library</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;Test_pipeline&quot;</span> <span class="ow">in</span>
                             <span class="n">pkg</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">package_tree</span><span class="p">[</span><span class="s1">&#39;User_processes&#39;</span><span class="p">])</span></div></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab">[docs]</a><span class="k">class</span> <span class="nc">TestMIAPipelineManagerTab</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tests &#39;pipeline_manager_tab.py&#39;.</span>

<span class="sd">    :Contains:</span>
<span class="sd">        :Method:</span>
<span class="sd">            - add_visualized_tag: selects a tag to display with the</span>
<span class="sd">              &quot;Visualized tags&quot; pop-up</span>
<span class="sd">            - execute_QDialogAccept: accept (close) a QDialog window</span>
<span class="sd">            - get_new_test_project: create a temporary project that can</span>
<span class="sd">              be safely modified</span>
<span class="sd">            - restart_MIA: restarts MIA within a unit test.</span>
<span class="sd">            - setUp: called automatically before each test method</span>
<span class="sd">            - setUpClass: called before tests in the individual class</span>
<span class="sd">            - tearDown: cleans up after each test method</span>
<span class="sd">            - tearDownClass: called after tests in the individual class</span>
<span class="sd">            - test_add_plug_value_to_database_list_type: adds a list </span>
<span class="sd">              type plug value to the database</span>
<span class="sd">            - test_add_plug_value_to_database_non_list_type: adds a non </span>
<span class="sd">              list type plug value to the database</span>
<span class="sd">            - test_ask_iterated_pipeline_plugs: test the iteration dialog for</span>
<span class="sd">               each plug of a Rename process</span>
<span class="sd">            - test_build_iterated_pipeline: mocks methods and builds an </span>
<span class="sd">              iterated pipeline</span>
<span class="sd">            - test_check_requirements: checks the requirements for a</span>
<span class="sd">              given node</span>
<span class="sd">            - test_cleanup_older_init: tests the cleaning of old initialisations</span>
<span class="sd">            - test_complete_pipeline_parameters: test the pipeline parameters</span>
<span class="sd">              completion</span>
<span class="sd">            - test_delete_processes: deletes a process and makes the </span>
<span class="sd">              undo/redo</span>
<span class="sd">            - test_finish_execution: finishes the execution of the </span>
<span class="sd">              pipeline</span>
<span class="sd">            - test_garbage_collect: collects the garbage of the pipeline</span>
<span class="sd">            - test_get_capsul_engine: gets the capsul engine of the</span>
<span class="sd">              pipeline</span>
<span class="sd">            - test_get_missing_mandatory_parameters: tries to initialize</span>
<span class="sd">              the pipeline with missing mandatory parameters</span>
<span class="sd">            - test_get_pipeline_or_process: gets a pipeline and a</span>
<span class="sd">              process from the pipeline_manager</span>
<span class="sd">            - test_initialize: mocks objects and initializes the </span>
<span class="sd">              workflow</span>
<span class="sd">            - test_register_completion_attributes: registers completion </span>
<span class="sd">              attributes</span>
<span class="sd">            - test_register_node_io_in_database: sets input and output </span>
<span class="sd">              parameters and registers them in database</span>
<span class="sd">            - test_remove_progress: removes the progress of the pipeline</span>
<span class="sd">            - test_save_pipeline: saves a simple pipeline</span>
<span class="sd">            - test_set_anim_frame: runs the &#39;rotatingBrainVISA.gif&#39; </span>
<span class="sd">              animation</span>
<span class="sd">            - test_undo_redo: tests the undo/redo</span>
<span class="sd">            - test_update_node_list: initializes a workflow and adds a </span>
<span class="sd">              process to the &quot;pipline_manager.node_list&quot;</span>
<span class="sd">            - test_z_init_pipeline: initializes the pipeline</span>
<span class="sd">            - test_z_init_pipeline_2: initialize a pipeline with several</span>
<span class="sd">               mock parameters</span>
<span class="sd">            - test_z_runPipeline: adds a processruns a pipeline</span>
<span class="sd">            - test_zz_del_pack(self): deletion of the brick created during UTs</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.add_visualized_tag"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.add_visualized_tag">[docs]</a>    <span class="k">def</span> <span class="nf">add_visualized_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        With the &quot;Visualized tags&quot; pop-up open, selects a tag to display.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tag: string</span>
<span class="sd">          The tag to be displayed</span>

<span class="sd">        Usage</span>
<span class="sd">        -----</span>
<span class="sd">        Should be called, with a delay, before opening the &quot;Visualized tags&quot;</span>
<span class="sd">        pop-up:</span>
<span class="sd">        QTimer.singleShot(1000,</span>
<span class="sd">                          lambda:self.add_visualized_tag(&#39;AcquisitionDate&#39;))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">activeWindow</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">QDialog</span><span class="p">):</span>
            <span class="n">visualized_tags</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span>
            <span class="n">tags_list</span> <span class="o">=</span> <span class="n">visualized_tags</span><span class="o">.</span><span class="n">list_widget_tags</span>

            <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">QT_VERSION_STR</span><span class="p">)</span> <span class="o">==</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;5.9.2&#39;</span><span class="p">):</span>
                <span class="n">found_item</span> <span class="o">=</span> <span class="n">tags_list</span><span class="o">.</span><span class="n">findItems</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">MatchExactly</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">found_item</span> <span class="o">=</span> <span class="n">tags_list</span><span class="o">.</span><span class="n">findItems</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span>
                                                 <span class="n">Qt</span><span class="o">.</span><span class="n">MatchFlag</span><span class="o">.</span><span class="n">MatchExactly</span><span class="p">)</span>

            <span class="n">tags_list</span><span class="o">.</span><span class="n">setCurrentItem</span><span class="p">(</span><span class="n">found_item</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">visualized_tags</span><span class="o">.</span><span class="n">click_select_tag</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.execute_QDialogAccept"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.execute_QDialogAccept">[docs]</a>    <span class="k">def</span> <span class="nf">execute_QDialogAccept</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Accept (close) a QDialog window</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">activeWindow</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">QDialog</span><span class="p">):</span>
            <span class="n">w</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.execute_QMessageBox_clickYes"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.execute_QMessageBox_clickYes">[docs]</a>    <span class="k">def</span> <span class="nf">execute_QMessageBox_clickYes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is supposed to allow to press the Yes button if a pipeline is </span>
<span class="sd">        overwritten in the test_zz_check_modifications method</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">activeWindow</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="p">):</span>
            <span class="n">close_button</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">)</span>
            <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">close_button</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.execute_QDialogClose"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.execute_QDialogClose">[docs]</a>    <span class="k">def</span> <span class="nf">execute_QDialogClose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is supposed to abort( close) a QDialog window</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">activeWindow</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">QDialog</span><span class="p">):</span>
            <span class="n">w</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="TestMIAPipelineManagerTab.get_new_test_project"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.get_new_test_project">[docs]</a>    <span class="k">def</span> <span class="nf">get_new_test_project</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy the test project in a location we can modify safely</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">project_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;project_8&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">project_path</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">project_path</span><span class="p">)</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">mia_path</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">()</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mia_path</span><span class="p">,</span> <span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="s1">&#39;mia&#39;</span><span class="p">,</span>
                                      <span class="s1">&#39;project_8&#39;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="n">project_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">project_path</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.restart_MIA"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.restart_MIA">[docs]</a>    <span class="k">def</span> <span class="nf">restart_MIA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restarts MIA within a unit test.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Can be used to restart MIA after changing the controller version in MIA</span>
<span class="sd">        preferences.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Removing the opened projects (in CI, the tests are run twice)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_opened_projects</span><span class="p">([])</span>
        <span class="n">config</span><span class="o">.</span><span class="n">saveConfig</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_user_mode</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span> <span class="o">=</span> <span class="n">MainWindow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.setUp"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called before each test</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># All the tests are run in admin mode</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_user_mode</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span> <span class="o">=</span> <span class="n">MainWindow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.setUpClass"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.setUpClass">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called once at the beginning of the class</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">config_path</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;mia_tests&#39;</span><span class="p">)</span>
        <span class="c1"># hack the Config class to get config_path, because some Config</span>
        <span class="c1"># instances are created out of our control in the code</span>
        <span class="n">Config</span><span class="o">.</span><span class="n">config_path</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">config_path</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.tearDown"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called after each test</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Removing the opened projects (in CI, the tests are run twice)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_opened_projects</span><span class="p">([])</span>
        <span class="n">config</span><span class="o">.</span><span class="n">saveConfig</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.tearDownClass"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.tearDownClass">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">tearDownClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called once at the end of the class</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">config_path</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_add_plug_value_to_database_list_type"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_add_plug_value_to_database_list_type">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_plug_value_to_database_list_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens a project, adds a &#39;Select&#39; process, exports a list type</span>
<span class="sd">        input plug and adds it to the database.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Tests the PipelineManagerTab(QWidget).add_plug_value_to_database().</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Opens project 8 and switches to it</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s1">&#39;project_9&#39;</span><span class="p">)</span>

        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                                                                   <span class="s2">&quot;current&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">DOCUMENT_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                                                                   <span class="s2">&quot;current&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>

        <span class="c1"># Adds the processes Select, creates the &quot;select_1&quot; node</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Select</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Exports the mandatory input and output plugs for &quot;select_1&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s1">&#39;select_1&#39;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="n">pipeline_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="c1"># Initializes the workflow manually</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">workflow</span> <span class="o">=</span> <span class="n">workflow_from_pipeline</span><span class="p">(</span>
                                                       <span class="n">pipeline</span><span class="p">,</span>
                                                       <span class="n">complete_parameters</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Gets the &#39;job&#39; and mocks adding a brick to the collection</span>
        <span class="n">job</span> <span class="o">=</span> <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">jobs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">brick_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="n">job</span><span class="o">.</span><span class="n">uuid</span> <span class="o">=</span> <span class="n">brick_id</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">brick_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">brick_id</span><span class="p">)</span>

        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_document</span><span class="p">(</span><span class="n">COLLECTION_BRICK</span><span class="p">,</span>
                                                      <span class="n">brick_id</span><span class="p">)</span>

        <span class="c1"># Sets the mandatory plug values corresponding to &quot;inputs&quot; node</span>
        <span class="n">trait_list_inlist</span> <span class="o">=</span> <span class="n">TraitListObject</span><span class="p">(</span><span class="n">InputMultiObject</span><span class="p">(),</span> <span class="n">pipeline</span><span class="p">,</span>
                                            <span class="s1">&#39;inlist&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">DOCUMENT_1</span><span class="p">,</span> <span class="n">DOCUMENT_2</span><span class="p">])</span>

        <span class="c1"># Mocks the creation of a completion engine</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>
        <span class="n">plug_name</span> <span class="o">=</span> <span class="s1">&#39;inlist&#39;</span>
        <span class="n">trait</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">trait</span><span class="p">(</span><span class="n">plug_name</span><span class="p">)</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">get_inputs</span><span class="p">()</span>

        <span class="c1"># Mocks the attributes dict</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;not_list&#39;</span><span class="p">:</span> <span class="s1">&#39;not_list_value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;small_list&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;list_item1&#39;</span><span class="p">],</span>
            <span class="s1">&#39;large_list&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;list_item1&#39;</span><span class="p">,</span> <span class="s1">&#39;list_item2&#39;</span><span class="p">,</span> <span class="s1">&#39;list_item3&#39;</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="c1"># Adds plug value of type &#39;TraitListObject&#39;</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span><span class="n">trait_list_inlist</span><span class="p">,</span> <span class="n">brick_id</span><span class="p">,</span>
                                                    <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;select_1&#39;</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">,</span>
                                                    <span class="s1">&#39;select_1&#39;</span><span class="p">,</span> <span class="n">job</span><span class="p">,</span>
                                                    <span class="n">trait</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>

        <span class="c1"># Asserts that both &#39;DOCUMENT_1&#39; and &#39;DOCUMENT_2&#39; are stored in</span>
        <span class="c1"># the database</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_document</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                      <span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_document</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                      <span class="n">DOCUMENT_2</span><span class="p">)</span>
        <span class="n">has_document</span> <span class="o">=</span> <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">has_document</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">has_document</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">has_document</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">DOCUMENT_2</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_add_plug_value_to_database_non_list_type"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_add_plug_value_to_database_non_list_type">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_plug_value_to_database_non_list_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens a project, adds a &#39;Rename&#39; process, exports a non list type</span>
<span class="sd">        input plug and adds it to the database.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Tests the PipelineManagerTab(QWidget).add_plug_value_to_database().</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Opens project 8 and switches to it</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s1">&#39;project_8&#39;</span><span class="p">)</span>

        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                                                                   <span class="s2">&quot;current&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span>
                                                             <span class="n">pipelineEditorTabs</span><span class="p">)</span>

        <span class="c1"># Adds the processes Smooth, creates the &quot;rename_1&quot; node</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Rename</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Exports the mandatory input and output plugs for &quot;rename_1&quot;</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s1">&#39;rename_1&#39;</span>
        <span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span>
                     <span class="n">get_current_editor</span><span class="p">)()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span>
                          <span class="n">get_current_editor</span><span class="p">)()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="n">old_scan_name</span> <span class="o">=</span> <span class="n">DOCUMENT_1</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">new_scan_name</span> <span class="o">=</span> <span class="s1">&#39;new_name.nii&#39;</span>

        <span class="c1"># Changes the &quot;_out_file&quot; in the &quot;outputs&quot; node</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s1">&#39;_out_file&#39;</span><span class="p">,</span>
                                          <span class="n">DOCUMENT_1</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old_scan_name</span><span class="p">,</span>
                                                             <span class="n">new_scan_name</span><span class="p">))</span>

        <span class="n">pipeline_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">workflow</span> <span class="o">=</span> <span class="n">workflow_from_pipeline</span><span class="p">(</span>
                                                       <span class="n">pipeline</span><span class="p">,</span>
                                                       <span class="n">complete_parameters</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">job</span> <span class="o">=</span> <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">jobs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">brick_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="n">job</span><span class="o">.</span><span class="n">uuid</span> <span class="o">=</span> <span class="n">brick_id</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">brick_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">brick_id</span><span class="p">)</span>

        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_document</span><span class="p">(</span><span class="n">COLLECTION_BRICK</span><span class="p">,</span>
                                                      <span class="n">brick_id</span><span class="p">)</span>

        <span class="c1"># Sets the mandatory plug values in the &quot;inputs&quot; node</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s1">&#39;in_file&#39;</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s1">&#39;format_string&#39;</span><span class="p">,</span> <span class="n">new_scan_name</span><span class="p">)</span>

        <span class="n">process</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>
        <span class="n">plug_name</span> <span class="o">=</span> <span class="s1">&#39;in_file&#39;</span>
        <span class="n">trait</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">trait</span><span class="p">(</span><span class="n">plug_name</span><span class="p">)</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">get_inputs</span><span class="p">()</span>

        <span class="n">attributes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">completion</span> <span class="o">=</span> <span class="n">ProcessCompletionEngine</span><span class="o">.</span><span class="n">get_completion_engine</span><span class="p">(</span><span class="n">process</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">completion</span><span class="p">:</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="n">completion</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">()</span><span class="o">.</span><span class="n">export_to_dict</span><span class="p">()</span>

        <span class="n">has_document</span> <span class="o">=</span> <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">has_document</span>

        <span class="c1"># Plug value is file location outside project directory</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span><span class="n">DOCUMENT_1</span><span class="p">,</span> <span class="n">brick_id</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;rename_1&#39;</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">,</span>
                                                    <span class="s1">&#39;rename_1&#39;</span><span class="p">,</span> <span class="n">job</span><span class="p">,</span> <span class="n">trait</span><span class="p">,</span>
                                                    <span class="n">inputs</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_document</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                      <span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">has_document</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">))</span>
        <span class="c1"># Plug values outside the directory are not registered into the</span>
        <span class="c1"># database, therefore only plug values inside the project will be used</span>
        <span class="c1"># from now on.</span>

        <span class="c1"># Plug value is file location inside project directory</span>
        <span class="n">inside_project</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span>
                                      <span class="n">DOCUMENT_1</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span><span class="n">inside_project</span><span class="p">,</span> <span class="n">brick_id</span><span class="p">,</span>
                                                    <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;rename_1&#39;</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">,</span>
                                                    <span class="s1">&#39;rename_1&#39;</span><span class="p">,</span> <span class="n">job</span><span class="p">,</span> <span class="n">trait</span><span class="p">,</span>
                                                    <span class="n">inputs</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>

        <span class="c1"># Plug value that is already in the database</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span><span class="n">inside_project</span><span class="p">,</span> <span class="n">brick_id</span><span class="p">,</span>
                                                    <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;rename_1&#39;</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">,</span>
                                                    <span class="s1">&#39;rename_1&#39;</span><span class="p">,</span> <span class="n">job</span><span class="p">,</span> <span class="n">trait</span><span class="p">,</span>
                                                    <span class="n">inputs</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>

        <span class="c1"># Plug value is tag</span>
        <span class="n">tag_value</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="s1">&#39;tag.gz&#39;</span><span class="p">)</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span><span class="n">tag_value</span><span class="p">,</span> <span class="n">brick_id</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;rename_1&#39;</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">,</span>
                                                    <span class="s1">&#39;rename_1&#39;</span><span class="p">,</span> <span class="n">job</span><span class="p">,</span> <span class="n">trait</span><span class="p">,</span>
                                                    <span class="n">inputs</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>

        <span class="c1"># Plug value is .mat</span>
        <span class="n">mat_value</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="s1">&#39;file.mat&#39;</span><span class="p">)</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span><span class="n">mat_value</span><span class="p">,</span> <span class="n">brick_id</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;rename_1&#39;</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">,</span>
                                                    <span class="s1">&#39;rename_1&#39;</span><span class="p">,</span> <span class="n">job</span><span class="p">,</span> <span class="n">trait</span><span class="p">,</span>
                                                    <span class="n">inputs</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>

        <span class="c1"># Plug value is .txt</span>
        <span class="n">txt_value</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="s1">&#39;file.txt&#39;</span><span class="p">)</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span><span class="n">txt_value</span><span class="p">,</span> <span class="n">brick_id</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;rename_1&#39;</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">,</span>
                                                    <span class="s1">&#39;rename_1&#39;</span><span class="p">,</span> <span class="n">job</span><span class="p">,</span> <span class="n">trait</span><span class="p">,</span>
                                                    <span class="n">inputs</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>

        <span class="c1"># &#39;parent_files&#39; are extracted from the &#39;inheritance_dict&#39; and</span>
        <span class="c1"># &#39;auto_inheritance_dict&#39; attributes of &#39;job&#39;. They test cases are</span>
        <span class="c1"># listed below:</span>

        <span class="c1"># &#39;parent_files&#39; inside &#39;auto_inheritance_dict&#39;</span>
        <span class="n">job</span><span class="o">.</span><span class="n">auto_inheritance_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">inside_project</span><span class="p">:</span> <span class="s1">&#39;parent_files_value&#39;</span><span class="p">}</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span><span class="n">inside_project</span><span class="p">,</span> <span class="n">brick_id</span><span class="p">,</span>
                                                    <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;rename_1&#39;</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">,</span>
                                                    <span class="s1">&#39;rename_1&#39;</span><span class="p">,</span> <span class="n">job</span><span class="p">,</span> <span class="n">trait</span><span class="p">,</span>
                                                    <span class="n">inputs</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>

        <span class="c1"># &#39;parent_files&#39; inside &#39;inheritance_dict&#39;</span>
        <span class="n">job</span><span class="o">.</span><span class="n">auto_inheritance_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">job</span><span class="o">.</span><span class="n">inheritance_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">inside_project</span><span class="p">:</span> <span class="s1">&#39;parent_files_value&#39;</span><span class="p">}</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span><span class="n">inside_project</span><span class="p">,</span> <span class="n">brick_id</span><span class="p">,</span>
                                                    <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;rename_1&#39;</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">,</span>
                                                    <span class="s1">&#39;rename_1&#39;</span><span class="p">,</span> <span class="n">job</span><span class="p">,</span> <span class="n">trait</span><span class="p">,</span>
                                                    <span class="n">inputs</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>

        <span class="c1"># &#39;parent_files&#39; inside &#39;inheritance_dict&#39;, dict type</span>
        <span class="n">job</span><span class="o">.</span><span class="n">inheritance_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">inside_project</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;own_tags&#39;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;tag_name&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;field_type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;description_content&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;visibility&#39;</span><span class="p">:</span> <span class="s1">&#39;visibility_content&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;origin&#39;</span><span class="p">:</span> <span class="s1">&#39;origin_content&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;unit_content&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;value_content&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;default_value&#39;</span><span class="p">:</span> <span class="s1">&#39;default_value_content&#39;</span>
                    <span class="p">}</span>
                <span class="p">],</span>
                <span class="s1">&#39;parent&#39;</span><span class="p">:</span> <span class="s1">&#39;parent_content&#39;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span><span class="n">inside_project</span><span class="p">,</span> <span class="n">brick_id</span><span class="p">,</span>
                                                    <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;rename_1&#39;</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">,</span>
                                                    <span class="s1">&#39;rename_1&#39;</span><span class="p">,</span> <span class="n">job</span><span class="p">,</span> <span class="n">trait</span><span class="p">,</span>
                                                    <span class="n">inputs</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>

        <span class="c1"># &#39;parent_files&#39; inside &#39;inheritance_dict&#39;, output is one of the inputs</span>
        <span class="n">job</span><span class="o">.</span><span class="n">inheritance_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">inside_project</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;own_tags&#39;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;tag_name&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;field_type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;description_content&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;visibility&#39;</span><span class="p">:</span> <span class="s1">&#39;visibility_content&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;origin&#39;</span><span class="p">:</span> <span class="s1">&#39;origin_content&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;unit_content&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;value_content&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;default_value&#39;</span><span class="p">:</span> <span class="s1">&#39;default_value_content&#39;</span>
                    <span class="p">}</span>
                <span class="p">],</span>
                <span class="s1">&#39;parent&#39;</span><span class="p">:</span> <span class="s1">&#39;parent_content&#39;</span><span class="p">,</span>
                <span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="n">inside_project</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span><span class="n">inside_project</span><span class="p">,</span> <span class="n">brick_id</span><span class="p">,</span>
                                                    <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;rename_1&#39;</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">,</span>
                                                    <span class="s1">&#39;rename_1&#39;</span><span class="p">,</span> <span class="n">job</span><span class="p">,</span> <span class="n">trait</span><span class="p">,</span>
                                                    <span class="n">inputs</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_ask_iterated_pipeline_plugs"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_ask_iterated_pipeline_plugs">[docs]</a>    <span class="k">def</span> <span class="nf">test_ask_iterated_pipeline_plugs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Adds the process &#39;Rename&#39;, export mandatory input and output plug </span>
<span class="sd">        and opens an iteration dialog for each plug.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Tests the PipelineManagerTab.ask_iterated_pipeline_plugs.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>

        <span class="c1"># Adds the processes Smooth, creates the &quot;rename_1&quot; node</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Rename</span><span class="p">)</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        <span class="n">pipeline_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="c1"># Exports the mandatory input and output plugs for &quot;rename_1&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s1">&#39;rename_1&#39;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_QDialogAccept</span><span class="p">)</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">ask_iterated_pipeline_plugs</span><span class="p">(</span><span class="n">pipeline</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_build_iterated_pipeline"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_build_iterated_pipeline">[docs]</a>    <span class="k">def</span> <span class="nf">test_build_iterated_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Adds a &#39;Select&#39; process, exports its mandatory inputs, mocks </span>
<span class="sd">        some methods of the pipeline manager and builds an iterated </span>
<span class="sd">        pipeline.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Tests the method &#39;PipelineManagerTab.build_iterated_pipeline&#39;.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="c1"># Adds the processes Select, creates the &quot;select_1&quot; node</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Select</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Exports the mandatory input and output plugs for &quot;select_1&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s1">&#39;select_1&#39;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="c1"># Mocks &#39;parent_pipeline&#39; and returns a &#39;Process&#39; instead of a </span>
        <span class="c1"># &#39;Pipeline&#39;</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;select_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">parent_pipeline</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">get_pipeline_or_process</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">pipeline</span><span class="p">)</span>

        <span class="c1"># Mocks &#39;ask_iterated_pipeline_plugs&#39; and returns the tuple </span>
        <span class="c1"># &#39;(iterated_plugs, database_plugs)&#39;</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">ask_iterated_pipeline_plugs</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span>
                                      <span class="n">return_value</span><span class="o">=</span><span class="p">([</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;inlist&#39;</span><span class="p">,</span> <span class="s1">&#39;_out&#39;</span><span class="p">],</span>
                                                    <span class="p">[</span><span class="s1">&#39;inlist&#39;</span><span class="p">]))</span>

        <span class="c1"># Mocks &#39;update_nodes_and_plugs_activation&#39; with no returned values</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">update_nodes_and_plugs_activation</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>

        <span class="c1"># Builds iterated pipeline</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">** an exception message is expected below</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">build_iterated_pipeline</span><span class="p">()</span>

        <span class="c1"># Asserts the mock methods were called as expected</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">get_pipeline_or_process</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">()</span>
        <span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">ask_iterated_pipeline_plugs</span><span class="o">.</span>
                                              <span class="n">assert_called_once_with</span><span class="p">)(</span><span class="n">pipeline</span><span class="p">)</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">update_nodes_and_plugs_activation</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_check_requirements"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_check_requirements">[docs]</a>    <span class="k">def</span> <span class="nf">test_check_requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Adds a &#39;Select&#39; process, appends it to the nodes list and checks</span>
<span class="sd">        the requirements for the given node.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Tests PipelineManagerTab.check_requirements.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">pipeline_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="c1"># Adds the processes Select, creates the &quot;select_1&quot; node</span>
        <span class="n">process_class</span> <span class="o">=</span> <span class="n">Select</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">process_class</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Appends a &#39;Process&#39; to &#39;pipeline_manager.node_list&#39; and checks</span>
        <span class="c1"># requirements</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">node_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;select_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">check_requirements</span><span class="p">()</span>

        <span class="c1"># Asserts the output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="nb">dict</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;capsul_engine&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;capsul.engine.module.nipype&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_cleanup_older_init"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_cleanup_older_init">[docs]</a>    <span class="k">def</span> <span class="nf">test_cleanup_older_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Mocks a brick list, mocks some methods from the pipeline manager</span>
<span class="sd">        and cleans older inits.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Tests PipelineManagerTab.cleanup_older_init.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="c1"># Mocks a &#39;pipeline_manager.brick_list&#39;</span>
        <span class="n">brick_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">brick_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">brick_id</span><span class="p">)</span>

        <span class="c1"># Mocks methods used in the test</span>
        <span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span>
                                                <span class="n">delete_from_brick</span><span class="p">)</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">cleanup_orphan_nonexisting_files</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>

        <span class="c1"># Cleans up older init</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">cleanup_older_init</span><span class="p">()</span>

        <span class="c1"># Asserts that the mock methods were called as expected</span>
        <span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">delete_from_brick</span><span class="o">.</span>
                                              <span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">brick_id</span><span class="p">))</span>
        <span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">cleanup_orphan_nonexisting_files</span><span class="o">.</span>
                                                      <span class="n">assert_called_once_with</span><span class="p">())</span>

        <span class="c1"># Asserts that both &#39;brick_list&#39; and &#39;node_list&#39; were cleaned</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">brick_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">node_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_complete_pipeline_parameters"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_complete_pipeline_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">test_complete_pipeline_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Mocks a method of pipeline manager and completes the pipeline</span>
<span class="sd">        parameters.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Tests PipelineManagerTab.complete_pipeline_parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="c1"># Mocks method used in the test</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">get_capsul_engine</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span>
                             <span class="n">return_value</span><span class="o">=</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">get_pipeline_or_process</span><span class="p">())</span>

        <span class="c1"># Complete pipeline parameters</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">complete_pipeline_parameters</span><span class="p">()</span>

        <span class="c1"># Asserts that the mock method was called as expected</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">get_capsul_engine</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_delete_processes"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_delete_processes">[docs]</a>    <span class="k">def</span> <span class="nf">test_delete_processes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes a process and makes the undo/redo action</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span>
                                                             <span class="n">pipelineEditorTabs</span><span class="p">)</span>

        <span class="c1"># Adding processes</span>
        <span class="n">process_class</span> <span class="o">=</span> <span class="n">Smooth</span>

        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="c1"># Creates a node called &quot;smooth_1&quot;</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
                                                                  <span class="n">process_class</span><span class="p">)</span>
        <span class="c1"># Creates a node called &quot;smooth_2&quot;</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
                                                                  <span class="n">process_class</span><span class="p">)</span>
        <span class="c1"># Creates a node called &quot;smooth_3&quot;</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
                                                                  <span class="n">process_class</span><span class="p">)</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_3&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span>
                                                <span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">,</span> <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">),</span>
                                                <span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">,</span> <span class="s2">&quot;in_files&quot;</span><span class="p">),</span>
                                                <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">weak</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                        <span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                   <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">))</span>

        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span>
                                                <span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">,</span> <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">),</span>
                                                <span class="p">(</span><span class="s2">&quot;smooth_3&quot;</span><span class="p">,</span> <span class="s2">&quot;in_files&quot;</span><span class="p">),</span>
                                                <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">weak</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_3&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                        <span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                   <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">))</span>

        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s2">&quot;smooth_2&quot;</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">del_node</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_3&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                   <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_3&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                        <span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">))</span>

        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">undo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_3&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                        <span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                   <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_3&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                        <span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                   <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">))</span>

        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">redo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_3&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                   <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_3&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                        <span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_finish_execution"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_finish_execution">[docs]</a>    <span class="k">def</span> <span class="nf">test_finish_execution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Mocks several objects of the pipeline manager and finishes the </span>
<span class="sd">        execution of the pipeline.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Tests the method PipelineManagerTab.finish_execution.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="c1"># Mock objects of &#39;pipeline_manager&#39; used during the test</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;status_value&#39;</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">last_run_pipeline</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">last_pipeline_name</span> <span class="o">=</span> <span class="s1">&#39;last_pipeline_name_value&#39;</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">_mmovie</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>

        <span class="c1"># Mock methods of &#39;ppl_manager&#39; used during the test</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">show_pipeline_status_action</span><span class="o">.</span><span class="n">setIcon</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">nodeController</span><span class="o">.</span><span class="n">update_parameters</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">run_pipeline_action</span><span class="o">.</span><span class="n">setDisabled</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">garbage_collect_action</span><span class="o">.</span><span class="n">setDisabled</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">stop_pipeline_action</span><span class="o">.</span><span class="n">setEnabled</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>

        <span class="c1"># Connect &#39;worker&#39; to &#39;finished_execution&#39; method</span>
        <span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span>
                                          <span class="n">connect</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">finish_execution</span><span class="p">))</span>

        <span class="c1"># Finish the execution of the pipeline (no errors are thrown)</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">finish_execution</span><span class="p">()</span>

        <span class="c1"># Asserts that the mocked objects were called as expected</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s1">&#39;status_value&#39;</span><span class="p">,</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">last_status</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">ppl_manager</span><span class="p">,</span> <span class="s1">&#39;_mmovie&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">last_run_log</span><span class="p">)</span>

        <span class="c1"># Asserts that the mocked methods were called as expected</span>
        <span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">stop_pipeline_action</span><span class="o">.</span>
                                      <span class="n">setEnabled</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="kc">False</span><span class="p">))</span>
        <span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">last_run_pipeline</span><span class="o">.</span><span class="n">get_study_config</span><span class="p">()</span><span class="o">.</span>
                                   <span class="n">engine</span><span class="o">.</span><span class="n">raise_for_status</span><span class="o">.</span><span class="n">assert_called_once</span><span class="p">())</span>
        <span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="o">.</span>
                                                       <span class="n">assert_called_once_with</span><span class="p">)(</span>
                                <span class="s1">&#39;Pipeline &quot;</span><span class="si">{0}</span><span class="s1">&quot; has been correctly run.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                                <span class="n">ppl_manager</span><span class="o">.</span><span class="n">last_pipeline_name</span><span class="p">))</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">show_pipeline_status_action</span><span class="o">.</span><span class="n">setIcon</span><span class="o">.</span><span class="n">assert_called_once</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">nodeController</span><span class="o">.</span><span class="n">update_parameters</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">()</span>
        <span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">run_pipeline_action</span><span class="o">.</span>
                                     <span class="n">setDisabled</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="kc">False</span><span class="p">))</span>
        <span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">garbage_collect_action</span><span class="o">.</span>
                                     <span class="n">setDisabled</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="kc">False</span><span class="p">))</span>

        <span class="c1"># Mock objects in order to induce a &#39;RuntimeError&#39; which is </span>
        <span class="c1"># treated by the method</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">swconstants</span><span class="o">.</span><span class="n">WORKFLOW_DONE</span>
        <span class="nb">delattr</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">worker</span><span class="p">,</span> <span class="s1">&#39;exec_id&#39;</span><span class="p">)</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">_mmovie</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>

        <span class="c1"># Finish the execution of the pipeline with no &#39;worker.exec_id&#39; </span>
        <span class="c1"># (an error is thrown)</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">finish_execution</span><span class="p">()</span>

        <span class="c1"># Asserts that the execution of the pipeline failed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">last_run_log</span><span class="p">,</span> 
                         <span class="s1">&#39;Execution aborted before running&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_garbage_collect"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_garbage_collect">[docs]</a>    <span class="k">def</span> <span class="nf">test_garbage_collect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Mocks several objects of the pipeline manager and collects the </span>
<span class="sd">        garbage of the pipeline.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Tests PipelineManagerTab.test_garbage_collect.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="c1"># INTEGRATED TEST</span>

        <span class="c1"># Mocks the &#39;initialized&#39; object</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">initialized</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Collects the garbage</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">garbage_collect</span><span class="p">()</span>

        <span class="c1"># Asserts that the &#39;initialized&#39; object changed state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span>
                                                                    <span class="n">initialized</span><span class="p">)</span>

        <span class="c1"># ISOLATED TEST</span>

        <span class="c1"># Mocks again the &#39;initialized&#39; object</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">initialized</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Mocks the methods used in the test</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">postprocess_pipeline_execution</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">cleanup_orphan_nonexisting_files</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">cleanup_orphan_history</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
        <span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span>
                                                     <span class="n">update_table</span><span class="p">)</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">update_user_buttons_states</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>

        <span class="c1"># Collects the garbage</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">garbage_collect</span><span class="p">()</span>

        <span class="c1"># Asserts that the &#39;initialized&#39; object changed state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span>
                                                                    <span class="n">initialized</span><span class="p">)</span>

        <span class="c1"># Assertes that the mocked methods were called as expected</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">postprocess_pipeline_execution</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">()</span>
        <span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span>
                     <span class="n">cleanup_orphan_nonexisting_files</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">())</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">cleanup_orphan_history</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">()</span>
        <span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span>
                                         <span class="n">update_table</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">())</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">update_user_buttons_states</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_get_capsul_engine"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_get_capsul_engine">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_capsul_engine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Mocks an object in the pipeline manager and gets the capsul engine</span>
<span class="sd">        of the pipeline.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Tests PipelineManagerTab.get_capsul_engine.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="c1"># INTEGRATED</span>

        <span class="c1"># Gets the capsul engine</span>
        <span class="n">capsul_engine</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">get_capsul_engine</span><span class="p">()</span>  <span class="c1"># integrated</span>

        <span class="c1"># Asserts that the &#39;capsul_engine&#39; is of class &#39;CapsulEngine&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">capsul_engine</span><span class="p">,</span> <span class="n">CapsulEngine</span><span class="p">)</span>

        <span class="c1"># ISOLATED</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_capsul_engine</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>

        <span class="c1"># Gets the capsul engine</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">get_capsul_engine</span><span class="p">()</span>  <span class="c1"># isolated</span>

        <span class="c1"># Asserts that the mocked method was called as expected</span>
        <span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span>
         <span class="n">get_capsul_engine</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">())</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_get_missing_mandatory_parameters"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_get_missing_mandatory_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_missing_mandatory_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Adds a process, exports input and output plugs and tries to initialize</span>
<span class="sd">        the pipeline with missing mandatory parameters.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Tests PipelineManagerTab.get_missing_mandatory_parameters.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Rename</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Exports the mandatory inputs and outputs for &quot;rename_1&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s1">&#39;rename_1&#39;</span>
        <span class="p">(</span><span class="n">ppl_edt_tabs</span><span class="o">.</span>
                     <span class="n">get_current_editor</span><span class="p">)()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="p">(</span><span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">)()</span><span class="o">.</span><span class="n">_export_plug</span><span class="p">(</span>
                                       <span class="n">temp_plug_name</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;rename_1&#39;</span><span class="p">,</span> <span class="s1">&#39;_out_file&#39;</span><span class="p">),</span>
                                       <span class="n">pipeline_parameter</span><span class="o">=</span><span class="s1">&#39;_out_file&#39;</span><span class="p">,</span>
                                       <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                       <span class="n">weak_link</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Initializes the pipeline</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">workflow</span> <span class="o">=</span> <span class="n">workflow_from_pipeline</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span>
                                                      <span class="n">complete_parameters</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">update_node_list</span><span class="p">()</span>

        <span class="c1"># Asserts that 2 mandatory parameters are missing</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">update_node_list</span><span class="p">()</span>
        <span class="n">missing_inputs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">get_missing_mandatory_parameters</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">missing_inputs</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">missing_inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Pipeline.rename_1.format_string&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">missing_inputs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;Pipeline.rename_1.in_file&#39;</span><span class="p">)</span>

        <span class="c1"># Empties the jobs list</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">jobs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Asserts that 2 mandatory parameters are still missing</span>
        <span class="n">missing_inputs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">get_missing_mandatory_parameters</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">missing_inputs</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">missing_inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Pipeline.rename_1.format_string&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">missing_inputs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;Pipeline.rename_1.in_file&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_get_pipeline_or_process"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_get_pipeline_or_process">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_pipeline_or_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a process and gets a pipeline and a process from the pipeline</span>
<span class="sd">        manager.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Tests PipelineManagerTab.get_pipeline_or_process.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Sets shortcuts for often used objects</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>

        <span class="c1"># Gets the pipeline</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">get_pipeline_or_process</span><span class="p">()</span>

        <span class="c1"># Asserts that the object &#39;pipeline&#39; is a &#39;Pipeline&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">)</span>

        <span class="c1"># Adds the processes Rename, creates the &quot;rename_1&quot; node</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Rename</span><span class="p">)</span>

        <span class="c1"># Gets a process</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">get_pipeline_or_process</span><span class="p">()</span>

        <span class="c1"># Asserts that the process &#39;pipeline&#39; is indeed a &#39;NipypeProcess&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="n">NipypeProcess</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_initialize"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_initialize">[docs]</a>    <span class="k">def</span> <span class="nf">test_initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Adds Select process, exports its plugs, mocks objects from the </span>
<span class="sd">        pipeline manager and initializes the workflow.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Tests the PipelineManagerTab.initialize.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Gets the paths of 2 documents</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span>
                                              <span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="s1">&#39;mia&#39;</span><span class="p">,</span> <span class="s1">&#39;project_8&#39;</span><span class="p">,</span>
                                              <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;raw_data&#39;</span><span class="p">))</span>
        
        <span class="n">NII_FILE_1</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Guerbet-C6-2014-Rat-K52-Tube27-2014-02-14102317-04-G3_&#39;</span>
                      <span class="s1">&#39;Guerbet_MDEFT-MDEFTpvm-000940_800.nii&#39;</span><span class="p">)</span>

        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">NII_FILE_1</span><span class="p">))</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        
        <span class="c1"># Adds the process &#39;Select&#39; as the node &#39;select_1&#39;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Rename</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Exports the mandatory inputs and outputs for &#39;select_1&#39;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s1">&#39;rename_1&#39;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="c1"># Sets mandatory parameters &#39;select_1&#39;</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s1">&#39;in_file&#39;</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s1">&#39;format_string&#39;</span><span class="p">,</span> <span class="s1">&#39;new_name.nii&#39;</span><span class="p">)</span>

        <span class="c1"># Checks that there is no workflowindex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">workflow</span><span class="p">)</span>

        <span class="c1"># Mocks objects</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_clicked</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">ignore_node</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="s1">&#39;item_value&#39;</span><span class="p">}</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">ignore</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="s1">&#39;item_value&#39;</span><span class="p">}</span>

        <span class="c1"># Mocks methods</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
        <span class="c1"># FIXME: if the method &#39;init_pipeline&#39; is not mocked the whole</span>
        <span class="c1">#        test routine fails with a &#39;Segmentation Fault&#39;</span>

        <span class="c1"># Initializes the pipeline</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

        <span class="c1"># Asserts that a workflow has been created</span>
        <span class="c1">#self.assertIsNotNone(ppl_manager.workflow)</span>
        <span class="c1">#from soma_workflow.client_types import Workflow</span>
        <span class="c1">#self.assertIsInstance(ppl_manager.workflow, Workflow)</span>
        <span class="c1"># FiXME: the above code else leads to &#39;Segmentation Fault&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">ignore_node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">key</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">ignore</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">()</span>

        <span class="c1"># Mocks an object to induce an exception</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Induces an exception in the pipeline initialization</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">** an exception message is expected below&#39;</span><span class="p">)</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">ignore_node</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_register_node_io_in_database"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_register_node_io_in_database">[docs]</a>    <span class="k">def</span> <span class="nf">test_register_node_io_in_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Adds a process, sets input and output parameters and registers them</span>
<span class="sd">        in database.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Tests PipelineManagerTab._register_node_io_in_database.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Opens project 8 and switches to it</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s1">&#39;project_9&#39;</span><span class="p">)</span>

        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span>
                      <span class="n">get_documents_names</span><span class="p">)(</span><span class="s2">&quot;current&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span>
                                <span class="n">pipelineEditorTabs</span><span class="p">)</span>

        <span class="c1"># Adds the processes Smooth, creates the &quot;rename_1&quot; node</span>
        <span class="n">process_class</span> <span class="o">=</span> <span class="n">Rename</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
                                                                  <span class="n">process_class</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Exports the mandatory input and output plugs for &quot;rename_1&quot;</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s1">&#39;rename_1&#39;</span>
        <span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span>
                     <span class="n">get_current_editor</span><span class="p">)()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span>
                          <span class="n">get_current_editor</span><span class="p">)()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="n">old_scan_name</span> <span class="o">=</span> <span class="n">DOCUMENT_1</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">new_scan_name</span> <span class="o">=</span> <span class="s1">&#39;new_name.nii&#39;</span>

        <span class="c1"># Sets the mandatory plug values in the &quot;inputs&quot; node</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s1">&#39;in_file&#39;</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s1">&#39;format_string&#39;</span><span class="p">,</span> <span class="n">new_scan_name</span><span class="p">)</span>

        <span class="c1"># Changes the &quot;_out_file&quot; in the &quot;outputs&quot; node</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s1">&#39;_out_file&#39;</span><span class="p">,</span>
                                          <span class="n">DOCUMENT_1</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old_scan_name</span><span class="p">,</span>
                                                             <span class="n">new_scan_name</span><span class="p">))</span>

        <span class="n">pipeline_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">workflow</span> <span class="o">=</span> <span class="n">workflow_from_pipeline</span><span class="p">(</span>
                                                       <span class="n">pipeline</span><span class="p">,</span>
                                                       <span class="n">complete_parameters</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">job</span> <span class="o">=</span> <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">jobs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">brick_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="n">job</span><span class="o">.</span><span class="n">uuid</span> <span class="o">=</span> <span class="n">brick_id</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">brick_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">brick_id</span><span class="p">)</span>

        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_document</span><span class="p">(</span><span class="n">COLLECTION_BRICK</span><span class="p">,</span>
                                                      <span class="n">brick_id</span><span class="p">)</span>

        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">_register_node_io_in_database</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">process</span><span class="p">())</span>

        <span class="c1"># Simulates a &#39;ProcessNode()&#39; as &#39;process&#39;</span>
        <span class="n">process_node</span> <span class="o">=</span> <span class="n">ProcessNode</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">process</span><span class="p">())</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">_register_node_io_in_database</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">process_node</span><span class="p">)</span>

        <span class="c1"># Simulates a &#39;PipelineNode()&#39; as &#39;process&#39;</span>
        <span class="n">pipeline_node</span> <span class="o">=</span> <span class="n">PipelineNode</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">process</span><span class="p">())</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">_register_node_io_in_database</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">pipeline_node</span><span class="p">)</span>

        <span class="c1"># Simulates a &#39;Switch()&#39; as &#39;process&#39;</span>
        <span class="n">switch</span> <span class="o">=</span> <span class="n">Switch</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
        <span class="n">switch</span><span class="o">.</span><span class="n">completion_engine</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">_register_node_io_in_database</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">switch</span><span class="p">)</span>

        <span class="c1"># Simulates a list of outputs in &#39;process&#39;</span>
        <span class="n">job</span><span class="o">.</span><span class="n">process</span><span class="p">()</span><span class="o">.</span><span class="n">list_outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">job</span><span class="o">.</span><span class="n">process</span><span class="p">()</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">_register_node_io_in_database</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">process</span><span class="p">())</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_register_completion_attributes"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_register_completion_attributes">[docs]</a>    <span class="k">def</span> <span class="nf">test_register_completion_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Mocks methods of the pipeline manager and registers completion </span>
<span class="sd">        attributes.</span>

<span class="sd">        Notes</span>
<span class="sd">        ------</span>
<span class="sd">        Tests PipelineManagerTab.register_completion_attributes.</span>
<span class="sd">        Since a method of the ProcessCompletionEngine class is mocked, </span>
<span class="sd">        this test may render the upcoming testing routine instable.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">ppl</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Gets the path of one document</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span>
                                              <span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="s1">&#39;mia&#39;</span><span class="p">,</span> <span class="s1">&#39;project_8&#39;</span><span class="p">,</span>
                                              <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;raw_data&#39;</span><span class="p">))</span>

        <span class="n">NII_FILE_1</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Guerbet-C6-2014-Rat-K52-Tube27-2014-02-14102317-01-G1_&#39;</span>
                      <span class="s1">&#39;Guerbet_Anat-RAREpvm-000220_000.nii&#39;</span><span class="p">)</span>
        <span class="n">NII_FILE_2</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Guerbet-C6-2014-Rat-K52-Tube27-2014-02-14102317-04-G3_&#39;</span>
                      <span class="s1">&#39;Guerbet_MDEFT-MDEFTpvm-000940_800.nii&#39;</span><span class="p">)</span>

        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">NII_FILE_1</span><span class="p">))</span>
        <span class="n">DOCUMENT_2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">NII_FILE_2</span><span class="p">))</span>

        <span class="c1"># Adds a Rename processes, creates the &#39;rename_1&#39; node</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Select</span><span class="p">)</span>

        <span class="c1"># Export plugs and sets their values</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">** an exception message is expected below</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s1">&#39;inlist&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">DOCUMENT_1</span><span class="p">,</span> <span class="n">DOCUMENT_2</span><span class="p">])</span>
        <span class="n">proj_dir</span> <span class="o">=</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span>
                                                   <span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span><span class="p">)),</span>
                                 <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">proj_dir</span><span class="p">,</span> <span class="s1">&#39;output_file.nii&#39;</span><span class="p">)</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s1">&#39;_out&#39;</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span>

        <span class="c1"># Register completion without &#39;attributes&#39;</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">register_completion_attributes</span><span class="p">(</span><span class="n">ppl</span><span class="p">)</span>

        <span class="c1"># Mocks &#39;get_capsul_engine&#39; for the method not to throw an error</span>
        <span class="c1"># with the insertion of the upcoming mock</span>
        <span class="n">capsul_engine</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_capsul_engine</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">get_capsul_engine</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">capsul_engine</span><span class="p">)</span>

        <span class="c1"># Mocks attributes values that are in the tags list</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Checksum&#39;</span><span class="p">:</span><span class="s1">&#39;Checksum_value&#39;</span><span class="p">}</span>
        <span class="p">(</span><span class="n">ProcessCompletionEngine</span><span class="o">.</span><span class="n">get_completion_engine</span><span class="p">(</span><span class="n">ppl</span><span class="p">)</span><span class="o">.</span>
                                  <span class="n">get_attribute_values</span><span class="p">)()</span><span class="o">.</span><span class="n">export_to_dict</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span>
                                                      <span class="n">return_value</span><span class="o">=</span><span class="n">attributes</span><span class="p">)</span>

        <span class="c1"># Register completion with mocked &#39;attributes&#39;</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">register_completion_attributes</span><span class="p">(</span><span class="n">ppl</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_remove_progress"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_remove_progress">[docs]</a>    <span class="k">def</span> <span class="nf">test_remove_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Mocks an object of the pipeline manager and removes its progress.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Tests the method PipelineManagerTab.remove_progress.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="c1"># Mocks the &#39;progress&#39; object</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>

        <span class="c1"># Removes progress</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">remove_progress</span><span class="p">()</span>

        <span class="c1"># Asserts that the object &#39;progress&#39; was deleted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">pipeline_manager</span><span class="p">,</span> <span class="s1">&#39;progress&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_savePipeline"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_savePipeline">[docs]</a>    <span class="k">def</span> <span class="nf">test_savePipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Mocks methods of the pipeline manager and tries to save the </span>
<span class="sd">        pipeline over several conditions.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Tests PipelineManagerTab.savePipeline.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">ppl_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;processes&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;User_processes&#39;</span><span class="p">,</span> <span class="s1">&#39;test_pipeline_1.py&#39;</span><span class="p">)</span>

        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">_pipeline_filename</span> <span class="o">=</span> <span class="n">ppl_path</span>

        <span class="c1"># Mocks methods</span>
        <span class="c1">#ppl_manager.main_window.statusBar().showMessage = Mock()</span>

        <span class="c1"># Save pipeline as with empty filename, checked</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">savePipeline</span><span class="p">(</span><span class="n">uncheck</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Mocks &#39;savePipeline&#39; from &#39;ppl_edt_tabs&#39;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">save_pipeline</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="s1">&#39;not_empty&#39;</span><span class="p">)</span>

        <span class="c1"># Saves pipeline as with empty filename, checked</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">savePipeline</span><span class="p">(</span><span class="n">uncheck</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Sets the path to save the pipeline</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">_pipeline_filename</span> <span class="o">=</span> <span class="n">ppl_path</span>

        <span class="c1"># Saves pipeline as with filled filename, uncheck</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">savePipeline</span><span class="p">(</span><span class="n">uncheck</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Aborts pipeline saving with filled filename</span>
        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_QDialogClose</span><span class="p">)</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">savePipeline</span><span class="p">()</span>
        
        <span class="c1"># Accept pipeline saving with filled filename</span>
        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_QMessageBox_clickYes</span><span class="p">)</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">savePipeline</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_savePipelineAs"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_savePipelineAs">[docs]</a>    <span class="k">def</span> <span class="nf">test_savePipelineAs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Mocks a method from pipeline manager and saves a pipeline under</span>
<span class="sd">        another name.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Tests PipelineManagerTab.savePipelineAs.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>

        <span class="c1"># Saves pipeline with empty filename</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">savePipelineAs</span><span class="p">()</span>

        <span class="c1"># Mocks &#39;savePipeline&#39; from &#39;ppl_edt_tabs&#39;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">save_pipeline</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="s1">&#39;not_empty&#39;</span><span class="p">)</span>

        <span class="c1"># Saves pipeline with not empty filename</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">savePipelineAs</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_set_anim_frame"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_set_anim_frame">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_anim_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Runs the &#39;rotatingBrainVISA.gif&#39; animation.</span>
<span class="sd">      &quot;&quot;&quot;</span>

      <span class="n">pipeline_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
      
      <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
      <span class="n">sources_images_dir</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getSourceImageDir</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">sources_images_dir</span><span class="p">)</span>  <span class="c1"># if the string is not empty</span>

      <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">_mmovie</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMovie</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                                       <span class="n">sources_images_dir</span><span class="p">,</span>
                                                       <span class="s1">&#39;rotatingBrainVISA.gif&#39;</span><span class="p">))</span>
      <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">_set_anim_frame</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_show_status"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_show_status">[docs]</a>    <span class="k">def</span> <span class="nf">test_show_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Shows the status window of the pipeline manager.</span>
<span class="sd">        Tests PipelineManagerTab.test_show_status.        </span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">show_status</span><span class="p">()</span>

        <span class="c1"># Asserts that the status windows was created</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">ppl_manager</span><span class="p">,</span> <span class="s1">&#39;status_widget&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_stop_execution"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_stop_execution">[docs]</a>    <span class="k">def</span> <span class="nf">test_stop_execution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Shows the status window of the pipeline manager.</span>
<span class="sd">        Tests PipelineManagerTab.test_show_status.        </span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="c1"># Creates a &#39;RunProgress&#39; object</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="n">RunProgress</span><span class="p">(</span><span class="n">ppl_manager</span><span class="p">)</span>

        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">stop_execution</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">interrupt_request</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_undo_redo"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_undo_redo">[docs]</a>    <span class="k">def</span> <span class="nf">test_undo_redo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the undo/redo actions</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span>
                                <span class="n">pipelineEditorTabs</span><span class="p">)</span>

        <span class="c1"># Add a process =&gt; creates a node called &quot;smooth_1&quot;,</span>
        <span class="c1"># test if Smooth_1 is a node in the current pipeline / editor</span>
        <span class="n">process_class</span> <span class="o">=</span> <span class="n">Smooth</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
                                                                  <span class="n">process_class</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Undo (remove the node), test if the node was removed</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">undo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Redo (add again the node), test if the node was added</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">redo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Delete the node, test if the node was removed</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s2">&quot;smooth_1&quot;</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">del_node</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Undo (add again the node), test if the node was added</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">undo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Redo (delete again the node), test if the node was removed</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">redo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;smooth1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Adding a new process =&gt; creates a node called &quot;smooth_1&quot;</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>

        <span class="c1"># Creates a node called &quot;smooth_1&quot;</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
                                                                  <span class="n">process_class</span><span class="p">)</span>

        <span class="c1"># Export the &quot;out_prefix&quot; plug,</span>
        <span class="c1"># test if the Input node have a prefix_smooth plug</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">_export_plug</span><span class="p">(</span>
                                      <span class="n">temp_plug_name</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">,</span> <span class="s2">&quot;out_prefix&quot;</span><span class="p">),</span>
                                      <span class="n">pipeline_parameter</span><span class="o">=</span><span class="s2">&quot;prefix_smooth&quot;</span><span class="p">,</span>
                                      <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                      <span class="n">weak_link</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;prefix_smooth&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Undo (remove prefix_smooth from Input node),</span>
        <span class="c1"># test if the prefix_smooth plug was deleted from Input node</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">undo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;prefix_smooth&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># redo (export again the &quot;out_prefix&quot; plug),</span>
        <span class="c1"># test if the Input node have a prefix_smooth plug</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">redo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;prefix_smooth&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Delete the &quot;prefix_smooth&quot; plug from the Input node,</span>
        <span class="c1"># test if the Input node have not a prefix_smooth plug</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">_remove_plug</span><span class="p">(</span>
                                    <span class="n">_temp_plug_name</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;prefix_smooth&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;prefix_smooth&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Undo (export again the &quot;out_prefix&quot; plug),</span>
        <span class="c1"># test if the Input node have a prefix_smooth plug</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">undo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;prefix_smooth&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># redo (deleting the &quot;prefix_smooth&quot; plug from the Input node),</span>
        <span class="c1"># test if the Input node have not a prefix_smooth plug</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">redo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;prefix_smooth&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># FIXME: export_plugs (currently there is a bug if a plug is</span>
        <span class="c1">#        of type list)</span>

        <span class="c1"># Adding a new process =&gt; creates a node called &quot;smooth_2&quot;</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">550</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
                                                                  <span class="n">process_class</span><span class="p">)</span>

        <span class="c1"># Adding a link</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span>
                                                <span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">,</span> <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">),</span>
                                                <span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">,</span> <span class="s2">&quot;in_files&quot;</span><span class="p">),</span>
                                                <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">weak</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># test if the 2 nodes have the good links</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                        <span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                   <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">))</span>

        <span class="c1"># Undo (remove the link), test if the 2 nodes have not the links</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">undo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                        <span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                   <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">))</span>

        <span class="c1"># Redo (add again the link), test if the 2 nodes have the good links</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">redo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                        <span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                   <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">))</span>

        <span class="c1"># Removing the link, test if the 2 nodes have not the links</span>
        <span class="n">link</span> <span class="o">=</span> <span class="s2">&quot;smooth_1._smoothed_files-&gt;smooth_2.in_files&quot;</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">_del_link</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                        <span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                   <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">))</span>

        <span class="c1"># Undo (add again the link), test if the 2 nodes have the good links</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">undo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                        <span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                   <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">))</span>

        <span class="c1"># Redo (remove the link), test if the 2 nodes have not the links</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">redo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                        <span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                   <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">))</span>

        <span class="c1"># Re-adding a link</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span>
                                                <span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">,</span> <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">),</span>
                                                <span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">,</span> <span class="s2">&quot;in_files&quot;</span><span class="p">),</span>
                                                <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">weak</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Updating the node name</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;smooth_2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">displayNodeParameters</span><span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">,</span> <span class="n">process</span><span class="p">)</span>
        <span class="n">node_controller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">nodeController</span>
        <span class="n">node_controller</span><span class="o">.</span><span class="n">display_parameters</span><span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">)</span>
        <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;my_smooth&quot;</span><span class="p">)</span>
        <span class="n">keyEvent</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QKeyEvent</span><span class="p">(</span><span class="n">QEvent</span><span class="o">.</span><span class="n">KeyPress</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key_Return</span><span class="p">,</span>
                                   <span class="n">Qt</span><span class="o">.</span><span class="n">NoModifier</span><span class="p">)</span>
        <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">postEvent</span><span class="p">(</span><span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="p">,</span>
                                   <span class="n">keyEvent</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

        <span class="c1"># test if the smooth_2 node has been replaced by the</span>
        <span class="c1"># my_smooth node and test the links</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;my_smooth&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;my_smooth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                        <span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                   <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">))</span>

        <span class="c1"># Undo (Updating the node name from my_smooth to smooth_2),</span>
        <span class="c1"># test if it&#39;s ok</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">undo</span><span class="p">()</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;my_smooth&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                        <span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                   <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">))</span>

        <span class="c1"># Redo (Updating the node name from smooth_2 to my_smooth),</span>
        <span class="c1"># test if it&#39;s ok</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">redo</span><span class="p">()</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;my_smooth&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;my_smooth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                        <span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span>
                                                   <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">))</span>

        <span class="c1"># Updating a plug value</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node_controller</span><span class="p">,</span> <span class="s1">&#39;get_index_from_plug_name&#39;</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">node_controller</span><span class="o">.</span><span class="n">get_index_from_plug_name</span><span class="p">(</span><span class="s2">&quot;out_prefix&quot;</span><span class="p">,</span>
                                                             <span class="s2">&quot;in&quot;</span><span class="p">)</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_input</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;PREFIX&quot;</span><span class="p">)</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">update_plug_value</span><span class="p">(</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="s2">&quot;out_prefix&quot;</span><span class="p">,</span>
                                              <span class="n">pipeline</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s2">&quot;PREFIX&quot;</span><span class="p">,</span>
                             <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;my_smooth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_plug_value</span><span class="p">(</span>
                                                                  <span class="s2">&quot;out_prefix&quot;</span><span class="p">))</span>

            <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">undo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
                             <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;my_smooth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_plug_value</span><span class="p">(</span>
                                                                  <span class="s2">&quot;out_prefix&quot;</span><span class="p">))</span>

            <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">redo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s2">&quot;PREFIX&quot;</span><span class="p">,</span>
                             <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;my_smooth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_plug_value</span><span class="p">(</span>
                                                                  <span class="s2">&quot;out_prefix&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_update_auto_inheritance"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_update_auto_inheritance">[docs]</a>    <span class="k">def</span> <span class="nf">test_update_auto_inheritance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Tests PipelineManagerTab.update_auto_inheritance.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">ppl</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span>
                                              <span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="s1">&#39;mia&#39;</span><span class="p">,</span> <span class="s1">&#39;project_8&#39;</span><span class="p">,</span>
                                              <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;raw_data&#39;</span><span class="p">))</span>

        <span class="n">NII_FILE_1</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Guerbet-C6-2014-Rat-K52-Tube27-2014-02-14102317-01-G1_&#39;</span>
                      <span class="s1">&#39;Guerbet_Anat-RAREpvm-000220_000.nii&#39;</span><span class="p">)</span>
        <span class="n">NII_FILE_2</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Guerbet-C6-2014-Rat-K52-Tube27-2014-02-14102317-04-G3_&#39;</span>
                      <span class="s1">&#39;Guerbet_MDEFT-MDEFTpvm-000940_800.nii&#39;</span><span class="p">)</span>

        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">NII_FILE_1</span><span class="p">))</span>
        <span class="n">DOCUMENT_2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">NII_FILE_2</span><span class="p">))</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">ppl</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        
        <span class="c1"># Adds a Rename processes, creates the &#39;rename_1&#39; node</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Select</span><span class="p">)</span>

        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">** an exception message is expected below</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;select_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s1">&#39;inlist&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">DOCUMENT_1</span><span class="p">,</span><span class="n">DOCUMENT_2</span><span class="p">])</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;select_1&#39;</span><span class="p">]</span>

        <span class="c1"># Initializes the workflow manually</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">workflow</span> <span class="o">=</span> <span class="n">workflow_from_pipeline</span><span class="p">(</span><span class="n">ppl</span><span class="p">,</span>
                                                      <span class="n">complete_parameters</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">job</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">jobs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Mocks the node&#39;s parameters</span>
        <span class="n">node</span><span class="o">.</span><span class="n">auto_inheritance_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">process</span>
        <span class="n">process</span><span class="o">.</span><span class="n">study_config</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
        <span class="n">process</span><span class="o">.</span><span class="n">study_config</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">()</span>
        <span class="n">process</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">process</span><span class="o">.</span><span class="n">list_outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">process</span><span class="o">.</span><span class="n">auto_inheritance_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># &#39;job.param_dict&#39; as single object</span>
        <span class="n">job</span><span class="o">.</span><span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;_out&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;_out_value&#39;</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">update_auto_inheritance</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>

        <span class="c1"># &#39;job.param_dict&#39; as list of objects</span>
        <span class="n">job</span><span class="o">.</span><span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;inlist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">DOCUMENT_1</span><span class="p">,</span> <span class="n">DOCUMENT_2</span><span class="p">]</span>
        <span class="n">process</span><span class="o">.</span><span class="n">get_outputs</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;_out&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;_out_value&#39;</span><span class="p">]})</span>
        <span class="n">job</span><span class="o">.</span><span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;_out&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;_out_value&#39;</span><span class="p">]</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">update_auto_inheritance</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>

        <span class="c1"># &#39;node&#39; does not have a &#39;project&#39;</span>
        <span class="k">del</span> <span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">study_config</span><span class="o">.</span><span class="n">project</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">update_auto_inheritance</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>

        <span class="c1"># &#39;node.process&#39; is not a process</span>
        <span class="c1">#node.process = {}</span>
        <span class="c1">#ppl_manager.update_auto_inheritance(job, node)</span>

        <span class="c1"># &#39;node&#39; is not a &#39;Process&#39;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">update_auto_inheritance</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_update_inheritance"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_update_inheritance">[docs]</a>    <span class="k">def</span> <span class="nf">test_update_inheritance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Adds a process and updates the job&#39;s inheritance dict.</span>
<span class="sd">        Tests PipelineManagerTab.update_inheritance.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">ppl</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        
        <span class="c1"># Adds a Rename processes, creates the &#39;rename_1&#39; node</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Rename</span><span class="p">)</span>

        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="n">node</span> <span class="o">=</span> <span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;rename_1&#39;</span><span class="p">]</span>

        <span class="c1"># Initializes the workflow manually</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">workflow</span> <span class="o">=</span> <span class="n">workflow_from_pipeline</span><span class="p">(</span><span class="n">ppl</span><span class="p">,</span>
                                                      <span class="n">complete_parameters</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Gets the &#39;job&#39; and mocks adding a brick to the collection</span>
        <span class="n">job</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">jobs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Node&#39;s name does not contains &#39;Pipeline&#39;</span>
        <span class="n">node</span><span class="o">.</span><span class="n">context_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">inheritance_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="s1">&#39;value&#39;</span><span class="p">}</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">node_inheritance_history</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">update_inheritance</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">inheritance_dict</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="s1">&#39;value&#39;</span><span class="p">})</span>

        <span class="c1"># Node&#39;s name contains &#39;Pipeline&#39;</span>
        <span class="n">node</span><span class="o">.</span><span class="n">context_name</span> <span class="o">=</span> <span class="s1">&#39;Pipeline.rename_1&#39;</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">update_inheritance</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">inheritance_dict</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="s1">&#39;value&#39;</span><span class="p">})</span>

        <span class="c1"># Node&#39;s name in &#39;node_inheritance_history&#39;</span>
        <span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span>
         <span class="o">.</span><span class="n">node_inheritance_history</span><span class="p">[</span><span class="s1">&#39;rename_1&#39;</span><span class="p">])</span> <span class="o">=</span> <span class="p">[{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;new_value&#39;</span><span class="p">}]</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">update_inheritance</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">inheritance_dict</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;new_value&#39;</span><span class="p">})</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_update_node_list"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_update_node_list">[docs]</a>    <span class="k">def</span> <span class="nf">test_update_node_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a process, exports input and output plugs, initializes a workflow</span>
<span class="sd">        and adds the process to the &quot;pipline_manager.node_list&quot;.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Tests the PipelineManagerTab.update_node_list.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span>
                                                             <span class="n">pipelineEditorTabs</span><span class="p">)</span>
        <span class="n">pipeline_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="n">process_class</span> <span class="o">=</span> <span class="n">Rename</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
                                                                  <span class="n">process_class</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Exports the mandatory inputs and outputs for &quot;rename_1&quot;</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s1">&#39;rename_1&#39;</span>
        <span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span>
                     <span class="n">get_current_editor</span><span class="p">)()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span>
                          <span class="n">get_current_editor</span><span class="p">)()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="c1"># Initializes the workflow</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">workflow</span> <span class="o">=</span> <span class="n">workflow_from_pipeline</span><span class="p">(</span>
                                                       <span class="n">pipeline</span><span class="p">,</span>
                                                       <span class="n">complete_parameters</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Asserts that the &quot;node_list&quot; is empty by default</span>
        <span class="n">node_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">node_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_list</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Asserts that the process &quot;Rename&quot; was added to &quot;node_list&quot;</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">update_node_list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_list</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">node_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_nipype_class</span><span class="p">,</span> <span class="s1">&#39;Rename&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_z_init_pipeline"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_z_init_pipeline">[docs]</a>    <span class="k">def</span> <span class="nf">test_z_init_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Adds a process, mocks several parameters from the pipeline</span>
<span class="sd">        manager and initializes the pipeline.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Tests PipelineManagerTab.init_pipeline.</span>
<span class="sd">        The &#39;z&#39; prefix places this test at the end of the alphabetically</span>
<span class="sd">        organized routine. This prevents the &#39;Segmentation Fault&#39; error </span>
<span class="sd">        to be thrown during the test.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">ppl</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Gets the path of one document</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span>
                                              <span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="s1">&#39;mia&#39;</span><span class="p">,</span> <span class="s1">&#39;project_8&#39;</span><span class="p">,</span>
                                              <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;raw_data&#39;</span><span class="p">))</span>

        <span class="n">NII_FILE_1</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Guerbet-C6-2014-Rat-K52-Tube27-2014-02-14102317-01-G1_&#39;</span>
                      <span class="s1">&#39;Guerbet_Anat-RAREpvm-000220_000.nii&#39;</span><span class="p">)</span>

        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">NII_FILE_1</span><span class="p">))</span>
        
        <span class="c1"># Adds a Rename processes, creates the &#39;rename_1&#39; node</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Rename</span><span class="p">)</span>

        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>
        
        <span class="c1"># Verifies that all the processes were added</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;rename_1&#39;</span><span class="p">],</span> <span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        
        <span class="c1"># Initialize the pipeline with missing mandatory parameters</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">workflow</span> <span class="o">=</span> <span class="n">workflow_from_pipeline</span><span class="p">(</span><span class="n">ppl</span><span class="p">,</span>
                                                      <span class="n">complete_parameters</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">update_node_list</span><span class="p">()</span>
        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_QDialogAccept</span><span class="p">)</span>
        <span class="n">init_result</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">init_result</span><span class="p">)</span>
        
        <span class="c1"># Sets the mandatory parameters</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s1">&#39;in_file&#39;</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s1">&#39;format_string&#39;</span><span class="p">,</span> <span class="s1">&#39;new_name.nii&#39;</span><span class="p">)</span>

        <span class="c1"># Mocks an iteration pipeline</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Iteration_pipeline&#39;</span>
        <span class="n">process_it</span> <span class="o">=</span> <span class="n">ProcessIteration</span><span class="p">(</span><span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;rename_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">list_process_in_pipeline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">process_it</span><span class="p">)</span>

        <span class="c1"># Initialize the pipeline with mandatory parameters set</span>
        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_QDialogAccept</span><span class="p">)</span>
        <span class="c1">#init_result = ppl_manager.init_pipeline(pipeline=ppl)</span>

        <span class="c1"># Mocks null requirements and initializes the pipeline</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">check_requirements</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_QDialogAccept</span><span class="p">)</span>
        <span class="n">init_result</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">init_result</span><span class="p">)</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">check_requirements</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s1">&#39;global&#39;</span><span class="p">,</span> 
                                                               <span class="n">message_list</span><span class="o">=</span><span class="p">[])</span>

        <span class="c1"># Mocks external packages as requirements and initializes the </span>
        <span class="c1"># pipeline</span>
        <span class="n">pkgs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fsl&#39;</span><span class="p">,</span> <span class="s1">&#39;afni&#39;</span><span class="p">,</span> <span class="s1">&#39;ants&#39;</span><span class="p">,</span> <span class="s1">&#39;matlab&#39;</span><span class="p">,</span> <span class="s1">&#39;spm&#39;</span><span class="p">]</span>
        <span class="n">req</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;capsul_engine&#39;</span><span class="p">:{</span><span class="s1">&#39;uses&#39;</span><span class="p">:</span> <span class="n">Mock</span><span class="p">()}}</span>

        <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">pkgs</span><span class="p">:</span>                
            <span class="n">req</span><span class="p">[</span><span class="s1">&#39;capsul.engine.module.</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pkg</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;directory&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

        <span class="n">req</span><span class="p">[</span><span class="s1">&#39;capsul_engine&#39;</span><span class="p">][</span><span class="s1">&#39;uses&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">check_requirements</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">req</span><span class="p">)</span>

        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_QDialogAccept</span><span class="p">)</span>
        <span class="n">init_result</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">init_result</span><span class="p">)</span>

        <span class="c1"># Extra steps for SPM</span>
        <span class="n">req</span><span class="p">[</span><span class="s1">&#39;capsul.engine.module.spm&#39;</span><span class="p">][</span><span class="s1">&#39;directory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">req</span><span class="p">[</span><span class="s1">&#39;capsul.engine.module.spm&#39;</span><span class="p">][</span><span class="s1">&#39;standalone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">Config</span><span class="p">()</span><span class="o">.</span><span class="n">set_matlab_standalone_path</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_QDialogAccept</span><span class="p">)</span>
        <span class="n">init_result</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">init_result</span><span class="p">)</span>

        <span class="n">req</span><span class="p">[</span><span class="s1">&#39;capsul.engine.module.spm&#39;</span><span class="p">][</span><span class="s1">&#39;standalone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_QDialogAccept</span><span class="p">)</span>
        <span class="n">init_result</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">init_result</span><span class="p">)</span>

        <span class="c1"># Deletes an attribute of each package requirement</span>
        <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">pkgs</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">req</span><span class="p">[</span><span class="s1">&#39;capsul.engine.module.</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pkg</span><span class="p">)]</span>

        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_QDialogAccept</span><span class="p">)</span>
        <span class="n">init_result</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">init_result</span><span class="p">)</span>

        <span class="c1"># Mocks a &#39;ValueError&#39; in &#39;workflow_from_pipeline&#39;</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">find_empty_parameters</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">side_effect</span><span class="o">=</span><span class="ne">ValueError</span><span class="p">)</span>

        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_QDialogAccept</span><span class="p">)</span>
        <span class="n">init_result</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">init_result</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_z_init_pipeline_2"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_z_init_pipeline_2">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skip</span>
    <span class="k">def</span> <span class="nf">test_z_init_pipeline_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Adds a process, mocks several parameters from the pipeline</span>
<span class="sd">        manager and initializes the pipeline.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Tests PipelineManagerTab.init_pipeline.</span>
<span class="sd">        The &#39;z&#39; prefix places this test at the end of the alphabetically</span>
<span class="sd">        organized routine. This prevents the &#39;Segmentation Fault&#39; error </span>
<span class="sd">        to be thrown during the test.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">ppl</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Gets the path of one document</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span>
                                              <span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="s1">&#39;mia&#39;</span><span class="p">,</span> <span class="s1">&#39;project_8&#39;</span><span class="p">,</span>
                                              <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;raw_data&#39;</span><span class="p">))</span>

        <span class="n">NII_FILE_1</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Guerbet-C6-2014-Rat-K52-Tube27-2014-02-14102317-01-G1_&#39;</span>
                      <span class="s1">&#39;Guerbet_Anat-RAREpvm-000220_000.nii&#39;</span><span class="p">)</span>

        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">NII_FILE_1</span><span class="p">))</span>
        
        <span class="c1"># Adds a Rename processes, creates the &#39;rename_1&#39; node</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Rename</span><span class="p">)</span>

        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>
        
        <span class="c1"># Verifies that all the processes were added</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;rename_1&#39;</span><span class="p">],</span> <span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        
        <span class="c1"># Initialize the pipeline with missing mandatory parameters</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">workflow</span> <span class="o">=</span> <span class="n">workflow_from_pipeline</span><span class="p">(</span><span class="n">ppl</span><span class="p">,</span>
                                                      <span class="n">complete_parameters</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">update_node_list</span><span class="p">()</span>
        <span class="n">init_result</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span><span class="p">()</span>
        <span class="c1">#self.assertFalse(init_result)</span>
        
        <span class="c1"># Sets the mandatory parameters</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s1">&#39;in_file&#39;</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s1">&#39;format_string&#39;</span><span class="p">,</span> <span class="s1">&#39;new_name.nii&#39;</span><span class="p">)</span>

        <span class="c1"># Mocks an iteration pipeline</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Iteration_pipeline&#39;</span>
        <span class="n">process_it</span> <span class="o">=</span> <span class="n">ProcessIteration</span><span class="p">(</span><span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;rename_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">list_process_in_pipeline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">process_it</span><span class="p">)</span>

        <span class="c1"># Initialize the pipeline with mandatory parameters set</span>
        <span class="n">init_result</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span><span class="p">(</span><span class="n">pipeline</span><span class="o">=</span><span class="n">ppl</span><span class="p">)</span>

        <span class="c1"># Mocks null requirements and initializes the pipeline</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">check_requirements</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">init_result</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">init_result</span><span class="p">)</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">check_requirements</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s1">&#39;global&#39;</span><span class="p">,</span> 
                                                               <span class="n">message_list</span><span class="o">=</span><span class="p">[])</span>

        <span class="c1"># Mocks external packages as requirements and initializes the </span>
        <span class="c1"># pipeline</span>
        <span class="n">pkgs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fsl&#39;</span><span class="p">,</span> <span class="s1">&#39;afni&#39;</span><span class="p">,</span> <span class="s1">&#39;ants&#39;</span><span class="p">,</span> <span class="s1">&#39;matlab&#39;</span><span class="p">,</span> <span class="s1">&#39;spm&#39;</span><span class="p">]</span>
        <span class="n">req</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;capsul_engine&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;uses&#39;</span><span class="p">:</span> <span class="n">Mock</span><span class="p">()}}</span>

        <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">pkgs</span><span class="p">:</span>                
            <span class="n">req</span><span class="p">[</span><span class="s1">&#39;capsul.engine.module.</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pkg</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;directory&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

        <span class="n">req</span><span class="p">[</span><span class="s1">&#39;capsul_engine&#39;</span><span class="p">][</span><span class="s1">&#39;uses&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">check_requirements</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">req</span><span class="p">)</span>

        <span class="n">init_result</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">init_result</span><span class="p">)</span>

        <span class="c1"># Extra steps for SPM</span>
        <span class="n">req</span><span class="p">[</span><span class="s1">&#39;capsul.engine.module.spm&#39;</span><span class="p">][</span><span class="s1">&#39;directory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">req</span><span class="p">[</span><span class="s1">&#39;capsul.engine.module.spm&#39;</span><span class="p">][</span><span class="s1">&#39;standalone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">Config</span><span class="p">()</span><span class="o">.</span><span class="n">set_matlab_standalone_path</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="n">init_result</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">init_result</span><span class="p">)</span>

        <span class="n">req</span><span class="p">[</span><span class="s1">&#39;capsul.engine.module.spm&#39;</span><span class="p">][</span><span class="s1">&#39;standalone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">init_result</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">init_result</span><span class="p">)</span>

        <span class="c1"># Deletes an attribute of each package requirement</span>
        <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">pkgs</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">req</span><span class="p">[</span><span class="s1">&#39;capsul.engine.module.</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pkg</span><span class="p">)]</span>

        <span class="n">init_result</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">init_result</span><span class="p">)</span>

        <span class="c1"># Mocks a &#39;ValueError&#39; in &#39;workflow_from_pipeline&#39;</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">find_empty_parameters</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">side_effect</span><span class="o">=</span><span class="ne">ValueError</span><span class="p">)</span>

        <span class="n">init_result</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">init_result</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_z_runPipeline"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_z_runPipeline">[docs]</a>    <span class="k">def</span> <span class="nf">test_z_runPipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Adds a process, export plugs and runs a pipeline.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Tests PipelineManagerTab.runPipeline.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">ppl</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Gets the path of one document</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span>
                                              <span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="s1">&#39;mia&#39;</span><span class="p">,</span> <span class="s1">&#39;project_8&#39;</span><span class="p">,</span>
                                              <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;raw_data&#39;</span><span class="p">))</span>

        <span class="n">NII_FILE_1</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Guerbet-C6-2014-Rat-K52-Tube27-2014-02-14102317-01-G1_&#39;</span>
                      <span class="s1">&#39;Guerbet_Anat-RAREpvm-000220_000.nii&#39;</span><span class="p">)</span>

        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">NII_FILE_1</span><span class="p">))</span>
        
        <span class="c1"># Adds a Rename processes, creates the &#39;rename_1&#39; node</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Rename</span><span class="p">)</span>

        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>
        
        <span class="c1"># Sets the mandatory parameters</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s1">&#39;in_file&#39;</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s1">&#39;format_string&#39;</span><span class="p">,</span> <span class="s1">&#39;new_name.nii&#39;</span><span class="p">)</span>

        <span class="c1"># Mocks &#39;initialize&#39; in order to avoid &#39;Segmentation Fault&#39;</span>
        <span class="c1">#ppl_manager.test_init = True</span>
        <span class="c1">#ppl_manager.initialize = Mock()</span>

        <span class="c1"># Runs the pipeline assuring that the it will be initialized</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">runPipeline</span><span class="p">()</span>

        <span class="c1"># Asserts that the pipeline has run</span>
        <span class="c1">#ppl_manager.initialize.assert_called_once_with()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">brick_list</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">last_run_pipeline</span><span class="p">,</span> <span class="n">ppl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">ppl_manager</span><span class="p">,</span> <span class="s1">&#39;_mmovie&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_zz_del_pack"><a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_zz_del_pack">[docs]</a>    <span class="k">def</span> <span class="nf">test_zz_del_pack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; We remove the brick created during the unit tests, and we take</span>
<span class="sd">        advantage of this to cover the part of the code used to remove the</span>
<span class="sd">        packages &quot;&quot;&quot;</span>

        <span class="n">pkg</span> <span class="o">=</span> <span class="n">PackageLibraryDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="p">)</span>
        <span class="c1"># The Test_pipeline brick was added in the package library</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;Test_pipeline_1&quot;</span> <span class="ow">in</span>
                        <span class="n">pkg</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">package_tree</span><span class="p">[</span><span class="s1">&#39;User_processes&#39;</span><span class="p">])</span>

        <span class="n">pkg</span><span class="o">.</span><span class="n">delete_package</span><span class="p">(</span><span class="n">to_delete</span><span class="o">=</span><span class="s2">&quot;User_processes.Test_pipeline_1&quot;</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># The Test_pipeline brick has been removed from the package library</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;Test_pipeline_1&quot;</span> <span class="ow">in</span>
                         <span class="n">pkg</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">package_tree</span><span class="p">[</span><span class="s1">&#39;User_processes&#39;</span><span class="p">])</span></div></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>

      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, populse.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
  </body>
</html>