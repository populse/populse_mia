<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>populse_mia.test &#8212; populse_mia 2.5.1-dev+53a60969 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=f63d8bfa" />
    <link rel="stylesheet" type="text/css" href="../../_static/haiku.css?v=e491ac2d" />
    <script src="../../_static/documentation_options.js?v=8f6e2028"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="https://unpkg.com/mermaid@10.2.0/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../../index.html">
          <span>populse_mia 2.5.1-dev+53a60969 documentation</span></a></h1>
        <h2 class="heading"><span>populse_mia.test</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="../../index.html">Contents</a>
        </p>

      </div>
      <div class="content" role="main">
        
        
  <h1>Source code for populse_mia.test</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;This module is dedicated to populse_mia unit tests.</span>

<span class="sd">:Contains:</span>
<span class="sd">    :Class:</span>
<span class="sd">        - TestMIACase</span>
<span class="sd">        - TestMIADataBrowser</span>
<span class="sd">        - TestMIAMainWindow</span>
<span class="sd">        - TestMIANodeController</span>
<span class="sd">        - TestMIAPipelineEditor</span>
<span class="sd">        - TestMIAPipelineManagerTab</span>
<span class="sd">        - Test_Z_MIAOthers</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">##########################################################################</span>
<span class="c1"># Populse_mia - Copyright (C) IRMaGe/CEA, 2018</span>
<span class="c1"># Distributed under the terms of the CeCILL license, as published by</span>
<span class="c1"># the CEA-CNRS-INRIA. Refer to the LICENSE file or to</span>
<span class="c1"># http://www.cecill.info/licences/Licence_CeCILL_V2.1-en.html</span>
<span class="c1"># for details.</span>
<span class="c1">##########################################################################</span>

<span class="c1"># General imports:</span>

<span class="c1"># Other import</span>
<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">tempfile</span>

<span class="c1"># import threading</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">sha256</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">MagicMock</span><span class="p">,</span> <span class="n">Mock</span>

<span class="kn">import</span> <span class="nn">psutil</span>
<span class="kn">import</span> <span class="nn">yaml</span>

<span class="c1"># Nipype import</span>
<span class="kn">from</span> <span class="nn">nipype.interfaces</span> <span class="kn">import</span> <span class="n">Rename</span><span class="p">,</span> <span class="n">Select</span>
<span class="kn">from</span> <span class="nn">nipype.interfaces.base.traits_extension</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">File</span><span class="p">,</span>
    <span class="n">InputMultiObject</span><span class="p">,</span>
    <span class="n">OutputMultiPath</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">nipype.interfaces.spm</span> <span class="kn">import</span> <span class="n">Smooth</span><span class="p">,</span> <span class="n">Threshold</span>
<span class="kn">from</span> <span class="nn">packaging</span> <span class="kn">import</span> <span class="n">version</span>

<span class="c1"># PyQt5 import</span>
<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="kn">import</span> <span class="n">QtGui</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">QT_VERSION_STR</span><span class="p">,</span>
    <span class="n">QCoreApplication</span><span class="p">,</span>
    <span class="n">QEvent</span><span class="p">,</span>
    <span class="n">QModelIndex</span><span class="p">,</span>
    <span class="n">QPoint</span><span class="p">,</span>
    <span class="n">Qt</span><span class="p">,</span>
    <span class="n">QThread</span><span class="p">,</span>
    <span class="n">QTimer</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtTest</span> <span class="kn">import</span> <span class="n">QTest</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">QApplication</span><span class="p">,</span>
    <span class="n">QDialog</span><span class="p">,</span>
    <span class="n">QFileDialog</span><span class="p">,</span>
    <span class="n">QInputDialog</span><span class="p">,</span>
    <span class="n">QMessageBox</span><span class="p">,</span>
    <span class="n">QTableWidgetItem</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">traits.api</span> <span class="kn">import</span> <span class="n">TraitListObject</span><span class="p">,</span> <span class="n">Undefined</span>

<span class="c1"># The following statement is currently commented because it has no effect and</span>
<span class="c1"># can be replaced by a function call to have an effect, e.g. sys.settrace()</span>
<span class="c1"># sys.settrace</span>

<span class="n">uts_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))),</span>
        <span class="s2">&quot;miautdata&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">uts_dir</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">To work properly, unit tests need data in the populse_mia(or &quot;</span>
        <span class="s2">&quot;populse-mia)/miautdata directory. Please use:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;git clone https://gricad-gitlab.univ-grenoble-alpes.fr/condamie/&quot;</span>
        <span class="s2">&quot;miautdata.git</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;in populse_mia directory to download it...</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

<span class="k">if</span> <span class="p">(</span>
    <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span>
    <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span>
<span class="p">):</span>
    <span class="c1"># &quot;developer&quot; mode</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MIA_DEV_MODE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
    <span class="n">root_dev_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span>
    <span class="p">)</span>

    <span class="c1"># Adding populse_mia</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">- Unit testing in &quot;developer&quot; mode</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dev_dir</span><span class="p">,</span> <span class="s2">&quot;populse-mia&quot;</span><span class="p">)):</span>
        <span class="n">mia_dev_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dev_dir</span><span class="p">,</span> <span class="s2">&quot;populse-mia&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">mia_dev_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dev_dir</span><span class="p">,</span> <span class="s2">&quot;populse_mia&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Using populse_mia package from </span><span class="si">{}</span><span class="s2"> &quot;</span> <span class="s2">&quot;...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mia_dev_dir</span><span class="p">))</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mia_dev_dir</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">mia_dev_dir</span>

    <span class="c1"># Adding mia_processes:</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dev_dir</span><span class="p">,</span> <span class="s2">&quot;mia_processes&quot;</span><span class="p">)):</span>
        <span class="n">mia_processes_dev_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dev_dir</span><span class="p">,</span> <span class="s2">&quot;mia_processes&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;- Using mia_processes package from </span><span class="si">{}</span><span class="s2"> &quot;</span>
            <span class="s2">&quot;...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mia_processes_dev_dir</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">mia_processes_dev_dir</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">mia_processes_dev_dir</span>

    <span class="c1"># Adding populse_db:</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dev_dir</span><span class="p">,</span> <span class="s2">&quot;populse_db&quot;</span><span class="p">)):</span>
        <span class="n">populse_db_dev_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dev_dir</span><span class="p">,</span> <span class="s2">&quot;populse_db&quot;</span><span class="p">,</span> <span class="s2">&quot;python&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;- Using populse_db package from </span><span class="si">{}</span><span class="s2"> &quot;</span>
            <span class="s2">&quot;...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">populse_db_dev_dir</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">populse_db_dev_dir</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">populse_db_dev_dir</span>

    <span class="c1"># Adding capsul:</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dev_dir</span><span class="p">,</span> <span class="s2">&quot;capsul&quot;</span><span class="p">)):</span>
        <span class="n">capsul_dev_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dev_dir</span><span class="p">,</span> <span class="s2">&quot;capsul&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Using capsul package from </span><span class="si">{}</span><span class="s2"> ...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">capsul_dev_dir</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">capsul_dev_dir</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">capsul_dev_dir</span>

    <span class="c1"># Adding soma-base:</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dev_dir</span><span class="p">,</span> <span class="s2">&quot;soma-base&quot;</span><span class="p">)):</span>
        <span class="n">soma_base_dev_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dev_dir</span><span class="p">,</span> <span class="s2">&quot;soma-base&quot;</span><span class="p">,</span> <span class="s2">&quot;python&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;- Using soma-base package from </span><span class="si">{}</span><span class="s2"> &quot;</span>
            <span class="s2">&quot;...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">soma_base_dev_dir</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">soma_base_dev_dir</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">soma_base_dev_dir</span>

    <span class="c1"># Adding soma-workflow:</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dev_dir</span><span class="p">,</span> <span class="s2">&quot;soma-workflow&quot;</span><span class="p">)):</span>
        <span class="n">soma_workflow_dev_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">root_dev_dir</span><span class="p">,</span> <span class="s2">&quot;soma-workflow&quot;</span><span class="p">,</span> <span class="s2">&quot;python&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;- Using soma-workflow package from </span><span class="si">{}</span><span class="s2"> &quot;</span>
            <span class="s2">&quot;...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">soma_workflow_dev_dir</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">soma_workflow_dev_dir</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">soma_workflow_dev_dir</span>

<span class="k">else</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MIA_DEV_MODE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>

<span class="c1"># Imports after defining the location of populse packages in the case of a</span>
<span class="c1"># developer configuration:</span>

<span class="c1"># Capsul import</span>
<span class="kn">from</span> <span class="nn">capsul.api</span> <span class="kn">import</span> <span class="p">(</span>  <span class="c1"># noqa: E402</span>
    <span class="n">PipelineNode</span><span class="p">,</span>
    <span class="n">ProcessNode</span><span class="p">,</span>
    <span class="n">Switch</span><span class="p">,</span>
    <span class="n">get_process_instance</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">capsul.attributes.completion_engine</span> <span class="kn">import</span> <span class="p">(</span>  <span class="c1"># noqa: E402</span>
    <span class="n">ProcessCompletionEngine</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">capsul.engine</span> <span class="kn">import</span> <span class="n">CapsulEngine</span><span class="p">,</span> <span class="n">WorkflowExecutionError</span>  <span class="c1"># noqa: E402</span>
<span class="kn">from</span> <span class="nn">capsul.pipeline.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>  <span class="c1"># noqa: E402</span>
<span class="kn">from</span> <span class="nn">capsul.pipeline.pipeline_workflow</span> <span class="kn">import</span> <span class="p">(</span>  <span class="c1"># noqa: E402</span>
    <span class="n">workflow_from_pipeline</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">capsul.pipeline.process_iteration</span> <span class="kn">import</span> <span class="n">ProcessIteration</span>  <span class="c1"># noqa: E402</span>
<span class="kn">from</span> <span class="nn">capsul.process.process</span> <span class="kn">import</span> <span class="n">NipypeProcess</span>  <span class="c1"># noqa: E402</span>
<span class="kn">from</span> <span class="nn">capsul.qt_gui.widgets.settings_editor</span> <span class="kn">import</span> <span class="n">SettingsEditor</span>  <span class="c1"># noqa: E402</span>

<span class="c1"># Mia_processes import</span>
<span class="kn">from</span> <span class="nn">mia_processes.bricks.tools</span> <span class="kn">import</span> <span class="n">Input_Filter</span>  <span class="c1"># noqa: E402</span>

<span class="c1"># Populse_db import</span>
<span class="kn">from</span> <span class="nn">populse_db.database</span> <span class="kn">import</span> <span class="p">(</span>  <span class="c1"># noqa: E402</span>
    <span class="n">FIELD_TYPE_BOOLEAN</span><span class="p">,</span>
    <span class="n">FIELD_TYPE_DATE</span><span class="p">,</span>
    <span class="n">FIELD_TYPE_DATETIME</span><span class="p">,</span>
    <span class="n">FIELD_TYPE_FLOAT</span><span class="p">,</span>
    <span class="n">FIELD_TYPE_INTEGER</span><span class="p">,</span>
    <span class="n">FIELD_TYPE_LIST_BOOLEAN</span><span class="p">,</span>
    <span class="n">FIELD_TYPE_LIST_DATE</span><span class="p">,</span>
    <span class="n">FIELD_TYPE_LIST_DATETIME</span><span class="p">,</span>
    <span class="n">FIELD_TYPE_LIST_FLOAT</span><span class="p">,</span>
    <span class="n">FIELD_TYPE_LIST_INTEGER</span><span class="p">,</span>
    <span class="n">FIELD_TYPE_LIST_STRING</span><span class="p">,</span>
    <span class="n">FIELD_TYPE_LIST_TIME</span><span class="p">,</span>
    <span class="n">FIELD_TYPE_STRING</span><span class="p">,</span>
    <span class="n">FIELD_TYPE_TIME</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># soma import</span>
<span class="kn">from</span> <span class="nn">soma.qt_gui.qt_backend.Qt</span> <span class="kn">import</span> <span class="p">(</span>  <span class="c1"># noqa: E402</span>
    <span class="n">QItemSelectionModel</span><span class="p">,</span>
    <span class="n">QTreeView</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">soma.qt_gui.qt_backend.QtWidgets</span> <span class="kn">import</span> <span class="n">QMenu</span>  <span class="c1"># noqa: E402</span>

<span class="c1"># Populse_mia import</span>
<span class="kn">from</span> <span class="nn">populse_mia.data_manager.data_loader</span> <span class="kn">import</span> <span class="p">(</span>  <span class="c1"># noqa: E402</span>
    <span class="n">ImportProgress</span><span class="p">,</span>
    <span class="n">ImportWorker</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">populse_mia.data_manager.project</span> <span class="kn">import</span> <span class="p">(</span>  <span class="c1"># noqa: E402</span>
    <span class="n">COLLECTION_BRICK</span><span class="p">,</span>
    <span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
    <span class="n">COLLECTION_HISTORY</span><span class="p">,</span>
    <span class="n">COLLECTION_INITIAL</span><span class="p">,</span>
    <span class="n">TAG_BRICKS</span><span class="p">,</span>
    <span class="n">TAG_CHECKSUM</span><span class="p">,</span>
    <span class="n">TAG_EXP_TYPE</span><span class="p">,</span>
    <span class="n">TAG_FILENAME</span><span class="p">,</span>
    <span class="n">TAG_HISTORY</span><span class="p">,</span>
    <span class="n">TAG_ORIGIN_USER</span><span class="p">,</span>
    <span class="n">TAG_TYPE</span><span class="p">,</span>
    <span class="n">TYPE_NII</span><span class="p">,</span>
    <span class="n">Project</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">populse_mia.data_manager.project_properties</span> <span class="kn">import</span> <span class="p">(</span>  <span class="c1"># noqa: E402</span>
    <span class="n">SavedProjects</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">populse_mia.software_properties</span> <span class="kn">import</span> <span class="n">Config</span>  <span class="c1"># noqa: E402</span>
<span class="kn">from</span> <span class="nn">populse_mia.user_interface.data_browser.modify_table</span> <span class="kn">import</span> <span class="p">(</span>  <span class="c1"># noqa: E402, E501</span>
    <span class="n">ModifyTable</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">populse_mia.user_interface.main_window</span> <span class="kn">import</span> <span class="n">MainWindow</span>  <span class="c1"># noqa: E402</span>
<span class="kn">from</span> <span class="nn">populse_mia.user_interface.pipeline_manager.pipeline_editor</span> <span class="kn">import</span> <span class="p">(</span>  <span class="c1"># noqa: E402, E501</span>
    <span class="n">PipelineEditor</span><span class="p">,</span>
    <span class="n">save_pipeline</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">populse_mia.user_interface.pipeline_manager.pipeline_manager_tab</span> <span class="kn">import</span> <span class="p">(</span>  <span class="c1"># noqa: E402, E501</span>
    <span class="n">RunProgress</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">populse_mia.user_interface.pipeline_manager.process_library</span> <span class="kn">import</span> <span class="p">(</span>  <span class="c1"># noqa: E402, E501</span>
    <span class="n">PackageLibraryDialog</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">populse_mia.user_interface.pop_ups</span> <span class="kn">import</span> <span class="p">(</span>  <span class="c1"># noqa: E402</span>
    <span class="n">DefaultValueListCreation</span><span class="p">,</span>
    <span class="n">PopUpAddPath</span><span class="p">,</span>
    <span class="n">PopUpAddTag</span><span class="p">,</span>
    <span class="n">PopUpClosePipeline</span><span class="p">,</span>
    <span class="n">PopUpDeletedProject</span><span class="p">,</span>
    <span class="n">PopUpDeleteProject</span><span class="p">,</span>
    <span class="n">PopUpInheritanceDict</span><span class="p">,</span>
    <span class="n">PopUpNewProject</span><span class="p">,</span>
    <span class="n">PopUpOpenProject</span><span class="p">,</span>
    <span class="n">PopUpQuit</span><span class="p">,</span>
    <span class="n">PopUpRemoveScan</span><span class="p">,</span>
    <span class="n">PopUpSeeAllProjects</span><span class="p">,</span>
    <span class="n">PopUpSelectTag</span><span class="p">,</span>
    <span class="n">PopUpSelectTagCountTable</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">populse_mia.utils</span> <span class="kn">import</span> <span class="p">(</span>  <span class="c1"># noqa: E402</span>
    <span class="n">check_value_type</span><span class="p">,</span>
    <span class="n">table_to_database</span><span class="p">,</span>
    <span class="n">verify_processes</span><span class="p">,</span>
    <span class="n">verify_setup</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Working from the scripts directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span>

<span class="c1"># Disables any etelemetry check.</span>
<span class="k">if</span> <span class="s2">&quot;NO_ET&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;NO_ET&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>

<span class="k">if</span> <span class="s2">&quot;NIPYPE_NO_ET&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;NIPYPE_NO_ET&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>


<div class="viewcode-block" id="TestMIACase">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIACase">[docs]</a>
<span class="k">class</span> <span class="nc">TestMIACase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parent class for the test classes of mia.</span>

<span class="sd">    :Contains:</span>
<span class="sd">        :Method:</span>
<span class="sd">            - add_visualized_tag: selects a tag to display with the</span>
<span class="sd">              &quot;Visualized tags&quot; pop-up</span>
<span class="sd">            - clean_uts_packages: deleting the package added during the UTs or</span>
<span class="sd">              old one still existing</span>
<span class="sd">            - create_mock_jar: creates a mocked java (.jar) executable</span>
<span class="sd">            - edit_databrowser_list: change value for a tag in DataBrowser</span>
<span class="sd">            - execute_QDialogAccept: accept (close) a QDialog instance</span>
<span class="sd">            - execute_QDialogClose: closes a QDialog instance</span>
<span class="sd">            - execute_QMessageBox_clickClose: press the Close button of</span>
<span class="sd">              a QMessageBox instance</span>
<span class="sd">            - execute_QMessageBox_clickOk: press the Ok button of a</span>
<span class="sd">              QMessageBox instance</span>
<span class="sd">            - execute_QMessageBox_clickYes: press the Yes button of a</span>
<span class="sd">              QMessageBox instance</span>
<span class="sd">            - find_item_by_data: looks for a QModelIndex whose contents</span>
<span class="sd">              correspond to the argument data</span>
<span class="sd">            - get_new_test_project: create a temporary project that can</span>
<span class="sd">              be safely modified</span>
<span class="sd">            - proclibview_nipype_state: give the state of nipype in the process</span>
<span class="sd">            - proclibview_nipype_reset_state: reset nipype to its initial state</span>
<span class="sd">              (before the start of the current test) in the process library</span>
<span class="sd">              view</span>
<span class="sd">            - restart_MIA: restarts MIA within a unit test</span>
<span class="sd">            - setUp: called automatically before each test method</span>
<span class="sd">            - setUpClass: called before tests in the individual class</span>
<span class="sd">            - tearDown: cleans up after each test method</span>
<span class="sd">            - tearDownClass: called after tests in the individual class</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestMIACase.add_visualized_tag">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIACase.add_visualized_tag">[docs]</a>
    <span class="k">def</span> <span class="nf">add_visualized_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;With the &quot;Visualized tags&quot; pop-up open, selects a tag to display.</span>

<span class="sd">        - Should be called, with a delay, before opening the &quot;Visualized tags&quot;</span>
<span class="sd">          pop-up, i.e.:</span>
<span class="sd">              QTimer.singleShot(1000, lambda:self.add_visualized_tag(</span>
<span class="sd">              &#39;AcquisitionDate&#39;))</span>
<span class="sd">          It&#39;s currently not the case</span>
<span class="sd">          (see TestMIANodeController.test_filter_widget()).</span>

<span class="sd">        :param tag: the tag to be displayed (str)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">activeWindow</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">QDialog</span><span class="p">):</span>
            <span class="n">visualized_tags</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span>
            <span class="n">tags_list</span> <span class="o">=</span> <span class="n">visualized_tags</span><span class="o">.</span><span class="n">list_widget_tags</span>

            <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">QT_VERSION_STR</span><span class="p">)</span> <span class="o">==</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;5.9.2&quot;</span><span class="p">):</span>
                <span class="n">found_item</span> <span class="o">=</span> <span class="n">tags_list</span><span class="o">.</span><span class="n">findItems</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">MatchExactly</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">found_item</span> <span class="o">=</span> <span class="n">tags_list</span><span class="o">.</span><span class="n">findItems</span><span class="p">(</span>
                    <span class="n">tag</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">MatchFlag</span><span class="o">.</span><span class="n">MatchExactly</span>
                <span class="p">)</span>

            <span class="n">tags_list</span><span class="o">.</span><span class="n">setCurrentItem</span><span class="p">(</span><span class="n">found_item</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">visualized_tags</span><span class="o">.</span><span class="n">click_select_tag</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIACase.clean_uts_packages">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIACase.clean_uts_packages">[docs]</a>
    <span class="k">def</span> <span class="nf">clean_uts_packages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proc_lib_view</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deleting the packages added during the UTs.&quot;&quot;&quot;</span>

        <span class="n">pck2remove</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">k</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">proc_lib_view</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;UTs_processes&quot;</span> <span class="ow">in</span> <span class="n">k</span>
        <span class="p">]</span>
        <span class="n">user_proc</span> <span class="o">=</span> <span class="n">proc_lib_view</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;User_processes&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">user_proc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;Unit_test_pipeline&quot;</span> <span class="ow">in</span> <span class="n">user_proc</span><span class="p">:</span>
            <span class="n">pck2remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Unit_test_pipeline&quot;</span><span class="p">)</span>

        <span class="c1"># Mocks the MessageBox().question() for populse_mia.user_interface.</span>
        <span class="c1"># pipeline_manager.process_library.PackageLibraryDialog.delete_package()</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">)</span>

        <span class="c1"># Mocks the event.key</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
        <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key_Delete</span>

        <span class="c1"># Remove</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">pck2remove</span><span class="p">:</span>
            <span class="n">pkg_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_item_by_data</span><span class="p">(</span><span class="n">proc_lib_view</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="p">(</span>
                <span class="n">proc_lib_view</span><span class="o">.</span><span class="n">selectionModel</span><span class="p">()</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                    <span class="n">pkg_index</span><span class="p">,</span> <span class="n">QItemSelectionModel</span><span class="o">.</span><span class="n">SelectCurrent</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">proc_lib_view</span><span class="o">.</span><span class="n">keyPressEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIACase.create_mock_jar">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIACase.create_mock_jar">[docs]</a>
    <span class="k">def</span> <span class="nf">create_mock_jar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a mocked java (.jar) executable.</span>

<span class="sd">        :param path: the full path of the executable, ending by &#39;.jar&#39;</span>

<span class="sd">        :returns: 0 if success or 1 if failure</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="n">CONTENT</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;public class MockApp {</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;    public static void main(String[] args){</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="s1">&#39;        System.out.println(&quot;Executed mock java app.&quot;);</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="o">+</span> <span class="s2">&quot;    }</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Creates the .java source code</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="s2">&quot;MockApp.java&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">)</span>

        <span class="c1"># Creates the MANIFEST file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="s2">&quot;MANIFEST.MF&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Main-Class:  MockApp</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># The build only works with the &#39;\n&#39; at the end of the manifest</span>

        <span class="c1"># Check if the OpenJDK Runtime (java) is installed</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;java&quot;</span><span class="p">,</span> <span class="s2">&quot;-version&quot;</span><span class="p">])</span>

        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OpenJDK Runtime is not installed&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span>

        <span class="c1"># Compile and pack</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;javac&quot;</span><span class="p">,</span> <span class="s2">&quot;-d&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;MockApp.java&quot;</span><span class="p">],</span> <span class="n">cwd</span><span class="o">=</span><span class="n">folder</span><span class="p">)</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;jar&quot;</span><span class="p">,</span> <span class="s2">&quot;cvmf&quot;</span><span class="p">,</span> <span class="s2">&quot;MANIFEST.MF&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;MockApp.class&quot;</span><span class="p">],</span> <span class="n">cwd</span><span class="o">=</span><span class="n">folder</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The java executable was not created&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="TestMIACase.edit_databrowser_list">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIACase.edit_databrowser_list">[docs]</a>
    <span class="k">def</span> <span class="nf">edit_databrowser_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Change value for a tag in DataBrowser.</span>

<span class="sd">        :param value: the new value</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">activeWindow</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">QDialog</span><span class="p">):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">update_table_values</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIACase.execute_QDialogAccept">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIACase.execute_QDialogAccept">[docs]</a>
    <span class="k">def</span> <span class="nf">execute_QDialogAccept</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Accept (close) a QDialog window.&quot;&quot;&quot;</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">activeWindow</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">QDialog</span><span class="p">):</span>
            <span class="n">w</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span></div>


    <span class="c1"># def execute_QDialogClose(self):</span>
    <span class="c1">#     &quot;&quot;&quot;Close a QDialog window.</span>
    <span class="c1">#</span>
    <span class="c1">#     Currently, this method is not used.</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#     w = QApplication.activeWindow()</span>
    <span class="c1">#</span>
    <span class="c1">#     if isinstance(w, QDialog):</span>
    <span class="c1">#         w.close()</span>

    <span class="c1"># def execute_QMessageBox_clickClose(self):</span>
    <span class="c1">#     &quot;&quot;&quot;Press the Close button of a QMessageBox instance.</span>
    <span class="c1">#</span>
    <span class="c1">#     Currently, this method is not used.</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#     w = QApplication.activeWindow()</span>
    <span class="c1">#</span>
    <span class="c1">#     if isinstance(w, QMessageBox):</span>
    <span class="c1">#         close_button = w.button(QMessageBox.Close)</span>
    <span class="c1">#         QTest.mouseClick(close_button, Qt.LeftButton)</span>

<div class="viewcode-block" id="TestMIACase.execute_QMessageBox_clickOk">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIACase.execute_QMessageBox_clickOk">[docs]</a>
    <span class="k">def</span> <span class="nf">execute_QMessageBox_clickOk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Press the Ok button of a QMessageBox instance.&quot;&quot;&quot;</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">activeWindow</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="p">):</span>
            <span class="n">close_button</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
            <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">close_button</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span></div>


    <span class="c1"># def execute_QMessageBox_clickYes(self):</span>
    <span class="c1">#     &quot;&quot;&quot;Press the Yes button of a QMessageBox instance.</span>
    <span class="c1">#</span>
    <span class="c1">#     Currently, this method is not used.</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#     w = QApplication.activeWindow()</span>
    <span class="c1">#</span>
    <span class="c1">#     if isinstance(w, QMessageBox):</span>
    <span class="c1">#         close_button = w.button(QMessageBox.Yes)</span>
    <span class="c1">#         QTest.mouseClick(close_button, Qt.LeftButton)</span>

<div class="viewcode-block" id="TestMIACase.find_item_by_data">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIACase.find_item_by_data">[docs]</a>
    <span class="k">def</span> <span class="nf">find_item_by_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">q_tree_view</span><span class="p">:</span> <span class="n">QTreeView</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QModelIndex</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Looks for a QModelIndex, in a QTreeView instance.&quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">q_tree_view</span><span class="p">,</span> <span class="n">QTreeView</span>
        <span class="p">),</span> <span class="s2">&quot;first argument is not a QTreeView instance!&quot;</span>
        <span class="n">q_tree_view</span><span class="o">.</span><span class="n">expandAll</span><span class="p">()</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">q_tree_view</span><span class="o">.</span><span class="n">indexAt</span><span class="p">(</span><span class="n">QPoint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="k">while</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">()</span> <span class="ow">and</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">()</span> <span class="o">!=</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">q_tree_view</span><span class="o">.</span><span class="n">indexBelow</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">index</span></div>


<div class="viewcode-block" id="TestMIACase.get_new_test_project">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIACase.get_new_test_project">[docs]</a>
    <span class="k">def</span> <span class="nf">get_new_test_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;test_project&quot;</span><span class="p">,</span> <span class="n">light</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Copies a test project where it can be safely modified.</span>

<span class="sd">        - The new project is created in the /tmp (/Temp) folder.</span>

<span class="sd">        :param name: name of the directory containing the project (str)</span>
<span class="sd">        :param light: True to copy a project with few documents (bool)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">new_test_proj</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">new_test_proj</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">new_test_proj</span><span class="p">)</span>

        <span class="n">test_proj</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))),</span>
            <span class="s2">&quot;miautdata&quot;</span><span class="p">,</span>
            <span class="s2">&quot;resources&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mia&quot;</span><span class="p">,</span>
            <span class="s2">&quot;light_test_project&quot;</span> <span class="k">if</span> <span class="n">light</span> <span class="k">else</span> <span class="s2">&quot;project_8&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">test_proj</span><span class="p">,</span> <span class="n">new_test_proj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_test_proj</span></div>


<div class="viewcode-block" id="TestMIACase.proclibview_nipype_state">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIACase.proclibview_nipype_state">[docs]</a>
    <span class="k">def</span> <span class="nf">proclibview_nipype_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proc_lib_view</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Give the state of nipype proc_lib_view.</span>

<span class="sd">        :param proc_lib_view: the process library view object</span>

<span class="sd">        :returns: the state of nipype proc_lib_view:</span>
<span class="sd">                  - None: proc_lib_view is empty or nipype is not loaded.</span>
<span class="sd">                  - &#39;nipype&#39;: &#39;nipype&#39; is loaded but &#39;interfaces&#39; not.</span>
<span class="sd">                  - &#39;nipype.interface&#39;: &#39;nipype.interface&#39; is loaded but</span>
<span class="sd">                                        &#39;DataGrabber&#39; not.</span>
<span class="sd">                  - &#39;process_enabled&#39;: &#39;nipype.interface.DataGrabber&#39; is</span>
<span class="sd">                                       loaded.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">proc_lib_view</span><span class="o">.</span><span class="n">to_dict</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">proc_lib_view</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nipype&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">proc_lib_view</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nipype&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;interfaces&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">proc_lib_view</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
                        <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nipype&quot;</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;interfaces&quot;</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DataGrabber&quot;</span><span class="p">)</span>
                    <span class="p">):</span>
                        <span class="n">state</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">proc_lib_view</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
                            <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nipype&quot;</span><span class="p">)</span>
                            <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;interfaces&quot;</span><span class="p">)</span>
                            <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DataGrabber&quot;</span><span class="p">)</span>
                        <span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;nipype.interfaces&quot;</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;nipype&quot;</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">state</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">state</span></div>


<div class="viewcode-block" id="TestMIACase.proclibview_nipype_reset_state">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIACase.proclibview_nipype_reset_state">[docs]</a>
    <span class="k">def</span> <span class="nf">proclibview_nipype_reset_state</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">main_window</span><span class="p">,</span> <span class="n">ppl_manager</span><span class="p">,</span> <span class="n">init_state</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset the process library view to its initial state.</span>

<span class="sd">        :param main_window: the main window object</span>
<span class="sd">        :param ppl_manager: the pipeline manager object</span>
<span class="sd">        :param init_state: the initial state of nipype proc_lib_view:</span>
<span class="sd">                           - None: proc_lib_view is empty or nipype is not</span>
<span class="sd">                                   loaded.</span>
<span class="sd">                           - &#39;nipype&#39;: &#39;nipype&#39; is loaded but &#39;interfaces&#39; not.</span>
<span class="sd">                           - &#39;nipype.interface&#39;: &#39;nipype.interface&#39; is loaded</span>
<span class="sd">                                                 but &#39;DataGrabber&#39; not.</span>
<span class="sd">                           - &#39;process_enabled&#39;: &#39;nipype.interface.DataGrabber&#39;</span>
<span class="sd">                                                is loaded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">main_window</span><span class="o">.</span><span class="n">package_library_pop_up</span><span class="p">()</span>
        <span class="n">pkg_lib_window</span> <span class="o">=</span> <span class="n">main_window</span><span class="o">.</span><span class="n">pop_up_package_library</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">processLibrary</span><span class="o">.</span><span class="n">process_library</span><span class="o">.</span><span class="n">pkg_library</span><span class="o">.</span><span class="n">is_path</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">init_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;nipype&quot;</span><span class="p">)</span>
            <span class="c1"># Clicks on remove package</span>
            <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span>
                <span class="mi">3</span>
            <span class="p">]</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">init_state</span> <span class="o">==</span> <span class="s2">&quot;nipype&quot;</span><span class="p">:</span>
            <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;nipype.interfaces&quot;</span><span class="p">)</span>
            <span class="c1"># Clicks on remove package</span>
            <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span>
                <span class="mi">3</span>
            <span class="p">]</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">init_state</span> <span class="o">==</span> <span class="s2">&quot;nipype.interfaces&quot;</span><span class="p">:</span>
            <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;nipype.interfaces.DataGrabber&quot;</span><span class="p">)</span>
            <span class="c1"># Clicks on remove package</span>
            <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span>
                <span class="mi">3</span>
            <span class="p">]</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;nipype.interfaces.DataGrabber&quot;</span><span class="p">)</span>
            <span class="c1"># Clicks on add package</span>
            <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span>
                <span class="mi">3</span>
            <span class="p">]</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIACase.restart_MIA">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIACase.restart_MIA">[docs]</a>
    <span class="k">def</span> <span class="nf">restart_MIA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Restarts MIA within a unit test.</span>

<span class="sd">        - Can be used to restart MIA after changing the controller version in</span>
<span class="sd">          Mia preferences.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Removing the opened projects (in CI, the tests are run twice)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_opened_projects</span><span class="p">([])</span>
        <span class="n">config</span><span class="o">.</span><span class="n">saveConfig</span><span class="p">()</span>
        <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_user_mode</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span> <span class="o">=</span> <span class="n">MainWindow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIACase.setUp">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIACase.setUp">[docs]</a>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called before each test&quot;&quot;&quot;</span>

        <span class="c1"># All the tests are run in admin mode</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_user_mode</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span> <span class="o">=</span> <span class="n">MainWindow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIACase.setUpClass">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIACase.setUpClass">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called once at the beginning of the class&quot;&quot;&quot;</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">properties_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;mia_tests&quot;</span><span class="p">),</span> <span class="s2">&quot;dev&quot;</span>
        <span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">project_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;mia_project&quot;</span><span class="p">),</span> <span class="s2">&quot;project&quot;</span>
        <span class="p">)</span>
        <span class="c1"># hack the Config class to get properties path, because some Config</span>
        <span class="c1"># instances are created out of our control in the code</span>
        <span class="n">Config</span><span class="o">.</span><span class="n">properties_path</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">properties_path</span>

        <span class="c1"># properties folder management / initialisation:</span>
        <span class="n">properties_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">properties_path</span><span class="p">,</span> <span class="s2">&quot;properties&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">properties_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">properties_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">properties_dir</span><span class="p">,</span> <span class="s2">&quot;saved_projects.yml&quot;</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">properties_dir</span><span class="p">,</span> <span class="s2">&quot;saved_projects.yml&quot;</span><span class="p">),</span>
                <span class="s2">&quot;w&quot;</span><span class="p">,</span>
                <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">,</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">configfile</span><span class="p">:</span>
                <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
                    <span class="p">{</span><span class="s2">&quot;paths&quot;</span><span class="p">:</span> <span class="p">[]},</span>
                    <span class="n">configfile</span><span class="p">,</span>
                    <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">properties_dir</span><span class="p">,</span> <span class="s2">&quot;config.yml&quot;</span><span class="p">)):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">properties_dir</span><span class="p">,</span> <span class="s2">&quot;config.yml&quot;</span><span class="p">),</span>
                <span class="s2">&quot;w&quot;</span><span class="p">,</span>
                <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">,</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">configfile</span><span class="p">:</span>
                <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
                    <span class="s2">&quot;gAAAAABd79UO5tVZSRNqnM5zzbl0KDd7Y98KCSKCNizp9aDq&quot;</span>
                    <span class="s2">&quot;ADs9dAQHJFbmOEX2QL_jJUHOTBfFFqa3OdfwpNLbvWNU_rR0&quot;</span>
                    <span class="s2">&quot;VuT1ZdlmTYv4wwRjhlyPiir7afubLrLK4Jfk84OoOeVtR0a5&quot;</span>
                    <span class="s2">&quot;a0k0WqPlZl-y8_Wu4osHeQCfeWFKW5EWYF776rWgJZsjn3fx&quot;</span>
                    <span class="s2">&quot;Z-V2g5aHo-Q5aqYi2V1Kc-kQ9ZwjFBFbXNa1g9nHKZeyd3ve&quot;</span>
                    <span class="s2">&quot;6p3RUSELfUmEhS0eOWn8i-7GW1UGa4zEKCsoY6T19vrimiuR&quot;</span>
                    <span class="s2">&quot;Vy-DTmmgzbbjGkgmNxB5MvEzs0BF2bAcina_lKR-yeICuIqp&quot;</span>
                    <span class="s2">&quot;TSOBfgkTDcB0LVPBoQmogUVVTeCrjYH9_llFTJQ3ZtKZLdeS&quot;</span>
                    <span class="s2">&quot;tFR5Y2I2ZkQETi6m-0wmUDKf-KRzmk6sLRK_oz6GmuTAN8A5&quot;</span>
                    <span class="s2">&quot;1au2v1M=&quot;</span><span class="p">,</span>
                    <span class="n">configfile</span><span class="p">,</span>
                    <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># processes/User_processes folder management / initialisation:</span>
            <span class="n">user_processes_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">properties_path</span><span class="p">,</span> <span class="s2">&quot;processes&quot;</span><span class="p">,</span> <span class="s2">&quot;User_processes&quot;</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">user_processes_dir</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">user_processes_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">user_processes_dir</span><span class="p">,</span> <span class="s2">&quot;__init__.py&quot;</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">Path</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="n">user_processes_dir</span><span class="p">,</span>
                        <span class="s2">&quot;__init__.py&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span><span class="o">.</span><span class="n">touch</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIACase.tearDown">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIACase.tearDown">[docs]</a>
    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called after each test&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c1"># Removing the opened projects (in CI, the tests are run twice)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_opened_projects</span><span class="p">([])</span>
        <span class="n">config</span><span class="o">.</span><span class="n">saveConfig</span><span class="p">()</span>
        <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span></div>


<div class="viewcode-block" id="TestMIACase.tearDownClass">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIACase.tearDownClass">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">tearDownClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called once at the end of the class&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">properties_path</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">project_path</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestMIADataBrowser">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser">[docs]</a>
<span class="k">class</span> <span class="nc">TestMIADataBrowser</span><span class="p">(</span><span class="n">TestMIACase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests for the data browser tab (DataBrowser).</span>

<span class="sd">    :Contains:</span>
<span class="sd">        :Method:</span>
<span class="sd">            - test_add_path: tests the popup to add a path</span>
<span class="sd">            - test_add_tag: tests the pop up adding a tag</span>
<span class="sd">            - test_advanced_search: tests the advanced search widget</span>
<span class="sd">            - test_brick_history: tests the brick history popup</span>
<span class="sd">            - test_clear_cell: tests the method clearing cells</span>
<span class="sd">            - test_clone_tag: tests the pop up cloning a tag</span>
<span class="sd">            - test_count_table: tests the count table popup</span>
<span class="sd">            - test_mia_preferences: tests the Mia preferences popup</span>
<span class="sd">            - test_mini_viewer: selects scans and display them in the mini</span>
<span class="sd">              viewer</span>
<span class="sd">            - test_modify_table: tests the modify table module</span>
<span class="sd">            - test_multiple_sort: tests the multiple sort popup</span>
<span class="sd">            - test_multiple_sort_appendix: adds and removes tags in the data</span>
<span class="sd">              browser</span>
<span class="sd">            - test_openTagsPopUp: opens a pop-up to select the legend of the</span>
<span class="sd">              thumbnails</span>
<span class="sd">            - test_open_project: tests project opening</span>
<span class="sd">            - test_project_filter: tests project filter opening</span>
<span class="sd">            - test_project_properties: tests saved projects addition and</span>
<span class="sd">              removal</span>
<span class="sd">            - test_proj_remov_from_cur_proj: tests that the projects are</span>
<span class="sd">              removed from the list of current projects</span>
<span class="sd">            - test_rapid_search: tests the rapid search bar</span>
<span class="sd">            - test_remove_scan: tests scans removal in the DataBrowser</span>
<span class="sd">            - test_remove_tag: tests the popup removing user tags</span>
<span class="sd">            - test_reset_cell: tests the method resetting the selected</span>
<span class="sd">              cells</span>
<span class="sd">            - test_reset_column: tests the method resetting the columns</span>
<span class="sd">              selected</span>
<span class="sd">            - test_reset_row: test row reset</span>
<span class="sd">            - test_save_project: test opening &amp; saving of a project</span>
<span class="sd">            - test_send_doc_to_pipeline_manager: tests the popup sending</span>
<span class="sd">              documents to the pipeline manager</span>
<span class="sd">            - test_set_value: tests the values modifications</span>
<span class="sd">            - test_show_brick_history: opens the history pop-up for</span>
<span class="sd">              scans with history related to a brick</span>
<span class="sd">            - test_sort: tests the sorting in the DataBrowser</span>
<span class="sd">            - test_table_data_add_columns: adds tag columns to the table data</span>
<span class="sd">              window</span>
<span class="sd">            - test_table_data_appendix: opens a project and tests miscellaneous</span>
<span class="sd">              methods of the table data view, in the data browser</span>
<span class="sd">            - test_table_data_context_menu: right clicks a scan to show the</span>
<span class="sd">              context menu table, and choses one option</span>
<span class="sd">            - test_undo_redo_databrowser: tests data browser undo/redo</span>
<span class="sd">            - test_unnamed_proj_soft_open: tests unnamed project</span>
<span class="sd">              creation at software opening</span>
<span class="sd">            - test_update_data_history: updates the history of data that</span>
<span class="sd">              have been re-written</span>
<span class="sd">            - test_update_default_value: updates the values when a list</span>
<span class="sd">              of default values is created</span>
<span class="sd">            - test_utils: test the utils functions</span>
<span class="sd">            - test_visualized_tags: tests the popup modifying the</span>
<span class="sd">              visualized tags</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestMIADataBrowser.test_add_path">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_add_path">[docs]</a>
    <span class="k">def</span> <span class="nf">test_add_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tries import a document to the project.</span>

<span class="sd">        - Tests: DataBrowser.add_path and PopUpAddPath</span>

<span class="sd">        - Mocks: the execution of QFileDialog and QMessageBox</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Sets shortcuts for often used objects</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span>
        <span class="n">table_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span>

        <span class="c1"># Creates a new project folder and adds one document to the</span>
        <span class="c1"># project, sets the plug value that is added to the database</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span> <span class="o">=</span> <span class="n">project_8_path</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;raw_data&quot;</span><span class="p">)</span>
        <span class="n">NII_FILE_1</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Guerbet-C6-2014-Rat-K52-Tube27-2014-02-14102317-04-G3_&quot;</span>
            <span class="s2">&quot;Guerbet_MDEFT-MDEFTpvm-000940_800.nii&quot;</span>
        <span class="p">)</span>
        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">NII_FILE_1</span><span class="p">))</span>

        <span class="c1"># Mocks the execution of a message box</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">show</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>

        <span class="c1"># Opens the &#39;add_path&#39; pop-up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">add_path</span><span class="p">()</span>
        <span class="n">add_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">pop_up_add_path</span>

        <span class="c1"># Tries to add a document without filling the pop-up fields</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">add_path</span><span class="o">.</span><span class="n">ok_button</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">add_path</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;Invalid arguments&quot;</span><span class="p">)</span>

        <span class="c1"># Tries to add invalid document path</span>
        <span class="n">add_path</span><span class="o">.</span><span class="n">file_line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">([</span><span class="n">DOCUMENT_1</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="p">]))</span>
        <span class="n">add_path</span><span class="o">.</span><span class="n">type_line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">([</span><span class="n">TYPE_NII</span><span class="p">]))</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">add_path</span><span class="o">.</span><span class="n">ok_button</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">add_path</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;Invalid arguments&quot;</span><span class="p">)</span>

        <span class="c1"># Adds a valid document path</span>
        <span class="n">add_path</span><span class="o">.</span><span class="n">file_line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">([</span><span class="n">DOCUMENT_1</span><span class="p">]))</span>
        <span class="n">add_path</span><span class="o">.</span><span class="n">type_line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">([</span><span class="n">TYPE_NII</span><span class="p">]))</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">add_path</span><span class="o">.</span><span class="n">ok_button</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>

        <span class="c1"># Asserts that the document was added into the data browser</span>
        <span class="c1"># A regular &#39;.split(&#39;/&#39;)&#39; will not work in Windows OS</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
            <span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">filename</span> <span class="ow">in</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Mocks the execution of file dialog box and finds the file type</span>
        <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;nii&quot;</span><span class="p">,</span> <span class="s2">&quot;mat&quot;</span><span class="p">,</span> <span class="s2">&quot;txt&quot;</span><span class="p">]:</span>
            <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileNames</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span>
                <span class="n">return_value</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;file.&quot;</span> <span class="o">+</span> <span class="n">ext</span><span class="p">],</span> <span class="s2">&quot;All Files (*)&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">add_path</span><span class="o">.</span><span class="n">file_to_choose</span><span class="p">()</span>

        <span class="c1"># Adds a document into the database and tries to save the same</span>
        <span class="c1"># one once again</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_document</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="n">add_path</span><span class="o">.</span><span class="n">file_line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">([</span><span class="n">DOCUMENT_1</span><span class="p">]))</span>
        <span class="n">add_path</span><span class="o">.</span><span class="n">save_path</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_add_tag">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_add_tag">[docs]</a>
    <span class="k">def</span> <span class="nf">test_add_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests the pop-up adding a tag.&quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="c1"># Mocks the execution of a dialog box and clicking close</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">self_</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">self_</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Testing without tag name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">add_tag_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">add_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">pop_up_add_tag</span>
        <span class="c1"># QTimer.singleShot(1000, self.execute_QMessageBox_clickClose)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">add_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">add_tag</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;The tag name cannot be empty&quot;</span><span class="p">)</span>

        <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>

        <span class="c1"># Testing with tag name already existing</span>
        <span class="n">add_tag</span><span class="o">.</span><span class="n">text_edit_tag_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Type&quot;</span><span class="p">)</span>
        <span class="c1"># QTimer.singleShot(1000, self.execute_QMessageBox_clickClose)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">add_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">add_tag</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;This tag name already exists&quot;</span><span class="p">)</span>

        <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>

        <span class="c1"># Testing with wrong type</span>
        <span class="n">add_tag</span><span class="o">.</span><span class="n">text_edit_tag_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="n">add_tag</span><span class="o">.</span><span class="n">combo_box_type</span><span class="o">.</span><span class="n">setCurrentText</span><span class="p">(</span><span class="n">FIELD_TYPE_INTEGER</span><span class="p">)</span>
        <span class="n">add_tag</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">FIELD_TYPE_INTEGER</span>
        <span class="n">add_tag</span><span class="o">.</span><span class="n">text_edit_default_value</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Should be integer&quot;</span><span class="p">)</span>
        <span class="c1"># QTimer.singleShot(1000, self.execute_QMessageBox_clickClose)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">add_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">add_tag</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;Invalid default value&quot;</span><span class="p">)</span>

        <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>

        <span class="c1"># Testing when everything is ok</span>
        <span class="n">add_tag</span><span class="o">.</span><span class="n">text_edit_tag_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="n">add_tag</span><span class="o">.</span><span class="n">text_edit_default_value</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;def_value&quot;</span><span class="p">)</span>
        <span class="n">add_tag</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">FIELD_TYPE_STRING</span>

        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>

        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">add_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;Test&quot;</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;Test&quot;</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                <span class="n">COLLECTION_INITIAL</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                    <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="s2">&quot;Test&quot;</span>
                <span class="p">),</span>
                <span class="s2">&quot;def_value&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
            <span class="n">COLLECTION_INITIAL</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                    <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="s2">&quot;Test&quot;</span>
                <span class="p">),</span>
                <span class="s2">&quot;def_value&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">test_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span><span class="p">(</span>
            <span class="s2">&quot;Test&quot;</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
                <span class="n">row</span><span class="p">,</span> <span class="n">test_column</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;def_value&quot;</span><span class="p">)</span>

        <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>

        <span class="c1"># Testing with list type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">add_tag_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">add_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">pop_up_add_tag</span>
        <span class="n">add_tag</span><span class="o">.</span><span class="n">text_edit_tag_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Test_list&quot;</span><span class="p">)</span>

        <span class="n">combo_box_types</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;String&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Integer&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Float&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Boolean&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Date&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Datetime&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Time&quot;</span><span class="p">,</span>
            <span class="s2">&quot;String List&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Integer List&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Float List&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Boolean List&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Date List&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Datetime List&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Time List&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">data_type</span> <span class="ow">in</span> <span class="n">combo_box_types</span><span class="p">:</span>
            <span class="n">add_tag</span><span class="o">.</span><span class="n">combo_box_type</span><span class="o">.</span><span class="n">setCurrentText</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span>

        <span class="n">add_tag</span><span class="o">.</span><span class="n">combo_box_type</span><span class="o">.</span><span class="n">setCurrentText</span><span class="p">(</span><span class="s2">&quot;Integer List&quot;</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">add_tag</span><span class="o">.</span><span class="n">text_edit_default_value</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span>
            <span class="n">add_tag</span><span class="o">.</span><span class="n">text_edit_default_value</span><span class="o">.</span><span class="n">list_creation</span><span class="o">.</span><span class="n">add_element_label</span><span class="p">,</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">add_tag</span><span class="o">.</span><span class="n">text_edit_default_value</span><span class="o">.</span><span class="n">list_creation</span><span class="o">.</span><span class="n">table</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">QTableWidgetItem</span><span class="p">()</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">QTableWidgetItem</span><span class="p">()</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">QTableWidgetItem</span><span class="p">()</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>

        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span>
            <span class="n">add_tag</span><span class="o">.</span><span class="n">text_edit_default_value</span><span class="o">.</span><span class="n">list_creation</span><span class="o">.</span><span class="n">ok_button</span><span class="p">,</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">add_tag</span><span class="o">.</span><span class="n">text_edit_default_value</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;[1, 2, 3]&quot;</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">add_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>

        <span class="n">test_list_column</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span><span class="p">(</span>
                <span class="s2">&quot;Test_list&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
                <span class="n">row</span><span class="p">,</span> <span class="n">test_list_column</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;[1, 2, 3]&quot;</span><span class="p">)</span>

        <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_advanced_search">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_advanced_search">[docs]</a>
    <span class="k">def</span> <span class="nf">test_advanced_search</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests the advanced search widget.&quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="n">scans_displayed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">scans_displayed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scans_displayed</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
            <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-04-G3_Guerbet_MDEFT-MDEFT&quot;</span>
            <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-05-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-06-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-08-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-09-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-10-G3_Guerbet_MDEFT-MDEFT&quot;</span>
            <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-11-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/derived_data/sGuerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
            <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>

        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">advanced_search_button</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span>
        <span class="p">)</span>

        <span class="c1"># Testing - and + buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">first_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">first_row</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">second_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">second_row</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">first_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">first_row</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">field_filename_index</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="n">TAG_FILENAME</span><span class="p">)</span>
        <span class="n">field</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">field_filename_index</span><span class="p">)</span>
        <span class="n">condition_contains_index</span> <span class="o">=</span> <span class="n">condition</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="s2">&quot;CONTAINS&quot;</span><span class="p">)</span>
        <span class="n">condition</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">condition_contains_index</span><span class="p">)</span>
        <span class="n">value</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;G1&quot;</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">search</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span>
        <span class="p">)</span>

        <span class="c1"># Testing that only G1 scans are displayed with the filter applied</span>
        <span class="n">scans_displayed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">scans_displayed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scans_displayed</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
            <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/derived_data/sGuerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
            <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>

        <span class="c1"># Testing that every scan is back when clicking again on</span>
        <span class="c1"># advanced search</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">advanced_search_button</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span>
        <span class="p">)</span>
        <span class="n">scans_displayed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">scans_displayed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scans_displayed</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
            <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-04-G3_Guerbet_MDEFT-MDEFT&quot;</span>
            <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-05-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-06-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-08-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-09-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-10-G3_Guerbet_MDEFT-MDEFT&quot;</span>
            <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-11-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/derived_data/sGuerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
            <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_brick_history">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_brick_history">[docs]</a>
    <span class="k">def</span> <span class="nf">test_brick_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests the brick history popup.&quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="n">bricks_column</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span>
        <span class="p">)(</span><span class="s2">&quot;History&quot;</span><span class="p">)</span>
        <span class="n">bricks_widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">bricks_column</span>
        <span class="p">)</span>
        <span class="n">smooth_button</span> <span class="o">=</span> <span class="n">bricks_widget</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">smooth_button</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;smooth_1&quot;</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">smooth_button</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">brick_history</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">brick_history_popup</span>
        <span class="p">)</span>
        <span class="n">brick_table</span> <span class="o">=</span> <span class="n">brick_history</span><span class="o">.</span><span class="n">table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">brick_table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;Name&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">brick_table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;Init&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">brick_table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;Init Time&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">brick_table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;Exec&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">brick_table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;Exec Time&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">brick_table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;data_type&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">brick_table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;fwhm&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">brick_table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;implicit_masking&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">brick_table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;in_files&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">brick_table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;matlab_cmd&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">brick_table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;mfile&quot;</span><span class="p">)</span>
        <span class="c1"># self.assertEqual(brick_table.item(0, 0).text(), &quot;smooth_1&quot;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">brick_table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;smooth_1&quot;</span>
        <span class="p">)</span>
        <span class="c1"># self.assertEqual(brick_table.item(0, 1).text(), &quot;Done&quot;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">brick_table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;Done&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">brick_table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
            <span class="s2">&quot;2022-04-05 14:22:30.298043&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">brick_table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;Done&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">brick_table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
            <span class="s2">&quot;2022-04-05 14:22:30.298043&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">brick_table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;0&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">brick_table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
            <span class="s2">&quot;[6.0, 6.0, 6.0]&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">brick_table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;False&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">brick_table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
            <span class="s2">&quot;pvm-000220_000.nii&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">brick_table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
            <span class="s2">&quot;/usr/local/SPM/spm12_standalone/run_spm12.sh &quot;</span>
            <span class="s2">&quot;/usr/local/MATLAB/MATLAB_Runtime/v95 script&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">brick_table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;True&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_clear_cell">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_clear_cell">[docs]</a>
    <span class="k">def</span> <span class="nf">test_clear_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests the method clearing cells.&quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="c1"># Selecting a cell</span>
        <span class="n">bw_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span><span class="p">(</span>
            <span class="s2">&quot;BandWidth&quot;</span>
        <span class="p">)</span>
        <span class="n">bw_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bw_column</span><span class="p">)</span>
        <span class="n">bw_item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bw_item</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="mf">50000.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                <span class="s2">&quot;data/derived_data/sGuerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                <span class="s2">&quot;pvm-000220_000.nii&quot;</span><span class="p">,</span>
                <span class="s2">&quot;BandWidth&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="p">[</span><span class="mf">50000.0</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># Clearing the cell</span>
        <span class="n">bw_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bw_column</span><span class="p">)</span>
        <span class="n">bw_item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">clear_cell</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">change_cell_color</span>
        <span class="p">)</span>

        <span class="c1"># Checking that it&#39;s empty</span>
        <span class="n">bw_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bw_column</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">bw_item</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;*Not Defined*&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                <span class="s2">&quot;data/derived_data/sGuerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                <span class="s2">&quot;pvm-000220_000.nii&quot;</span><span class="p">,</span>
                <span class="s2">&quot;BandWidth&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_clone_tag">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_clone_tag">[docs]</a>
    <span class="k">def</span> <span class="nf">test_clone_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests the pop up cloning a tag.&quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="c1"># Testing without new tag name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">clone_tag_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">clone_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">pop_up_clone_tag</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">clone_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">clone_tag</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;The tag name can&#39;t be empty&quot;</span><span class="p">)</span>

        <span class="c1"># Testing without any tag selected to clone</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">clone_tag_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">clone_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">pop_up_clone_tag</span>
        <span class="n">clone_tag</span><span class="o">.</span><span class="n">line_edit_new_tag_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">clone_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">clone_tag</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;The tag to clone must be selected&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Testing with tag name already existing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">clone_tag_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">clone_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">pop_up_clone_tag</span>
        <span class="n">clone_tag</span><span class="o">.</span><span class="n">line_edit_new_tag_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Type&quot;</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">clone_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">clone_tag</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;This tag name already exists&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">clone_tag_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">clone_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">pop_up_clone_tag</span>
        <span class="n">clone_tag</span><span class="o">.</span><span class="n">line_edit_new_tag_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="n">clone_tag</span><span class="o">.</span><span class="n">search_bar</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
        <span class="n">clone_tag</span><span class="o">.</span><span class="n">list_widget_tags</span><span class="o">.</span><span class="n">setCurrentRow</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># BandWidth tag selected</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">clone_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;Test&quot;</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;Test&quot;</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                <span class="n">COLLECTION_INITIAL</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">test_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="s2">&quot;Test&quot;</span>
        <span class="p">)</span>
        <span class="n">bandwidth_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="s2">&quot;BandWidth&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_row</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">bandwidth_row</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_row</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">bandwidth_row</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_row</span><span class="o">.</span><span class="n">default_value</span><span class="p">,</span> <span class="n">bandwidth_row</span><span class="o">.</span><span class="n">default_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_row</span><span class="o">.</span><span class="n">field_type</span><span class="p">,</span> <span class="n">bandwidth_row</span><span class="o">.</span><span class="n">field_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_row</span><span class="o">.</span><span class="n">origin</span><span class="p">,</span> <span class="n">TAG_ORIGIN_USER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_row</span><span class="o">.</span><span class="n">visibility</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">test_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span>
            <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="s2">&quot;Test&quot;</span>
        <span class="p">)</span>
        <span class="n">bandwidth_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span>
            <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="s2">&quot;BandWidth&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_row</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">bandwidth_row</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_row</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">bandwidth_row</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_row</span><span class="o">.</span><span class="n">default_value</span><span class="p">,</span> <span class="n">bandwidth_row</span><span class="o">.</span><span class="n">default_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_row</span><span class="o">.</span><span class="n">field_type</span><span class="p">,</span> <span class="n">bandwidth_row</span><span class="o">.</span><span class="n">field_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_row</span><span class="o">.</span><span class="n">origin</span><span class="p">,</span> <span class="n">TAG_ORIGIN_USER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_row</span><span class="o">.</span><span class="n">visibility</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                    <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="s2">&quot;Test&quot;</span>
                <span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                    <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="s2">&quot;BandWidth&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
            <span class="n">COLLECTION_INITIAL</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                    <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="s2">&quot;Test&quot;</span>
                <span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                    <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="s2">&quot;BandWidth&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>

        <span class="n">test_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span><span class="p">(</span>
            <span class="s2">&quot;Test&quot;</span>
        <span class="p">)</span>
        <span class="n">bw_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span><span class="p">(</span>
            <span class="s2">&quot;BandWidth&quot;</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">item_bw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
                <span class="n">row</span><span class="p">,</span> <span class="n">bw_column</span>
            <span class="p">)</span>
            <span class="n">item_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
                <span class="n">row</span><span class="p">,</span> <span class="n">test_column</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">item_bw</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="n">item_test</span><span class="o">.</span><span class="n">text</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_count_table">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_count_table">[docs]</a>
    <span class="k">def</span> <span class="nf">test_count_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests the count table popup.&quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">count_table_button</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span>
        <span class="p">)</span>
        <span class="n">count_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">count_table_pop_up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">push_buttons</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">count_table</span><span class="o">.</span><span class="n">push_buttons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
        <span class="n">count_table</span><span class="o">.</span><span class="n">fill_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">count_table</span><span class="o">.</span><span class="n">push_buttons</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;EchoTime&quot;</span><span class="p">)</span>
        <span class="n">count_table</span><span class="o">.</span><span class="n">fill_values</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">push_button_count</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>

        <span class="c1"># Trying to add and remove tag buttons</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">add_tag_label</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">push_buttons</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">remove_tag_label</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">push_buttons</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">push_buttons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">push_buttons</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;EchoTime&quot;</span><span class="p">)</span>

        <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;BandWidth&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;75.0&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
            <span class="mf">5.8239923</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;5.0&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">verticalHeaderItem</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;Total&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;50000.0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;25000.0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="mf">65789.48</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;3&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;5&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_table</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;5&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_mia_preferences">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_mia_preferences">[docs]</a>
    <span class="k">def</span> <span class="nf">test_mia_preferences</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests the MIA preferences popup.&quot;&quot;&quot;</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">old_auto_save</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">isAutoSave</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">old_auto_save</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Auto save activated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">action_software_preferences</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pop_up_preferences</span>
        <span class="n">properties</span><span class="o">.</span><span class="n">projects_save_path_line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
            <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;projects_tests&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">properties</span><span class="o">.</span><span class="n">tab_widget</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">properties</span><span class="o">.</span><span class="n">save_checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">properties</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execute_QMessageBox_clickOk</span><span class="p">()</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">new_auto_save</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">isAutoSave</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_auto_save</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Auto save disabled again</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">action_software_preferences</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pop_up_preferences</span>
        <span class="n">properties</span><span class="o">.</span><span class="n">tab_widget</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">properties</span><span class="o">.</span><span class="n">save_checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">properties</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execute_QMessageBox_clickOk</span><span class="p">()</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">reput_auto_save</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">isAutoSave</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reput_auto_save</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Checking that the changes are not effective if cancel is clicked</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">action_software_preferences</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pop_up_preferences</span>
        <span class="n">properties</span><span class="o">.</span><span class="n">tab_widget</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">properties</span><span class="o">.</span><span class="n">save_checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">properties</span><span class="o">.</span><span class="n">push_button_cancel</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execute_QMessageBox_clickOk</span><span class="p">()</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="c1"># clear config -&gt; user_mode become True !</span>
        <span class="n">config</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">auto_save</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">isAutoSave</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">auto_save</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Checking that the values for the &quot;Projects preferences&quot; are well set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_max_projects</span><span class="p">(),</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_max_projects</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_max_projects</span><span class="p">(),</span> <span class="mi">7</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_max_projects</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span> <span class="s2">&quot;properties&quot;</span><span class="p">,</span> <span class="s2">&quot;config.yml&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config_path</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_user_mode</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_user_mode</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_user_mode</span><span class="p">(),</span> <span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mri_conv_path</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_matlab_command</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_matlab_path</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_matlab_standalone_path</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_spm_path</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_spm_standalone_path</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_use_matlab</span><span class="p">(),</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_use_spm</span><span class="p">(),</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_use_spm_standalone</span><span class="p">(),</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">getBackgroundColor</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">getChainCursors</span><span class="p">(),</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">getNbAllSlicesMax</span><span class="p">(),</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">getShowAllSlices</span><span class="p">(),</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">getTextColor</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">getThumbnailTag</span><span class="p">(),</span> <span class="s2">&quot;SequenceName&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="kc">False</span><span class="p">,</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;9.1&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="kc">True</span><span class="p">,</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;9.1&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_projects_save_path</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_mini_viewer">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_mini_viewer">[docs]</a>
    <span class="k">def</span> <span class="nf">test_mini_viewer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Selects scans and display them in the mini viewer.</span>

<span class="sd">        - Tests MiniViewer.</span>
<span class="sd">        - The mini viewer displays information of the selected scan in a</span>
<span class="sd">          box under the scans list, in the data browser tab.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Creates a new project folder and switches to it</span>
        <span class="n">new_proj_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">(</span><span class="n">light</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">new_proj_path</span><span class="p">,</span> <span class="s2">&quot;test_light_project&quot;</span><span class="p">)</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">data_browser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span>
        <span class="n">viewer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">viewer</span>

        <span class="c1"># Selects the first scan</span>
        <span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Gets the 3D slider range</span>
        <span class="n">slider_3D_range</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">slider_3D</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">maximum</span><span class="p">()</span>

        <span class="c1"># Moves the 3D slide to the middle of the range</span>
        <span class="n">viewer</span><span class="o">.</span><span class="n">slider_3D</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">slider_3D_range</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>

        <span class="c1"># Shows all slices</span>
        <span class="n">viewer</span><span class="o">.</span><span class="n">check_box_slices</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>

        <span class="c1"># Unchecks show all slices</span>
        <span class="n">viewer</span><span class="o">.</span><span class="n">check_box_slices</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>

        <span class="c1"># Checks the chain cursors</span>
        <span class="n">viewer</span><span class="o">.</span><span class="n">check_box_cursors</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>

        <span class="c1"># Selects the second scan</span>
        <span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Moves the 3D slides to the lower limit</span>
        <span class="n">viewer</span><span class="o">.</span><span class="n">slider_3D</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Moves the 3D slides to the middle of the range</span>
        <span class="n">viewer</span><span class="o">.</span><span class="n">slider_3D</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">slider_3D_range</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>

        <span class="c1"># Moves the 3D slides to the middle of the range</span>
        <span class="n">viewer</span><span class="o">.</span><span class="n">slider_3D</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_3D_range</span><span class="p">)</span>

        <span class="c1"># Unchecks the chain cursors</span>
        <span class="n">viewer</span><span class="o">.</span><span class="n">check_box_cursors</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>

        <span class="n">viewer</span><span class="o">.</span><span class="n">update_nb_slices</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_modify_table">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_modify_table">[docs]</a>
    <span class="k">def</span> <span class="nf">test_modify_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test the modify_table module.&quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>
        <span class="n">scans_displayed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1"># Test values of a list of floats</span>
        <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]</span>
        <span class="n">tag_name</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;FOV&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">scans_displayed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_name</span><span class="p">)</span>

        <span class="c1"># Test that the value will not change if the tag&#39;s type is incorrect</span>
        <span class="n">old_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scans_displayed</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;FOV&quot;</span>
        <span class="p">)</span>

        <span class="n">mod</span> <span class="o">=</span> <span class="n">ModifyTable</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="p">,</span>
            <span class="n">value</span><span class="p">,</span>
            <span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)],</span>
            <span class="n">scans_displayed</span><span class="p">,</span>
            <span class="n">tag_name</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">mod</span><span class="o">.</span><span class="n">update_table_values</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">mod</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
        <span class="k">del</span> <span class="n">mod</span>
        <span class="n">new_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scans_displayed</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;FOV&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">old_value</span><span class="p">,</span> <span class="n">new_value</span><span class="p">)</span>

        <span class="c1"># Test that the value will change when all parameters are correct</span>
        <span class="n">tag_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="s2">&quot;FOV&quot;</span>
        <span class="p">)</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="n">ModifyTable</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="p">,</span>
            <span class="n">value</span><span class="p">,</span>
            <span class="p">[</span><span class="n">tag_object</span><span class="o">.</span><span class="n">field_type</span><span class="p">],</span>
            <span class="n">scans_displayed</span><span class="p">,</span>
            <span class="n">tag_name</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">mod</span><span class="o">.</span><span class="n">update_table_values</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">new_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scans_displayed</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;FOV&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">columnCount</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">mod</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
        <span class="k">del</span> <span class="n">mod</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">new_value</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_multiple_sort">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_multiple_sort">[docs]</a>
    <span class="k">def</span> <span class="nf">test_multiple_sort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests the multiple sort popup.&quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">multiple_sort_pop_up</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">change_cell_color</span>
        <span class="p">)</span>
        <span class="n">multiple_sort</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">pop_up</span>

        <span class="n">multiple_sort</span><span class="o">.</span><span class="n">push_buttons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
        <span class="n">multiple_sort</span><span class="o">.</span><span class="n">fill_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">multiple_sort</span><span class="o">.</span><span class="n">push_buttons</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Exp Type&quot;</span><span class="p">)</span>
        <span class="n">multiple_sort</span><span class="o">.</span><span class="n">fill_values</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">multiple_sort</span><span class="o">.</span><span class="n">push_button_sort</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>

        <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27-2014&quot;</span>
            <span class="s2">&quot;-02-14102317-10-G3_Guerbet_MDEFT-MDEFTpvm-000940&quot;</span>
            <span class="s2">&quot;_800.nii&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27-2014&quot;</span>
            <span class="s2">&quot;-02-14102317-04-G3_Guerbet_MDEFT-MDEFTpvm-000940&quot;</span>
            <span class="s2">&quot;_800.nii&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RAREpvm&quot;</span>
            <span class="s2">&quot;-000220_000.nii&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="s2">&quot;data/derived_data/sGuerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RAREpvm&quot;</span>
            <span class="s2">&quot;-000220_000.nii&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-11-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
            <span class="s2">&quot;-000142_400.nii&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-09-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
            <span class="s2">&quot;-000142_400.nii&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-08-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
            <span class="s2">&quot;-000142_400.nii&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-06-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
            <span class="s2">&quot;-000142_400.nii&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-05-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
            <span class="s2">&quot;-000142_400.nii&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_multiple_sort_appendix">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_multiple_sort_appendix">[docs]</a>
    <span class="k">def</span> <span class="nf">test_multiple_sort_appendix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds and removes tags in the data browser.</span>

<span class="sd">        - Tests: PopUpMultipleSort</span>

<span class="sd">        - Mocks: PopUpSelectTagCountTable.exec_</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">table_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span>

        <span class="n">table_data</span><span class="o">.</span><span class="n">multiple_sort_pop_up</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">table_data</span><span class="p">,</span> <span class="s2">&quot;pop_up&quot;</span><span class="p">))</span>

        <span class="c1"># Adds a 3rd tag to the pop-up</span>
        <span class="n">table_data</span><span class="o">.</span><span class="n">pop_up</span><span class="o">.</span><span class="n">add_tag_label</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table_data</span><span class="o">.</span><span class="n">pop_up</span><span class="o">.</span><span class="n">push_buttons</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>

        <span class="c1"># Removes the tag</span>
        <span class="n">table_data</span><span class="o">.</span><span class="n">pop_up</span><span class="o">.</span><span class="n">remove_tag_label</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table_data</span><span class="o">.</span><span class="n">pop_up</span><span class="o">.</span><span class="n">push_buttons</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Mocks the execution of &#39;PopUpSelectTagCountTable&#39;</span>
        <span class="k">def</span> <span class="nf">mock_select_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;blabla&quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected_tag</span> <span class="o">=</span> <span class="s2">&quot;Exp Type&quot;</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="n">PopUpSelectTagCountTable</span><span class="o">.</span><span class="n">exec_</span> <span class="o">=</span> <span class="n">mock_select_tags</span>

        <span class="n">table_data</span><span class="o">.</span><span class="n">pop_up</span><span class="o">.</span><span class="n">select_tag</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Adds a tag in place of &#39;Tag n1&#39;</span>
        <span class="n">table_data</span><span class="o">.</span><span class="n">pop_up</span><span class="o">.</span><span class="n">select_tag</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Closes the pop-up</span>
        <span class="n">table_data</span><span class="o">.</span><span class="n">pop_up</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_openTagsPopUp">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_openTagsPopUp">[docs]</a>
    <span class="k">def</span> <span class="nf">test_openTagsPopUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Opens a document in data viewer and opens a pop-up to select the</span>
<span class="sd">        legend of the thumbnails.</span>

<span class="sd">        - Tests MiniViewer.openTagsPopUp.</span>
<span class="sd">        - Indirectly tests PopUpSelectTag.</span>
<span class="sd">        - Mocks: PopUpSelectTag.exec_</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">data_browser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span>
        <span class="n">viewer</span> <span class="o">=</span> <span class="n">data_browser</span><span class="o">.</span><span class="n">viewer</span>

        <span class="c1"># Gets a document filepath</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))),</span>
            <span class="s2">&quot;miautdata&quot;</span><span class="p">,</span>
            <span class="s2">&quot;resources&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mia&quot;</span><span class="p">,</span>
            <span class="s2">&quot;project_8&quot;</span><span class="p">,</span>
            <span class="s2">&quot;data&quot;</span><span class="p">,</span>
            <span class="s2">&quot;raw_data&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">NII_FILE_1</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Guerbet-C6-2014-Rat-K52-Tube27-2014-02-14102317-04-G3_&quot;</span>
            <span class="s2">&quot;Guerbet_MDEFT-MDEFTpvm-000940_800.nii&quot;</span>
        <span class="p">)</span>
        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">NII_FILE_1</span><span class="p">))</span>

        <span class="c1"># Adds the document to the data browser</span>
        <span class="n">addPath</span> <span class="o">=</span> <span class="n">PopUpAddPath</span><span class="p">(</span><span class="n">data_browser</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">data_browser</span><span class="p">)</span>
        <span class="n">addPath</span><span class="o">.</span><span class="n">file_line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">([</span><span class="n">DOCUMENT_1</span><span class="p">]))</span>
        <span class="n">addPath</span><span class="o">.</span><span class="n">save_path</span><span class="p">()</span>

        <span class="c1"># Selects the document in the data browser</span>
        <span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Mocks the execution of the dialog window</span>
        <span class="n">PopUpSelectTag</span><span class="o">.</span><span class="n">exec_</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Opens the tags pop-up and cancel it</span>
        <span class="n">viewer</span><span class="o">.</span><span class="n">openTagsPopUp</span><span class="p">()</span>
        <span class="n">viewer</span><span class="o">.</span><span class="n">popUp</span><span class="o">.</span><span class="n">cancel_clicked</span><span class="p">()</span>

        <span class="c1"># Opens the tags pop-up</span>
        <span class="n">viewer</span><span class="o">.</span><span class="n">openTagsPopUp</span><span class="p">()</span>

        <span class="c1"># Searches for an empty string</span>
        <span class="n">viewer</span><span class="o">.</span><span class="n">popUp</span><span class="o">.</span><span class="n">search_str</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Asserts that both the first and second tags are not hidden</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">viewer</span><span class="o">.</span><span class="n">popUp</span><span class="o">.</span><span class="n">list_widget_tags</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">isHidden</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">viewer</span><span class="o">.</span><span class="n">popUp</span><span class="o">.</span><span class="n">list_widget_tags</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">isHidden</span><span class="p">())</span>

        <span class="c1"># Searches for the tag &#39;Exp Type&#39;</span>
        <span class="n">data_browser</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">popUp</span><span class="o">.</span><span class="n">search_str</span><span class="p">(</span><span class="s2">&quot;Exp Type&quot;</span><span class="p">)</span>

        <span class="c1"># Asserts that the second tag is hidden, the first is not</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">viewer</span><span class="o">.</span><span class="n">popUp</span><span class="o">.</span><span class="n">list_widget_tags</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">isHidden</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">viewer</span><span class="o">.</span><span class="n">popUp</span><span class="o">.</span><span class="n">list_widget_tags</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">isHidden</span><span class="p">())</span>

        <span class="c1"># Selects one tab</span>
        <span class="n">item_0</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">popUp</span><span class="o">.</span><span class="n">list_widget_tags</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">viewer</span><span class="o">.</span><span class="n">popUp</span><span class="o">.</span><span class="n">list_widget_tags</span><span class="o">.</span><span class="n">itemClicked</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">item_0</span><span class="p">)</span>

        <span class="n">viewer</span><span class="o">.</span><span class="n">popUp</span><span class="o">.</span><span class="n">list_widget_tags</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>
        <span class="n">viewer</span><span class="o">.</span><span class="n">popUp</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_open_project">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_open_project">[docs]</a>
    <span class="k">def</span> <span class="nf">test_open_project</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests project opening.&quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;project_8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">windowTitle</span><span class="p">(),</span>
            <span class="s2">&quot;MIA - Multiparametric Image Analysis (Admin mode) - project_8&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
            <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-04-G3_Guerbet_MDEFT-MDEFT&quot;</span>
            <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-05-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-06-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-08-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-09-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-10-G3_Guerbet_MDEFT-MDEFT&quot;</span>
            <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-11-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/derived_data/sGuerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
            <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span>
        <span class="p">)</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
            <span class="n">COLLECTION_INITIAL</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
            <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-04-G3_Guerbet_MDEFT-MDEFT&quot;</span>
            <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-05-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-06-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-08-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-09-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-10-G3_Guerbet_MDEFT-MDEFT&quot;</span>
            <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-11-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/derived_data/sGuerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
            <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">documents</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_project_filter">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_project_filter">[docs]</a>
    <span class="k">def</span> <span class="nf">test_project_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a project, saves a filter and opens it.</span>

<span class="sd">        - Tests:</span>
<span class="sd">            - DataBrowser.open_popup</span>
<span class="sd">            - Project.save_current_filter</span>

<span class="sd">        - Mocks:</span>
<span class="sd">           - QMessageBox.exec</span>
<span class="sd">           - QInputDialog.getText</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">test_project_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">(</span><span class="n">light</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">test_project_path</span><span class="p">,</span> <span class="s2">&quot;test_project&quot;</span><span class="p">)</span>

        <span class="c1"># Mocks the execution of a dialog box</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">arg</span><span class="p">:</span> <span class="kc">None</span>

        <span class="c1"># Saves the current filter as &#39;filter_1&#39;</span>
        <span class="n">QInputDialog</span><span class="o">.</span><span class="n">getText</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">argv</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;filter_1&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">save_filter_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>

        <span class="c1"># Tries to save it again by the same name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">save_filter_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>

        <span class="c1"># Opens the saved filters pop-up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">open_filter_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">open_popup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">popUp</span>

        <span class="c1"># Closes the pop-up and re-opens it</span>
        <span class="n">open_popup</span><span class="o">.</span><span class="n">cancel_clicked</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">open_filter_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>

        <span class="c1"># Tries to search for an empty string</span>
        <span class="n">open_popup</span><span class="o">.</span><span class="n">search_str</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">open_popup</span><span class="o">.</span><span class="n">list_widget_filters</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">isHidden</span><span class="p">())</span>

        <span class="c1"># Tries to search for a non-existent filter</span>
        <span class="n">open_popup</span><span class="o">.</span><span class="n">search_str</span><span class="p">(</span><span class="s2">&quot;filter_2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">open_popup</span><span class="o">.</span><span class="n">list_widget_filters</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">isHidden</span><span class="p">())</span>

        <span class="c1"># Tries to search for an existing filter</span>
        <span class="n">open_popup</span><span class="o">.</span><span class="n">search_str</span><span class="p">(</span><span class="s2">&quot;filter_1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">open_popup</span><span class="o">.</span><span class="n">list_widget_filters</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">isHidden</span><span class="p">())</span>

        <span class="n">open_popup</span><span class="o">.</span><span class="n">list_widget_filters</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># QTest.mouseClick(open_popup.push_button_ok, Qt.LeftButton)</span>
        <span class="n">open_popup</span><span class="o">.</span><span class="n">push_button_ok</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

        <span class="n">scans_displayed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">scans_displayed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scans_displayed</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_project_properties">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_project_properties">[docs]</a>
    <span class="k">def</span> <span class="nf">test_project_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests saved projects addition and removal.&quot;&quot;&quot;</span>

        <span class="n">saved_projects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">saved_projects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">saved_projects</span><span class="o">.</span><span class="n">pathsList</span><span class="p">,</span> <span class="p">[])</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>

        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span>
                <span class="s2">&quot;properties&quot;</span><span class="p">,</span>
                <span class="s2">&quot;saved_projects.yml&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">saved_projects</span> <span class="o">=</span> <span class="n">SavedProjects</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">saved_projects</span><span class="o">.</span><span class="n">pathsList</span><span class="p">,</span> <span class="p">[])</span>

        <span class="n">saved_projects</span><span class="o">.</span><span class="n">addSavedProject</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">saved_projects</span><span class="o">.</span><span class="n">pathsList</span><span class="p">,</span> <span class="p">[</span><span class="n">project_8_path</span><span class="p">])</span>

        <span class="n">saved_projects</span><span class="o">.</span><span class="n">addSavedProject</span><span class="p">(</span><span class="s2">&quot;/home&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">saved_projects</span><span class="o">.</span><span class="n">pathsList</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;/home&quot;</span><span class="p">,</span> <span class="n">project_8_path</span><span class="p">])</span>

        <span class="n">saved_projects</span><span class="o">.</span><span class="n">addSavedProject</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">saved_projects</span><span class="o">.</span><span class="n">pathsList</span><span class="p">,</span> <span class="p">[</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;/home&quot;</span><span class="p">])</span>

        <span class="n">saved_projects</span><span class="o">.</span><span class="n">removeSavedProject</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">)</span>
        <span class="n">saved_projects</span><span class="o">.</span><span class="n">removeSavedProject</span><span class="p">(</span><span class="s2">&quot;/home&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">saved_projects</span><span class="o">.</span><span class="n">pathsList</span><span class="p">,</span> <span class="p">[])</span>

        <span class="n">SavedProjects</span><span class="o">.</span><span class="n">loadSavedProjects</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="kc">True</span>
        <span class="n">saved_projects</span> <span class="o">=</span> <span class="n">SavedProjects</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">saved_projects</span><span class="o">.</span><span class="n">pathsList</span><span class="p">,</span> <span class="p">[])</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_proj_remov_from_cur_proj">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_proj_remov_from_cur_proj">[docs]</a>
    <span class="k">def</span> <span class="nf">test_proj_remov_from_cur_proj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests that the projects are removed from the list of current</span>
<span class="sd">        projects.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">projects</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_opened_projects</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">projects</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span> <span class="ow">in</span> <span class="n">projects</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_rapid_search">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_rapid_search">[docs]</a>
    <span class="k">def</span> <span class="nf">test_rapid_search</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests the rapid search bar.&quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="c1"># Checking that the 9 scans are shown in the DataBrowser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">(),</span> <span class="mi">9</span>
        <span class="p">)</span>
        <span class="n">scans_displayed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">scans_displayed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scans_displayed</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
            <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-04-G3_Guerbet_MDEFT-MDEFT&quot;</span>
            <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-05-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-06-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-08-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-09-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-10-G3_Guerbet_MDEFT-MDEFT&quot;</span>
            <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-11-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/derived_data/sGuerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
            <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>

        <span class="c1"># Testing G1 rapid search</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">search_bar</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;G1&quot;</span><span class="p">)</span>
        <span class="n">scans_displayed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">scans_displayed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scans_displayed</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
            <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/derived_data/sGuerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
            <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>

        <span class="c1"># Testing that all the scans are back when clicking on the cross</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">button_cross</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span>
        <span class="p">)</span>
        <span class="n">scans_displayed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">scans_displayed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scans_displayed</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RAREpvm&quot;</span>
            <span class="s2">&quot;-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-04-G3_Guerbet_MDEFT-MDEFT&quot;</span>
            <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-05-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-06-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-08-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-09-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-10-G3_Guerbet_MDEFT-MDEFTpvm&quot;</span>
            <span class="s2">&quot;-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-11-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
            <span class="s2">&quot;-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/derived_data/sGuerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RAREpvm&quot;</span>
            <span class="s2">&quot;-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans_displayed</span>
        <span class="p">)</span>

        <span class="c1"># Testing not defined values</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">button_cross</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">search_bar</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;*Not Defined*&quot;</span><span class="p">)</span>
        <span class="n">scans_displayed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">scans_displayed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">scans_displayed</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                <span class="s2">&quot;-2014-02-14102317-11-G4_Guerbet_T1SE_800-RARE&quot;</span>
                <span class="s2">&quot;pvm-000142_400.nii&quot;</span>
            <span class="p">],</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_remove_scan">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_remove_scan">[docs]</a>
    <span class="k">def</span> <span class="nf">test_remove_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new project, adds scans to the session and remove them.</span>

<span class="sd">        - Tests:</span>
<span class="sd">            - PipelineManagerTab.remove_scan</span>
<span class="sd">            - PopUpRemoveScan</span>

<span class="sd">        - Mocks:</span>
<span class="sd">            - PopUpRemoveScan.exec</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">data_browser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span>
        <span class="n">tb_data</span> <span class="o">=</span> <span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span>
        <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span>

        <span class="c1"># Creates a new project folder</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span> <span class="o">=</span> <span class="n">project_8_path</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;raw_data&quot;</span><span class="p">)</span>

        <span class="n">NII_FILE_1</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Guerbet-C6-2014-Rat-K52-Tube27-2014-02-14102317-04-G3_&quot;</span>
            <span class="s2">&quot;Guerbet_MDEFT-MDEFTpvm-000940_800.nii&quot;</span>
        <span class="p">)</span>
        <span class="n">NII_FILE_2</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Guerbet-C6-2014-Rat-K52-Tube27-2014-02-14102317-05-G4_&quot;</span>
            <span class="s2">&quot;Guerbet_T1SE_800-RAREpvm-000142_400.nii&quot;</span>
        <span class="p">)</span>
        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">NII_FILE_1</span><span class="p">))</span>
        <span class="n">DOCUMENT_2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">NII_FILE_2</span><span class="p">))</span>

        <span class="c1"># Adds 2 scans to the current session</span>
        <span class="n">session</span><span class="o">.</span><span class="n">add_document</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">add_document</span><span class="p">(</span><span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">add_document</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">DOCUMENT_2</span><span class="p">)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">add_document</span><span class="p">(</span><span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">DOCUMENT_2</span><span class="p">)</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">scan_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">scan_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DOCUMENT_2</span><span class="p">)</span>
        <span class="n">data_browser</span><span class="o">.</span><span class="n">data_sent</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Refreshes the data browser tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">update_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">)</span>

        <span class="c1"># Selects all scans</span>
        <span class="n">tb_data</span><span class="o">.</span><span class="n">selectColumn</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Cancels removing both scans</span>
        <span class="n">PopUpRemoveScan</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tb_data</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">cancel_clicked</span><span class="p">()</span>
        <span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">remove_scan</span><span class="p">()</span>

        <span class="c1"># Rejects removing both scans</span>
        <span class="n">PopUpRemoveScan</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tb_data</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">no_all_clicked</span><span class="p">()</span>
        <span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">remove_scan</span><span class="p">()</span>

        <span class="c1"># Asserts that the data browser kept both scans</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tb_data</span><span class="o">.</span><span class="n">scans</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Effectively removes both scans</span>
        <span class="n">PopUpRemoveScan</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tb_data</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">yes_all_clicked</span><span class="p">()</span>
        <span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">remove_scan</span><span class="p">()</span>

        <span class="c1"># Asserts that the scans were deleted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tb_data</span><span class="o">.</span><span class="n">scans</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Adds one scan to the current session</span>
        <span class="n">session</span><span class="o">.</span><span class="n">add_document</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">add_document</span><span class="p">(</span><span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">update_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">)</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">scan_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DOCUMENT_1</span><span class="p">)</span>

        <span class="c1"># Selects the scan</span>
        <span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">selectColumn</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Removes the scan</span>
        <span class="n">PopUpRemoveScan</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tb_data</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">yes_clicked</span><span class="p">()</span>
        <span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">remove_scan</span><span class="p">()</span>

        <span class="c1"># Asserts that the scans were deleted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tb_data</span><span class="o">.</span><span class="n">scans</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span></div>


        <span class="c1"># project_8_path = self.get_new_test_project()</span>
        <span class="c1"># self.main_window.switch_project(project_8_path, &quot;project_8&quot;)</span>

    <span class="c1">#</span>

    <span class="c1"># scans_displayed = []</span>
    <span class="c1">#</span>
    <span class="c1"># for row in range(0,</span>
    <span class="c1">#                 self.main_window.data_browser.table_data.rowCount()):</span>
    <span class="c1">#    item = self.main_window.data_browser.table_data.item(row, 0)</span>
    <span class="c1">#    scan_name = item.text()</span>
    <span class="c1">#</span>
    <span class="c1">#    if not self.main_window.data_browser.table_data.isRowHidden(row):</span>
    <span class="c1">#        scans_displayed.append(scan_name)</span>
    <span class="c1">#</span>
    <span class="c1"># self.assertEqual(len(scans_displayed), 9)</span>
    <span class="c1"># self.assertTrue(&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
    <span class="c1">#                &quot;-2014-02-14102317-01-G1_Guerbet_Anat-RAREpvm&quot;</span>
    <span class="c1">#                &quot;-000220_000.nii&quot; in scans_displayed)</span>
    <span class="c1"># self.assertTrue(&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
    <span class="c1">#                &quot;-2014-02-14102317-04-G3_Guerbet_MDEFT-MDEFTpvm&quot;</span>
    <span class="c1">#                &quot;-000940_800.nii&quot; in scans_displayed)</span>
    <span class="c1"># self.assertTrue(&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
    <span class="c1">#                &quot;-2014-02-14102317-05-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
    <span class="c1">#                &quot;-000142_400.nii&quot; in scans_displayed)</span>
    <span class="c1"># self.assertTrue(&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
    <span class="c1">#                &quot;-2014-02-14102317-06-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
    <span class="c1">#                &quot;-000142_400.nii&quot; in scans_displayed)</span>
    <span class="c1"># self.assertTrue(&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
    <span class="c1">#                &quot;-2014-02-14102317-08-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
    <span class="c1">#                &quot;-000142_400.nii&quot; in scans_displayed)</span>
    <span class="c1"># self.assertTrue(&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
    <span class="c1">#                &quot;-2014-02-14102317-09-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
    <span class="c1">#                &quot;-000142_400.nii&quot; in scans_displayed)</span>
    <span class="c1"># self.assertTrue(&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
    <span class="c1">#                &quot;-2014-02-14102317-10-G3_Guerbet_MDEFT-MDEFTpvm&quot;</span>
    <span class="c1">#                &quot;-000940_800.nii&quot; in scans_displayed)</span>
    <span class="c1"># self.assertTrue(&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
    <span class="c1">#                &quot;-2014-02-14102317-11-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
    <span class="c1">#                &quot;-000142_400.nii&quot; in scans_displayed)</span>
    <span class="c1"># self.assertTrue(&quot;data/derived_data/sGuerbet-C6-2014-Rat-K52-Tube27&quot;</span>
    <span class="c1">#                &quot;-2014-02-14102317-01-G1_Guerbet_Anat-RAREpvm&quot;</span>
    <span class="c1">#                &quot;-000220_000.nii&quot; in scans_displayed)</span>
    <span class="c1">#</span>
    <span class="c1"># Trying to remove a scan</span>
    <span class="c1"># self.main_window.data_browser.table_data.selectRow(0)</span>
    <span class="c1"># self.main_window.data_browser.table_data.remove_scan()</span>
    <span class="c1"># scans_displayed = []</span>
    <span class="c1">#</span>
    <span class="c1"># for row in range(0,</span>
    <span class="c1">#                 self.main_window.data_browser.table_data.rowCount()):</span>
    <span class="c1">#    item = self.main_window.data_browser.table_data.item(row, 0)</span>
    <span class="c1">#    scan_name = item.text()</span>
    <span class="c1">#</span>
    <span class="c1">#    if not self.main_window.data_browser.table_data.isRowHidden(row):</span>
    <span class="c1">#        scans_displayed.append(scan_name)</span>
    <span class="c1">#</span>
    <span class="c1"># self.assertEqual(len(scans_displayed), 8)</span>
    <span class="c1"># self.assertTrue(&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
    <span class="c1">#                &quot;-2014-02-14102317-04-G3_Guerbet_MDEFT-MDEFTpvm&quot;</span>
    <span class="c1">#                &quot;-000940_800.nii&quot; in scans_displayed)</span>
    <span class="c1"># self.assertTrue(&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
    <span class="c1">#                &quot;-2014-02-14102317-05-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
    <span class="c1">#                &quot;-000142_400.nii&quot; in scans_displayed)</span>
    <span class="c1"># self.assertTrue(&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
    <span class="c1">#                &quot;-2014-02-14102317-06-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
    <span class="c1">#                &quot;-000142_400.nii&quot; in scans_displayed)</span>
    <span class="c1"># self.assertTrue(&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
    <span class="c1">#                &quot;-2014-02-14102317-08-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
    <span class="c1">#                &quot;-000142_400.nii&quot; in scans_displayed)</span>
    <span class="c1"># self.assertTrue(&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
    <span class="c1">#                &quot;-2014-02-14102317-09-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
    <span class="c1">#                &quot;-000142_400.nii&quot; in scans_displayed)</span>
    <span class="c1"># self.assertTrue(&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
    <span class="c1">#                &quot;-2014-02-14102317-10-G3_Guerbet_MDEFT-MDEFTpvm&quot;</span>
    <span class="c1">#                &quot;-000940_800.nii&quot; in scans_displayed)</span>
    <span class="c1"># self.assertTrue(&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
    <span class="c1">#                &quot;-2014-02-14102317-11-G4_Guerbet_T1SE_800-RAREpvm&quot;</span>
    <span class="c1">#                &quot;-000142_400.nii&quot; in scans_displayed)</span>
    <span class="c1"># self.assertTrue(&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
    <span class="c1">#                &quot;-2014-02-14102317-01-G1_Guerbet_Anat-RAREpvm&quot;</span>
    <span class="c1">#                &quot;-000220_000.nii&quot; in scans_displayed)</span>

<div class="viewcode-block" id="TestMIADataBrowser.test_remove_tag">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_remove_tag">[docs]</a>
    <span class="k">def</span> <span class="nf">test_remove_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests the popup removing user tags.&quot;&quot;&quot;</span>

        <span class="c1"># Adding a tag &quot;Test&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">add_tag_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">add_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">pop_up_add_tag</span>
        <span class="n">add_tag</span><span class="o">.</span><span class="n">text_edit_tag_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">add_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">old_tags_current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span>
        <span class="p">)</span>
        <span class="n">old_tags_initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
            <span class="n">COLLECTION_INITIAL</span>
        <span class="p">)</span>

        <span class="c1"># Open the &quot;Remove a tag&quot; pop-up but do nothing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">remove_tag_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">remove_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">pop_up_remove_tag</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">remove_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">new_tags_current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span>
        <span class="p">)</span>
        <span class="n">new_tags_initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
            <span class="n">COLLECTION_INITIAL</span>
        <span class="p">)</span>

        <span class="c1"># Check that the list of tags has not changed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">old_tags_current</span> <span class="o">==</span> <span class="n">new_tags_current</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">old_tags_initial</span> <span class="o">==</span> <span class="n">new_tags_initial</span><span class="p">)</span>

        <span class="n">old_tags_current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span>
        <span class="p">)</span>
        <span class="n">old_tags_initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
            <span class="n">COLLECTION_INITIAL</span>
        <span class="p">)</span>
        <span class="c1"># Check that &quot;Test&quot; tag is in the list of tags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">in</span> <span class="n">old_tags_current</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">in</span> <span class="n">old_tags_initial</span><span class="p">)</span>

        <span class="c1"># Open the &quot;Remove a tag&quot; pop-up and remove &quot;Test&quot; tag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">remove_tag_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">remove_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">pop_up_remove_tag</span>
        <span class="n">remove_tag</span><span class="o">.</span><span class="n">list_widget_tags</span><span class="o">.</span><span class="n">setCurrentRow</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Test tag selected</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">remove_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">new_tags_current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span>
        <span class="p">)</span>
        <span class="n">new_tags_initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
            <span class="n">COLLECTION_INITIAL</span>
        <span class="p">)</span>
        <span class="c1"># Check that &quot;Test&quot; tag is no longer in the list of tags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_tags_current</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_tags_initial</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_reset_cell">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_reset_cell">[docs]</a>
    <span class="k">def</span> <span class="nf">test_reset_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests the method resetting the selected cells.&quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="c1"># scan name</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1"># Test for a list:</span>
        <span class="c1"># Values in the db</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="s2">&quot;BandWidth&quot;</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="s2">&quot;BandWidth&quot;</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># Value in the DataBrowser</span>
        <span class="n">bandwidth_column</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span>
        <span class="p">)(</span><span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">bandwidth_column</span>
        <span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Check equality between DataBrowser and db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">50000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value_initial</span><span class="p">)</span>

        <span class="c1"># Change the value</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># threading.Timer(</span>
        <span class="c1">#     2, partial(self.edit_databrowser_list, &quot;25000&quot;)</span>
        <span class="c1"># ).start()</span>
        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edit_databrowser_list</span><span class="p">,</span> <span class="s2">&quot;25000&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">edit_table_data_values</span><span class="p">()</span>

        <span class="c1"># Check again the equality between DataBrowser and db</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="s2">&quot;BandWidth&quot;</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="s2">&quot;BandWidth&quot;</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">bandwidth_column</span>
        <span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">25000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value_initial</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">50000</span><span class="p">))</span>

        <span class="c1"># Reset the current value to the initial value</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">bandwidth_column</span>
        <span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">reset_cell</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">change_cell_color</span>
        <span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Check whether the data has been reset</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="s2">&quot;BandWidth&quot;</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="s2">&quot;BandWidth&quot;</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">bandwidth_column</span>
        <span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">50000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value_initial</span><span class="p">)</span>

        <span class="c1"># Test for a string:</span>
        <span class="c1"># Values in the db</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span>
        <span class="p">)</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
            <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Value in the DataBrowser</span>
        <span class="n">type_column</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span>
        <span class="p">)(</span><span class="s2">&quot;Type&quot;</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">type_column</span><span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1"># Check equality between DataBrowser and db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;Scan&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value_initial</span><span class="p">)</span>

        <span class="c1"># Change the value</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Check again the equality between DataBrowser and db</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span>
        <span class="p">)</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
            <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span>
        <span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">type_column</span><span class="p">)</span>

        <span class="n">databrowser</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value_initial</span><span class="p">,</span> <span class="s2">&quot;Scan&quot;</span><span class="p">)</span>

        <span class="c1"># Reset the current value to the initial value</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">type_column</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">reset_cell</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">change_cell_color</span>
        <span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Check whether the data has been reset</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span>
        <span class="p">)</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
            <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span>
        <span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">type_column</span><span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;Scan&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value_initial</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_reset_column">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_reset_column">[docs]</a>
    <span class="k">def</span> <span class="nf">test_reset_column</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests the method resetting the columns selected.&quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="c1"># Second document; scan name</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">scan_name2</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1"># Second document; values in the db</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_name2</span><span class="p">,</span> <span class="s2">&quot;BandWidth&quot;</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">scan_name2</span><span class="p">,</span> <span class="s2">&quot;BandWidth&quot;</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># Second document; value in the DataBrowser</span>
        <span class="n">bandwidth_column</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span>
        <span class="p">)(</span><span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
        <span class="n">item2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="n">bandwidth_column</span>
        <span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item2</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Check equality between DataBrowser and db for second document</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">50000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value_initial</span><span class="p">)</span>
        <span class="n">item2</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Third document; scan name</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">scan_name3</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1"># Third document; values in the db</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_name3</span><span class="p">,</span> <span class="s2">&quot;BandWidth&quot;</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">scan_name3</span><span class="p">,</span> <span class="s2">&quot;BandWidth&quot;</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># Third document; value in the DataBrowser</span>
        <span class="n">item3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
            <span class="mi">2</span><span class="p">,</span> <span class="n">bandwidth_column</span>
        <span class="p">)</span>

        <span class="c1"># Check equality between DataBrowser and db for third document</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item3</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">25000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value_initial</span><span class="p">)</span>
        <span class="n">item3</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Change the value to [70000] for the third and second documents</span>
        <span class="c1"># threading.Timer(</span>
        <span class="c1">#     2, partial(self.edit_databrowser_list, &quot;70000&quot;)</span>
        <span class="c1"># ).start()</span>
        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edit_databrowser_list</span><span class="p">,</span> <span class="s2">&quot;70000&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">edit_table_data_values</span><span class="p">()</span>

        <span class="c1"># Second document; values in the db</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_name2</span><span class="p">,</span> <span class="s2">&quot;BandWidth&quot;</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">scan_name2</span><span class="p">,</span> <span class="s2">&quot;BandWidth&quot;</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="c1"># Second document; value in the DataBrowser</span>
        <span class="n">item2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="n">bandwidth_column</span>
        <span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item2</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Check equality between DataBrowser and db for second document</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">70000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mi">50000</span><span class="p">),</span> <span class="n">value_initial</span><span class="p">)</span>
        <span class="n">item2</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Third document; values in the db</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_name3</span><span class="p">,</span> <span class="s2">&quot;BandWidth&quot;</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">scan_name3</span><span class="p">,</span> <span class="s2">&quot;BandWidth&quot;</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># Third document; value in the DataBrowser</span>
        <span class="n">item3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
            <span class="mi">2</span><span class="p">,</span> <span class="n">bandwidth_column</span>
        <span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item3</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Check value in database for the third document</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">70000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value_initial</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">25000</span><span class="p">))</span>
        <span class="n">item3</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Reset the current value to the initial value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">reset_column</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">change_cell_color</span>
        <span class="p">)</span>

        <span class="c1"># Check the value in the db and DataBrowser for the second document</span>
        <span class="c1"># has been reset</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_name2</span><span class="p">,</span> <span class="s2">&quot;BandWidth&quot;</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">scan_name2</span><span class="p">,</span> <span class="s2">&quot;BandWidth&quot;</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">item2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="n">bandwidth_column</span>
        <span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item2</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">50000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value_initial</span><span class="p">)</span>

        <span class="c1"># Check the value in the db and DataBrowser for the third document</span>
        <span class="c1"># has been reset</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_name3</span><span class="p">,</span> <span class="s2">&quot;BandWidth&quot;</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">scan_name3</span><span class="p">,</span> <span class="s2">&quot;BandWidth&quot;</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">item3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
            <span class="mi">2</span><span class="p">,</span> <span class="n">bandwidth_column</span>
        <span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item3</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">25000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value_initial</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_reset_row">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_reset_row">[docs]</a>
    <span class="k">def</span> <span class="nf">test_reset_row</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests row reset.&quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="c1"># Value in DataBrowser for the second document</span>
        <span class="n">type_column</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span>
        <span class="p">)(</span><span class="s2">&quot;Type&quot;</span><span class="p">)</span>
        <span class="n">type_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="n">type_column</span>
        <span class="p">)</span>
        <span class="n">old_type</span> <span class="o">=</span> <span class="n">type_item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1"># Check value in DataBrowser for the second document</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">old_type</span><span class="p">,</span> <span class="s2">&quot;Scan&quot;</span><span class="p">)</span>

        <span class="c1"># Change the value</span>
        <span class="n">type_item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">type_item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>

        <span class="c1"># Check if value in DataBrowser as been changed</span>
        <span class="n">set_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="n">type_column</span>
        <span class="p">)</span>
        <span class="n">set_type</span> <span class="o">=</span> <span class="n">set_item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">set_type</span><span class="p">,</span> <span class="s2">&quot;Test&quot;</span><span class="p">)</span>

        <span class="c1"># Reset row for second document</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">clearSelection</span><span class="p">()</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">reset_row</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">change_cell_color</span>
        <span class="p">)</span>

        <span class="c1"># Check if value in DataBrowser as been reset</span>
        <span class="n">type_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="n">type_column</span>
        <span class="p">)</span>
        <span class="n">new_type</span> <span class="o">=</span> <span class="n">type_item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_type</span><span class="p">,</span> <span class="s2">&quot;Scan&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_save_project">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_save_project">[docs]</a>
    <span class="k">def</span> <span class="nf">test_save_project</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test opening &amp; saving of a project.&quot;&quot;&quot;</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">projects_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span>
            <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;projects_tests&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Instead of executing the pop-up, only shows it</span>
        <span class="c1"># This prevents thread deadlocking</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">self_</span><span class="p">:</span> <span class="n">self_</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># Tries to open the project pop-up without the projects save dir</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_projects_save_path</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">create_project_pop_up</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>

        <span class="c1"># Tries to save the project &#39;something&#39; without setting the</span>
        <span class="c1"># projects save directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">saveChoice</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>

        <span class="c1"># Sets the project save directory</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_projects_save_path</span><span class="p">(</span><span class="n">projects_dir</span><span class="p">)</span>
        <span class="n">something_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">projects_dir</span><span class="p">,</span> <span class="s2">&quot;something&quot;</span><span class="p">)</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="c1"># Saves the project &#39;something&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">saveChoice</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span> <span class="s2">&quot;something&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">something_path</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Switches to project &#39;project_8&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">saveChoice</span><span class="p">()</span>  <span class="c1"># Updates the project &#39;project_8&#39;</span>

        <span class="c1"># Removes the project &#39;something&#39; file tree</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">something_path</span><span class="p">)</span>

        <span class="n">PopUpNewProject</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">True</span>
        <span class="n">PopUpNewProject</span><span class="o">.</span><span class="n">selectedFiles</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">True</span>
        <span class="n">PopUpNewProject</span><span class="o">.</span><span class="n">get_filename</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="kc">True</span>
        <span class="n">PopUpNewProject</span><span class="o">.</span><span class="n">relative_path</span> <span class="o">=</span> <span class="n">something_path</span>

        <span class="n">PopUpOpenProject</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">True</span>
        <span class="n">PopUpOpenProject</span><span class="o">.</span><span class="n">selectedFiles</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">True</span>
        <span class="n">PopUpOpenProject</span><span class="o">.</span><span class="n">get_filename</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="kc">True</span>
        <span class="n">PopUpOpenProject</span><span class="o">.</span><span class="n">relative_path</span> <span class="o">=</span> <span class="n">something_path</span>
        <span class="n">PopUpOpenProject</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">PopUpOpenProject</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
            <span class="n">something_path</span>
        <span class="p">)</span>
        <span class="c1"># Creates and saves the project &#39;something&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">create_project_pop_up</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span> <span class="s2">&quot;something&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">something_path</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Switches to another project and verifies that project</span>
        <span class="c1"># &#39;something&#39; is shown in the projects pop-up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">open_project_pop_up</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span> <span class="s2">&quot;something&quot;</span><span class="p">)</span>

        <span class="c1"># Removes the project &#39;something&#39; tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">something_path</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_send_doc_to_pipeline_manager">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_send_doc_to_pipeline_manager">[docs]</a>
    <span class="k">def</span> <span class="nf">test_send_doc_to_pipeline_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests the popup sending the documents to the pipeline manager.&quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="c1"># Checking that the pipeline manager has an empty list at the beginning</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">scan_list</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c1"># Sending the selection (all scans), but closing the popup</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">send_documents_to_pipeline_button</span><span class="p">,</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">send_popup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">show_selection</span>

        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>

        <span class="n">send_popup</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Checking that the list is still empty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">scan_list</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c1"># Sending the selection (all scans), but hit the &quot;OK&quot; button</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">send_documents_to_pipeline_button</span><span class="p">,</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">send_popup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">show_selection</span>

        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>

        <span class="n">send_popup</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="c1"># Checking that all scans have been sent to the pipeline manager</span>
        <span class="n">scans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">scan_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scans</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
            <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-04-G3_Guerbet_MDEFT-MDEFT&quot;</span>
            <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-05-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-06-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-08-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-09-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-10-G3_Guerbet_MDEFT-MDEFT&quot;</span>
            <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-11-G4_Guerbet_T1SE_800-RARE&quot;</span>
            <span class="s2">&quot;pvm-000142_400.nii&quot;</span> <span class="ow">in</span> <span class="n">scans</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/derived_data/sGuerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
            <span class="s2">&quot;pvm-000220_000.nii&quot;</span> <span class="ow">in</span> <span class="n">scans</span>
        <span class="p">)</span>

        <span class="c1"># Selecting the first 2 scans</span>
        <span class="n">item1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">item1</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">scan1</span> <span class="o">=</span> <span class="n">item1</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">item2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">item2</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">scan2</span> <span class="o">=</span> <span class="n">item2</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1"># Sending the selection (first 2 scans)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">send_documents_to_pipeline_button</span><span class="p">,</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">send_popup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">show_selection</span>

        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>

        <span class="n">send_popup</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="c1"># Checking that the first 2 scans have been sent to the</span>
        <span class="c1"># pipeline manager</span>
        <span class="n">scans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">scan_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scans</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">scan1</span> <span class="ow">in</span> <span class="n">scans</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">scan2</span> <span class="ow">in</span> <span class="n">scans</span><span class="p">)</span>

        <span class="c1"># Checking with the rapid search</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">clearSelection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">search_bar</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;G3&quot;</span><span class="p">)</span>

        <span class="c1"># Sending the selection (G3 scans)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">send_documents_to_pipeline_button</span><span class="p">,</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">send_popup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">show_selection</span>

        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>

        <span class="n">send_popup</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="c1"># Checking that G3 scans have been sent to the pipeline manager</span>
        <span class="n">scans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">scan_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scans</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-04-G3_Guerbet_MDEFT-MDEFT&quot;</span>
            <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
            <span class="s2">&quot;-2014-02-14102317-10-G3_Guerbet_MDEFT-MDEFT&quot;</span>
            <span class="s2">&quot;pvm-000940_800.nii&quot;</span> <span class="ow">in</span> <span class="n">scans</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_set_value">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_set_value">[docs]</a>
    <span class="k">def</span> <span class="nf">test_set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests the values modifications.</span>

<span class="sd">        This test is redundant with the first part of test_reset_cell.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="c1"># Scan name for the second document</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1"># Test for a list:</span>
        <span class="c1"># Values in the db</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="s2">&quot;BandWidth&quot;</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="s2">&quot;BandWidth&quot;</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># Value in the DataBrowser</span>
        <span class="n">bandwidth_column</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span>
        <span class="p">)(</span><span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="n">bandwidth_column</span>
        <span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">50000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value_initial</span><span class="p">)</span>

        <span class="c1"># Change the value</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># threading.Timer(</span>
        <span class="c1">#     2, partial(self.edit_databrowser_list, &quot;25000&quot;)</span>
        <span class="c1"># ).start()</span>
        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edit_databrowser_list</span><span class="p">,</span> <span class="s2">&quot;25000&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">edit_table_data_values</span><span class="p">()</span>

        <span class="c1"># Check if value was changed in db and DataBrowser</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="s2">&quot;BandWidth&quot;</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="s2">&quot;BandWidth&quot;</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="n">bandwidth_column</span>
        <span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">25000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value_initial</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mi">50000</span><span class="p">))</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Test for a string:</span>
        <span class="c1"># Values in the db</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span>
        <span class="p">)</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
            <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Value in the DataBrowser</span>
        <span class="n">type_column</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span>
        <span class="p">)(</span><span class="s2">&quot;Type&quot;</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">type_column</span><span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1"># Check equality between DataBrowser and db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;Scan&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value_initial</span><span class="p">)</span>

        <span class="c1"># Change the value</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Check if value in DataBrowser and db as been changed</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span>
        <span class="p">)</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
            <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span>
        <span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">type_column</span><span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">databrowser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value_initial</span><span class="p">,</span> <span class="s2">&quot;Scan&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_show_brick_history">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_show_brick_history">[docs]</a>
    <span class="k">def</span> <span class="nf">test_show_brick_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Opens the history pop-up for scans with history related to</span>
<span class="sd">        standard bricks and bricks contained by a sub-pipeline.</span>

<span class="sd">        - Tests</span>
<span class="sd">            - TableDataBrowser.show_brick_history</span>
<span class="sd">            - PopUpShowHistory</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Creates a new project folder and switches to it</span>
        <span class="n">new_project_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">(</span><span class="n">light</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">new_project_path</span><span class="p">,</span> <span class="s2">&quot;light_test_project&quot;</span><span class="p">)</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">data_browser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span>
        <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span>

        <span class="c1"># Gets the input file path of the input scan</span>
        <span class="n">INPUT_SCAN</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get_documents</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;FileName&quot;</span><span class="p">]</span>

        <span class="c1"># Opens the history pop-up for the scan related to &#39;smooth_1&#39;</span>
        <span class="n">hist_index</span> <span class="o">=</span> <span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span><span class="p">(</span><span class="s2">&quot;History&quot;</span><span class="p">)</span>
        <span class="n">hist_button</span> <span class="o">=</span> <span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">hist_index</span>
        <span class="p">)</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">hist_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>  <span class="c1"># Opens the history window</span>

        <span class="c1"># Asserts that a history pop-up was created</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="nb">hasattr</span><span class="p">(</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="p">,</span> <span class="s2">&quot;brick_history_popup&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Clicks on the input button displayed on the history pop-up.</span>
        <span class="c1"># This shows the corresponding scan in the data browser</span>
        <span class="n">input_button</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">brick_history_popup</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span>
            <span class="p">)</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">input_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>  <span class="c1"># Clicks on the input button</span>

        <span class="c1"># Asserts that &#39;INPUT_SCAN&#39; history pop-up was created</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="n">INPUT_SCAN</span>
        <span class="p">)</span>

        <span class="c1"># Opens the history pop-up for the scan related to &#39;quad_smooth_1&#39;</span>
        <span class="n">hist_button</span> <span class="o">=</span> <span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="n">hist_index</span>
        <span class="p">)</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">hist_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>  <span class="c1"># Opens the history window</span>
        <span class="n">hist_button</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_sort">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_sort">[docs]</a>
    <span class="k">def</span> <span class="nf">test_sort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests the sorting in the DataBrowser.&quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="n">mixed_bandwidths</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">bandwidth_column</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span>
            <span class="p">)(</span><span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
                <span class="n">row</span><span class="p">,</span> <span class="n">bandwidth_column</span>
            <span class="p">)</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">mixed_bandwidths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_name</span><span class="p">)</span>

        <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">horizontalHeader</span>
        <span class="p">)()</span><span class="o">.</span><span class="n">setSortIndicator</span><span class="p">(</span><span class="n">bandwidth_column</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">up_bandwidths</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">bandwidth_column</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span>
            <span class="p">)(</span><span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
                <span class="n">row</span><span class="p">,</span> <span class="n">bandwidth_column</span>
            <span class="p">)</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">up_bandwidths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">mixed_bandwidths</span><span class="p">,</span> <span class="n">up_bandwidths</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">mixed_bandwidths</span><span class="p">),</span> <span class="n">up_bandwidths</span><span class="p">)</span>

        <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">horizontalHeader</span>
        <span class="p">)()</span><span class="o">.</span><span class="n">setSortIndicator</span><span class="p">(</span><span class="n">bandwidth_column</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">down_bandwidths</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">bandwidth_column</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span>
            <span class="p">)(</span><span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
                <span class="n">row</span><span class="p">,</span> <span class="n">bandwidth_column</span>
            <span class="p">)</span>
            <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">down_bandwidths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">mixed_bandwidths</span><span class="p">,</span> <span class="n">down_bandwidths</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="nb">sorted</span><span class="p">(</span><span class="n">mixed_bandwidths</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">down_bandwidths</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_table_data_add_columns">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_table_data_add_columns">[docs]</a>
    <span class="k">def</span> <span class="nf">test_table_data_add_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds tag columns to the table data window.</span>

<span class="sd">        - Tests TableDataBrowser.add_columns.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Creates a new project folder and switches to it</span>
        <span class="n">new_proj_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">(</span><span class="n">light</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">new_proj_path</span><span class="p">,</span> <span class="s2">&quot;test_light_project&quot;</span><span class="p">)</span>

        <span class="c1"># Sets shortcuts for often used objects</span>
        <span class="n">table_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span>

        <span class="c1"># Adds a tag, of the types float, datetime, date and time, to</span>
        <span class="c1"># the project session</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;mock_tag_float&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mock_tag_datetime&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mock_tag_date&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mock_tag_time&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">types</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">FIELD_TYPE_FLOAT</span><span class="p">,</span>
            <span class="n">FIELD_TYPE_DATETIME</span><span class="p">,</span>
            <span class="n">FIELD_TYPE_DATE</span><span class="p">,</span>
            <span class="n">FIELD_TYPE_TIME</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">tag_type</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tags</span><span class="p">,</span> <span class="n">types</span><span class="p">):</span>
            <span class="n">table_data</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">tag_type</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
            <span class="p">)</span>

        <span class="n">table_data</span><span class="o">.</span><span class="n">add_columns</span><span class="p">()</span>  <span class="c1"># Adds the tags to table view</span>

        <span class="c1"># Asserts that the tags were added to the table view</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_table_data_appendix">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_table_data_appendix">[docs]</a>
    <span class="k">def</span> <span class="nf">test_table_data_appendix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Opens a project and tests miscellaneous methods of the table</span>
<span class="sd">        data view, in the data browser.</span>

<span class="sd">        -Tests</span>
<span class="sd">            - TableDataBrowser.change_cell_color</span>
<span class="sd">            - TableDataBrowser.section_moved</span>
<span class="sd">            - TableDataBrowser.selectColumn</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Creates a new project folder and switches to it</span>
        <span class="n">new_proj_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">(</span><span class="n">light</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">new_proj_path</span><span class="p">,</span> <span class="s2">&quot;test_light_project&quot;</span><span class="p">)</span>

        <span class="c1"># Set often used shortcuts</span>
        <span class="n">table_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span>

        <span class="c1"># TESTS CHANGE_CELL_COLOR</span>
        <span class="c1"># Adds a new document to the collection</span>
        <span class="n">NEW_DOC</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;FileName&quot;</span><span class="p">:</span> <span class="s2">&quot;mock_file_name&quot;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_document</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">NEW_DOC</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_document</span><span class="p">(</span>
            <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">NEW_DOC</span>
        <span class="p">)</span>

        <span class="c1"># Selects the &#39;Filename&#39; of the first scan and changes its value</span>
        <span class="c1"># to this document filename</span>
        <span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">NEW_DOC</span><span class="p">[</span><span class="s2">&quot;FileName&quot;</span><span class="p">])</span>
        <span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Selects &#39;FOV&#39; and changes its value</span>
        <span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;[4.0, 4.0]&quot;</span><span class="p">)</span>
        <span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Creates a tag of type float and selects it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">add_tag_infos</span><span class="p">(</span>
            <span class="s2">&quot;mock_tag&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">FIELD_TYPE_FLOAT</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span>
        <span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Mocks the execution of a dialog box</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="kc">None</span>

        <span class="c1"># Tries setting an invalid string value to the tag</span>
        <span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;invalid_string&quot;</span><span class="p">)</span>
        <span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Creates another tag of type float and selects it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">add_tag_infos</span><span class="p">(</span>
            <span class="s2">&quot;mock_tag_1&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">FIELD_TYPE_FLOAT</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span>
        <span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Sets a valid float value to the tag</span>
        <span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;0.0&quot;</span><span class="p">)</span>

        <span class="c1"># Changing the same tag does not trigger the &#39;valueChanged&#39; and</span>
        <span class="c1"># thus not the &#39;change_cell_color&#39; method</span>
        <span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Selects the &#39;Exp Type&#39; and &#39;FOV&#39; of the first scan, which have</span>
        <span class="c1"># distinct data types</span>
        <span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Tries changing the value of &#39;Exp Type&#39;</span>
        <span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;RARE_B&quot;</span><span class="p">)</span>

        <span class="c1"># Asserts that only &#39;Exp Type&#39; changed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;RARE_B&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;RARE_B&quot;</span><span class="p">)</span>

        <span class="c1"># TESTS SELECTION_MOVED</span>

        <span class="c1"># Switch columns of the 2 first tags</span>
        <span class="n">table_data</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">sectionMoved</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># SELECT_COLUMN</span>
        <span class="c1"># Selects the whole filename column</span>
        <span class="n">table_data</span><span class="o">.</span><span class="n">selectColumn</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Asserts that it was selected</span>
        <span class="n">selected_items</span> <span class="o">=</span> <span class="n">table_data</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">selected_items</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">selected_items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="n">table_data</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_table_data_context_menu">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_table_data_context_menu">[docs]</a>
    <span class="k">def</span> <span class="nf">test_table_data_context_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Right-click on a scan to display the context menu table, and choose</span>
<span class="sd">        an option.</span>

<span class="sd">        - Tests: TableDataBrowser.context_menu_table</span>

<span class="sd">        - Mocks:</span>
<span class="sd">            - QMenu.exec_</span>
<span class="sd">            - QMessageBox.exec</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Creates a new project folder and switches to it</span>
        <span class="n">new_proj_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">(</span><span class="n">light</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">new_proj_path</span><span class="p">,</span> <span class="s2">&quot;test_light_project&quot;</span><span class="p">)</span>

        <span class="c1"># Sets shortcuts for often used objects</span>
        <span class="n">table_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span>

        <span class="c1"># Mocks the execution of a dialog box</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="kc">None</span>

        <span class="c1"># Opens the context menu one time before cycling through the</span>
        <span class="c1"># actions</span>
        <span class="n">QMenu</span><span class="o">.</span><span class="n">exec_</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="kc">None</span>
        <span class="n">table_data</span><span class="o">.</span><span class="n">context_menu_table</span><span class="p">(</span><span class="n">QPoint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

        <span class="c1"># Cycles through the actions by opening the context menu and</span>
        <span class="c1"># clicking in each one of them</span>
        <span class="n">act_names</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;action_reset_cell&quot;</span><span class="p">,</span>
            <span class="s2">&quot;action_reset_column&quot;</span><span class="p">,</span>
            <span class="s2">&quot;action_reset_row&quot;</span><span class="p">,</span>
            <span class="s2">&quot;action_clear_cell&quot;</span><span class="p">,</span>
            <span class="s2">&quot;action_add_scan&quot;</span><span class="p">,</span>
            <span class="s2">&quot;action_remove_scan&quot;</span><span class="p">,</span>
            <span class="s2">&quot;action_visualized_tags&quot;</span><span class="p">,</span>
            <span class="s2">&quot;action_select_column&quot;</span><span class="p">,</span>
            <span class="s2">&quot;action_multiple_sort&quot;</span><span class="p">,</span>
            <span class="s2">&quot;action_send_documents_to_pipeline&quot;</span><span class="p">,</span>
            <span class="s2">&quot;action_display_file&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="c1"># Including &#39;action_sort_column&#39; will crash the build</span>

        <span class="k">for</span> <span class="n">act_name</span> <span class="ow">in</span> <span class="n">act_names</span><span class="p">:</span>
            <span class="n">QMenu</span><span class="o">.</span><span class="n">exec_</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">table_data</span><span class="p">,</span> <span class="n">act_name</span><span class="p">)</span>
            <span class="n">table_data</span><span class="o">.</span><span class="n">context_menu_table</span><span class="p">(</span><span class="n">QPoint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_undo_redo_databrowser">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_undo_redo_databrowser">[docs]</a>
    <span class="k">def</span> <span class="nf">test_undo_redo_databrowser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests the DataBrowser undo/redo.&quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="c1"># 1. Tag value (list)</span>
        <span class="c1"># Check undos and redos are empty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">undos</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">redos</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c1"># DataBrowser value for second document</span>
        <span class="n">bw_column</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span><span class="p">)(</span>
            <span class="s2">&quot;BandWidth&quot;</span>
        <span class="p">)</span>
        <span class="n">bw_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">bw_column</span><span class="p">)</span>
        <span class="n">bw_old</span> <span class="o">=</span> <span class="n">bw_item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1"># Check the value is really 50000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bw_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">50000</span><span class="p">)</span>

        <span class="c1"># Change the value</span>
        <span class="n">bw_item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># threading.Timer(2,</span>
        <span class="c1">#                 partial(self.edit_databrowser_list, &quot;0.0&quot;)).start()</span>
        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edit_databrowser_list</span><span class="p">,</span> <span class="s2">&quot;0.0&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">edit_table_data_values</span><span class="p">()</span>

        <span class="c1"># Check undos and redos have the right values.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">undos</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="p">[</span>
                    <span class="s2">&quot;modified_values&quot;</span><span class="p">,</span>
                    <span class="p">[</span>
                        <span class="p">[</span>
                            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                            <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                            <span class="s2">&quot;pvm-000220_000.nii&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;BandWidth&quot;</span><span class="p">,</span>
                            <span class="p">[</span><span class="mf">50000.0</span><span class="p">],</span>
                            <span class="p">[</span><span class="mf">0.0</span><span class="p">],</span>
                        <span class="p">]</span>
                    <span class="p">],</span>
                <span class="p">]</span>
            <span class="p">],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">redos</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c1"># Check the value has really been changed to 0.0.</span>
        <span class="n">bw_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">bw_column</span><span class="p">)</span>
        <span class="n">bw_set</span> <span class="o">=</span> <span class="n">bw_item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bw_set</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Undo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">action_undo</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>

        <span class="c1"># Check the value has really been reset to 50000</span>
        <span class="n">bw_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">bw_column</span><span class="p">)</span>
        <span class="n">bw_undo</span> <span class="o">=</span> <span class="n">bw_item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bw_undo</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">50000</span><span class="p">)</span>

        <span class="c1"># Check undos / redos have the right values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">redos</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="p">[</span>
                    <span class="s2">&quot;modified_values&quot;</span><span class="p">,</span>
                    <span class="p">[</span>
                        <span class="p">[</span>
                            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                            <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                            <span class="s2">&quot;pvm-000220_000.nii&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;BandWidth&quot;</span><span class="p">,</span>
                            <span class="p">[</span><span class="mf">50000.0</span><span class="p">],</span>
                            <span class="p">[</span><span class="mf">0.0</span><span class="p">],</span>
                        <span class="p">]</span>
                    <span class="p">],</span>
                <span class="p">]</span>
            <span class="p">],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">undos</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c1"># Redo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">action_redo</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>

        <span class="c1"># Check the value has really been reset to 0.0</span>
        <span class="n">bw_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">bw_column</span><span class="p">)</span>
        <span class="n">bw_redo</span> <span class="o">=</span> <span class="n">bw_item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bw_redo</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># we test undos / redos have the right values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">undos</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="p">[</span>
                    <span class="s2">&quot;modified_values&quot;</span><span class="p">,</span>
                    <span class="p">[</span>
                        <span class="p">[</span>
                            <span class="s2">&quot;data/raw_data/Guerbet-C6-2014-Rat-K52-Tube27&quot;</span>
                            <span class="s2">&quot;-2014-02-14102317-01-G1_Guerbet_Anat-RARE&quot;</span>
                            <span class="s2">&quot;pvm-000220_000.nii&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;BandWidth&quot;</span><span class="p">,</span>
                            <span class="p">[</span><span class="mf">50000.0</span><span class="p">],</span>
                            <span class="p">[</span><span class="mf">0.0</span><span class="p">],</span>
                        <span class="p">]</span>
                    <span class="p">],</span>
                <span class="p">]</span>
            <span class="p">],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">redos</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c1"># 2. Remove a scan (document)</span>
        <span class="c1"># Check there are 9 documents in db (current and initial)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">9</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                    <span class="n">COLLECTION_CURRENT</span>
                <span class="p">)</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">9</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                    <span class="n">COLLECTION_INITIAL</span>
                <span class="p">)</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Remove the eighth document</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">remove_scan</span><span class="p">()</span>

        <span class="c1"># Check if there are now 8 documents in db (current and initial)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">8</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                    <span class="n">COLLECTION_CURRENT</span>
                <span class="p">)</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">8</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                    <span class="n">COLLECTION_INITIAL</span>
                <span class="p">)</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Undo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">action_undo</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>

        <span class="c1"># Check there are still only 8 documents in the database</span>
        <span class="c1"># (current and initial). In fact the document has been permanently</span>
        <span class="c1"># deleted and we cannot recover it in this case</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">8</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                    <span class="n">COLLECTION_CURRENT</span>
                <span class="p">)</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">8</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                    <span class="n">COLLECTION_INITIAL</span>
                <span class="p">)</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># 3. Add a tag</span>
        <span class="c1"># Check we don&#39;t have &#39;Test&#39; tag in the db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span>
            <span class="s2">&quot;Test&quot;</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span>
            <span class="s2">&quot;Test&quot;</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                <span class="n">COLLECTION_INITIAL</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Add the Test tag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">add_tag_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">add_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">pop_up_add_tag</span>
        <span class="n">add_tag</span><span class="o">.</span><span class="n">text_edit_tag_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">add_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>

        <span class="c1"># Check the &#39;Test&#39; tag is in the db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;Test&quot;</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;Test&quot;</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                <span class="n">COLLECTION_INITIAL</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Undo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">action_undo</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>

        <span class="c1"># Check &#39;Test&#39; tag is not in the db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span>
            <span class="s2">&quot;Test&quot;</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span>
            <span class="s2">&quot;Test&quot;</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                <span class="n">COLLECTION_INITIAL</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Redo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">action_redo</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>

        <span class="c1"># Check the &#39;Test&#39; tag is in the db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;Test&quot;</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;Test&quot;</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                <span class="n">COLLECTION_INITIAL</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># 4. Remove tag</span>
        <span class="c1"># Remove the &#39;Test&#39; tag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">remove_tag_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">remove_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">pop_up_remove_tag</span>
        <span class="n">remove_tag</span><span class="o">.</span><span class="n">list_widget_tags</span><span class="o">.</span><span class="n">setCurrentRow</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># &#39;Test&#39; tag selected</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">remove_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>

        <span class="c1"># Check &#39;Test&#39; tag is not in the db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span>
            <span class="s2">&quot;Test&quot;</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span>
            <span class="s2">&quot;Test&quot;</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                <span class="n">COLLECTION_INITIAL</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Undo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">action_undo</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>

        <span class="c1"># Check &#39;Test&#39; tag is in the db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;Test&quot;</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;Test&quot;</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                <span class="n">COLLECTION_INITIAL</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Redo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">action_redo</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>

        <span class="c1"># Check &#39;Test&#39; tag is not in the db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span>
            <span class="s2">&quot;Test&quot;</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span>
            <span class="s2">&quot;Test&quot;</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                <span class="n">COLLECTION_INITIAL</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># 4. clone tag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">clone_tag_action</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
        <span class="n">clone_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">pop_up_clone_tag</span>

        <span class="k">for</span> <span class="n">fov_column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">clone_tag</span><span class="o">.</span><span class="n">list_widget_tags</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">clone_tag</span><span class="o">.</span><span class="n">list_widget_tags</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">fov_column</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;FOV&quot;</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="c1"># &#39;FOV&#39; tag selected</span>
        <span class="n">clone_tag</span><span class="o">.</span><span class="n">list_widget_tags</span><span class="o">.</span><span class="n">setCurrentRow</span><span class="p">(</span><span class="n">fov_column</span><span class="p">)</span>
        <span class="n">clone_tag</span><span class="o">.</span><span class="n">line_edit_new_tag_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">clone_tag</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>

        <span class="c1"># Check &#39;Test&#39; tag is in the db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;Test&quot;</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;Test&quot;</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                <span class="n">COLLECTION_INITIAL</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Value in the db</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">scan_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="s2">&quot;Test&quot;</span>
        <span class="p">)</span>
        <span class="n">value_initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
            <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="s2">&quot;Test&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Value in the DataBrowser</span>
        <span class="n">test_column</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span>
        <span class="p">)(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">test_column</span><span class="p">)</span>
        <span class="n">databrowser</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1"># Check equality between DataBrowser and db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">databrowser</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value_initial</span><span class="p">)</span>

        <span class="c1"># Undo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">action_undo</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>

        <span class="c1"># Check &#39;Test&#39; tag is not in the db and not in the DataBrowser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span>
            <span class="s2">&quot;Test&quot;</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span>
            <span class="s2">&quot;Test&quot;</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                <span class="n">COLLECTION_INITIAL</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span><span class="p">)(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_unnamed_proj_soft_open">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_unnamed_proj_soft_open">[docs]</a>
    <span class="k">def</span> <span class="nf">test_unnamed_proj_soft_open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests unnamed project creation at software opening.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">Project</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span> <span class="s2">&quot;Unnamed project&quot;</span><span class="p">)</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tags</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_CHECKSUM</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_FILENAME</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_TYPE</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_EXP_TYPE</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_BRICKS</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_HISTORY</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span>
            <span class="p">),</span>
            <span class="p">[],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                <span class="n">COLLECTION_INITIAL</span>
            <span class="p">),</span>
            <span class="p">[],</span>
        <span class="p">)</span>
        <span class="n">collections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_collections_names</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">collections</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">COLLECTION_INITIAL</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">COLLECTION_BRICK</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">COLLECTION_HISTORY</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">windowTitle</span><span class="p">(),</span>
            <span class="s2">&quot;MIA - Multiparametric Image Analysis &quot;</span>
            <span class="s2">&quot;(Admin mode) - Unnamed project&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_update_data_history">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_update_data_history">[docs]</a>
    <span class="k">def</span> <span class="nf">test_update_data_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates the history of data that have been re-written.</span>

<span class="sd">        - Tests: Project.update_data_history</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Creates a test project</span>
        <span class="n">test_proj_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">(</span><span class="n">light</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">test_proj_path</span><span class="p">,</span> <span class="s2">&quot;test_project&quot;</span><span class="p">)</span>

        <span class="c1"># Gets a scan that contains a smooth brick in its history</span>
        <span class="n">NII_FILE_3</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;sGuerbet-C6-2014-Rat-K52-Tube27-2014-02-14102317-01-G1_&quot;</span>
            <span class="s2">&quot;Guerbet_Anat-RAREpvm-000220_000.nii&quot;</span>
        <span class="p">)</span>
        <span class="n">DOCUMENT_3</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;derived_data&quot;</span><span class="p">,</span> <span class="n">NII_FILE_3</span><span class="p">)</span>

        <span class="c1"># Cleanup earlier history and check that no obsolete bricks is detected</span>
        <span class="n">obsolete_bricks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">update_data_history</span><span class="p">(</span>
            <span class="p">[</span><span class="n">DOCUMENT_3</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">obsolete_bricks</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_update_default_value">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_update_default_value">[docs]</a>
    <span class="k">def</span> <span class="nf">test_update_default_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates the values when a list of default values is created.</span>

<span class="sd">        Tests: DefaultValueListCreation.update_default_value</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Set shortcuts for objects that are often used</span>
        <span class="n">data_browser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span>

        <span class="c1"># The objects are successively created in the following order:</span>
        <span class="c1"># PopUpAddTag &gt; DefaultValueQLineEdit &gt; DefaultValueListCreation</span>
        <span class="n">pop_up</span> <span class="o">=</span> <span class="n">PopUpAddTag</span><span class="p">(</span><span class="n">data_browser</span><span class="p">,</span> <span class="n">data_browser</span><span class="o">.</span><span class="n">project</span><span class="p">)</span>
        <span class="n">text_edt</span> <span class="o">=</span> <span class="n">pop_up</span><span class="o">.</span><span class="n">text_edit_default_value</span>

        <span class="c1"># Assures the instantiation of &#39;DefaultValueListCreation&#39;</span>
        <span class="n">text_edt</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s2">&quot;list_&quot;</span>

        <span class="c1"># Mocks the execution of a dialog window</span>
        <span class="n">DefaultValueListCreation</span><span class="o">.</span><span class="n">show</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>

        <span class="c1"># &#39;DefaultValueListCreation&#39; can be instantiated with an empty</span>
        <span class="c1"># string, non-empty string or list</span>
        <span class="c1"># Only a list leads to the table values being filled</span>
        <span class="c1"># Empty string</span>
        <span class="n">text_edt</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">text_edt</span><span class="o">.</span><span class="n">mousePressEvent</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Non-empty string</span>
        <span class="n">text_edt</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;non_empty&quot;</span><span class="p">)</span>
        <span class="n">text_edt</span><span class="o">.</span><span class="n">mousePressEvent</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">text_edt</span><span class="o">.</span><span class="n">list_creation</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># List of length = 2</span>
        <span class="n">text_edt</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;[1, 2]&quot;</span><span class="p">)</span>
        <span class="n">text_edt</span><span class="o">.</span><span class="n">mousePressEvent</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">text_edt</span><span class="o">.</span><span class="n">list_creation</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">text_edt</span><span class="o">.</span><span class="n">list_creation</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">text_edt</span><span class="o">.</span><span class="n">list_creation</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">columnCount</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c1"># &#39;&#39;[1]&#39;&#39; will become &#39;[1]&#39; after being passed through s</span>
        <span class="c1"># &#39;ast.literal_eval()&#39;</span>

        <span class="c1"># Adds one element to the table</span>
        <span class="n">text_edt</span><span class="o">.</span><span class="n">list_creation</span><span class="o">.</span><span class="n">add_element</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">text_edt</span><span class="o">.</span><span class="n">list_creation</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">columnCount</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span>

        <span class="c1"># Removes one element to the table</span>
        <span class="n">text_edt</span><span class="o">.</span><span class="n">list_creation</span><span class="o">.</span><span class="n">remove_element</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">text_edt</span><span class="o">.</span><span class="n">list_creation</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">columnCount</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Resize the table</span>
        <span class="n">text_edt</span><span class="o">.</span><span class="n">list_creation</span><span class="o">.</span><span class="n">resize_table</span><span class="p">()</span>

        <span class="c1"># Resize the table while mocking a column width of 900 elements</span>
        <span class="n">text_edt</span><span class="o">.</span><span class="n">list_creation</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setColumnWidth</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">900</span><span class="p">)</span>
        <span class="n">text_edt</span><span class="o">.</span><span class="n">list_creation</span><span class="o">.</span><span class="n">resize_table</span><span class="p">()</span>

        <span class="c1"># The default value can be updated with several types of data</span>
        <span class="n">types</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">FIELD_TYPE_LIST_INTEGER</span><span class="p">,</span>
            <span class="n">FIELD_TYPE_LIST_FLOAT</span><span class="p">,</span>
            <span class="n">FIELD_TYPE_LIST_BOOLEAN</span><span class="p">,</span>
            <span class="n">FIELD_TYPE_LIST_BOOLEAN</span><span class="p">,</span>
            <span class="n">FIELD_TYPE_LIST_STRING</span><span class="p">,</span>
            <span class="n">FIELD_TYPE_LIST_DATE</span><span class="p">,</span>
            <span class="n">FIELD_TYPE_LIST_DATETIME</span><span class="p">,</span>
            <span class="n">FIELD_TYPE_LIST_TIME</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;[1]&quot;</span><span class="p">,</span>
            <span class="s2">&quot;[1.1]&quot;</span><span class="p">,</span>
            <span class="s2">&quot;[True]&quot;</span><span class="p">,</span>
            <span class="s2">&quot;[False]&quot;</span><span class="p">,</span>
            <span class="s1">&#39;[&quot;str&quot;]&#39;</span><span class="p">,</span>
            <span class="s1">&#39;[&quot;11/11/1111&quot;]&#39;</span><span class="p">,</span>
            <span class="s1">&#39;[&quot;11/11/1111 11:11:11.11&quot;]&#39;</span><span class="p">,</span>
            <span class="s1">&#39;[&quot;11:11:11.11&quot;]&#39;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">type_</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">types</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
            <span class="n">text_edt</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">text_edt</span><span class="o">.</span><span class="n">mousePressEvent</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">text_edt</span><span class="o">.</span><span class="n">list_creation</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">type_</span>
            <span class="n">text_edt</span><span class="o">.</span><span class="n">list_creation</span><span class="o">.</span><span class="n">update_default_value</span><span class="p">()</span>

        <span class="c1"># Induces a &#39;ValueError&#39;, mocks the execution of a dialog box</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
        <span class="n">text_edt</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;[&quot;not_boolean&quot;]&#39;</span><span class="p">)</span>
        <span class="n">text_edt</span><span class="o">.</span><span class="n">mousePressEvent</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">text_edt</span><span class="o">.</span><span class="n">list_creation</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">FIELD_TYPE_LIST_BOOLEAN</span>
        <span class="n">text_edt</span><span class="o">.</span><span class="n">list_creation</span><span class="o">.</span><span class="n">update_default_value</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_utils">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_utils">[docs]</a>
    <span class="k">def</span> <span class="nf">test_utils</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test the utils functions.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">table_to_database</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">FIELD_TYPE_BOOLEAN</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">table_to_database</span><span class="p">(</span><span class="s2">&quot;False&quot;</span><span class="p">,</span> <span class="n">FIELD_TYPE_BOOLEAN</span><span class="p">),</span> <span class="kc">False</span><span class="p">)</span>

        <span class="n">format_</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;01/01/2019&quot;</span><span class="p">,</span> <span class="n">format_</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">check_value_type</span><span class="p">(</span><span class="s2">&quot;01/01/2019&quot;</span><span class="p">,</span> <span class="n">FIELD_TYPE_DATE</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">table_to_database</span><span class="p">(</span><span class="s2">&quot;01/01/2019&quot;</span><span class="p">,</span> <span class="n">FIELD_TYPE_DATE</span><span class="p">),</span> <span class="n">value</span>
        <span class="p">)</span>

        <span class="n">format_</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y %H:%M:%S.</span><span class="si">%f</span><span class="s2">&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;15/7/2019 16:16:55.789643&quot;</span><span class="p">,</span> <span class="n">format_</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">check_value_type</span><span class="p">(</span><span class="s2">&quot;15/7/2019 16:16:55.789643&quot;</span><span class="p">,</span> <span class="n">FIELD_TYPE_DATETIME</span><span class="p">),</span>
            <span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">table_to_database</span><span class="p">(</span>
                <span class="s2">&quot;15/7/2019 16:16:55.789643&quot;</span><span class="p">,</span> <span class="n">FIELD_TYPE_DATETIME</span>
            <span class="p">),</span>
            <span class="n">value</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">format_</span> <span class="o">=</span> <span class="s2">&quot;%H:%M:%S.</span><span class="si">%f</span><span class="s2">&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;16:16:55.789643&quot;</span><span class="p">,</span> <span class="n">format_</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">check_value_type</span><span class="p">(</span><span class="s2">&quot;16:16:55.789643&quot;</span><span class="p">,</span> <span class="n">FIELD_TYPE_TIME</span><span class="p">),</span> <span class="kc">True</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">table_to_database</span><span class="p">(</span><span class="s2">&quot;16:16:55.789643&quot;</span><span class="p">,</span> <span class="n">FIELD_TYPE_TIME</span><span class="p">),</span> <span class="n">value</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestMIADataBrowser.test_visualized_tags">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIADataBrowser.test_visualized_tags">[docs]</a>
    <span class="k">def</span> <span class="nf">test_visualized_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests the popup modifying the visualized tags.&quot;&quot;&quot;</span>

        <span class="c1"># Testing default tags visibility</span>
        <span class="n">visibles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_shown_tags</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">visibles</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_FILENAME</span> <span class="ow">in</span> <span class="n">visibles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_BRICKS</span> <span class="ow">in</span> <span class="n">visibles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_TYPE</span> <span class="ow">in</span> <span class="n">visibles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_EXP_TYPE</span> <span class="ow">in</span> <span class="n">visibles</span><span class="p">)</span>

        <span class="c1"># Testing columns displayed in the DataBrowser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">columns_displayed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">tag_displayed</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">horizontalHeaderItem</span>
            <span class="p">)(</span><span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isColumnHidden</span><span class="p">(</span>
                <span class="n">column</span>
            <span class="p">):</span>
                <span class="n">columns_displayed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag_displayed</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">visibles</span><span class="p">),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">columns_displayed</span><span class="p">))</span>

        <span class="c1"># Testing that FileName tag is the first column</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">TAG_FILENAME</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span>
                <span class="mi">0</span>
            <span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
        <span class="p">)</span>

        <span class="c1"># Trying to set the visibles tags</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">visualized_tags_button</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span>
        <span class="p">)</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">pop_up</span>

        <span class="c1"># Testing that checksum tag isn&#39;t displayed</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">search_bar</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">TAG_CHECKSUM</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">list_widget_tags</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Testing that history uuid tag isn&#39;t displayed</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">search_bar</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">TAG_HISTORY</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">list_widget_tags</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Testing that FileName is not displayed in the list of visible tags</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">search_bar</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">visible_tags</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">list_widget_selected_tags</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">list_widget_selected_tags</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">visible_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">visible_tags</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_BRICKS</span> <span class="ow">in</span> <span class="n">visible_tags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_EXP_TYPE</span> <span class="ow">in</span> <span class="n">visible_tags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_TYPE</span> <span class="ow">in</span> <span class="n">visible_tags</span><span class="p">)</span>

        <span class="c1"># Testing when hiding a tag</span>
        <span class="c1"># Bricks tag selected</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">list_widget_selected_tags</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">push_button_unselect_tag</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span>
        <span class="p">)</span>
        <span class="n">visible_tags</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">list_widget_selected_tags</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">list_widget_selected_tags</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">visible_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">visible_tags</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_TYPE</span> <span class="ow">in</span> <span class="n">visible_tags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_EXP_TYPE</span> <span class="ow">in</span> <span class="n">visible_tags</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>

        <span class="n">new_visibles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_shown_tags</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_visibles</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_FILENAME</span> <span class="ow">in</span> <span class="n">new_visibles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_EXP_TYPE</span> <span class="ow">in</span> <span class="n">new_visibles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_TYPE</span> <span class="ow">in</span> <span class="n">new_visibles</span><span class="p">)</span>

        <span class="n">columns_displayed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">horizontalHeaderItem</span>
            <span class="p">)(</span><span class="n">column</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isColumnHidden</span><span class="p">(</span>
                <span class="n">column</span>
            <span class="p">):</span>
                <span class="n">columns_displayed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">columns_displayed</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_FILENAME</span> <span class="ow">in</span> <span class="n">columns_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_EXP_TYPE</span> <span class="ow">in</span> <span class="n">columns_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_TYPE</span> <span class="ow">in</span> <span class="n">columns_displayed</span><span class="p">)</span>

        <span class="c1"># Testing when showing a new tag</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">visualized_tags_button</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span>
        <span class="p">)</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">pop_up</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">search_bar</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">TAG_BRICKS</span><span class="p">)</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">list_widget_tags</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">tab_tags</span><span class="o">.</span><span class="n">push_button_select_tag</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span>
        <span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">push_button_ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>

        <span class="n">new_visibles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_shown_tags</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_visibles</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_FILENAME</span> <span class="ow">in</span> <span class="n">new_visibles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_EXP_TYPE</span> <span class="ow">in</span> <span class="n">new_visibles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_TYPE</span> <span class="ow">in</span> <span class="n">new_visibles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_BRICKS</span> <span class="ow">in</span> <span class="n">new_visibles</span><span class="p">)</span>

        <span class="n">columns_displayed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">horizontalHeaderItem</span>
            <span class="p">)(</span><span class="n">column</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isColumnHidden</span><span class="p">(</span>
                <span class="n">column</span>
            <span class="p">):</span>
                <span class="n">columns_displayed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">columns_displayed</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_FILENAME</span> <span class="ow">in</span> <span class="n">columns_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_EXP_TYPE</span> <span class="ow">in</span> <span class="n">columns_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_TYPE</span> <span class="ow">in</span> <span class="n">columns_displayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">TAG_BRICKS</span> <span class="ow">in</span> <span class="n">columns_displayed</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestMIAMainWindow">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAMainWindow">[docs]</a>
<span class="k">class</span> <span class="nc">TestMIAMainWindow</span><span class="p">(</span><span class="n">TestMIACase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests for the main window class (MainWindow).</span>

<span class="sd">    :Contains:</span>
<span class="sd">        :Method:</span>
<span class="sd">            - test_check_database: checks if the database has changed</span>
<span class="sd">              since the scans were first imported</span>
<span class="sd">            - test_closeEvent: opens a project and closes the main window</span>
<span class="sd">            - test_create_project_pop_up: tries to create a new project</span>
<span class="sd">              with a project already open.</span>
<span class="sd">            - test_files_in_project: tests whether or not a given file</span>
<span class="sd">              is part of the project.</span>
<span class="sd">            - test_import_data: opens a project and simulates importing</span>
<span class="sd">              a file from the MriConv java executable</span>
<span class="sd">            - test_open_project_pop_up: creates a test project and opens</span>
<span class="sd">              a project, including unsaved modifications.</span>
<span class="sd">            - test_open_recent_project: creates 2 test projects and</span>
<span class="sd">              opens one by the recent projects action.</span>
<span class="sd">            - test_open_shell: opens Qt console and kill it afterwards.</span>
<span class="sd">            - test_package_library_dialog_add_pkg: creates a new project</span>
<span class="sd">              folder, opens the processes library and adds a package.</span>
<span class="sd">            - test_package_library_dialog_del_pkg: creates a new project</span>
<span class="sd">              folder, opens the processes library and deletes a package.</span>
<span class="sd">            - test_package_library_dialog_rmv_pkg: creates a new project</span>
<span class="sd">              folder, opens the processes library and removes a package.</span>
<span class="sd">            - test_package_library_others: Creates a new project folder, opens</span>
<span class="sd">              the processes library and adds a package.</span>
<span class="sd">            - test_popUpDeletedProject: adds a deleted projects to the</span>
<span class="sd">              projects list and launches mia.</span>
<span class="sd">            - test_popUpDeleteProject: creates a new project and deletes</span>
<span class="sd">              it.</span>
<span class="sd">            - test_see_all_projects: creates 2 projects and tries to</span>
<span class="sd">              open them through the all projects pop-up.</span>
<span class="sd">            - test_software_preferences_pop_up: opens the preferences</span>
<span class="sd">              pop up and changes parameters.</span>
<span class="sd">            - test_software_preferences_pop_up_config_file: opens the</span>
<span class="sd">              preferences pop up and changes parameters.</span>
<span class="sd">            - test_software_preferences_pop_up_modules_config: changes</span>
<span class="sd">              the configuration of AFNI, ANTS, FSL, SPM, mrtrix and MATLAB.</span>
<span class="sd">            - test_software_preferences_pop_up_validate: opens the</span>
<span class="sd">              preferences pop up for AFNI, ANTS, FSL, SPM, mrtrix and MATLAB.</span>
<span class="sd">            - test_switch_project: create project and switches to it.</span>
<span class="sd">            - test_tab_changed: switches between data browser, data</span>
<span class="sd">              viewer and pipeline manager.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestMIAMainWindow.test_check_database">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAMainWindow.test_check_database">[docs]</a>
    <span class="k">def</span> <span class="nf">test_check_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if the database has changed since the scans were first</span>
<span class="sd">        imported.</span>

<span class="sd">        - Tests: MainWindow.test_check_database</span>

<span class="sd">        - Mocks QMessageBox.exec</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Creates a new project and switches to it</span>
        <span class="n">test_proj_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">test_proj_path</span><span class="p">,</span> <span class="s2">&quot;test_project&quot;</span><span class="p">)</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="c1"># Mocks the execution of a dialog box by accepting it</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">self_</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">:</span> <span class="n">self_</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>

        <span class="c1"># Gets the file path</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span> <span class="o">=</span> <span class="n">test_proj_path</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">test_proj_path</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;raw_data&quot;</span><span class="p">)</span>
        <span class="n">NII_FILE_1</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Guerbet-C6-2014-Rat-K52-Tube27-2014-02-14102317-04-G3_&quot;</span>
            <span class="s2">&quot;Guerbet_MDEFT-MDEFTpvm-000940_800.nii&quot;</span>
        <span class="p">)</span>
        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">NII_FILE_1</span><span class="p">))</span>

        <span class="c1"># Removes one document from the database</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">DOCUMENT_1</span><span class="p">)</span>

        <span class="c1"># Check if the files of the database have been modified</span>
        <span class="c1"># Since QMessageBox.exec is mocked, the QMessageBox&#39;s text is not</span>
        <span class="c1"># observed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">action_check_database</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIAMainWindow.test_closeEvent">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAMainWindow.test_closeEvent">[docs]</a>
    <span class="k">def</span> <span class="nf">test_closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Opens a project and closes the main window.</span>

<span class="sd">        - Tests: MainWindow.closeEvent</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># FIXME: Does this test really bring anything new compared to other</span>
        <span class="c1">#        tests already performed?</span>
        <span class="c1"># Creates a new project folder and switches to it</span>
        <span class="n">new_proj_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">(</span><span class="n">light</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">new_proj_path</span><span class="p">,</span> <span class="s2">&quot;test_light_project&quot;</span><span class="p">)</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="c1"># Gets the UID of the first brick in the brick collection, which is</span>
        <span class="c1"># composed of the bricks appearing in the scan history.</span>
        <span class="n">bricks_coll</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents</span><span class="p">(</span>
            <span class="n">COLLECTION_BRICK</span>
        <span class="p">)</span>
        <span class="n">brick</span> <span class="o">=</span> <span class="n">bricks_coll</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Appends it to the &#39;brick_list&#39;</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">brick_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">brick</span><span class="o">.</span><span class="n">ID</span><span class="p">)</span>

        <span class="c1"># Mocks having initialized the pipeline</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_clicked</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># &#39;self.main_window.close()&#39; is already called by &#39;tearDown&#39;</span>
        <span class="c1"># after each test</span>

        <span class="c1"># No assertion is possible since the &#39;self.main_window.project&#39;</span>
        <span class="c1"># was deleted</span>

        <span class="nb">print</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIAMainWindow.test_create_project_pop_up">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAMainWindow.test_create_project_pop_up">[docs]</a>
    <span class="k">def</span> <span class="nf">test_create_project_pop_up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tries to create a new project with an already open project, with and</span>
<span class="sd">        without setting the projects folder path.</span>

<span class="sd">        - Tests:</span>
<span class="sd">            - MainWindow.create_project_pop_up</span>
<span class="sd">            - PopUpNewProject</span>

<span class="sd">        - Mocks:</span>
<span class="sd">            - PopUpQuit.exec</span>
<span class="sd">            - QMessageBox.exec</span>
<span class="sd">            - PopUpNewProject.exec</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Sets shortcuts for often used objects</span>
        <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span>

        <span class="c1"># Creates a new project folder and switches to it</span>
        <span class="n">new_proj_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">(</span><span class="n">light</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_proj_path</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;downloaded_data&quot;</span><span class="p">)</span>
        <span class="n">NII_FILE_1</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Guerbet-C6-2014-Rat-K52-Tube27-2014-02-14102317-01-G1_&quot;</span>
            <span class="s2">&quot;Guerbet_Anat-RAREpvm-000220_000.nii&quot;</span>
        <span class="p">)</span>
        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">NII_FILE_1</span><span class="p">))</span>

        <span class="c1"># Adds a document to the collection</span>
        <span class="n">session</span><span class="o">.</span><span class="n">add_document</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>

        <span class="c1"># Mocks the execution of the pop-up quit</span>
        <span class="n">PopUpQuit</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">self_</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">self_</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># Tries to create a project with unsaved modifications</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">create_project_pop_up</span><span class="p">()</span>

        <span class="c1"># Closes the error dialog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="p">,</span> <span class="s2">&quot;pop_up_close&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pop_up_close</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>

        <span class="n">session</span><span class="o">.</span><span class="n">remove_document</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>

        <span class="c1"># Mocks the execution of a pop-up</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">self_</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">self_</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># Resets the projects folder</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_projects_save_path</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Tries to create a new project without setting the projects folder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">create_project_pop_up</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>

        <span class="c1"># Sets the projects folder path</span>
        <span class="n">proj_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">new_proj_path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_projects_save_path</span><span class="p">(</span><span class="n">proj_folder</span><span class="p">)</span>

        <span class="c1"># Mocks the execution of &#39;PopUpNewProject</span>
        <span class="n">PopUpNewProject</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">self_</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="kc">None</span>

        <span class="c1"># Opens the &quot;create project&quot; pop-up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">create_project_pop_up</span><span class="p">()</span>

        <span class="c1"># Mocks the execution of a pop-up</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="kc">None</span>

        <span class="c1"># Tries to create a new project in the same directory of an</span>
        <span class="c1"># existing one</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">exPopup</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(</span>
            <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">NII_FILE_1</span><span class="p">),)</span>
        <span class="p">)</span>

        <span class="c1"># Creates a new project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">exPopup</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(</span>
            <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="s2">&quot;new_project&quot;</span><span class="p">),)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAMainWindow.test_files_in_project">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAMainWindow.test_files_in_project">[docs]</a>
    <span class="k">def</span> <span class="nf">test_files_in_project</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests whether a given file is part of the project.</span>

<span class="sd">        - Tests: MainWindow.files_in_project</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Creates a now test project</span>
        <span class="n">test_proj_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">(</span><span class="n">light</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span> <span class="o">=</span> <span class="n">test_proj_path</span>

        <span class="c1"># Checks for a bool type as a file</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">files_in_project</span><span class="p">([{</span><span class="s2">&quot;mock_key&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

        <span class="c1"># Checks for a str type path located out of the project</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">files_in_project</span><span class="p">(</span><span class="s2">&quot;/out_of_project&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

        <span class="c1"># Checks for a str type path within the project</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">files_in_project</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">test_proj_path</span><span class="p">,</span> <span class="s2">&quot;mock_file&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>  <span class="c1"># Asserts it is not empty</span></div>


<div class="viewcode-block" id="TestMIAMainWindow.test_import_data">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAMainWindow.test_import_data">[docs]</a>
    <span class="k">def</span> <span class="nf">test_import_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Opens a project and simulates importing a file from the mri_conv</span>
<span class="sd">        java executable.</span>

<span class="sd">        - Tests:</span>
<span class="sd">            - read_log (data_loader.py)</span>
<span class="sd">            - ImportProgress</span>

<span class="sd">        - Mocks:</span>
<span class="sd">            - ImportWorker.start</span>
<span class="sd">            - ImportProgress.exec</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Opens a test project and switches to it</span>
        <span class="n">test_proj_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">(</span><span class="n">light</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">test_proj_path</span><span class="p">,</span> <span class="s2">&quot;test_project&quot;</span><span class="p">)</span>

        <span class="c1"># Creates a mocked java executable</span>
        <span class="n">mock_mriconv_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">test_proj_path</span><span class="p">,</span> <span class="s2">&quot;mock_mriconv&quot;</span><span class="p">,</span> <span class="s2">&quot;mockapp.jar&quot;</span>
        <span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">mock_mriconv_path</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_mock_jar</span><span class="p">(</span><span class="n">mock_mriconv_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Sets the &#39;MRIManager.jar&#39; path to a mocked java executable</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_mri_conv_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">mock_mriconv_path</span><span class="p">))</span>

        <span class="c1"># Gets information regarding the fist scan, located in the</span>
        <span class="c1"># &#39;derived_data&#39; of the project</span>
        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">)(</span>
            <span class="s2">&quot;current&quot;</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">DOCUMENT_1_NAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">DOCUMENT_1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Gets the &#39;raw_data&#39; folder path, where the scan will be import</span>
        <span class="n">RAW_DATA_FLDR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">test_proj_path</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;raw_data&quot;</span><span class="p">)</span>

        <span class="c1"># Copies a scan to the raw data folder</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">test_proj_path</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">),</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">RAW_DATA_FLDR</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">DOCUMENT_1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
        <span class="p">)</span>

        <span class="c1"># Creates the .json with the tag values, in the raw data folder</span>
        <span class="n">JSON_TAG_DUMP</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;AcquisitionTime&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;HH:mm:ss.SSS&quot;</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;The time the acquisition of data.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;mock_unit&quot;</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span>
                <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;00:09:40.800&quot;</span><span class="p">],</span>
            <span class="p">},</span>
            <span class="s2">&quot;BandWidth&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;MHz&quot;</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;float&quot;</span><span class="p">,</span>
                <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="mf">50000.0</span><span class="p">]],</span>
            <span class="p">},</span>
        <span class="p">}</span>
        <span class="n">JSON_TAG</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">RAW_DATA_FLDR</span><span class="p">,</span> <span class="n">DOCUMENT_1_NAME</span> <span class="o">+</span> <span class="s2">&quot;.json&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">JSON_TAG</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">JSON_TAG_DUMP</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

        <span class="c1"># Creates the &#39;logExport*.json&#39; file, in the raw data folder</span>
        <span class="n">JSON_EXPORT_DUMP</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;StatusExport&quot;</span><span class="p">:</span> <span class="s2">&quot;Export ok&quot;</span><span class="p">,</span>
                <span class="s2">&quot;NameFile&quot;</span><span class="p">:</span> <span class="n">DOCUMENT_1_NAME</span><span class="p">,</span>
                <span class="s2">&quot;Bvec_bval&quot;</span><span class="p">:</span> <span class="s2">&quot;no&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">]</span>
        <span class="n">JSON_EXPORT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">test_proj_path</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;raw_data&quot;</span><span class="p">,</span> <span class="s2">&quot;logExportMock.json&quot;</span>
        <span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">JSON_EXPORT</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">JSON_EXPORT_DUMP</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

        <span class="c1"># Mocks the thread start to avoid thread deadlocking</span>
        <span class="n">ImportWorker</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">self_</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="kc">None</span>
        <span class="n">ImportProgress</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">self_</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">self_</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

        <span class="c1"># Reads the scans added to the project</span>
        <span class="c1"># FIXME: Try uncommenting the following line</span>
        <span class="c1"># scans_added = read_log(self.main_window.project, self.main_window)</span>

        <span class="c1"># Mocks importing a scan, runs a mocked java executable instead</span>
        <span class="c1"># of the &#39;MRIManager.jar&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">import_data</span><span class="p">()</span>

        <span class="n">new_scan</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span>
            <span class="n">DOCUMENT_1</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;derived_data&quot;</span><span class="p">,</span> <span class="s2">&quot;raw_data&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">table_data_scans</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_visualize</span>
        <span class="p">)</span>
        <span class="n">table_data_scans</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">table_data_scans</span>
        <span class="p">]</span>

        <span class="c1"># Asserts that the first scan was added to the &#39;raw_data&#39; folder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">new_scan</span><span class="p">,</span> <span class="n">table_data_scans</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAMainWindow.test_open_project_pop_up">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAMainWindow.test_open_project_pop_up">[docs]</a>
    <span class="k">def</span> <span class="nf">test_open_project_pop_up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a test project and opens a project, including unsaved</span>
<span class="sd">        modifications.</span>

<span class="sd">        - Tests: MainWindow.open_project_pop_up</span>

<span class="sd">        - Mocks:</span>
<span class="sd">            - QMessageBox.exec</span>
<span class="sd">            - PopUpOpenProject.exec</span>
<span class="sd">            - PopUpQuit.exec</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Creates a test project</span>
        <span class="n">test_proj_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">(</span><span class="n">light</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">test_proj_path</span><span class="p">,</span> <span class="s2">&quot;test_project&quot;</span><span class="p">)</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">data_browser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span>

        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">self_</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">:</span> <span class="n">self_</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># Resets the projects save directory</span>
        <span class="n">Config</span><span class="p">()</span><span class="o">.</span><span class="n">set_projects_save_path</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Tries to open a project without setting the projects save dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">open_project_pop_up</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>

        <span class="c1"># Sets the projects save dir</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_projects_save_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">test_proj_path</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">PopUpOpenProject</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">self_</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">:</span> <span class="n">self_</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># Opens a project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">open_project_pop_up</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">exPopup</span><span class="o">.</span><span class="n">get_filename</span><span class="p">((</span><span class="n">test_proj_path</span><span class="p">,))</span>

        <span class="c1"># Deletes a scan from data browser</span>
        <span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">remove_scan</span><span class="p">()</span>

        <span class="c1"># Asserts that there are unsaved modification</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">check_unsaved_modifications</span><span class="p">())</span>

        <span class="n">PopUpQuit</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">self_</span><span class="p">:</span> <span class="n">self_</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># Tries to open a project with unsaved modifications</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">open_project_pop_up</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pop_up_close</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIAMainWindow.test_open_recent_project">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAMainWindow.test_open_recent_project">[docs]</a>
    <span class="k">def</span> <span class="nf">test_open_recent_project</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates 2 test projects and opens one by the recent projects action.</span>

<span class="sd">        - Tests: MainWindow.open_recent_project</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Creates 2 test projects</span>
        <span class="n">proj_test_1_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;test_project_1&quot;</span><span class="p">,</span> <span class="n">light</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">proj_test_2_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;test_project_2&quot;</span><span class="p">,</span> <span class="n">light</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="c1"># Switches to the first one</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">proj_test_1_path</span><span class="p">,</span> <span class="s2">&quot;test_project_1&quot;</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_projects_save_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">proj_test_1_path</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">saved_projects_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">proj_test_1_path</span><span class="p">)</span>

        <span class="c1"># Saves project 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">saveChoice</span><span class="p">()</span>

        <span class="c1"># Switches to project 2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">proj_test_2_path</span><span class="p">,</span> <span class="s2">&quot;test_project_2&quot;</span><span class="p">)</span>

        <span class="c1"># Asserts that test project 1 is shown in recent projects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">saved_projects_actions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isVisible</span><span class="p">())</span>

        <span class="c1"># Clicks on it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">saved_projects_actions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

        <span class="c1"># Asserts that it is now the current project</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_opened_projects</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">proj_test_1_path</span>
        <span class="p">)</span>

        <span class="c1"># Deletes a scan from data browser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># FIXME: following line raise exception, only on macos build:</span>
        <span class="c1"># Traceback (most recent call last):</span>
        <span class="c1"># File &quot;/Users/appveyor/projects/populse-mia/populse_mia/</span>
        <span class="c1"># test.py&quot;,</span>
        <span class="c1"># line 3797, in test_open_recent_project</span>
        <span class="c1"># self.main_window.data_browser.table_data.remove_scan()</span>
        <span class="c1"># File &quot;/Users/appveyor/projects/populse-mia/populse_mia/</span>
        <span class="c1"># user_interface/data_browser/data_browser.py&quot;, line 2055, in</span>
        <span class="c1"># remove_scan</span>
        <span class="c1"># scan_path)</span>
        <span class="c1"># File &quot;/Users/appveyor/projects/populse_db/python/populse_db/</span>
        <span class="c1"># database.py&quot;, line 724, in remove_document</span>
        <span class="c1"># self.engine.remove_document(collection, document_id)</span>
        <span class="c1"># File &quot;/Users/appveyor/projects/populse_db/python/populse_db/</span>
        <span class="c1"># engine/sqlite.py&quot;, line 628, in remove_document</span>
        <span class="c1"># self.remove_value(collection, document_id, field.field_name)</span>
        <span class="c1"># File &quot;/Users/appveyor/projects/populse_db/python/populse_db/</span>
        <span class="c1"># engine/sqlite.py&quot;, line 612, in remove_value</span>
        <span class="c1"># self.cursor.execute(sql, [document_id])</span>
        <span class="c1"># sqlite3.OperationalError: attempt to write a readonly database</span>
        <span class="c1"># While waiting to investiget and find a fix the line is commented:</span>
        <span class="c1"># self.main_window.data_browser.table_data.remove_scan()</span>

        <span class="c1"># Asserts that there are unsaved modification</span>
        <span class="c1"># FIXME: By commenting the previous line we have to also comment the</span>
        <span class="c1"># following line:</span>
        <span class="c1"># self.assertTrue(self.main_window.check_unsaved_modifications())</span>

        <span class="n">PopUpQuit</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">self_</span><span class="p">:</span> <span class="n">self_</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># Tries to open a project with unsaved modifications</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">saved_projects_actions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIAMainWindow.test_open_shell">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAMainWindow.test_open_shell">[docs]</a>
    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;Not currently available on all the platforms&quot;</span><span class="p">)</span>
    <span class="c1"># @unittest.skipUnless(sys.platform.startswith(&quot;linux&quot;), &quot;requires linux&quot;)</span>
    <span class="k">def</span> <span class="nf">test_open_shell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Opens a Qt console and kill it afterward.</span>

<span class="sd">        -Tests: MainWindow.open_shell</span>

<span class="sd">        Currently, this test is only done on linux.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Opens the Qt console</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">action_open_shell</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

        <span class="n">qt_console_process</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">time_elapsed</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">while</span> <span class="n">time_elapsed</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="c1"># Gets the current process</span>
            <span class="n">current_process</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span>
            <span class="n">children</span> <span class="o">=</span> <span class="n">current_process</span><span class="o">.</span><span class="n">children</span><span class="p">(</span><span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># If qt_console_process is not none, the qt console process</span>
            <span class="c1"># was found</span>
            <span class="k">if</span> <span class="n">qt_console_process</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="k">if</span> <span class="n">children</span><span class="p">:</span>
                <span class="c1"># Gets the process pid (process id)</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;jupyter-qtconso&quot;</span><span class="p">:</span>
                        <span class="n">qt_console_process</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">pid</span>

            <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">time_elapsed</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">qt_console_process</span><span class="p">:</span>
            <span class="c1"># Kills the Qt console</span>
            <span class="n">os</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="n">qt_console_process</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;the Qt console process was not found&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAMainWindow.test_package_library_dialog_add_pkg">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAMainWindow.test_package_library_dialog_add_pkg">[docs]</a>
    <span class="k">def</span> <span class="nf">test_package_library_dialog_add_pkg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new project folder, opens the processes library and</span>
<span class="sd">        adds a package.</span>

<span class="sd">        - Tests: PackageLibraryDialog</span>

<span class="sd">        - Mocks:</span>
<span class="sd">            - QMessageBox.exec</span>
<span class="sd">            - QMessageBox.exec_</span>
<span class="sd">            - QFileDialog.exec_</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">PKG</span> <span class="o">=</span> <span class="s2">&quot;nipype.interfaces.DataGrabber&quot;</span>

        <span class="c1"># Creates a new project folder and switches to it</span>
        <span class="n">new_proj_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">(</span><span class="n">light</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">new_proj_path</span><span class="p">,</span> <span class="s2">&quot;test_light_project&quot;</span><span class="p">)</span>

        <span class="c1"># Set shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">ppl_edt_tab</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span>
        <span class="n">ppl</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        <span class="n">proc_lib_view</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">processLibrary</span><span class="o">.</span><span class="n">process_library</span>

        <span class="c1"># Opens the package library pop-up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">package_library_pop_up</span><span class="p">()</span>
        <span class="n">pkg_lib_window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pop_up_package_library</span>

        <span class="c1"># Clicks on the add package button without selecting anything</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">None</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">exec_</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">None</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span>
            <span class="mi">0</span>
        <span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

        <span class="c1"># Open a browser to select a package</span>
        <span class="n">QFileDialog</span><span class="o">.</span><span class="n">exec_</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">True</span>
        <span class="c1"># proc_lib_view.pkg_library.browse_package()</span>

        <span class="c1"># Fill in the line edit to &quot;PKG&quot; then click on the add package button</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">PKG</span><span class="p">)</span>
        <span class="n">proc_lib_view</span><span class="o">.</span><span class="n">pkg_library</span><span class="o">.</span><span class="n">is_path</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;FSLOUTPUTTYPE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NIFTI&quot;</span>
        <span class="n">stdout_fileno</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">devnull</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">f</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span>
            <span class="mi">0</span>
        <span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout_fileno</span>
        <span class="c1"># Resets the previous action</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">add_list</span><span class="o">.</span><span class="n">selectAll</span><span class="p">()</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span>
            <span class="mi">8</span>
        <span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

        <span class="c1"># Apply changes, close the package library pop-up</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="c1"># Opens again the package library pop-up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">package_library_pop_up</span><span class="p">()</span>
        <span class="n">pkg_lib_window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pop_up_package_library</span>

        <span class="c1"># Writes the name of a non-existent package on the line edit</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;non-existent&quot;</span><span class="p">)</span>

        <span class="c1"># Clicks on the add package button</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span>
            <span class="mi">0</span>
        <span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

        <span class="c1"># Apply changes, close the package library pop-up</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="c1"># Makes a mocked process folder &quot;Mock_process&quot; in the temporary</span>
        <span class="c1"># project path</span>
        <span class="n">mock_proc_fldr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">new_proj_path</span><span class="p">,</span> <span class="s2">&quot;processes&quot;</span><span class="p">,</span> <span class="s2">&quot;UTs_processes&quot;</span>
        <span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">mock_proc_fldr</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Make a &#39;__init__.py&#39; in the mock_proc_fldr that raise</span>
        <span class="c1"># an &#39;ImportError&#39;</span>
        <span class="n">init_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mock_proc_fldr</span><span class="p">,</span> <span class="s2">&quot;__init__.py&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">init_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;raise ImportError(&#39;mock_import_error&#39;)&quot;</span><span class="p">)</span>
        <span class="n">init_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Make a &#39;test_unit_test_1.py&#39; in the mock_proc_fldr with a</span>
        <span class="c1"># real process</span>
        <span class="n">unit_test</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mock_proc_fldr</span><span class="p">,</span> <span class="s2">&quot;unit_test_1.py&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">unit_test</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;from capsul.api import Pipeline</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;import traits.api as traits</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;class Unit_test_1(Pipeline):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;    def pipeline_definition(self):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;        self.add_process(&#39;smooth_1&#39;, &quot;</span>
                <span class="s2">&quot;&#39;mia_processes.bricks.preprocess.spm.spatial_preprocessing.&quot;</span>
                <span class="s2">&quot;Smooth&#39;)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;        self.export_parameter(&#39;smooth_1&#39;, &#39;in_files&#39;, &quot;</span>
                <span class="s2">&quot;is_optional=False)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;        self.export_parameter(&#39;smooth_1&#39;, &#39;fwhm&#39;, &quot;</span>
                <span class="s2">&quot;is_optional=True)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;        self.export_parameter(&#39;smooth_1&#39;, &#39;data_type&#39;, &quot;</span>
                <span class="s2">&quot;is_optional=True)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;        self.export_parameter(&#39;smooth_1&#39;, &#39;implicit_masking&#39;,&quot;</span>
                <span class="s2">&quot; is_optional=True)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;        self.export_parameter(&#39;smooth_1&#39;, &#39;out_prefix&#39;, &quot;</span>
                <span class="s2">&quot;is_optional=True)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;        self.export_parameter(&#39;smooth_1&#39;, &#39;smoothed_files&#39;, &quot;</span>
                <span class="s2">&quot;is_optional=False)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;        self.reorder_traits((&#39;in_files&#39;, &#39;fwhm&#39;, &#39;data_type&#39;,&quot;</span>
                <span class="s2">&quot; &#39;implicit_masking&#39;, &#39;out_prefix&#39;, &#39;smoothed_files&#39;))</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;        self.node_position = {</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;            &#39;smooth_1&#39;: (-119.0, -73.0),</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;            &#39;inputs&#39;: (-373.26518439966446, -73.0),</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;            &#39;outputs&#39;: (227.03404291855725, -73.0),</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;        }</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;        self.node_dimension = {</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;            &#39;smooth_1&#39;: (221.046875, 215.0),</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;            &#39;inputs&#39;: (137.3125, 161.0),</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;            &#39;outputs&#39;: (111.25867003946317, 61.0),</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;        }</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;        self.do_autoexport_nodes_parameters = False</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">unit_test</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Makes a file &quot;mock_file_path&quot; in the temporary projects path</span>
        <span class="n">mock_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_proj_path</span><span class="p">,</span> <span class="s2">&quot;mock_file&quot;</span><span class="p">)</span>
        <span class="n">mock_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">mock_file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">mock_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Opens again the package library pop-up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">package_library_pop_up</span><span class="p">()</span>
        <span class="n">pkg_lib_window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pop_up_package_library</span>

        <span class="c1"># Opens the &quot;installation processes&quot; (from folder) pop up</span>
        <span class="n">folder_btn</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span>
            <span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="o">.</span><span class="n">layout</span><span class="p">()</span>
            <span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="o">.</span><span class="n">widget</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">folder_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

        <span class="c1"># Sets the folder to a non-existent file path</span>
        <span class="p">(</span>
            <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">pop_up_install_processes</span><span class="o">.</span><span class="n">path_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="n">mock_file_path</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Clicks on &quot;install package&quot; button of &quot;installation processes&quot; pup-up</span>
        <span class="n">instl_pkg_btn</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">pop_up_install_processes</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span>
            <span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
            <span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="o">.</span><span class="n">widget</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">instl_pkg_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>  <span class="c1"># Displays an error dialog box</span>

        <span class="c1"># Sets the folder to an existing file path</span>
        <span class="p">(</span>
            <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">pop_up_install_processes</span><span class="o">.</span><span class="n">path_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="n">mock_file_path</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Clicks on &quot;install package&quot; button of &quot;installation processes&quot; pup-up</span>
        <span class="n">instl_pkg_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>  <span class="c1"># Displays an error dialog box</span>

        <span class="c1"># Sets the folder to be a valid package</span>
        <span class="p">(</span>
            <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">pop_up_install_processes</span><span class="o">.</span><span class="n">path_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="n">mock_proc_fldr</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Clicks on &quot;install package&quot; button of &quot;installation processes&quot; pup-up</span>
        <span class="c1"># Displays an error dialog box since __init__.py raise ImportError</span>
        <span class="n">instl_pkg_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

        <span class="c1"># Make a proper &#39;__init__.py</span>
        <span class="n">init_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mock_proc_fldr</span><span class="p">,</span> <span class="s2">&quot;__init__.py&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">init_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;from .unit_test_1 import Unit_test_1&quot;</span><span class="p">)</span>
        <span class="n">init_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Clicks again on &quot;install package&quot; button</span>
        <span class="n">instl_pkg_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

        <span class="c1"># Closes the &quot;installation processes&quot; (from folder) pop up</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">pop_up_install_processes</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Apply changes, close the package library pop-up</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="c1"># Switches to the pipeline manager tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Adds the processes Rename, creates the &quot;rename_1&quot; node</span>
        <span class="n">ppl_edt_tab</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tab</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Rename</span><span class="p">)</span>

        <span class="c1"># Exports the mandatory input and output plugs for &quot;rename_1&quot;</span>
        <span class="n">ppl_edt_tab</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s2">&quot;rename_1&quot;</span>
        <span class="n">ppl_edt_tab</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tab</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="c1"># Saves the pipeline as the package &#39;Unit_test_pipeline&#39; in</span>
        <span class="c1"># User_processes</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span>
            <span class="s2">&quot;processes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;User_processes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;unit_test_pipeline.py&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">save_pipeline</span><span class="p">(</span><span class="n">ppl</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">updateProcessLibrary</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1"># Cleaning the process library in pipeline manager tab (deleting the</span>
        <span class="c1"># package added in this test, or old one still existing)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clean_uts_packages</span><span class="p">(</span><span class="n">proc_lib_view</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAMainWindow.test_package_library_dialog_del_pkg">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAMainWindow.test_package_library_dialog_del_pkg">[docs]</a>
    <span class="k">def</span> <span class="nf">test_package_library_dialog_del_pkg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new project folder, opens the processes library and</span>
<span class="sd">        deletes a package.</span>

<span class="sd">        - Tests: PackageLibraryDialog</span>

<span class="sd">        - Mocks:</span>
<span class="sd">            - QMessageBox.exec</span>
<span class="sd">            - QMessageBox.question</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">PKG</span> <span class="o">=</span> <span class="s2">&quot;nipype.interfaces.DataGrabber&quot;</span>

        <span class="c1"># Creates a new project folder and switches to it</span>
        <span class="n">new_proj_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">(</span><span class="n">light</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">new_proj_path</span><span class="p">,</span> <span class="s2">&quot;test_light_project&quot;</span><span class="p">)</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">ppl_edt_tab</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span>
        <span class="n">ppl</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        <span class="n">proc_lib_view</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">processLibrary</span><span class="o">.</span><span class="n">process_library</span>

        <span class="c1"># Takes the initial state of nipype proc_lib_view and makes sure that</span>
        <span class="c1"># PKG is already installed</span>

        <span class="n">init_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proclibview_nipype_state</span><span class="p">(</span><span class="n">proc_lib_view</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">init_state</span> <span class="o">!=</span> <span class="s2">&quot;process_enabled&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">package_library_pop_up</span><span class="p">()</span>
            <span class="n">pkg_lib_window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pop_up_package_library</span>
            <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">PKG</span><span class="p">)</span>
            <span class="p">(</span>
                <span class="n">ppl_manager</span><span class="o">.</span><span class="n">processLibrary</span><span class="o">.</span><span class="n">process_library</span><span class="o">.</span><span class="n">pkg_library</span><span class="o">.</span><span class="n">is_path</span>
            <span class="p">)</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># Clicks on add package</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;FSLOUTPUTTYPE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NIFTI&quot;</span>
            <span class="n">stdout_fileno</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">devnull</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">f</span>
            <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span>
                <span class="mi">3</span>
            <span class="p">]</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout_fileno</span>
            <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="c1"># Opens the package library pop-up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">package_library_pop_up</span><span class="p">()</span>
        <span class="n">pkg_lib_window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pop_up_package_library</span>

        <span class="c1"># Tries to delete PKG</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">PKG</span><span class="p">)</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span>
            <span class="mi">2</span>
        <span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>  <span class="c1"># Clicks on delete package</span>

        <span class="c1"># Resets the previous action</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">del_list</span><span class="o">.</span><span class="n">selectAll</span><span class="p">()</span>
        <span class="n">stdout_fileno</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">devnull</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">f</span>
        <span class="p">(</span>
            <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span>
            <span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="o">.</span><span class="n">layout</span><span class="p">()</span>
            <span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
            <span class="o">.</span><span class="n">widget</span><span class="p">()</span>
            <span class="o">.</span><span class="n">layout</span><span class="p">()</span>
            <span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="o">.</span><span class="n">widget</span><span class="p">()</span>
            <span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="p">)</span>  <span class="c1"># clicks on Reset</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout_fileno</span>

        <span class="c1"># Tries to delete again PKG</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span>
            <span class="mi">2</span>
        <span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>  <span class="c1"># Clicks on delete package</span>

        <span class="c1"># Close the package library pop-up</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>
        <span class="n">stdout_fileno</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">devnull</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">f</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Do not apply the modification</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout_fileno</span>

        <span class="c1"># Opens again the package library pop-up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">package_library_pop_up</span><span class="p">()</span>
        <span class="n">pkg_lib_window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pop_up_package_library</span>

        <span class="c1"># Tries to delete PKG</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">PKG</span><span class="p">)</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span>
            <span class="mi">2</span>
        <span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>  <span class="c1"># Clicks on delete package</span>

        <span class="c1"># Close the package library pop-up, apply changes for a package which</span>
        <span class="c1"># is part of nipype, the package is only removed.</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">)</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># Closes the warning message</span>

        <span class="c1"># Add again PKG</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">package_library_pop_up</span><span class="p">()</span>
        <span class="n">pkg_lib_window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pop_up_package_library</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">PKG</span><span class="p">)</span>
        <span class="n">stdout_fileno</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">devnull</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">f</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span>
            <span class="mi">0</span>
        <span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>  <span class="c1"># Clicks on add package</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout_fileno</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="c1"># Switches to the pipeline manager tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Selects the &#39;DataGrabber&#39; package in Pipeline Manager tab</span>
        <span class="n">pkg_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_item_by_data</span><span class="p">(</span><span class="n">proc_lib_view</span><span class="p">,</span> <span class="s2">&quot;DataGrabber&quot;</span><span class="p">)</span>
        <span class="p">(</span>
            <span class="n">proc_lib_view</span><span class="o">.</span><span class="n">selectionModel</span><span class="p">()</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="n">pkg_index</span><span class="p">,</span> <span class="n">QItemSelectionModel</span><span class="o">.</span><span class="n">SelectCurrent</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Tries to delete a package that cannot be deleted (is part of nipype),</span>
        <span class="c1"># selecting it and pressing the del key</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
        <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key_Delete</span>
        <span class="n">proc_lib_view</span><span class="o">.</span><span class="n">keyPressEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="n">proc_lib_view</span><span class="o">.</span><span class="n">pkg_library</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Tries to delete a package that cannot be deleted, calling the</span>
        <span class="c1"># function</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">delete_package</span><span class="p">()</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># Closes the warning message</span>

        <span class="c1"># Tries to delete a package corresponding to an empty string</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">delete_package</span><span class="p">()</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># Closes the warning message</span>

        <span class="c1"># Adds the processes Rename, creates the &quot;rename_1&quot; node</span>
        <span class="n">ppl_edt_tab</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tab</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Rename</span><span class="p">)</span>

        <span class="c1"># Exports the mandatory input and output plugs for &quot;rename_1&quot;</span>
        <span class="n">ppl_edt_tab</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s2">&quot;rename_1&quot;</span>
        <span class="n">ppl_edt_tab</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tab</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="c1"># Saves the pipeline as the package &#39;Unit_test_pipeline&#39; in</span>
        <span class="c1"># User_processes</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span>
            <span class="s2">&quot;processes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;User_processes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;unit_test_pipeline.py&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">save_pipeline</span><span class="p">(</span><span class="n">ppl</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">updateProcessLibrary</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1"># Makes a mocked process folder &quot;Mock_process&quot; in the temporary</span>
        <span class="c1"># project path</span>
        <span class="n">mock_proc_fldr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">new_proj_path</span><span class="p">,</span> <span class="s2">&quot;processes&quot;</span><span class="p">,</span> <span class="s2">&quot;UTs_processes&quot;</span>
        <span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">mock_proc_fldr</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span>
                <span class="s2">&quot;processes&quot;</span><span class="p">,</span>
                <span class="s2">&quot;User_processes&quot;</span><span class="p">,</span>
                <span class="s2">&quot;unit_test_pipeline.py&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span>
                    <span class="s2">&quot;processes&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;User_processes&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;unit_test_pipeline.py&quot;</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mock_proc_fldr</span><span class="p">,</span> <span class="s2">&quot;unit_test_2.py&quot;</span><span class="p">),</span>
            <span class="p">)</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mock_proc_fldr</span><span class="p">,</span> <span class="s2">&quot;unit_test_2.py&quot;</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">filedata</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">filedata</span> <span class="o">=</span> <span class="n">filedata</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                    <span class="s2">&quot;Unit_test_pipeline&quot;</span><span class="p">,</span> <span class="s2">&quot;Unit_test_2&quot;</span>
                <span class="p">)</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mock_proc_fldr</span><span class="p">,</span> <span class="s2">&quot;unit_test_2.py&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filedata</span><span class="p">)</span>

            <span class="n">init_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mock_proc_fldr</span><span class="p">,</span> <span class="s2">&quot;__init__.py&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="n">init_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;from .unit_test_2 import Unit_test_2&quot;</span><span class="p">)</span>
            <span class="n">init_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Imports the UTs_processes processes folder as a package</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">install_processes_pop_up</span><span class="p">()</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">pop_up_install_processes</span><span class="o">.</span><span class="n">path_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
            <span class="n">mock_proc_fldr</span>
        <span class="p">)</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span>
        <span class="p">(</span>
            <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">pop_up_install_processes</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span>
            <span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="o">.</span><span class="n">widget</span><span class="p">()</span>
            <span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">pop_up_install_processes</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="c1"># Gets the &#39;Unit_test_2&#39; index and selects it</span>
        <span class="n">test_ppl_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_item_by_data</span><span class="p">(</span><span class="n">proc_lib_view</span><span class="p">,</span> <span class="s2">&quot;Unit_test_2&quot;</span><span class="p">)</span>
        <span class="p">(</span>
            <span class="n">proc_lib_view</span><span class="o">.</span><span class="n">selectionModel</span><span class="p">()</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="n">test_ppl_index</span><span class="p">,</span> <span class="n">QItemSelectionModel</span><span class="o">.</span><span class="n">SelectCurrent</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Tries to delete the package &#39;Unit_test_2&#39;, rejects the</span>
        <span class="c1"># dialog box</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>
        <span class="n">proc_lib_view</span><span class="o">.</span><span class="n">keyPressEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="c1"># Effectively deletes the package &#39;Unit_test_2&#39;, accepting the</span>
        <span class="c1"># dialog box</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">)</span>
        <span class="n">proc_lib_view</span><span class="o">.</span><span class="n">keyPressEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="c1"># Resets the process library to its original state for nipype</span>
        <span class="n">cur_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proclibview_nipype_state</span><span class="p">(</span><span class="n">proc_lib_view</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cur_state</span> <span class="o">!=</span> <span class="n">init_state</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">proclibview_nipype_reset_state</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="p">,</span> <span class="n">ppl_manager</span><span class="p">,</span> <span class="n">init_state</span>
            <span class="p">)</span>

        <span class="c1"># Cleaning the process library in pipeline manager tab (deleting the</span>
        <span class="c1"># package added in this test, or old one still existing)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clean_uts_packages</span><span class="p">(</span><span class="n">proc_lib_view</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAMainWindow.test_package_library_dialog_rmv_pkg">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAMainWindow.test_package_library_dialog_rmv_pkg">[docs]</a>
    <span class="k">def</span> <span class="nf">test_package_library_dialog_rmv_pkg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new project folder, opens the processes library and</span>
<span class="sd">        removes a package. Also saves the current configuration.</span>

<span class="sd">        - Tests: PackageLibraryDialog</span>

<span class="sd">        - Mocks:</span>
<span class="sd">            - QMessageBox.exec</span>
<span class="sd">            - QMessageBox.exec_</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">PKG</span> <span class="o">=</span> <span class="s2">&quot;nipype.interfaces.DataGrabber&quot;</span>

        <span class="c1"># Creates a new project folder and switches to it</span>
        <span class="n">new_proj_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">(</span><span class="n">light</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">new_proj_path</span><span class="p">,</span> <span class="s2">&quot;test_light_project&quot;</span><span class="p">)</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">proc_lib_view</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">processLibrary</span><span class="o">.</span><span class="n">process_library</span>

        <span class="c1"># Takes the initial state of nipype proc_lib_view and makes sure that</span>
        <span class="c1"># PKG is already installed</span>
        <span class="n">init_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proclibview_nipype_state</span><span class="p">(</span><span class="n">proc_lib_view</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">init_state</span> <span class="o">!=</span> <span class="s2">&quot;process_enabled&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">package_library_pop_up</span><span class="p">()</span>
            <span class="n">pkg_lib_window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pop_up_package_library</span>
            <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">PKG</span><span class="p">)</span>
            <span class="p">(</span>
                <span class="n">ppl_manager</span><span class="o">.</span><span class="n">processLibrary</span><span class="o">.</span><span class="n">process_library</span><span class="o">.</span><span class="n">pkg_library</span><span class="o">.</span><span class="n">is_path</span>
            <span class="p">)</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># Clicks on add package</span>
            <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">()[</span>
                <span class="mi">3</span>
            <span class="p">]</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
            <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="c1"># Opens the package library pop-up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">package_library_pop_up</span><span class="p">()</span>
        <span class="n">pkg_lib_window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pop_up_package_library</span>

        <span class="c1"># Mocks the execution of a dialog box</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">None</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">exec_</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">None</span>

        <span class="c1"># Mocks deleting a package that is not specified</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">remove_package</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

        <span class="c1"># Tries removing a non-existent package</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">remove_package</span><span class="p">(</span><span class="s2">&quot;non_existent_package&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

        <span class="c1"># Clicks on the remove package button without selecting package</span>
        <span class="n">rmv_pkg_button</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span>
            <span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="o">.</span><span class="n">layout</span><span class="p">()</span>
            <span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span>
            <span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="o">.</span><span class="n">widget</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">rmv_pkg_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

        <span class="c1"># Writes the name of an existing package on the line edit and clicks on</span>
        <span class="c1"># the remove package button</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">PKG</span><span class="p">)</span>
        <span class="n">rmv_pkg_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

        <span class="c1"># Resets the previous action</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">remove_list</span><span class="o">.</span><span class="n">selectAll</span><span class="p">()</span>
        <span class="p">(</span>
            <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span>
            <span class="o">.</span><span class="n">children</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="o">.</span><span class="n">layout</span><span class="p">()</span>
            <span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="o">.</span><span class="n">widget</span><span class="p">()</span>
            <span class="o">.</span><span class="n">layout</span><span class="p">()</span>
            <span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="o">.</span><span class="n">widget</span><span class="p">()</span>
            <span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="c1"># Click again on the remove package button</span>
        <span class="n">rmv_pkg_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

        <span class="c1"># Apply changes</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="c1"># Mocks removing a package with text and from the tree</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">remove_dic</span><span class="p">[</span><span class="n">PKG</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">add_dic</span><span class="p">[</span><span class="n">PKG</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">delete_dic</span><span class="p">[</span><span class="n">PKG</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">remove_package_with_text</span><span class="p">(</span><span class="n">_2rem</span><span class="o">=</span><span class="n">PKG</span><span class="p">,</span> <span class="n">tree_remove</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Resets the process library to its original state for nipype</span>
        <span class="n">cur_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proclibview_nipype_state</span><span class="p">(</span><span class="n">proc_lib_view</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cur_state</span> <span class="o">!=</span> <span class="n">init_state</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">proclibview_nipype_reset_state</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="p">,</span> <span class="n">ppl_manager</span><span class="p">,</span> <span class="n">init_state</span>
            <span class="p">)</span>

        <span class="c1"># Saves the config to &#39;process_config.yml&#39;</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">processLibrary</span><span class="o">.</span><span class="n">save_config</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIAMainWindow.test_package_library_others">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAMainWindow.test_package_library_others">[docs]</a>
    <span class="k">def</span> <span class="nf">test_package_library_others</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new project folder, opens the processes library and</span>
<span class="sd">        adds a package.</span>

<span class="sd">        The package library object opens up as a pop-up when</span>
<span class="sd">        File &gt; Package library manager is clicked.</span>

<span class="sd">        - Tests: PackageLibraryDialog</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Creates a new project folder and switches to it</span>
        <span class="n">new_proj_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">(</span><span class="n">light</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">new_proj_path</span><span class="p">,</span> <span class="s2">&quot;test_light_project&quot;</span><span class="p">)</span>

        <span class="c1"># Opens the package library pop-up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">package_library_pop_up</span><span class="p">()</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">pkg_lib</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">processLibrary</span><span class="o">.</span><span class="n">pkg_library</span><span class="o">.</span><span class="n">package_library</span>
        <span class="n">pkg_lib_window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pop_up_package_library</span>

        <span class="c1"># Mocks the package tree</span>
        <span class="n">mock_pkg_tree</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;Double_rename&quot;</span><span class="p">:</span> <span class="s2">&quot;process_enabled&quot;</span><span class="p">},</span>
            <span class="p">[{</span><span class="s2">&quot;Double_rename&quot;</span><span class="p">:</span> <span class="s2">&quot;process_enabled&quot;</span><span class="p">}],</span>
            <span class="p">({</span><span class="s2">&quot;Double_rename&quot;</span><span class="p">:</span> <span class="s2">&quot;process_enabled&quot;</span><span class="p">}),</span>
        <span class="p">]</span>

        <span class="c1"># Mocks filling an item with the above item</span>
        <span class="n">pkg_lib</span><span class="o">.</span><span class="n">fill_item</span><span class="p">(</span><span class="n">pkg_lib</span><span class="o">.</span><span class="n">invisibleRootItem</span><span class="p">(),</span> <span class="n">mock_pkg_tree</span><span class="p">)</span>

        <span class="c1"># Closes the package library pop-up</span>
        <span class="n">pkg_lib_window</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIAMainWindow.test_popUpDeletedProject">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAMainWindow.test_popUpDeletedProject">[docs]</a>
    <span class="k">def</span> <span class="nf">test_popUpDeletedProject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a deleted projects to the projects list and launches mia.</span>

<span class="sd">        - Tests: PopUpDeletedProject.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Sets a projects save directory</span>
        <span class="c1"># config = Config()</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">projects_save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">,</span> <span class="s2">&quot;projects&quot;</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_projects_save_path</span><span class="p">(</span><span class="n">projects_save_path</span><span class="p">)</span>

        <span class="c1"># Mocks a project filepath that does not exist in the filesystem</span>
        <span class="c1"># Adds this filepath to &#39;saved_projects.yml&#39;</span>
        <span class="n">savedProjects</span> <span class="o">=</span> <span class="n">SavedProjects</span><span class="p">()</span>
        <span class="n">del_prjct</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">projects_save_path</span><span class="p">,</span> <span class="s2">&quot;missing_project&quot;</span><span class="p">)</span>
        <span class="n">savedProjects</span><span class="o">.</span><span class="n">addSavedProject</span><span class="p">(</span><span class="n">del_prjct</span><span class="p">)</span>

        <span class="c1"># Asserts that &#39;saved_projects.yml&#39; contains the filepath</span>
        <span class="c1"># FIXME: The following line does not seem to be supported by the</span>
        <span class="c1">#        appveyor version, while it works fine on my station...</span>
        <span class="c1">#        For now I comment ...</span>
        <span class="c1"># self.assertIn(del_prjct, savedProjects.loadSavedProjects()[&#39;paths&#39;])</span>

        <span class="c1"># Mocks the execution of a dialog box</span>
        <span class="n">PopUpDeletedProject</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>

        <span class="c1"># Adds code from the &#39;main.py&#39;, gets deleted projects</span>
        <span class="n">saved_projects_object</span> <span class="o">=</span> <span class="n">SavedProjects</span><span class="p">()</span>
        <span class="n">saved_projects_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">saved_projects_object</span><span class="o">.</span><span class="n">pathsList</span><span class="p">)</span>
        <span class="n">deleted_projects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">saved_project</span> <span class="ow">in</span> <span class="n">saved_projects_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">saved_project</span><span class="p">):</span>
                <span class="n">deleted_projects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">saved_project</span><span class="p">))</span>
                <span class="n">saved_projects_object</span><span class="o">.</span><span class="n">removeSavedProject</span><span class="p">(</span><span class="n">saved_project</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">deleted_projects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">deleted_projects</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">PopUpDeletedProject</span><span class="p">(</span><span class="n">deleted_projects</span><span class="p">)</span></div>


        <span class="c1"># Asserts that &#39;saved_projects.yml&#39; no longer contains it</span>
        <span class="c1"># FIXME: Since the previous FIXME, and comment, the following line is</span>
        <span class="c1">#        also commented</span>
        <span class="c1"># self.assertNotIn(del_prjct,</span>
        <span class="c1">#                  savedProjects.loadSavedProjects()[&#39;paths&#39;])</span>

<div class="viewcode-block" id="TestMIAMainWindow.test_popUpDeleteProject">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAMainWindow.test_popUpDeleteProject">[docs]</a>
    <span class="k">def</span> <span class="nf">test_popUpDeleteProject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new project and deletes it.</span>

<span class="sd">        Not to be confused with test_PopUpDeletedProject!</span>

<span class="sd">        - Tests:</span>
<span class="sd">            - MainWindow.delete_project</span>
<span class="sd">            - PopUpDeleteProject.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Gets a new project</span>
        <span class="n">test_proj_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">test_proj_path</span><span class="p">,</span> <span class="s2">&quot;test_project&quot;</span><span class="p">)</span>

        <span class="c1"># Instead of executing the pop-up, only shows it</span>
        <span class="c1"># This avoids thread deadlocking</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">self_</span><span class="p">:</span> <span class="n">self_</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># Resets the projects folder</span>
        <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span><span class="o">.</span><span class="n">set_projects_save_path</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Tries to delete a project without setting the projects folder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">delete_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>

        <span class="c1"># Sets a projects save directory</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">proj_save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">test_proj_path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_projects_save_path</span><span class="p">(</span><span class="n">proj_save_path</span><span class="p">)</span>

        <span class="c1"># Append &#39;test_proj_path&#39; to &#39;saved_projects.pathsList&#39; and</span>
        <span class="c1"># &#39;opened_projects&#39;, to increase coverage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">saved_projects</span><span class="o">.</span><span class="n">pathsList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">test_proj_path</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_opened_projects</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">test_proj_path</span><span class="p">)])</span>

        <span class="c1"># PopUpDeleteProject.exec = lambda self_: self_.show()</span>
        <span class="n">PopUpDeleteProject</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">self_</span><span class="p">:</span> <span class="kc">None</span>

        <span class="c1"># Deletes a project with the projects folder set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">delete_project</span><span class="p">()</span>

        <span class="n">exPopup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">exPopup</span>

        <span class="c1"># Checks the first project to be deleted</span>
        <span class="n">exPopup</span><span class="o">.</span><span class="n">check_boxes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Mocks the dialog box to directly return &#39;YesToAll&#39;</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">YesToAll</span><span class="p">)</span>
        <span class="n">exPopup</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIAMainWindow.test_see_all_projects">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAMainWindow.test_see_all_projects">[docs]</a>
    <span class="k">def</span> <span class="nf">test_see_all_projects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates 2 projects and tries to open them through the</span>
<span class="sd">        all projects pop-up.</span>

<span class="sd">        - Tests:</span>
<span class="sd">            - MainWindow.see_all_projects</span>
<span class="sd">            - PopUpSeeAllProjects</span>

<span class="sd">        - Mocks:</span>
<span class="sd">            - PopUpSeeAllProjects.exec</span>
<span class="sd">            - QMessageBox.exec</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">main_wnd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span>

        <span class="c1"># Creates 2 new project folders</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;project_8&quot;</span><span class="p">)</span>
        <span class="n">project_9_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;project_9&quot;</span><span class="p">)</span>

        <span class="c1"># Sets the projects save path</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_projects_save_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>

        <span class="c1"># Adds the projects to the &#39;pathsList&#39;</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">saved_projects</span><span class="o">.</span><span class="n">pathsList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">)</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">saved_projects</span><span class="o">.</span><span class="n">pathsList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">project_9_path</span><span class="p">)</span>

        <span class="c1"># Mocks the execution of &#39;PopUpSeeAllProjects&#39; and &#39;QMessageBox&#39;</span>
        <span class="n">PopUpSeeAllProjects</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">None</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">None</span>

        <span class="c1"># Deletes the folder containing the project 9</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">project_9_path</span><span class="p">)</span>

        <span class="c1"># Show the projects pop-up</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">see_all_projects</span><span class="p">()</span>

        <span class="n">item_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">exPopup</span><span class="o">.</span><span class="n">treeWidget</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">item_0</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">exPopup</span><span class="o">.</span><span class="n">treeWidget</span><span class="o">.</span><span class="n">itemBelow</span><span class="p">(</span><span class="n">item_0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;project_9&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Asserts that project 8 is not opened:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_opened_projects</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">project_8_path</span>
        <span class="p">)</span>

        <span class="c1"># Tries to open a project with no projects selected</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">exPopup</span><span class="o">.</span><span class="n">open_project</span><span class="p">()</span>

        <span class="c1"># Selects project 8, which was not deleted</span>
        <span class="n">item_0</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Opens project 8</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">exPopup</span><span class="o">.</span><span class="n">open_project</span><span class="p">()</span>

        <span class="c1"># Asserts that project 8 is now opened</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_opened_projects</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">project_8_path</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAMainWindow.test_software_preferences_pop_up">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAMainWindow.test_software_preferences_pop_up">[docs]</a>
    <span class="k">def</span> <span class="nf">test_software_preferences_pop_up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Opens the preferences pop up and changes parameters.</span>

<span class="sd">        - Tests:</span>
<span class="sd">            - MainWindow.software_preferences_pop_up</span>
<span class="sd">            - PopUpPreferences</span>

<span class="sd">        - Mocks</span>
<span class="sd">            - QFileDialog.getOpenFileName</span>
<span class="sd">            - QFileDialog.getExistingDirectory</span>
<span class="sd">            - QLineEdit.text</span>
<span class="sd">            - QDialog.exec</span>
<span class="sd">            - QMessageBox.exec</span>
<span class="sd">            - QPlainTextEdit.toPlainText</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">main_wnd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="n">main_wnd</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="c1"># Creates a new project folder and adds one document to the project</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span> <span class="o">=</span> <span class="n">project_8_path</span>

        <span class="c1"># Modification of some configuration parameters</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">setControlV1</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">setAutoSave</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_clinical_mode</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_use_fsl</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_use_afni</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_use_ants</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_use_mrtrix</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_mainwindow_size</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>

        <span class="c1"># Open and close the software preferences window</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">software_preferences_pop_up</span><span class="p">()</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Activate the V1 controller GUI and the user mode</span>
        <span class="n">config</span><span class="o">.</span><span class="n">setControlV1</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_user_mode</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Enables Matlab MCR</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_use_matlab_standalone</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Check that matlab MCR is selected</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">software_preferences_pop_up</span><span class="p">()</span>
        <span class="c1"># fmt: off</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">use_matlab_standalone_checkbox</span><span class="o">.</span>
            <span class="n">isChecked</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># fmt: on</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Enables Matlab</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_use_matlab</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Check that matlab is selected and matlab MCR not</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">software_preferences_pop_up</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">use_matlab_checkbox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># fmt: off</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">use_matlab_standalone_checkbox</span><span class="o">.</span>
            <span class="n">isChecked</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># fmt: on</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Enables SPM</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_use_spm</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Check that SPM and matlab are selected</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">software_preferences_pop_up</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">use_matlab_checkbox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">use_spm_checkbox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Enables SPM standalone</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_use_spm_standalone</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Check that SPM standalone and matlab MCR are selected,</span>
        <span class="c1"># SPM and matlab not</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">software_preferences_pop_up</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;Windows&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">platform</span><span class="o">.</span><span class="n">architecture</span><span class="p">()[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="c1"># fmt: off</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
                <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">use_matlab_standalone_checkbox</span><span class="o">.</span>
                <span class="n">isChecked</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
                <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">use_spm_standalone_checkbox</span><span class="o">.</span>
                <span class="n">isChecked</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="c1"># fmt: on</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span>
                <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">use_matlab_checkbox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span>
                <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">use_spm_checkbox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Mocks &#39;QFileDialog.getOpenFileName&#39; (returns an existing file)</span>
        <span class="c1"># This method returns a tuple (filename, file_types), where file_types</span>
        <span class="c1"># is the allowed file type (eg. &#39;All Files (*)&#39;)</span>
        <span class="n">mock_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="p">(</span><span class="n">mock_path</span><span class="p">,)</span>

        <span class="c1"># Mocks &#39;QFileDialog.getExistingDirectory&#39;</span>
        <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getExistingDirectory</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">mock_path</span>

        <span class="c1"># Open the software preferences window</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">software_preferences_pop_up</span><span class="p">()</span>

        <span class="c1"># Browses the FSL path</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">browse_fsl</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">fsl_choice</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="n">mock_path</span>
        <span class="p">)</span>

        <span class="c1"># Browses the AFNI path</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">browse_afni</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">afni_choice</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="n">mock_path</span>
        <span class="p">)</span>

        <span class="c1"># Browses the ANTS path</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">browse_ants</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ants_choice</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="n">mock_path</span>
        <span class="p">)</span>

        <span class="c1"># Browses the mrtrix path</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">browse_mrtrix</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">mrtrix_choice</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="n">mock_path</span>
        <span class="p">)</span>

        <span class="c1"># Browses the MATLAB path</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">browse_matlab</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">matlab_choice</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="n">mock_path</span>
        <span class="p">)</span>

        <span class="c1"># Browses the MATLAB MCR path</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">browse_matlab_standalone</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">matlab_standalone_choice</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
            <span class="n">mock_path</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Browses the SPM path</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">browse_spm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">spm_choice</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="n">mock_path</span>
        <span class="p">)</span>

        <span class="c1"># Browses the SPM Standalone path</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">browse_spm_standalone</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">spm_standalone_choice</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="n">mock_path</span>
        <span class="p">)</span>

        <span class="c1"># Browses the MriConv path</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">browse_mri_conv_path</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">mri_conv_path_line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
            <span class="n">mock_path</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Browser the projects save path</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">browse_projects_save_path</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">projects_save_path_line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
            <span class="n">mock_path</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Sets the admin password to be &#39;mock_admin_password&#39;</span>
        <span class="n">admin_password</span> <span class="o">=</span> <span class="s2">&quot;mock_admin_password&quot;</span>
        <span class="n">old_psswd</span> <span class="o">=</span> <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">salt</span> <span class="o">+</span> <span class="n">admin_password</span>
        <span class="n">hash_psswd</span> <span class="o">=</span> <span class="n">sha256</span><span class="p">(</span><span class="n">old_psswd</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_admin_hash</span><span class="p">(</span><span class="n">hash_psswd</span><span class="p">)</span>

        <span class="c1"># Calls &#39;admin_mode_switch&#39; without checking the box</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">admin_mode_switch</span><span class="p">()</span>

        <span class="c1"># Calls &#39;admin_mode_switch&#39;, mocking the execution of &#39;QInputDialog&#39;</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">admin_mode_checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">QInputDialog</span><span class="o">.</span><span class="n">getText</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">admin_mode_switch</span><span class="p">()</span>

        <span class="c1"># Tries to activate admin mode with the wrong password</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">admin_mode_checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">QInputDialog</span><span class="o">.</span><span class="n">getText</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="p">(</span>
            <span class="s2">&quot;mock_wrong_password&quot;</span><span class="p">,</span>
            <span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">admin_mode_switch</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">change_psswd</span><span class="o">.</span><span class="n">isVisible</span><span class="p">())</span>

        <span class="c1"># Activates admin mode with the correct password</span>
        <span class="n">QInputDialog</span><span class="o">.</span><span class="n">getText</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="p">(</span><span class="n">admin_password</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">admin_mode_checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">admin_mode_switch</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">change_psswd</span><span class="o">.</span><span class="n">isVisible</span><span class="p">())</span>

        <span class="c1"># Mocks the old passwd text field to be &#39;mock_admin_password&#39;</span>
        <span class="c1"># (and the other textfields too!)</span>
        <span class="c1"># QLineEdit.text = lambda x: admin_password</span>

        <span class="c1"># Changes the admin password</span>
        <span class="n">QDialog</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">False</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">change_admin_psswd</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="c1"># QDialog.exec = lambda x: True</span>
        <span class="c1"># main_wnd.pop_up_preferences.change_admin_psswd(&#39;&#39;)</span>

        <span class="c1"># Shows a wrong path pop-up message</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">wrong_path</span><span class="p">(</span>
            <span class="s2">&quot;/mock_path&quot;</span><span class="p">,</span> <span class="s2">&quot;mock_tool&quot;</span><span class="p">,</span> <span class="n">extra_mess</span><span class="o">=</span><span class="s2">&quot;mock_msg&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">icon</span><span class="p">(),</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Critical</span>
        <span class="p">)</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Sets the main window size</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">use_current_mainwindow_size</span><span class="p">(</span><span class="n">main_wnd</span><span class="p">)</span>

        <span class="c1"># Mocks the click of the OK button on &#39;QMessageBox.exec&#39;</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span>

        <span class="c1"># Programs the controller version to change to V1</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">control_checkbox_toggled</span><span class="p">(</span><span class="n">main_wnd</span><span class="p">)</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">control_checkbox_changed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">main_wnd</span><span class="o">.</span><span class="n">get_controller_version</span><span class="p">())</span>

        <span class="c1"># Cancels the above change</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">control_checkbox_toggled</span><span class="p">(</span><span class="n">main_wnd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">main_wnd</span><span class="o">.</span><span class="n">get_controller_version</span><span class="p">())</span>

        <span class="c1"># Edits the Capsul config file</span>
        <span class="c1"># QDialog.exec = lambda x: False</span>
        <span class="c1"># capsul_engine.load = lambda x: True</span>
        <span class="c1"># main_wnd.pop_up_preferences.edit_capsul_config()</span>

        <span class="c1"># Mocks an exception in the QDialog execution</span>
        <span class="c1"># exc_1 = lambda x: (_ for _ in ()).throw(Exception(&#39;mock exception&#39;))</span>
        <span class="c1"># QDialog.exec = exc_1</span>
        <span class="c1"># main_wnd.pop_up_preferences.edit_capsul_config()</span>

        <span class="c1"># Mocks an exception in the &#39;set_capsul_config&#39; call</span>
        <span class="c1"># QDialog.exec = lambda x: True</span>
        <span class="c1"># exc_2 = lambda x, y: (_ for _ in ()).throw(Exception(</span>
        <span class="c1">#                                            &#39;mock exception&#39;))</span>
        <span class="c1"># Config.set_capsul_config = exc_2</span>
        <span class="c1"># main_wnd.pop_up_preferences.edit_capsul_config()</span>
        <span class="c1"># FIXME: failing in MacOS build</span>

        <span class="c1"># Close the software preferences window</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIAMainWindow.test_software_preferences_pop_up_config_file">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAMainWindow.test_software_preferences_pop_up_config_file">[docs]</a>
    <span class="k">def</span> <span class="nf">test_software_preferences_pop_up_config_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Opens the preferences pop up and changes parameters to edit the</span>
<span class="sd">        config file and capsul config file.</span>

<span class="sd">        -Tests:</span>
<span class="sd">            - PopUpPreferences.edit_config_file</span>
<span class="sd">            - PopUpPreferences.findChar</span>
<span class="sd">            - PopUpPreferences.edit_capsul_config</span>

<span class="sd">        - Mocks</span>
<span class="sd">            - Config.set_capsul_config</span>
<span class="sd">            - QDialog.exec</span>
<span class="sd">            - SettingsEditor.update_gui</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">main_wnd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span>

        <span class="c1"># Mocks the execution of &#39;PopUpPreferences&#39; to speed up the test</span>
        <span class="c1"># PopUpPreferences.show = lambda x: None</span>

        <span class="n">main_wnd</span><span class="o">.</span><span class="n">software_preferences_pop_up</span><span class="p">()</span>

        <span class="c1"># Tries to edit the config file, mocks failure in &#39;QDialog.exec&#39;</span>
        <span class="n">QDialog</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">False</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">edit_config_file</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="p">,</span> <span class="s2">&quot;editConf&quot;</span><span class="p">))</span>

        <span class="c1"># Mocks the execution to change &#39;user_mode&#39; from &#39;false&#39; to &#39;true&#39;</span>
        <span class="k">def</span> <span class="nf">mock_exec</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;blabla&quot;&quot;&quot;</span>
            <span class="n">config_file</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">editConf</span><span class="o">.</span><span class="n">txt</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">config_file</span> <span class="o">=</span> <span class="n">config_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="s2">&quot;user_mode: false&quot;</span><span class="p">,</span> <span class="s2">&quot;user_mode: true&quot;</span>
            <span class="p">)</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">editConf</span><span class="o">.</span><span class="n">txt</span><span class="o">.</span><span class="n">setPlainText</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="n">QDialog</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="n">mock_exec</span>

        <span class="c1"># Asserts that the &#39;Config&#39; object was updated</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">edit_config_file</span><span class="p">()</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_user_mode</span><span class="p">())</span>

        <span class="c1"># Tries to find an empty string of characters in the config file</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">findChar</span><span class="p">()</span>

        <span class="c1"># Highlights the string &#39;user_mode&#39; in the config file</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">findChar_line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;user_mode&quot;</span><span class="p">)</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">findChar</span><span class="p">()</span>

        <span class="c1"># Mocks the execution of a &#39;capsul&#39; method</span>
        <span class="n">SettingsEditor</span><span class="o">.</span><span class="n">update_gui</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">None</span>
        <span class="c1"># This fixes the Mac OS build</span>

        <span class="c1"># Mocks the execution of a &#39;QDialog&#39;</span>
        <span class="n">QDialog</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">True</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">edit_capsul_config</span><span class="p">()</span>

        <span class="n">Config</span><span class="o">.</span><span class="n">set_capsul_config</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">_</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="p">())</span><span class="o">.</span><span class="n">throw</span><span class="p">(</span>
            <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;mock_except&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">edit_capsul_config</span><span class="p">()</span>

        <span class="n">QDialog</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">_</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="p">())</span><span class="o">.</span><span class="n">throw</span><span class="p">(</span>
            <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;mock_except&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">edit_capsul_config</span><span class="p">()</span>

        <span class="n">QDialog</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">False</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">edit_capsul_config</span><span class="p">()</span>

        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIAMainWindow.test_software_preferences_pop_up_modules_config">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAMainWindow.test_software_preferences_pop_up_modules_config">[docs]</a>
    <span class="k">def</span> <span class="nf">test_software_preferences_pop_up_modules_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Opens the preferences pop up and sets the configuration of modules.</span>

<span class="sd">        For AFNI, ANTS, FSL, SPM, mrtrix and MATLAB.</span>

<span class="sd">        -Tests: PopUpPreferences.validate_and_save</span>

<span class="sd">        - Mocks:</span>
<span class="sd">            - PopUpPreferences.show</span>
<span class="sd">            - QMessageBox.show</span>
<span class="sd">            - QLineEdit.text</span>
<span class="sd">            - QDialog.exec</span>
<span class="sd">            - QMessageBox.exec</span>
<span class="sd">            - QPlainTextEdit.toPlainText</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">main_wnd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span>

        <span class="c1"># Mocks the execution of &#39;PopUpPreferences&#39; to speed up the test</span>
        <span class="c1"># PopUpPreferences.show = lambda x: None</span>

        <span class="c1"># Mocks &#39;QMessageBox.show&#39;</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">show</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">None</span>

        <span class="n">tmp_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span>

        <span class="c1"># Temporary solution that allows test only on Linux and MacOS</span>
        <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Windows&quot;</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Mocks executables to be used as the afni, ants, mrtrix, fslm, matlab</span>
        <span class="c1"># and spm cmds</span>
        <span class="k">def</span> <span class="nf">mock_executable</span><span class="p">(</span>
            <span class="n">exc_dir</span><span class="p">,</span>
            <span class="n">exc_name</span><span class="p">,</span>
            <span class="n">failing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">output</span><span class="o">=</span><span class="s2">&quot;mock executable&quot;</span><span class="p">,</span>
            <span class="n">err_msg</span><span class="o">=</span><span class="s2">&quot;mock_error&quot;</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Creates a working or failing mocked executable, optionally</span>
<span class="sd">            setting the output and error messages,</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">system</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s2">&quot;Linux&quot;</span><span class="p">:</span>
                <span class="n">exc_content</span> <span class="o">=</span> <span class="s1">&#39;#!/bin/bash</span><span class="se">\n</span><span class="s1">echo &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">failing</span><span class="p">:</span>
                    <span class="n">exc_content</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">echo &quot;</span><span class="si">{}</span><span class="s1">&quot; 1&gt;&amp;2</span><span class="se">\n</span><span class="s1">exit 1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
                <span class="n">exc_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">exc_dir</span><span class="p">,</span> <span class="n">exc_name</span><span class="p">)</span>
                <span class="n">exc</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">exc_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
                <span class="n">exc</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">exc_content</span><span class="p">)</span>
                <span class="n">exc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;chmod&quot;</span><span class="p">,</span> <span class="s2">&quot;+x&quot;</span><span class="p">,</span> <span class="n">exc_path</span><span class="p">])</span>

            <span class="k">elif</span> <span class="n">system</span> <span class="o">==</span> <span class="s2">&quot;Darwin&quot;</span><span class="p">:</span>
                <span class="n">exc_content</span> <span class="o">=</span> <span class="s1">&#39;#!/usr/bin/env bash</span><span class="se">\n</span><span class="s1">echo &quot;mock executable&quot;&#39;</span>
                <span class="k">if</span> <span class="n">failing</span><span class="p">:</span>
                    <span class="n">exc_content</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">echo &quot;</span><span class="si">{}</span><span class="s1">&quot; 1&gt;&amp;2</span><span class="se">\n</span><span class="s1">exit 1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
                <span class="n">exc_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">exc_dir</span><span class="p">,</span> <span class="n">exc_name</span><span class="p">)</span>
                <span class="n">exc</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">exc_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
                <span class="n">exc</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">exc_content</span><span class="p">)</span>
                <span class="n">exc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;chmod&quot;</span><span class="p">,</span> <span class="s2">&quot;+x&quot;</span><span class="p">,</span> <span class="n">exc_path</span><span class="p">])</span>

            <span class="k">elif</span> <span class="n">system</span> <span class="o">==</span> <span class="s2">&quot;Windows&quot;</span><span class="p">:</span>
                <span class="k">pass</span>
                <span class="c1"># TODO: build mocked executable for Windows</span>

        <span class="c1"># Segment module testing into functions to improve readability</span>
        <span class="c1"># of the code</span>

        <span class="k">def</span> <span class="nf">test_afni_config</span><span class="p">():</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Tests the AFNI configuration.&quot;&quot;&quot;</span>

            <span class="n">main_wnd</span><span class="o">.</span><span class="n">software_preferences_pop_up</span><span class="p">()</span>  <span class="c1"># Reopens the window</span>

            <span class="c1"># Enables AFNI</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">use_afni_checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Sets a directory that does not exist</span>
            <span class="p">(</span>
                <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">afni_choice</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span> <span class="o">+</span> <span class="s2">&quot;mock&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Opens error dialog</span>

            <span class="c1"># Sets a directory that does not contain the AFNI cmd</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">afni_choice</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Opens error dialog</span>

            <span class="c1"># Asserts that AFNI is disabled in the &#39;config&#39; object</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_use_afni</span><span class="p">())</span>

            <span class="c1"># Sets the path to the AFNI to &#39;tmp_path&#39;</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">afni_choice</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>

            <span class="n">mock_executable</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;afni&quot;</span><span class="p">,</span> <span class="n">failing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Opens error dialog</span>

            <span class="n">mock_executable</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;afni&quot;</span><span class="p">)</span>
            <span class="c1"># main_wnd.pop_up_preferences.ok_clicked()  # Closes the window</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># Closes the window</span>

            <span class="c1"># Disables AFNI</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
            <span class="n">config</span><span class="o">.</span><span class="n">set_use_afni</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">config</span><span class="o">.</span><span class="n">set_afni_path</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">test_ants_config</span><span class="p">():</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Tests the ANTS configuration.&quot;&quot;&quot;</span>

            <span class="n">main_wnd</span><span class="o">.</span><span class="n">software_preferences_pop_up</span><span class="p">()</span>  <span class="c1"># Reopens the window</span>

            <span class="c1"># Enables ANTS</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">use_ants_checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Sets a directory that does not exist</span>
            <span class="p">(</span>
                <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ants_choice</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span> <span class="o">+</span> <span class="s2">&quot;mock&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Opens error dialog</span>

            <span class="c1"># Sets a directory that does not contain the ANTS cmd</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ants_choice</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Opens error dialog</span>

            <span class="c1"># Asserts that ANTS is disabled in the &#39;config&#39; object</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_use_ants</span><span class="p">())</span>

            <span class="c1"># Sets the path to the AFNI to &#39;tmp_path&#39;</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">afni_choice</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>

            <span class="n">mock_executable</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;SmoothImage&quot;</span><span class="p">,</span> <span class="n">failing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Opens error dialog</span>

            <span class="n">mock_executable</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;SmoothImage&quot;</span><span class="p">)</span>
            <span class="c1"># main_wnd.pop_up_preferences.ok_clicked()  # Closes the window</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># Closes the window</span>

            <span class="c1"># Disables ANTS</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
            <span class="n">config</span><span class="o">.</span><span class="n">set_use_ants</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">config</span><span class="o">.</span><span class="n">set_ants_path</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">test_fsl_config</span><span class="p">():</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Tests the FSL configuration.&quot;&quot;&quot;</span>

            <span class="n">main_wnd</span><span class="o">.</span><span class="n">software_preferences_pop_up</span><span class="p">()</span>  <span class="c1"># Reopens the window</span>

            <span class="c1"># Enables FSL</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">use_fsl_checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Does not set a directory for FSL</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

            <span class="c1"># Sets paths to the bin and parent directory folders</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">fsl_choice</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;etc&quot;</span><span class="p">,</span> <span class="s2">&quot;fslconf&quot;</span><span class="p">,</span> <span class="s2">&quot;bin&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Opens error dialog</span>

            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">fsl_choice</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;etc&quot;</span><span class="p">,</span> <span class="s2">&quot;fslconf&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Opens error dialog</span>

            <span class="c1"># Sets a directory that does not contain the FSL cmd</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">fsl_choice</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Opens error dialog</span>

            <span class="c1"># Asserts that FSL is disabled in the &#39;config&#39; object</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_use_fsl</span><span class="p">())</span>

            <span class="c1"># Sets the path to the FSL to &#39;tmp_path&#39;</span>
            <span class="n">fsl_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;bin&quot;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">fsl_path</span><span class="p">)</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">fsl_choice</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">fsl_path</span><span class="p">)</span>

            <span class="n">mock_executable</span><span class="p">(</span><span class="n">fsl_path</span><span class="p">,</span> <span class="s2">&quot;flirt&quot;</span><span class="p">,</span> <span class="n">failing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Opens error dialog</span>

            <span class="n">mock_executable</span><span class="p">(</span><span class="n">fsl_path</span><span class="p">,</span> <span class="s2">&quot;flirt&quot;</span><span class="p">)</span>
            <span class="c1"># main_wnd.pop_up_preferences.ok_clicked()  # Closes the window</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># Closes the window</span>

            <span class="c1"># Disables FSL</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
            <span class="n">config</span><span class="o">.</span><span class="n">set_use_fsl</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">config</span><span class="o">.</span><span class="n">set_fsl_config</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">test_mrtrix_config</span><span class="p">():</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Tests the mrtrix configuration.&quot;&quot;&quot;</span>

            <span class="n">main_wnd</span><span class="o">.</span><span class="n">software_preferences_pop_up</span><span class="p">()</span>  <span class="c1"># Reopens the window</span>

            <span class="c1"># Enables mrtrix</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">use_mrtrix_checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Sets a directory that does not exist</span>
            <span class="p">(</span>
                <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">mrtrix_choice</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span> <span class="o">+</span> <span class="s2">&quot;mock&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Opens error dialog</span>

            <span class="c1"># Sets a directory that does not contain the mrtrix cmd</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">mrtrix_choice</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Opens error dialog</span>

            <span class="c1"># Asserts that mrtrix is disabled in the &#39;config&#39; object</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_use_mrtrix</span><span class="p">())</span>

            <span class="c1"># Sets the path to the mrtrix to &#39;tmp_path&#39;</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">mrtrix_choice</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>

            <span class="n">mock_executable</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;mrinfo&quot;</span><span class="p">,</span> <span class="n">failing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Opens error dialog</span>

            <span class="n">mock_executable</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;mrinfo&quot;</span><span class="p">)</span>
            <span class="c1"># main_wnd.pop_up_preferences.ok_clicked()  # Closes the window</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># Closes the window</span>

            <span class="c1"># Disables mrtrix</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
            <span class="n">config</span><span class="o">.</span><span class="n">set_use_mrtrix</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">config</span><span class="o">.</span><span class="n">set_mrtrix_path</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">test_spm_matlab_config</span><span class="p">():</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Tests the SPM and MATLAB (licence) configuration.&quot;&quot;&quot;</span>

            <span class="n">main_wnd</span><span class="o">.</span><span class="n">software_preferences_pop_up</span><span class="p">()</span>  <span class="c1"># Reopens the window</span>

            <span class="c1"># Enables SPM</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">use_spm_checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Sets a MATLAB executable path that does not exists</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">matlab_choice</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;matlab&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Opens error dialog</span>

            <span class="c1"># Creates a failing MATLAB executable</span>
            <span class="n">mock_executable</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;matlab&quot;</span><span class="p">,</span> <span class="n">failing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Sets the same MATLAB directory in the preferences window and</span>
            <span class="c1"># in the config object</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
            <span class="n">config</span><span class="o">.</span><span class="n">set_matlab_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;matlab&quot;</span><span class="p">))</span>
            <span class="c1"># main_wnd.pop_up_preferences.ok_clicked() # Opens error dialog</span>

            <span class="c1"># Also sets the same SPM directory in the preferences window and</span>
            <span class="c1"># in the config object, and a &#39;tmp_path&#39; as the MATLAB directory</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
            <span class="n">config</span><span class="o">.</span><span class="n">set_spm_path</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">spm_choice</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Closes the window</span>

            <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_use_spm</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_use_matlab</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_use_matlab_standalone</span><span class="p">())</span>
            <span class="c1"># Case where both MATLAB and SPM applications are used</span>

            <span class="n">main_wnd</span><span class="o">.</span><span class="n">software_preferences_pop_up</span><span class="p">()</span>  <span class="c1"># Reopens the window</span>

            <span class="c1"># Resets the MATLAB executable path</span>
            <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span><span class="o">.</span><span class="n">set_matlab_path</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Opens error dialog</span>

            <span class="c1"># Creates a working MATLAB executable</span>
            <span class="n">mock_executable</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;matlab&quot;</span><span class="p">)</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Closes the window</span>

            <span class="n">main_wnd</span><span class="o">.</span><span class="n">software_preferences_pop_up</span><span class="p">()</span>  <span class="c1"># Reopens the window</span>

            <span class="c1"># Restricts the permission on the MATLAB executable to induce</span>
            <span class="c1"># an exception on &#39;subprocess.Popen&#39;</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;chmod&quot;</span><span class="p">,</span> <span class="s2">&quot;-x&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;matlab&quot;</span><span class="p">)])</span>

            <span class="c1"># Resets the MATLAB executable path (which was set by the last</span>
            <span class="c1"># call on &#39;ok_clicked&#39;)</span>
            <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span><span class="o">.</span><span class="n">set_matlab_path</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Opens error dialog</span>

            <span class="c1"># Case where SPM directory is not valid</span>
            <span class="p">(</span>
                <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">spm_choice</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;not_existing&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># main_wnd.pop_up_preferences.ok_clicked()  # Opens error dialog</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># Closes the window</span>

            <span class="c1"># Disables MATLAB and SPM</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
            <span class="n">config</span><span class="o">.</span><span class="n">set_use_matlab</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">config</span><span class="o">.</span><span class="n">set_use_spm</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">config</span><span class="o">.</span><span class="n">set_spm_path</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">config</span><span class="o">.</span><span class="n">set_matlab_path</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">test_matlab_config</span><span class="p">():</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Tests the MATLAB (license) configuration.&quot;&quot;&quot;</span>

            <span class="n">main_wnd</span><span class="o">.</span><span class="n">software_preferences_pop_up</span><span class="p">()</span>  <span class="c1"># Reopens the window</span>

            <span class="c1"># Sets the projects folder for the preferences window to close</span>
            <span class="c1"># when pressing on &#39;OK&#39;</span>
            <span class="c1"># fmt: off</span>
            <span class="p">(</span>
                <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">projects_save_path_line_edit</span><span class="o">.</span>
                <span class="n">setText</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># fmt: on</span>

            <span class="c1"># Enables MATLAB</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">use_matlab_checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Sets the same MATLAB directory on both the preferences</span>
            <span class="c1"># window and &#39;config&#39; object</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">matlab_choice</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>
            <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span><span class="o">.</span><span class="n">set_matlab_path</span><span class="p">(</span>
                <span class="n">tmp_path</span>
            <span class="p">)</span>

            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Closes the window</span>

            <span class="c1"># Asserts that MATLAB was enabled and MATLAB standalone</span>
            <span class="c1"># remains disabled</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_use_matlab</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_use_matlab_standalone</span><span class="p">())</span>

            <span class="n">main_wnd</span><span class="o">.</span><span class="n">software_preferences_pop_up</span><span class="p">()</span>  <span class="c1"># Reopens the window</span>

            <span class="c1"># Resets the &#39;config&#39; object</span>
            <span class="n">config</span><span class="o">.</span><span class="n">set_use_matlab</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Resets the MATLAB directory</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">matlab_choice</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Opens error dialog</span>

            <span class="c1"># Creates a failing MATLAB executable</span>
            <span class="n">mock_executable</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;matlab&quot;</span><span class="p">,</span> <span class="n">failing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Sets the MATLAB directory to this executable</span>
            <span class="p">(</span>
                <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">matlab_choice</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;matlab&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Opens error dialog</span>

            <span class="c1"># Restricts the permission required to run the MATLAB</span>
            <span class="c1"># executable to induce an exception on &#39;subprocess.Popen&#39;</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;chmod&quot;</span><span class="p">,</span> <span class="s2">&quot;-x&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;matlab&quot;</span><span class="p">)])</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Opens error dialog</span>

            <span class="c1"># Asserts that MATLAB was still not enabled</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_use_matlab</span><span class="p">())</span>

            <span class="c1"># Creates a working MATLAB executable</span>
            <span class="n">mock_executable</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;matlab&quot;</span><span class="p">)</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Closes window</span>
            <span class="c1"># main_wnd.pop_up_preferences.close()  # Closes the window</span>

            <span class="c1"># Asserts that MATLAB was enabled and MATLAB standalone</span>
            <span class="c1"># remains disabled</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_use_matlab</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_use_matlab_standalone</span><span class="p">())</span>

            <span class="c1"># Disables MATLAB and SPM</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
            <span class="n">config</span><span class="o">.</span><span class="n">set_use_matlab</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">config</span><span class="o">.</span><span class="n">set_matlab_path</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">test_matlab_mcr_spm_standalone</span><span class="p">():</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Tests the Matlab MCR and SPM standalone configuration&quot;&quot;&quot;</span>

            <span class="n">main_wnd</span><span class="o">.</span><span class="n">software_preferences_pop_up</span><span class="p">()</span>  <span class="c1"># Opens the window</span>

            <span class="c1"># Sets the projects folder for the preferences window to close</span>
            <span class="c1"># when pressing on &#39;OK&#39;</span>
            <span class="c1"># fmt: off</span>
            <span class="p">(</span>
                <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">projects_save_path_line_edit</span><span class="o">.</span>
                <span class="n">setText</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># fmt: on</span>

            <span class="c1"># Enables SPM standalone</span>
            <span class="c1"># fmt: off</span>
            <span class="p">(</span>
                <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">use_spm_standalone_checkbox</span><span class="o">.</span>
                <span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># fmt: on</span>

            <span class="c1"># Failing configurations for SPM standalone + MATLAB MCR</span>

            <span class="c1"># Sets a non-existing directory for MATLAB MCR</span>
            <span class="p">(</span>
                <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">matlab_standalone_choice</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;non_existing&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Opens error message</span>

            <span class="c1"># Sets an existing directory for MATLAB MCR, non-existing</span>
            <span class="c1"># directory for SPM standalone</span>
            <span class="p">(</span>
                <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">matlab_standalone_choice</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                    <span class="n">tmp_path</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="p">(</span>
                <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">spm_standalone_choice</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;non_existing&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Opens error dialog</span>

            <span class="c1"># Sets existing directories for both MATLAB MCR and SPM</span>
            <span class="c1"># standalone</span>
            <span class="p">(</span>
                <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">spm_standalone_choice</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                    <span class="n">tmp_path</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Opens error dialog</span>

            <span class="c1"># Does not find a SPM standalone executable</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Opens error dialog</span>

            <span class="c1"># Creates a failing SPM standalone executable</span>
            <span class="n">mock_executable</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;run_spm.sh&quot;</span><span class="p">,</span> <span class="n">failing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Opens error dialog</span>

            <span class="n">mock_executable</span><span class="p">(</span>
                <span class="n">tmp_path</span><span class="p">,</span>
                <span class="s2">&quot;run_spm.sh&quot;</span><span class="p">,</span>
                <span class="n">failing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">err_msg</span><span class="o">=</span><span class="s2">&quot;shared libraries&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Opens error dialog</span>

            <span class="c1"># Restricts the permission required to run the MATLAB</span>
            <span class="c1"># executable to induce an exception on &#39;subprocess.Popen&#39;</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;chmod&quot;</span><span class="p">,</span> <span class="s2">&quot;-x&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;run_spm.sh&quot;</span><span class="p">)]</span>
            <span class="p">)</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Opens error dialog</span>

            <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_use_spm_standalone</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_use_matlab_standalone</span><span class="p">())</span>

            <span class="c1"># Passing configurations for SPM standalone + MATLAB MCR</span>

            <span class="c1"># Creates an SPM standalone executable that throws a non-critical</span>
            <span class="c1"># error</span>
            <span class="n">mock_executable</span><span class="p">(</span>
                <span class="n">tmp_path</span><span class="p">,</span>
                <span class="s2">&quot;run_spm.sh&quot;</span><span class="p">,</span>
                <span class="n">failing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="s2">&quot;_ _ version (standalone)&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Closes window</span>

            <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
            <span class="c1"># FIXME: the following lines makes, only with macos build:</span>
            <span class="c1">#        &#39;AssertionError: False is not true&#39;. Commented.</span>
            <span class="c1"># self.assertTrue(config.get_use_spm_standalone())</span>
            <span class="c1"># self.assertTrue(config.get_use_matlab_standalone())</span>

            <span class="c1"># Resets the &#39;config&#39; object</span>
            <span class="n">config</span><span class="o">.</span><span class="n">set_spm_standalone_path</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">config</span><span class="o">.</span><span class="n">set_use_spm_standalone</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">config</span><span class="o">.</span><span class="n">set_use_matlab_standalone</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="n">main_wnd</span><span class="o">.</span><span class="n">software_preferences_pop_up</span><span class="p">()</span>  <span class="c1"># Opens the window</span>
            <span class="c1"># fmt: off</span>
            <span class="p">(</span>
                <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">use_spm_standalone_checkbox</span><span class="o">.</span>
                <span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># fmt: on</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">spm_standalone_choice</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>

            <span class="n">mock_executable</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;run_spm.sh&quot;</span><span class="p">)</span>

            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Closes the window</span>

            <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
            <span class="c1"># FIXME: the following lines makes, only with macos build:</span>
            <span class="c1">#        &#39;AssertionError: False is not true&#39;. Commented.</span>
            <span class="c1"># self.assertTrue(config.get_use_spm_standalone())</span>
            <span class="c1"># self.assertTrue(config.get_use_matlab_standalone())</span>

            <span class="c1"># Resets the &#39;config&#39; object</span>
            <span class="n">config</span><span class="o">.</span><span class="n">set_use_spm_standalone</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">config</span><span class="o">.</span><span class="n">set_use_matlab_standalone</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="n">main_wnd</span><span class="o">.</span><span class="n">software_preferences_pop_up</span><span class="p">()</span>  <span class="c1"># Opens the window</span>
            <span class="c1"># fmt: off</span>
            <span class="p">(</span>
                <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">use_spm_standalone_checkbox</span><span class="o">.</span>
                <span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># fmt: on</span>

            <span class="c1"># The same MATLAB directory is already the same on both the</span>
            <span class="c1"># preferences window and &#39;config&#39; object, same for SPM</span>
            <span class="c1"># standalone</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>  <span class="c1"># Closes the window</span>

            <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
            <span class="c1"># FIXME: the following lines makes, only with macos build:</span>
            <span class="c1">#        &#39;AssertionError: False is not true&#39;. Commented.</span>
            <span class="c1"># self.assertTrue(config.get_use_spm_standalone())</span>
            <span class="c1"># self.assertTrue(config.get_use_matlab_standalone())</span>

        <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span><span class="o">.</span><span class="n">set_projects_save_path</span><span class="p">(</span>
            <span class="n">tmp_path</span>
        <span class="p">)</span>

        <span class="c1"># Test the configuration modules AFNI, ANTS, FSL, mrtrix,</span>
        <span class="c1"># SPM and MATLAB</span>
        <span class="n">test_afni_config</span><span class="p">()</span>
        <span class="n">test_ants_config</span><span class="p">()</span>
        <span class="n">test_mrtrix_config</span><span class="p">()</span>
        <span class="n">test_fsl_config</span><span class="p">()</span>
        <span class="n">test_spm_matlab_config</span><span class="p">()</span>
        <span class="n">test_matlab_config</span><span class="p">()</span>
        <span class="n">test_matlab_mcr_spm_standalone</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIAMainWindow.test_software_preferences_pop_up_validate">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAMainWindow.test_software_preferences_pop_up_validate">[docs]</a>
    <span class="k">def</span> <span class="nf">test_software_preferences_pop_up_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Opens the preferences pop up, sets the configuration.</span>

<span class="sd">        For modules AFNI, ANTS, FSL, SPM, mrtrix and MATLAB without pressing</span>
<span class="sd">        the OK button and switches the auto-save, controller version and</span>
<span class="sd">        radio view options.</span>

<span class="sd">        - Tests: PopUpPreferences.validate_and_save</span>

<span class="sd">        - Mocks:</span>
<span class="sd">            - PopUpPreferences.show</span>
<span class="sd">            - QMessageBox.show</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Validates the Pipeline tab without pressing the &#39;OK&#39; button:</span>

        <span class="c1"># Set shortcuts for objects that are often used</span>
        <span class="n">main_wnd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span>

        <span class="c1"># Mocks the execution of &#39;PopUpPreferences&#39; to speed up the test</span>
        <span class="c1"># PopUpPreferences.show = lambda x: None</span>

        <span class="n">tmp_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">software_preferences_pop_up</span><span class="p">()</span>

        <span class="c1"># Selects standalone modules</span>
        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;matlab_standalone&quot;</span><span class="p">,</span> <span class="s2">&quot;spm_standalone&quot;</span><span class="p">]:</span>
            <span class="nb">getattr</span><span class="p">(</span>
                <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="p">,</span> <span class="s2">&quot;use_&quot;</span> <span class="o">+</span> <span class="n">module</span> <span class="o">+</span> <span class="s2">&quot;_checkbox&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Validates the Pipeline tab without pressing the &#39;OK&#39; button</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">validate_and_save</span><span class="p">()</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;matlab_standalone&quot;</span><span class="p">,</span> <span class="s2">&quot;spm_standalone&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;get_use_&quot;</span> <span class="o">+</span> <span class="n">module</span><span class="p">)())</span>

        <span class="c1"># Selects non standalone modules</span>
        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;afni&quot;</span><span class="p">,</span> <span class="s2">&quot;ants&quot;</span><span class="p">,</span> <span class="s2">&quot;fsl&quot;</span><span class="p">,</span> <span class="s2">&quot;matlab&quot;</span><span class="p">,</span> <span class="s2">&quot;mrtrix&quot;</span><span class="p">,</span> <span class="s2">&quot;spm&quot;</span><span class="p">]:</span>
            <span class="nb">getattr</span><span class="p">(</span>
                <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="p">,</span> <span class="s2">&quot;use_&quot;</span> <span class="o">+</span> <span class="n">module</span> <span class="o">+</span> <span class="s2">&quot;_checkbox&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Validates the Pipeline tab without pressing the &#39;OK&#39; button</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">validate_and_save</span><span class="p">()</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;afni&quot;</span><span class="p">,</span> <span class="s2">&quot;ants&quot;</span><span class="p">,</span> <span class="s2">&quot;fsl&quot;</span><span class="p">,</span> <span class="s2">&quot;matlab&quot;</span><span class="p">,</span> <span class="s2">&quot;mrtrix&quot;</span><span class="p">,</span> <span class="s2">&quot;spm&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;get_use_&quot;</span> <span class="o">+</span> <span class="n">module</span><span class="p">)())</span>

        <span class="c1"># Validates the Pipeline tab by pressing the &#39;OK&#39; button:</span>

        <span class="c1"># Sets the projects folder for the preferences window to close</span>
        <span class="c1"># when pressing on &#39;OK&#39;</span>
        <span class="p">(</span>
            <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">projects_save_path_line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="n">tmp_path</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Mocks the execution of &#39;wrong_path&#39; and &#39;QMessageBox.show&#39;</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">wrong_path</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="kc">None</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">show</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">None</span>

        <span class="c1"># Deselects non standalone modules</span>
        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;afni&quot;</span><span class="p">,</span> <span class="s2">&quot;ants&quot;</span><span class="p">,</span> <span class="s2">&quot;fsl&quot;</span><span class="p">,</span> <span class="s2">&quot;matlab&quot;</span><span class="p">,</span> <span class="s2">&quot;mrtrix&quot;</span><span class="p">,</span> <span class="s2">&quot;spm&quot;</span><span class="p">]:</span>
            <span class="nb">getattr</span><span class="p">(</span>
                <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="p">,</span> <span class="s2">&quot;use_&quot;</span> <span class="o">+</span> <span class="n">module</span> <span class="o">+</span> <span class="s2">&quot;_checkbox&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Deselects the &#39;radioView&#39;, &#39;adminMode&#39; and &#39;clinicalMode&#39; option</span>
        <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;save&quot;</span><span class="p">,</span> <span class="s2">&quot;radioView&quot;</span><span class="p">,</span> <span class="s2">&quot;admin_mode&quot;</span><span class="p">,</span> <span class="s2">&quot;clinical_mode&quot;</span><span class="p">]:</span>
            <span class="p">(</span>
                <span class="nb">getattr</span><span class="p">(</span>
                    <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="p">,</span> <span class="n">opt</span> <span class="o">+</span> <span class="s2">&quot;_checkbox&quot;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="c1"># The options autoSave, radioView and controlV1 are not selected</span>

        <span class="c1"># Sets the projects save path</span>
        <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span><span class="o">.</span><span class="n">set_projects_save_path</span><span class="p">(</span>
            <span class="n">tmp_path</span>
        <span class="p">)</span>

        <span class="c1"># Validates the all tab after pressing the &#39;OK&#39; button</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;isAutoSave&quot;</span><span class="p">,</span>
            <span class="s2">&quot;isRadioView&quot;</span><span class="p">,</span>
            <span class="s2">&quot;isControlV1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;get_use_clinical&quot;</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">opt</span><span class="p">)())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_user_mode</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_projects_save_path</span><span class="p">(),</span> <span class="n">tmp_path</span><span class="p">)</span>

        <span class="c1"># Deselects MATLAB and SPM modules from the config file</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;matlab&quot;</span><span class="p">,</span> <span class="s2">&quot;spm&quot;</span><span class="p">]:</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;set_use_&quot;</span> <span class="o">+</span> <span class="n">module</span><span class="p">)(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">main_wnd</span><span class="o">.</span><span class="n">software_preferences_pop_up</span><span class="p">()</span>  <span class="c1"># Reopens the window</span>

        <span class="c1"># Selects the autoSave, radioView and controlV1 options</span>
        <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;save_checkbox&quot;</span><span class="p">,</span>
            <span class="s2">&quot;radioView_checkbox&quot;</span><span class="p">,</span>
            <span class="s2">&quot;control_checkbox&quot;</span><span class="p">,</span>
            <span class="s2">&quot;admin_mode_checkbox&quot;</span><span class="p">,</span>
            <span class="s2">&quot;clinical_mode_checkbox&quot;</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Alternates to minimized mode</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">fullscreen_cbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Sets a non-existent projects save path</span>
        <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span><span class="o">.</span><span class="n">set_projects_save_path</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;non_existent&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Validates the all tab after pressing the &#39;OK&#39; button</span>
        <span class="n">main_wnd</span><span class="o">.</span><span class="n">pop_up_preferences</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="c1"># Asserts that the &#39;config&#39; objects was not updated with the</span>
        <span class="c1"># non-existent projects folder</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_projects_save_path</span><span class="p">(),</span> <span class="n">tmp_path</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAMainWindow.test_switch_project">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAMainWindow.test_switch_project">[docs]</a>
    <span class="k">def</span> <span class="nf">test_switch_project</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a project and switches to it.</span>

<span class="sd">        - Tests: MainWindow.switch_project</span>

<span class="sd">        - Mocks: QMessageBox.exec</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Mocks the execution of a dialog window</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">self_</span><span class="p">:</span> <span class="kc">None</span>

        <span class="c1"># Creates a new project</span>
        <span class="n">test_proj_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>

        <span class="c1"># Switches to an existing mia project</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">test_proj_path</span><span class="p">,</span> <span class="s2">&quot;test_project&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="n">test_proj_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># Resets the project folder</span>

        <span class="c1"># Tries to switch to a non-existent project</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span>
            <span class="n">test_proj_path</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;test_project&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Tries to switch to a project that is already opened in another</span>
        <span class="c1"># instance of the software</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">test_proj_path</span><span class="p">,</span> <span class="s2">&quot;test_project&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Resets the opened projects list</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_opened_projects</span><span class="p">([])</span>

        <span class="c1"># Deletes the &#39;COLLECTION_CURRENT&#39; equivalent in &#39;mia.db&#39;</span>
        <span class="c1"># con = sqlite3.connect(os.path.join(test_proj_path,</span>
        <span class="c1">#                                    &#39;database&#39;,&#39;mia.db&#39;))</span>
        <span class="c1"># cursor = con.cursor()</span>
        <span class="c1"># query = &quot;DELETE FROM &#39;_collection&#39; WHERE collection_name = &#39;current&#39;&quot;</span>
        <span class="c1"># cursor.execute(query)</span>
        <span class="c1"># con.commit()</span>
        <span class="c1"># con.close()</span>

        <span class="c1"># Tries to switch to a project that cannot be read by mia</span>
        <span class="c1"># res = self.main_window.switch_project(test_proj_path, &#39;test_project&#39;)</span>
        <span class="c1"># self.assertFalse(res)</span>

        <span class="c1"># Deletes the &#39;filters&#39; folder of the project</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;rm&quot;</span><span class="p">,</span> <span class="s2">&quot;-rf&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">test_proj_path</span><span class="p">,</span> <span class="s2">&quot;filters&quot;</span><span class="p">)])</span>

        <span class="c1"># Tries to switch to non mia project</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">test_proj_path</span><span class="p">,</span> <span class="s2">&quot;test_project&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">res</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAMainWindow.test_tab_changed">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAMainWindow.test_tab_changed">[docs]</a>
    <span class="k">def</span> <span class="nf">test_tab_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Switches between tabs.</span>

<span class="sd">        Data browser, data viewer and pipeline manager.</span>

<span class="sd">        Tests: MainWindow.tab_changed.</span>

<span class="sd">        Mocks: QMessageBox.exec.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Creates a test project</span>
        <span class="n">test_proj_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">(</span><span class="n">light</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">test_proj_path</span><span class="p">,</span> <span class="s2">&quot;test_project&quot;</span><span class="p">)</span>

        <span class="c1"># Set shortcuts for objects that are often used</span>
        <span class="n">data_browser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span>

        <span class="c1"># Switches to data viewer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Calls tab_changed()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Deletes a scan from data browser</span>
        <span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">remove_scan</span><span class="p">()</span>

        <span class="c1"># Mocks the execution of a dialog box by accepting it</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">self_</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">:</span> <span class="n">self_</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>

        <span class="c1"># Switch to pipeline manager with unsaved modifications</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Calls tab_changed()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Mocks nots list</span>
        <span class="c1"># self.main_window.project.currentFilter.nots = [&#39;NOT&#39;, &#39;&#39;, &#39;&#39;]</span>

        <span class="c1"># Switches to data browser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Calls tab_changed()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestMIANodeController">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIANodeController">[docs]</a>
<span class="k">class</span> <span class="nc">TestMIANodeController</span><span class="p">(</span><span class="n">TestMIACase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests for the node controller, part of the pipeline manager tab.</span>

<span class="sd">    - Tests: NodeController.</span>

<span class="sd">    :Contains:</span>
<span class="sd">        :Method:</span>
<span class="sd">            - test_attributes_filter: displays an attributes filter and</span>
<span class="sd">              modifies it.</span>
<span class="sd">            - test_capsul_node_controller: adds, changes and deletes</span>
<span class="sd">              processes using the capsul node controller.</span>
<span class="sd">            - test_display_filter: displays node parameters and a plug</span>
<span class="sd">              filter.</span>
<span class="sd">            - test_filter_widget: opens up the &quot;FilterWidget()&quot; to</span>
<span class="sd">              modify its parameters.</span>
<span class="sd">            - test_node_controller: adds, changes and deletes processes</span>
<span class="sd">              to the node controller.</span>
<span class="sd">            - test_plug_filter: displays a plug filter and modifies it</span>
<span class="sd">            - test_update_node_name: displays node parameters and</span>
<span class="sd">              updates its name.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestMIANodeController.test_attributes_filter">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIANodeController.test_attributes_filter">[docs]</a>
    <span class="k">def</span> <span class="nf">test_attributes_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Displays the parameters of a node, displays an attributes filter</span>
<span class="sd">        and modifies it.</span>

<span class="sd">        - Tests: AttributesFilter in V2 controller GUI (CapsulNodeController).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Opens project 8 and switches to it</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">node_controller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">nodeController</span>

        <span class="c1"># Adds the process Smooth, creates a node called &quot;smooth_1&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Smooth</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Exports the unconnected mandatory plugs</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s2">&quot;smooth_1&quot;</span>
        <span class="p">(</span>
            <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span>
        <span class="p">)()</span><span class="o">.</span><span class="n">export_node_unconnected_mandatory_plugs</span><span class="p">()</span>

        <span class="c1"># Displays parameters of &#39;inputs&#39; node</span>
        <span class="n">input_process</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">displayNodeParameters</span><span class="p">(</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="n">input_process</span>
        <span class="p">)</span>

        <span class="c1"># Opens the attributes filter, selects item and closes it</span>
        <span class="n">node_controller</span><span class="o">.</span><span class="n">filter_attributes</span><span class="p">()</span>
        <span class="n">attributes_filter</span> <span class="o">=</span> <span class="n">node_controller</span><span class="o">.</span><span class="n">pop_up</span>
        <span class="n">attributes_filter</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">attributes_filter</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="c1"># Opens the attributes filter, does not select an item and closes it</span>
        <span class="n">node_controller</span><span class="o">.</span><span class="n">filter_attributes</span><span class="p">()</span>
        <span class="n">attributes_filter</span> <span class="o">=</span> <span class="n">node_controller</span><span class="o">.</span><span class="n">pop_up</span>
        <span class="n">attributes_filter</span><span class="o">.</span><span class="n">search_str</span><span class="p">(</span><span class="s2">&quot;!@#&quot;</span><span class="p">)</span>
        <span class="n">attributes_filter</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIANodeController.test_capsul_node_controller">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIANodeController.test_capsul_node_controller">[docs]</a>
    <span class="k">def</span> <span class="nf">test_capsul_node_controller</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds, changes and deletes processes using the capsul node controller.</span>

<span class="sd">        Displays the attributes filter.</span>

<span class="sd">        Tests: CapsulNodeController</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Opens project 8 and switches to it</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">)(</span>
            <span class="s2">&quot;current&quot;</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">node_ctrler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">nodeController</span>

        <span class="c1"># Adds 2 processes Rename, creates 2 nodes called &quot;rename_1&quot; and</span>
        <span class="c1"># &quot;rename_2&quot;:</span>
        <span class="n">process_class</span> <span class="o">=</span> <span class="n">Rename</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">process_class</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">process_class</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Displays parameters of &quot;rename_2&quot; node</span>
        <span class="n">rename_process</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;rename_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">displayNodeParameters</span><span class="p">(</span>
            <span class="s2">&quot;rename_2&quot;</span><span class="p">,</span> <span class="n">rename_process</span>
        <span class="p">)</span>

        <span class="c1"># Tries changing its name to &quot;rename_2&quot; and then to &quot;rename_3&quot;</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">update_node_name</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">node_ctrler</span><span class="o">.</span><span class="n">node_name</span><span class="p">,</span> <span class="s2">&quot;rename_2&quot;</span><span class="p">)</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">update_node_name</span><span class="p">(</span>
            <span class="n">new_node_name</span><span class="o">=</span><span class="s2">&quot;rename_1&quot;</span><span class="p">,</span> <span class="n">old_node_name</span><span class="o">=</span><span class="s2">&quot;rename_2&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">node_ctrler</span><span class="o">.</span><span class="n">node_name</span><span class="p">,</span> <span class="s2">&quot;rename_2&quot;</span><span class="p">)</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">update_node_name</span><span class="p">(</span>
            <span class="n">new_node_name</span><span class="o">=</span><span class="s2">&quot;rename_3&quot;</span><span class="p">,</span> <span class="n">old_node_name</span><span class="o">=</span><span class="s2">&quot;rename_2&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">node_ctrler</span><span class="o">.</span><span class="n">node_name</span><span class="p">,</span> <span class="s2">&quot;rename_3&quot;</span><span class="p">)</span>

        <span class="c1"># Deletes node &quot;rename_3&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">del_node</span><span class="p">(</span><span class="s2">&quot;rename_3&quot;</span><span class="p">)</span>

        <span class="c1"># Display parameters of the &quot;inputs&quot; node</span>
        <span class="n">input_process</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">display_parameters</span><span class="p">(</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="n">get_process_instance</span><span class="p">(</span><span class="n">input_process</span><span class="p">),</span> <span class="n">pipeline</span>
        <span class="p">)</span>

        <span class="c1"># Displays parameters of &quot;rename_1&quot; node</span>
        <span class="n">rename_process</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;rename_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">displayNodeParameters</span><span class="p">(</span>
            <span class="s2">&quot;rename_1&quot;</span><span class="p">,</span> <span class="n">rename_process</span>
        <span class="p">)</span>

        <span class="c1"># Exports plugs for &quot;rename_1&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s2">&quot;rename_1&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;rename_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;rename_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span>
            <span class="s2">&quot;format_string&quot;</span><span class="p">,</span> <span class="s2">&quot;new_name.nii&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Runs pipeline and expects an error</span>
        <span class="c1"># self.main_window.pipeline_manager.runPipeline()</span>
        <span class="c1"># FIXME: running the pipeline gives the error:</span>
        <span class="c1">#        ModuleNotFoundError: No module named &#39;capsul&#39;</span>

        <span class="c1"># Displays the attributes filter</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">filter_attributes</span><span class="p">()</span>
        <span class="n">attributes_filter</span> <span class="o">=</span> <span class="n">node_ctrler</span><span class="o">.</span><span class="n">pop_up</span>
        <span class="n">attributes_filter</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">attributes_filter</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="c1"># Releases the process</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">release_process</span><span class="p">()</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">update_parameters</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIANodeController.test_display_filter">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIANodeController.test_display_filter">[docs]</a>
    <span class="k">def</span> <span class="nf">test_display_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Displays parameters of a node and displays a plug filter.&quot;&quot;&quot;</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">controlV1_ver</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">isControlV1</span><span class="p">()</span>

        <span class="c1"># Switch to V1 node controller GUI, if necessary</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">controlV1_ver</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">setControlV1</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restart_MIA</span><span class="p">()</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="p">)</span>
        <span class="n">node_controller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">nodeController</span>

        <span class="c1"># Adding a process</span>
        <span class="n">process_class</span> <span class="o">=</span> <span class="n">Threshold</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="c1"># Creates a node called &quot;threshold_1&quot;</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
            <span class="n">process_class</span>
        <span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Exporting the input plugs and modifying the &quot;synchronize&quot; input plug</span>
        <span class="p">(</span>
            <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span>
        <span class="p">)()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s2">&quot;threshold_1&quot;</span>
        <span class="p">(</span>
            <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span>
        <span class="p">)()</span><span class="o">.</span><span class="n">export_node_all_unconnected_inputs</span><span class="p">()</span>

        <span class="n">input_process</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="n">node_controller</span><span class="o">.</span><span class="n">display_parameters</span><span class="p">(</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="n">get_process_instance</span><span class="p">(</span><span class="n">input_process</span><span class="p">),</span> <span class="n">pipeline</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node_controller</span><span class="p">,</span> <span class="s2">&quot;get_index_from_plug_name&quot;</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">node_controller</span><span class="o">.</span><span class="n">get_index_from_plug_name</span><span class="p">(</span>
                <span class="s2">&quot;synchronize&quot;</span><span class="p">,</span> <span class="s2">&quot;in&quot;</span>
            <span class="p">)</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_input</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>
            <span class="c1"># This calls &quot;update_plug_value&quot; method</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_input</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

            <span class="c1"># Calling the display_filter method</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">display_filter</span><span class="p">(</span>
                <span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;synchronize&quot;</span><span class="p">,</span> <span class="p">(),</span> <span class="n">input_process</span>
            <span class="p">)</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">pop_up</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                <span class="mi">2</span><span class="p">,</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;threshold_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_plug_value</span><span class="p">(</span><span class="s2">&quot;synchronize&quot;</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Switches back to node controller V2, if necessary (return to initial</span>
        <span class="c1"># state)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">controlV1_ver</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">setControlV1</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIANodeController.test_filter_widget">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIANodeController.test_filter_widget">[docs]</a>
    <span class="k">def</span> <span class="nf">test_filter_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Places a node of the &quot;Input_Filter&quot; process, feeds in documents</span>
<span class="sd">        and opens up the &quot;FilterWidget()&quot; to modify its parameters.</span>

<span class="sd">        Tests the class FilterWidget() within the Node Controller V1</span>
<span class="sd">        (class NodeController()). The class FilterWidget() is</span>
<span class="sd">        independent on the Node</span>
<span class="sd">        Controller version (V1 or V2) and can be used in both of them.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">controlV1_ver</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">isControlV1</span><span class="p">()</span>

        <span class="c1"># Switch to V1 node controller GUI, if necessary</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">controlV1_ver</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">setControlV1</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restart_MIA</span><span class="p">()</span>

        <span class="c1"># Opens project 8 and switches to it</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">)(</span>
            <span class="s2">&quot;current&quot;</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">DOCUMENT_2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">)(</span>
            <span class="s2">&quot;current&quot;</span>
        <span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">node_ctrler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">nodeController</span>

        <span class="c1"># Adds the process &quot;input_filter_1&quot;</span>
        <span class="n">process_class</span> <span class="o">=</span> <span class="n">Input_Filter</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">process_class</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Exports the input plugs for &quot;input_filter_1&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s2">&quot;input_filter_1&quot;</span>
        <span class="p">(</span>
            <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span>
        <span class="p">)()</span><span class="o">.</span><span class="n">export_node_unconnected_mandatory_plugs</span><span class="p">()</span>

        <span class="c1"># Displays parameters of the &quot;inputs&quot; node</span>
        <span class="n">input_process</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">display_parameters</span><span class="p">(</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="n">get_process_instance</span><span class="p">(</span><span class="n">input_process</span><span class="p">),</span> <span class="n">pipeline</span>
        <span class="p">)</span>

        <span class="c1"># Opens a filter for the plug &quot;input&quot; of the &quot;inputs&quot; node</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">Undefined</span><span class="p">))</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">display_filter</span><span class="p">(</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">input_process</span>
        <span class="p">)</span>

        <span class="c1"># Selects all records in the &quot;input&quot; node</span>
        <span class="n">plug_filter</span> <span class="o">=</span> <span class="n">node_ctrler</span><span class="o">.</span><span class="n">pop_up</span>

        <span class="n">plug_filter</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="c1"># Opens the filter widget for the node &quot;input_filter_1&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">open_filter</span><span class="p">(</span><span class="s2">&quot;input_filter_1&quot;</span><span class="p">)</span>
        <span class="n">input_filter</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">filter_widget</span>

        <span class="n">index_DOCUMENT_1</span> <span class="o">=</span> <span class="n">input_filter</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_scan_row</span><span class="p">(</span><span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="c1"># index_DOCUMENT_2 = input_filter.table_data.get_scan_row(DOCUMENT_2)</span>

        <span class="c1"># Tries to search for an empty string and asserts that none of the</span>
        <span class="c1"># documents are hidden</span>
        <span class="n">input_filter</span><span class="o">.</span><span class="n">search_str</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Test &quot;DOCUMENT_1&quot; is not hidden</span>
        <span class="c1"># FIXME: Only for the Windows version, the method isRowHidden()</span>
        <span class="c1">#        does not seem to give the expected result. Waiting to look at</span>
        <span class="c1">#        this, we comment ..</span>
        <span class="c1"># self.assertFalse(input_filter.table_data.isRowHidden(index_DOCUMENT_1))</span>
        <span class="c1"># Test &quot;DOCUMENT_2&quot; is not hidden</span>
        <span class="c1"># FIXME: Only for the Windows version, the method isRowHidden()</span>
        <span class="c1">#        does not seem to give the expected result. Waiting to look at</span>
        <span class="c1">#        this, we comment ..</span>
        <span class="c1"># self.assertFalse(input_filter.table_data.isRowHidden(index_DOCUMENT_2))</span>

        <span class="c1"># Searches for &quot;DOCUMENT_2&quot; and verifies that &quot;DOCUMENT_1&quot; is hidden</span>
        <span class="n">input_filter</span><span class="o">.</span><span class="n">search_str</span><span class="p">(</span><span class="n">DOCUMENT_2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">input_filter</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">index_DOCUMENT_1</span><span class="p">))</span>

        <span class="c1"># Resets the search bar and assert that none of the documents</span>
        <span class="c1"># are hidden</span>
        <span class="n">input_filter</span><span class="o">.</span><span class="n">reset_search_bar</span><span class="p">()</span>

        <span class="c1"># Test &quot;DOCUMENT_1&quot; is not hidden</span>
        <span class="c1"># FIXME: Only for the Windows version, the method isRowHidden()</span>
        <span class="c1">#        does not seem to give the expected result. Waiting to look at</span>
        <span class="c1">#        this, we comment ..</span>
        <span class="c1"># self.assertFalse(input_filter.table_data.isRowHidden(index_DOCUMENT_1))</span>
        <span class="c1"># Test &quot;DOCUMENT_1&quot; is not hidden</span>
        <span class="c1"># FIXME: Only for the Windows version, the method isRowHidden()</span>
        <span class="c1">#        does not seem to give the expected result. Waiting to look at</span>
        <span class="c1">#        this, we comment ..</span>
        <span class="c1"># self.assertFalse(input_filter.table_data.isRowHidden(index_DOCUMENT_2))</span>

        <span class="c1"># Opens the &quot;Visualized tags&quot; pop up and adds the &quot;AcquisitionDate&quot; tag</span>
        <span class="n">input_filter</span><span class="o">.</span><span class="n">update_tags</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_visualized_tag</span><span class="p">(</span><span class="s2">&quot;AcquisitionDate&quot;</span><span class="p">)</span>
        <span class="c1"># FIXME: The following statement is always True (not the correct test)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="nb">type</span><span class="p">(</span><span class="n">input_filter</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span><span class="p">(</span><span class="s2">&quot;AcquisitionDate&quot;</span><span class="p">))</span>
            <span class="o">==</span> <span class="nb">int</span>
        <span class="p">)</span>

        <span class="c1"># Updates the tag to filter with</span>
        <span class="n">input_filter</span><span class="o">.</span><span class="n">update_tag_to_filter</span><span class="p">()</span>

        <span class="n">input_filter</span><span class="o">.</span><span class="n">push_button_tag_filter</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;FileName&quot;</span><span class="p">)</span>
        <span class="c1"># TODO: select tag to filter with</span>

        <span class="c1"># Closes the filter</span>
        <span class="n">input_filter</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="c1"># Switches back to node controller V2, if necessary (return to initial</span>
        <span class="c1"># state)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">controlV1_ver</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">setControlV1</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIANodeController.test_node_controller">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIANodeController.test_node_controller">[docs]</a>
    <span class="k">def</span> <span class="nf">test_node_controller</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds, changes and deletes processes to the node controller,</span>
<span class="sd">        display the attributes filter.</span>

<span class="sd">        Tests the class NodeController().</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">controlV1_ver</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">isControlV1</span><span class="p">()</span>

        <span class="c1"># Switch to V1 node controller GUI, if necessary</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">controlV1_ver</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">setControlV1</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restart_MIA</span><span class="p">()</span>

        <span class="c1"># Opens project 8 and switches to it</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">)(</span>
            <span class="s2">&quot;current&quot;</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">node_ctrler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">nodeController</span>

        <span class="c1"># Add, twice, the process Rename, creates the &quot;rename_1&quot; and &quot;rename_2&quot;</span>
        <span class="c1"># nodes</span>
        <span class="n">process_class</span> <span class="o">=</span> <span class="n">Rename</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">process_class</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">process_class</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Displays parameters of &quot;rename_2&quot; node</span>
        <span class="n">rename_process</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;rename_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">displayNodeParameters</span><span class="p">(</span>
            <span class="s2">&quot;rename_2&quot;</span><span class="p">,</span> <span class="n">rename_process</span>
        <span class="p">)</span>

        <span class="c1"># Tries to change its name to &quot;rename_1&quot; and then to &quot;rename_3&quot;</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">update_node_name</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">node_ctrler</span><span class="o">.</span><span class="n">node_name</span><span class="p">,</span> <span class="s2">&quot;rename_2&quot;</span><span class="p">)</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">update_node_name</span><span class="p">(</span><span class="n">new_node_name</span><span class="o">=</span><span class="s2">&quot;rename_1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">node_ctrler</span><span class="o">.</span><span class="n">node_name</span><span class="p">,</span> <span class="s2">&quot;rename_2&quot;</span><span class="p">)</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">update_node_name</span><span class="p">(</span><span class="n">new_node_name</span><span class="o">=</span><span class="s2">&quot;rename_3&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">node_ctrler</span><span class="o">.</span><span class="n">node_name</span><span class="p">,</span> <span class="s2">&quot;rename_3&quot;</span><span class="p">)</span>

        <span class="c1"># Deletes node &quot;rename_2&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">del_node</span><span class="p">(</span><span class="s2">&quot;rename_3&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;rename_3&quot;</span><span class="p">])</span>

        <span class="c1"># Exports the input plugs for &quot;rename_1&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s2">&quot;rename_1&quot;</span>
        <span class="p">(</span>
            <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span>
        <span class="p">)()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="c1"># Display parameters of the &quot;inputs&quot; node</span>
        <span class="n">input_process</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">display_parameters</span><span class="p">(</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="n">get_process_instance</span><span class="p">(</span><span class="n">input_process</span><span class="p">),</span> <span class="n">pipeline</span>
        <span class="p">)</span>

        <span class="c1"># Display the filter of the &#39;in_file&#39; plug, &quot;inputs&quot; node</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">display_filter</span><span class="p">(</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">Undefined</span><span class="p">)),</span> <span class="n">input_process</span>
        <span class="p">)</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">pop_up</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Sets the values of the mandatory plugs</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s2">&quot;format_string&quot;</span><span class="p">,</span> <span class="s2">&quot;new_file.nii&quot;</span><span class="p">)</span>

        <span class="c1"># Checks the indexed of input and output plug labels</span>
        <span class="n">in_plug_index</span> <span class="o">=</span> <span class="n">node_ctrler</span><span class="o">.</span><span class="n">get_index_from_plug_name</span><span class="p">(</span><span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="s2">&quot;in&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">in_plug_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">out_plug_index</span> <span class="o">=</span> <span class="n">node_ctrler</span><span class="o">.</span><span class="n">get_index_from_plug_name</span><span class="p">(</span>
            <span class="s2">&quot;_out_file&quot;</span><span class="p">,</span> <span class="s2">&quot;out&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">out_plug_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Tries to update the plug value without a new value</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">update_plug_value</span><span class="p">(</span>
            <span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">Undefined</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">update_plug_value</span><span class="p">(</span>
            <span class="s2">&quot;out&quot;</span><span class="p">,</span> <span class="s2">&quot;_out_file&quot;</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">Undefined</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">update_plug_value</span><span class="p">(</span>
            <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">Undefined</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Tries to update the plug value with a new value</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">update_plug_value</span><span class="p">(</span>
            <span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_value</span><span class="o">=</span><span class="s2">&quot;new_value.nii&quot;</span>
        <span class="p">)</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">update_plug_value</span><span class="p">(</span>
            <span class="s2">&quot;out&quot;</span><span class="p">,</span> <span class="s2">&quot;_out_file&quot;</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_value</span><span class="o">=</span><span class="s2">&quot;new_value.nii&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Releases the process</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">release_process</span><span class="p">()</span>
        <span class="n">node_ctrler</span><span class="o">.</span><span class="n">update_parameters</span><span class="p">()</span>

        <span class="c1"># Switches back to node controller V2, if necessary (return to initial</span>
        <span class="c1"># state)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">controlV1_ver</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">setControlV1</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIANodeController.test_plug_filter">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIANodeController.test_plug_filter">[docs]</a>
    <span class="k">def</span> <span class="nf">test_plug_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Displays the parameters of a node, displays a plug filter and</span>
<span class="sd">        modifies it.</span>

<span class="sd">        Tests the class PlugFilter() within the Node Controller V1</span>
<span class="sd">        (class NodeController()).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">controlV1_ver</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">isControlV1</span><span class="p">()</span>

        <span class="c1"># Switch to V1 node controller GUI, if necessary</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">controlV1_ver</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">setControlV1</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restart_MIA</span><span class="p">()</span>

        <span class="c1"># Opens project 8 and switches to it</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="c1"># Get the 2 first documents/records</span>
        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">)(</span>
            <span class="s2">&quot;current&quot;</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">DOCUMENT_2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">)(</span>
            <span class="s2">&quot;current&quot;</span>
        <span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="p">)</span>
        <span class="n">node_controller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">nodeController</span>

        <span class="c1"># Add the &quot;Smooth&quot; process, creates a node called &quot;smooth_1&quot;</span>
        <span class="n">process_class</span> <span class="o">=</span> <span class="n">Smooth</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
            <span class="n">process_class</span>
        <span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Exports the mandatory plugs</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;smooth_1&quot;</span>
        <span class="p">)</span>
        <span class="p">(</span>
            <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span>
        <span class="p">)()</span><span class="o">.</span><span class="n">export_node_unconnected_mandatory_plugs</span><span class="p">()</span>

        <span class="c1"># Display parameters of &quot;smooth_1&quot; node</span>
        <span class="n">input_process</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>

        <span class="n">node_controller</span><span class="o">.</span><span class="n">display_parameters</span><span class="p">(</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="n">get_process_instance</span><span class="p">(</span><span class="n">input_process</span><span class="p">),</span> <span class="n">pipeline</span>
        <span class="p">)</span>

        <span class="c1"># Opens a filter for the plug &quot;in_files&quot;,</span>
        <span class="c1"># without &quot;node_controller.scans_list&quot;</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">Undefined</span><span class="p">))</span>
        <span class="n">node_controller</span><span class="o">.</span><span class="n">display_filter</span><span class="p">(</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;in_files&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">input_process</span>
        <span class="p">)</span>

        <span class="c1"># Asserts its default value</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Undefined</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">get_plug_value</span><span class="p">(</span><span class="s2">&quot;in_files&quot;</span><span class="p">))</span>

        <span class="c1"># Look for &quot;DOCUMENT_2&quot; in the input documents</span>
        <span class="n">plug_filter</span> <span class="o">=</span> <span class="n">node_controller</span><span class="o">.</span><span class="n">pop_up</span>
        <span class="n">plug_filter</span><span class="o">.</span><span class="n">search_str</span><span class="p">(</span><span class="n">DOCUMENT_2</span><span class="p">)</span>
        <span class="n">index_DOCUMENT_1</span> <span class="o">=</span> <span class="n">plug_filter</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_scan_row</span><span class="p">(</span><span class="n">DOCUMENT_1</span><span class="p">)</span>

        <span class="c1"># if &quot;DOCUMENT_1&quot; is hidden</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">plug_filter</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">index_DOCUMENT_1</span><span class="p">))</span>

        <span class="c1"># Resets the search bar</span>
        <span class="n">plug_filter</span><span class="o">.</span><span class="n">reset_search_bar</span><span class="p">()</span>

        <span class="c1"># if &quot;DOCUMENT_1&quot; is not hidden</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">plug_filter</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">isRowHidden</span><span class="p">(</span><span class="n">index_DOCUMENT_1</span><span class="p">))</span>

        <span class="c1"># Tries search for an empty string</span>
        <span class="n">plug_filter</span><span class="o">.</span><span class="n">search_str</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Search for &quot;DOCUMENT_2&quot; and changes tags</span>
        <span class="n">plug_filter</span><span class="o">.</span><span class="n">search_str</span><span class="p">(</span><span class="n">DOCUMENT_2</span><span class="p">)</span>

        <span class="n">index_DOCUMENT_2</span> <span class="o">=</span> <span class="n">plug_filter</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_scan_row</span><span class="p">(</span><span class="n">DOCUMENT_2</span><span class="p">)</span>
        <span class="n">plug_filter</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="n">index_DOCUMENT_2</span><span class="p">)</span>

        <span class="c1"># FIXME: we need to find a better way to interact with the plug_filter</span>
        <span class="c1">#        objects. At the moment, QTimer.singleShoot does not give a</span>
        <span class="c1">#        good result because it is an asynchronous action and we can</span>
        <span class="c1">#        observe mixtures of QT signals. Since we are not</span>
        <span class="c1">#        instantiating exactly the right objects, this results in a</span>
        <span class="c1">#        mixture of signals that can crash the execution. Currently</span>
        <span class="c1">#        the QTimer.singleShoot is removed (this should not change</span>
        <span class="c1">#        much the test coverage because the objects are still used</span>
        <span class="c1">#        (update_tags, update_tag_to_filter)</span>

        <span class="n">plug_filter</span><span class="o">.</span><span class="n">update_tags</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="nb">type</span><span class="p">(</span><span class="n">plug_filter</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_tag_column</span><span class="p">(</span><span class="s2">&quot;AcquisitionDate&quot;</span><span class="p">))</span>
            <span class="o">==</span> <span class="nb">int</span>
        <span class="p">)</span>

        <span class="n">plug_filter</span><span class="o">.</span><span class="n">update_tag_to_filter</span><span class="p">()</span>
        <span class="n">plug_filter</span><span class="o">.</span><span class="n">push_button_tag_filter</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;FileName&quot;</span><span class="p">)</span>
        <span class="c1"># TODO: select tag to filter with</span>

        <span class="c1"># Closes the filter for the plug &quot;in_files&quot;</span>
        <span class="n">plug_filter</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="c1"># Assert the modified value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">DOCUMENT_2</span><span class="p">)),</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">get_plug_value</span><span class="p">(</span><span class="s2">&quot;in_files&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])),</span>
        <span class="p">)</span>

        <span class="c1"># Opens a filter for the plug &quot;in_files&quot;, now with a &quot;scans_list&quot;</span>
        <span class="n">node_controller</span><span class="o">.</span><span class="n">scan_list</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span>
        <span class="p">)(</span><span class="s2">&quot;current&quot;</span><span class="p">)</span>
        <span class="n">node_controller</span><span class="o">.</span><span class="n">display_filter</span><span class="p">(</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;in_files&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">input_process</span>
        <span class="p">)</span>

        <span class="c1"># Look for something that does not give any match</span>
        <span class="n">plug_filter</span><span class="o">.</span><span class="n">search_str</span><span class="p">(</span><span class="s2">&quot;!@#&quot;</span><span class="p">)</span>
        <span class="c1"># this will empty the &quot;plug_filter.table_data.selectedIndexes()&quot;</span>
        <span class="c1"># and trigger an uncovered part of &quot;set_plug_value(self)&quot;</span>

        <span class="n">plug_filter</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>

        <span class="c1"># Switches back to node controller V2, if necessary (return to initial</span>
        <span class="c1"># state)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">controlV1_ver</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">setControlV1</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIANodeController.test_update_node_name">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIANodeController.test_update_node_name">[docs]</a>
    <span class="k">def</span> <span class="nf">test_update_node_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Displays parameters of a node and updates its name.&quot;&quot;&quot;</span>

        <span class="n">pipeline_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>

        <span class="c1"># Adding a process =&gt; creates a node called &quot;smooth_1&quot;</span>
        <span class="n">process_class</span> <span class="o">=</span> <span class="n">Smooth</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
            <span class="n">process_class</span>
        <span class="p">)</span>

        <span class="c1"># Displaying the smooth_1 node parameters</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">displayNodeParameters</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">,</span> <span class="n">process</span><span class="p">)</span>
        <span class="n">node_controller</span> <span class="o">=</span> <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">nodeController</span>

        <span class="c1"># Change the node name from smooth_1 to smooth_test, test if it&#39;s ok</span>
        <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;smooth_test&quot;</span><span class="p">)</span>
        <span class="n">keyEvent</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QKeyEvent</span><span class="p">(</span>
            <span class="n">QEvent</span><span class="o">.</span><span class="n">KeyPress</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key_Return</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">NoModifier</span>
        <span class="p">)</span>
        <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">postEvent</span><span class="p">(</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="p">,</span> <span class="n">keyEvent</span>
        <span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_test&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Add 2 another Smooth process =&gt; Creates nodes called</span>
        <span class="c1"># smooth_1 and smooth_2</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
            <span class="n">process_class</span>
        <span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
            <span class="n">process_class</span>
        <span class="p">)</span>

        <span class="c1"># Adding link between smooth_test and smooth_1 nodes</span>
        <span class="n">source</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;smooth_test&quot;</span><span class="p">,</span> <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">)</span>
        <span class="n">dest</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">,</span> <span class="s2">&quot;in_files&quot;</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span>
            <span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span>
        <span class="p">)</span>

        <span class="c1"># Adding link between smooth_2 and smooth_1 nodes</span>
        <span class="n">source</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">,</span> <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">)</span>
        <span class="n">dest</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">,</span> <span class="s2">&quot;in_files&quot;</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span>
            <span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span>
        <span class="p">)</span>

        <span class="c1"># Displaying the smooth_1 node parameters</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">displayNodeParameters</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">,</span> <span class="n">process</span><span class="p">)</span>
        <span class="n">node_controller</span> <span class="o">=</span> <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">nodeController</span>

        <span class="c1"># Change node name from smooth_1 to smooth_test.</span>
        <span class="c1"># This should not change the node name because there is already a</span>
        <span class="c1"># &quot;smooth_test&quot; process in the pipeline.</span>
        <span class="c1"># Test if smooth_1 is still in the pipeline</span>
        <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;smooth_test&quot;</span><span class="p">)</span>
        <span class="n">keyEvent</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QKeyEvent</span><span class="p">(</span>
            <span class="n">QEvent</span><span class="o">.</span><span class="n">KeyPress</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key_Return</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">NoModifier</span>
        <span class="p">)</span>
        <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">postEvent</span><span class="p">(</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="p">,</span> <span class="n">keyEvent</span>
        <span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;smooth_test_2&quot;</span><span class="p">)</span>
        <span class="n">keyEvent</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QKeyEvent</span><span class="p">(</span>
            <span class="n">QEvent</span><span class="o">.</span><span class="n">KeyPress</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key_Return</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">NoModifier</span>
        <span class="p">)</span>
        <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">postEvent</span><span class="p">(</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="p">,</span> <span class="n">keyEvent</span>
        <span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_test_2&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Verifying that the updated node has the same links</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_test_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span>
                <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_test_2&quot;</span><span class="p">]</span>
                <span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span>
                <span class="o">.</span><span class="n">links_to</span>
            <span class="p">),</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestMIAPipelineEditor">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineEditor">[docs]</a>
<span class="k">class</span> <span class="nc">TestMIAPipelineEditor</span><span class="p">(</span><span class="n">TestMIACase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests for the pipeline editor, part of the pipeline manager tab.</span>

<span class="sd">    Tests PipelineEditor.</span>

<span class="sd">    :Contains:</span>
<span class="sd">        :Method:</span>
<span class="sd">            - test_add_tab: adds tabs to the PipelineEditorTabs</span>
<span class="sd">            - test_close_tab: closes a tab in the PipelineEditorTabs</span>
<span class="sd">            - test_drop_process: adds a Nipype SPM Smooth process to the</span>
<span class="sd">              pipeline editor</span>
<span class="sd">            - test_export_plug: exports plugs and mocks dialog boxes</span>
<span class="sd">            - test_save_pipeline: creates a pipeline and tries to save it</span>
<span class="sd">            - test_update_plug_value: displays node parameters and</span>
<span class="sd">              updates a plug value</span>
<span class="sd">            - test_z_check_modif: opens a pipeline, modifies it and</span>
<span class="sd">              check the modifications</span>
<span class="sd">            - test_z_get_editor: gets the instance of an editor</span>
<span class="sd">            - test_z_get_filename: gets the relative path to a</span>
<span class="sd">              previously saved pipeline file</span>
<span class="sd">            - test_z_get_index: gets the index of an editor</span>
<span class="sd">            - test_z_get_tab_name: gets the tab name of the editor</span>
<span class="sd">            - test_z_load_pipeline: loads a pipeline</span>
<span class="sd">            - test_z_open_sub_pipeline: opens a sub_pipeline</span>
<span class="sd">            - test_z_set_current_editor: sets the current editor</span>
<span class="sd">            - test_zz_del_pack: deletes a brick created during UTs</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestMIAPipelineEditor.test_add_tab">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineEditor.test_add_tab">[docs]</a>
    <span class="k">def</span> <span class="nf">test_add_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds tabs to the PipelineEditorTabs.&quot;&quot;&quot;</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="p">)</span>

        <span class="c1"># Adding two new tabs</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">new_tab</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">tabText</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;New Pipeline 1&quot;</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">new_tab</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">tabText</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;New Pipeline 2&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAPipelineEditor.test_close_tab">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineEditor.test_close_tab">[docs]</a>
    <span class="k">def</span> <span class="nf">test_close_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Closes a tab in the pipeline editor tabs.</span>

<span class="sd">        Indirectly tests PopUpClosePipeline.</span>

<span class="sd">        - Tests: PipelineEditor.close_tab</span>

<span class="sd">        - Mocks: PopUpClosePipeline.exec</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>

        <span class="c1"># Closes an unmodified tab</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">close_tab</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Adds a process to modify the pipeline</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Rename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">tabText</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span> <span class="s2">&quot; *&quot;</span><span class="p">)</span>

        <span class="c1"># Mocks the execution of the &#39;QDialog&#39;</span>
        <span class="c1"># Instead of showing it, directly chooses &#39;save_as_clicked&#39;</span>
        <span class="n">PopUpClosePipeline</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span>
            <span class="n">side_effect</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">pop_up_close</span><span class="o">.</span><span class="n">save_as_clicked</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">save_pipeline</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>

        <span class="c1"># Tries to close the modified tab and saves the pipeline as</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">close_tab</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Asserts that &#39;undos&#39; and &#39;redos&#39; were deleted</span>
        <span class="n">editor</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_editor_by_index</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">):</span>
            <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">undos</span><span class="p">[</span><span class="n">editor</span><span class="p">]</span>
            <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">redos</span><span class="p">[</span><span class="n">editor</span><span class="p">]</span>

        <span class="c1"># Directly chooses &#39;do_not_save_clicked&#39;</span>
        <span class="n">PopUpClosePipeline</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span>
            <span class="n">side_effect</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">pop_up_close</span><span class="o">.</span><span class="n">do_not_save_clicked</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="c1"># Adds a new tab and a process</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">new_tab</span><span class="p">()</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Rename</span><span class="p">)</span>

        <span class="c1"># Tries to close the modified tab and cancels saving</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">close_tab</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Directly chooses &#39;cancel_clicked&#39;</span>
        <span class="n">PopUpClosePipeline</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span>
            <span class="n">side_effect</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">pop_up_close</span><span class="o">.</span><span class="n">cancel_clicked</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="c1"># Adds a process</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Rename</span><span class="p">)</span>

        <span class="c1"># Tries to close the modified tab and cancels saving</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">close_tab</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Directly chooses &#39;cancel_clicked&#39;</span>
        <span class="n">PopUpClosePipeline</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span>
            <span class="n">side_effect</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">pop_up_close</span><span class="o">.</span><span class="n">cancel_clicked</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="c1"># Adds a new process</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Rename</span><span class="p">)</span>

        <span class="c1"># Tries to close the modified tab and cancels saving</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">close_tab</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAPipelineEditor.test_drop_process">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineEditor.test_drop_process">[docs]</a>
    <span class="k">def</span> <span class="nf">test_drop_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a Nipype SPM&#39;s Smooth process to the pipeline editor.&quot;&quot;&quot;</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span>
            <span class="s2">&quot;smooth_1&quot;</span>
            <span class="ow">in</span> <span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">)()</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">drop_process</span><span class="p">(</span>
            <span class="s2">&quot;nipype.interfaces.spm.Smooth&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;smooth_1&quot;</span>
            <span class="ow">in</span> <span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">)()</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAPipelineEditor.test_export_plug">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineEditor.test_export_plug">[docs]</a>
    <span class="k">def</span> <span class="nf">test_export_plug</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a process and exports plugs in the pipeline editor.</span>

<span class="sd">        -Tests: PipelineEditor.test_export_plug</span>

<span class="sd">        - Mocks:</span>
<span class="sd">            - QMessageBox.question</span>
<span class="sd">            - QInputDialog.getText</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Set shortcuts for objects that are often used</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">ppl_edt</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span>

        <span class="c1"># Mocks &#39;PipelineEditor&#39; attributes</span>
        <span class="n">ppl_edt</span><span class="o">.</span><span class="n">_temp_plug_name</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">ppl_edt</span><span class="o">.</span><span class="n">_temp_plug</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
        <span class="n">ppl_edt</span><span class="o">.</span><span class="n">_temp_plug</span><span class="o">.</span><span class="n">optional</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Mocks the execution of a plug edit dialog</span>
        <span class="n">PipelineEditor</span><span class="o">.</span><span class="n">_PlugEdit</span><span class="o">.</span><span class="n">exec_</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>

        <span class="c1"># Exports a plug with no parameters</span>
        <span class="n">ppl_edt</span><span class="o">.</span><span class="n">_export_plug</span><span class="p">(</span><span class="n">pipeline_parameter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">temp_plug_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="n">PipelineEditor</span><span class="o">.</span><span class="n">_PlugEdit</span><span class="o">.</span><span class="n">exec_</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">()</span>

        <span class="c1"># Adds a Rename processes, creates the &#39;rename_1&#39; node</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Rename</span><span class="p">)</span>

        <span class="c1"># Exports a plug value</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">ppl_edt</span><span class="o">.</span><span class="n">_export_plug</span><span class="p">(</span>
            <span class="n">temp_plug_name</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;rename_1&quot;</span><span class="p">,</span> <span class="s2">&quot;_out_file&quot;</span><span class="p">),</span>
            <span class="n">pipeline_parameter</span><span class="o">=</span><span class="s2">&quot;_out_file&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

        <span class="c1"># Mocks &#39;QMessageBox.question&#39; to click accept</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">)</span>

        <span class="c1"># Tries to export the same plug value, accepts overwriting it</span>
        <span class="c1"># With &#39;multi_export&#39; then the temp_plug_value will be returned</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">ppl_edt</span><span class="o">.</span><span class="n">_export_plug</span><span class="p">(</span>
            <span class="n">temp_plug_name</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;rename_1&quot;</span><span class="p">,</span> <span class="s2">&quot;_out_file&quot;</span><span class="p">),</span>
            <span class="n">pipeline_parameter</span><span class="o">=</span><span class="s2">&quot;_out_file&quot;</span><span class="p">,</span>
            <span class="n">multi_export</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span><span class="o">.</span><span class="n">assert_called_once</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="s2">&quot;_out_file&quot;</span><span class="p">)</span>

        <span class="c1"># Mocks again &#39;QMessageBox.question&#39; to click reject</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>
        <span class="n">QInputDialog</span><span class="o">.</span><span class="n">getText</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;new_name&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>

        <span class="c1"># Mocks &#39;export_parameter&#39; to throw a &#39;TraitError&#39;</span>
        <span class="c1"># from traits.api import TraitError</span>
        <span class="c1"># ppl_edt.scene.pipeline.export_parameter = Mock(</span>
        <span class="c1">#    side_effect=TraitError())</span>

        <span class="c1"># Tries to export the same plug value, denies overwriting it</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">ppl_edt</span><span class="o">.</span><span class="n">_export_plug</span><span class="p">(</span>
            <span class="n">temp_plug_name</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;rename_1&quot;</span><span class="p">,</span> <span class="s2">&quot;_out_file&quot;</span><span class="p">),</span>
            <span class="n">pipeline_parameter</span><span class="o">=</span><span class="s2">&quot;_out_file&quot;</span><span class="p">,</span>
            <span class="n">multi_export</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span><span class="o">.</span><span class="n">assert_called_once</span><span class="p">()</span>
        <span class="n">QInputDialog</span><span class="o">.</span><span class="n">getText</span><span class="o">.</span><span class="n">assert_called_once</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="s2">&quot;_out_file&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAPipelineEditor.test_save_pipeline">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineEditor.test_save_pipeline">[docs]</a>
    <span class="k">def</span> <span class="nf">test_save_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a pipeline and tries to save it.</span>

<span class="sd">        - Tests:</span>
<span class="sd">            - PipelineEditor.save_pipeline</span>
<span class="sd">            - PipelineEditorTabs.save_pipeline</span>
<span class="sd">            - save_pipeline inside pipeline_editor.py</span>

<span class="sd">        - Mocks:</span>
<span class="sd">            - QMessageBox.exec</span>
<span class="sd">            - QFileDialog.getSaveFileName</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Save the state of the current process library</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">usr_proc_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span> <span class="s2">&quot;processes&quot;</span><span class="p">,</span> <span class="s2">&quot;User_processes&quot;</span>
        <span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
            <span class="n">usr_proc_folder</span><span class="p">,</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">,</span>
                <span class="s2">&quot;4UTs_TestMIAPipelineEditor&quot;</span><span class="p">,</span>
                <span class="s2">&quot;User_processes&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span>
                <span class="s2">&quot;properties&quot;</span><span class="p">,</span>
                <span class="s2">&quot;process_config.yml&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">,</span> <span class="s2">&quot;4UTs_TestMIAPipelineEditor&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Sets often used shortcuts</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>

        <span class="c1"># Switch to pipeline manager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Tries to save a pipeline that is empty</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">save_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

        <span class="c1"># Adds a process</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Smooth</span><span class="p">)</span>

        <span class="c1"># Exports the input and output plugs</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s2">&quot;smooth_1&quot;</span>
        <span class="c1"># fmt: off</span>
        <span class="p">(</span>
            <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span>
            <span class="n">export_node_unconnected_mandatory_plugs</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="p">(</span>
            <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span>
            <span class="n">export_node_all_unconnected_outputs</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># fmt: on</span>

        <span class="c1"># Mocks the execution of a dialog box</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="kc">None</span>

        <span class="c1"># Tries to save the pipeline with the user cancelling it</span>
        <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">save_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

        <span class="c1"># Mocks the execution of a QFileDialog</span>
        <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="p">[</span><span class="n">filename</span><span class="p">]</span>

        <span class="c1"># Removes the config.get_properties_path()/processes/User_processes</span>
        <span class="c1"># folder, to increase coverage</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">usr_proc_folder</span><span class="p">)</span>

        <span class="c1"># Tries to save the pipeline with a filename starting by a digit</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">usr_proc_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span> <span class="s2">&quot;processes&quot;</span><span class="p">,</span> <span class="s2">&quot;User_processes&quot;</span>
        <span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">usr_proc_folder</span><span class="p">,</span> <span class="s2">&quot;1_test_pipeline&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">save_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

        <span class="c1"># Tries to save the pipeline with a filename without extension,</span>
        <span class="c1"># which is automatically completed to .py</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">usr_proc_folder</span><span class="p">,</span> <span class="s2">&quot;test_pipeline_1&quot;</span><span class="p">)</span>
        <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="p">[</span><span class="n">filename</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">save_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>  <span class="c1"># The resulting filename is not empty</span>

        <span class="c1"># Save the pipeline with a filename with the wrong .c extension,</span>
        <span class="c1"># which is automatically corrected to .py</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">usr_proc_folder</span><span class="p">,</span> <span class="s2">&quot;test_pipeline_2.c&quot;</span><span class="p">)</span>
        <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="p">[</span><span class="n">filename</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">save_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>  <span class="c1"># The resulting filename is not empty</span>

        <span class="c1"># Sets user mode to true</span>
        <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span><span class="o">.</span><span class="n">set_user_mode</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Tries to overwrite the previously saved pipeline without</span>
        <span class="c1"># permissions</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">save_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

        <span class="c1"># Sets user mode back to false</span>
        <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span><span class="o">.</span><span class="n">set_user_mode</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Saves a pipeline by specifying a filename</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">usr_proc_folder</span><span class="p">,</span> <span class="s2">&quot;test_pipeline_3.py&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">save_pipeline</span><span class="p">(</span><span class="n">new_file_name</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>  <span class="c1"># The resulting filename is not empty</span></div>


<div class="viewcode-block" id="TestMIAPipelineEditor.test_update_plug_value">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineEditor.test_update_plug_value">[docs]</a>
    <span class="k">def</span> <span class="nf">test_update_plug_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Displays parameters of a node and updates a plug value.&quot;&quot;&quot;</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">controlV1_ver</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">isControlV1</span><span class="p">()</span>

        <span class="c1"># Switch to V1 node controller GUI, if necessary</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">controlV1_ver</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">setControlV1</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restart_MIA</span><span class="p">()</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="p">)</span>
        <span class="n">node_controller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">nodeController</span>

        <span class="c1"># Adding a process, creates a node called &quot;threshold_1&quot;</span>
        <span class="n">process_class</span> <span class="o">=</span> <span class="n">Threshold</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
            <span class="n">process_class</span>
        <span class="p">)</span>

        <span class="c1"># Displaying the node parameters</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        <span class="n">node_controller</span><span class="o">.</span><span class="n">display_parameters</span><span class="p">(</span>
            <span class="s2">&quot;threshold_1&quot;</span><span class="p">,</span> <span class="n">get_process_instance</span><span class="p">(</span><span class="n">process_class</span><span class="p">),</span> <span class="n">pipeline</span>
        <span class="p">)</span>

        <span class="c1"># Updating the value of the &quot;synchronize&quot; input plug and</span>
        <span class="c1"># &quot;_activation_forced&quot; output plugs.</span>
        <span class="c1"># get_index_from_plug_name() only exists on the NodeController class</span>
        <span class="c1"># (v1).</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node_controller</span><span class="p">,</span> <span class="s2">&quot;get_index_from_plug_name&quot;</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">node_controller</span><span class="o">.</span><span class="n">get_index_from_plug_name</span><span class="p">(</span>
                <span class="s2">&quot;synchronize&quot;</span><span class="p">,</span> <span class="s2">&quot;in&quot;</span>
            <span class="p">)</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_input</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>

            <span class="c1"># This calls &quot;update_plug_value&quot; method:</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_input</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                <span class="mi">1</span><span class="p">,</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;threshold_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_plug_value</span><span class="p">(</span><span class="s2">&quot;synchronize&quot;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># Updating the value of the &quot;_activation_forced&quot; plug</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">node_controller</span><span class="o">.</span><span class="n">get_index_from_plug_name</span><span class="p">(</span>
                <span class="s2">&quot;_activation_forced&quot;</span><span class="p">,</span> <span class="s2">&quot;out&quot;</span>
            <span class="p">)</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_output</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;True&quot;</span><span class="p">)</span>

            <span class="c1"># This calls &quot;update_plug_value&quot; method:</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_output</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                <span class="kc">True</span><span class="p">,</span>
                <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;threshold_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_plug_value</span><span class="p">(</span>
                    <span class="s2">&quot;_activation_forced&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>

        <span class="c1"># Exporting the input plugs and modifying the &quot;synchronize&quot; input plug</span>
        <span class="p">(</span>
            <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span>
        <span class="p">)()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s2">&quot;threshold_1&quot;</span>
        <span class="p">(</span>
            <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span>
        <span class="p">)()</span><span class="o">.</span><span class="n">export_node_all_unconnected_inputs</span><span class="p">()</span>

        <span class="n">input_process</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="n">node_controller</span><span class="o">.</span><span class="n">display_parameters</span><span class="p">(</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="n">get_process_instance</span><span class="p">(</span><span class="n">input_process</span><span class="p">),</span> <span class="n">pipeline</span>
        <span class="p">)</span>

        <span class="c1"># Updating the value of the &quot;synchronize&quot; input plug.</span>
        <span class="c1"># get_index_from_plug_name() only exists on the NodeController class</span>
        <span class="c1"># (v1).</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node_controller</span><span class="p">,</span> <span class="s2">&quot;get_index_from_plug_name&quot;</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">node_controller</span><span class="o">.</span><span class="n">get_index_from_plug_name</span><span class="p">(</span>
                <span class="s2">&quot;synchronize&quot;</span><span class="p">,</span> <span class="s2">&quot;in&quot;</span>
            <span class="p">)</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_input</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>

            <span class="c1"># This calls &quot;update_plug_value&quot; method:</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_input</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                <span class="mi">2</span><span class="p">,</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;threshold_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_plug_value</span><span class="p">(</span><span class="s2">&quot;synchronize&quot;</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Switches back to node controller V2, if necessary (return to initial</span>
        <span class="c1"># state)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">controlV1_ver</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">setControlV1</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAPipelineEditor.test_z_check_modif">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineEditor.test_z_check_modif">[docs]</a>
    <span class="k">def</span> <span class="nf">test_z_check_modif</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Opens a pipeline, opens it as a process in another tab, modifies it</span>
<span class="sd">        and check the modifications.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="p">)</span>

        <span class="c1"># Adding a process from a .py file, creates a node called &quot;smooth_1&quot;</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span>
            <span class="s2">&quot;processes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;User_processes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;test_pipeline_1.py&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">load_pipeline</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Make a new pipeline editor tab</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">new_tab</span><span class="p">()</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">set_current_editor_by_tab_name</span><span class="p">(</span><span class="s2">&quot;New Pipeline 1&quot;</span><span class="p">)</span>

        <span class="c1"># Adding a process from Packages library, creates a node called</span>
        <span class="c1"># &quot;test_pipeline_1_1&quot;</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">drop_process</span><span class="p">(</span>
            <span class="s2">&quot;User_processes.Test_pipeline_1&quot;</span>
        <span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;test_pipeline_1_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Adding two processes, creates nodes called &quot;smooth_1&quot; and &quot;smooth_2&quot;</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">drop_process</span><span class="p">(</span>
            <span class="s2">&quot;nipype.interfaces.spm.Smooth&quot;</span>
        <span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">drop_process</span><span class="p">(</span>
            <span class="s2">&quot;nipype.interfaces.spm.Smooth&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Adding a link between smooth_1 and test_pipeline_1_1 nodes</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">,</span> <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;test_pipeline_1_1&quot;</span><span class="p">,</span> <span class="s2">&quot;in_files&quot;</span><span class="p">),</span>
            <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">weak</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span>
                <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;test_pipeline_1_1&quot;</span><span class="p">]</span>
                <span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;in_files&quot;</span><span class="p">]</span>
                <span class="o">.</span><span class="n">links_from</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Adding a link between test_pipeline_1_1 and smooth_2 nodes</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;test_pipeline_1_1&quot;</span><span class="p">,</span> <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">,</span> <span class="s2">&quot;in_files&quot;</span><span class="p">),</span>
            <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">weak</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span>
                <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;test_pipeline_1_1&quot;</span><span class="p">]</span>
                <span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span>
                <span class="o">.</span><span class="n">links_to</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Return to the first tab</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">set_current_editor_by_tab_name</span><span class="p">(</span>
            <span class="s2">&quot;test_pipeline_1.py&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Export all plugs of the smooth_1 node</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_node_plugs</span><span class="p">(</span>
            <span class="s2">&quot;smooth_1&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="c1"># Save the pipeline</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">savePipeline</span><span class="p">(</span><span class="n">uncheck</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Go back to the second tab</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">set_current_editor_by_tab_name</span><span class="p">(</span><span class="s2">&quot;New Pipeline 1&quot;</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span>
            <span class="s2">&quot;test_pipeline_1_1&quot;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>

        <span class="c1"># Check if the nodes of the pipeline have been modified</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">check_modifications</span><span class="p">()</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;fwhm&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;test_pipeline_1_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAPipelineEditor.test_z_get_editor">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineEditor.test_z_get_editor">[docs]</a>
    <span class="k">def</span> <span class="nf">test_z_get_editor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the instance of an editor.</span>

<span class="sd">        - Tests:</span>
<span class="sd">            - PipelineEditorTabs.get_editor_by_index</span>
<span class="sd">            - PipelineEditorTabs.get_current_editor</span>
<span class="sd">            - PipelineEditorTabs.get_editor_by_tab_name</span>
<span class="sd">            - PipelineEditorTabs.get_editor_by_filename</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span>
            <span class="s2">&quot;processes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;User_processes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;test_pipeline_1.py&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">load_pipeline</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">editor0</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span>

        <span class="c1"># create new tab with new editor and make it current:</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">new_tab</span><span class="p">()</span>
        <span class="n">editor1</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span>

        <span class="c1"># Perform various tests on the pipeline editor tabs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_editor_by_index</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">editor0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_editor_by_index</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">editor1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">(),</span> <span class="n">editor1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">editor0</span><span class="p">,</span>
            <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_editor_by_tab_name</span><span class="p">(</span><span class="s2">&quot;test_pipeline_1.py&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">editor1</span><span class="p">,</span>
            <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_editor_by_tab_name</span><span class="p">(</span><span class="s2">&quot;New Pipeline 1&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="kc">None</span><span class="p">,</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_editor_by_tab_name</span><span class="p">(</span><span class="s2">&quot;dummy&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">editor0</span><span class="p">,</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_editor_by_file_name</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="kc">None</span><span class="p">,</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_editor_by_file_name</span><span class="p">(</span><span class="s2">&quot;dummy&quot;</span><span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAPipelineEditor.test_z_get_filename">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineEditor.test_z_get_filename">[docs]</a>
    <span class="k">def</span> <span class="nf">test_z_get_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the relative path to a previously saved pipeline file.</span>

<span class="sd">        - Tests:</span>
<span class="sd">            - PipelineEditorTabs.get_filename_by_index</span>
<span class="sd">            - PipelineEditorTabs.get_current_filename</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span>
            <span class="s2">&quot;processes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;User_processes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;test_pipeline_1.py&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">load_pipeline</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">filename</span><span class="p">,</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_filename_by_index</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_filename_by_index</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">filename</span><span class="p">,</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_filename</span><span class="p">()),</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAPipelineEditor.test_z_get_index">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineEditor.test_z_get_index">[docs]</a>
    <span class="k">def</span> <span class="nf">test_z_get_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the index of an editor.</span>

<span class="sd">        - Tests:</span>
<span class="sd">            - PipelineEditorTabs.get_index_by_tab_name</span>
<span class="sd">            - PipelineEditorTabs.get_index_by_filename</span>
<span class="sd">            - PipelineEditorTabs.get_index_by_editor</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span>
            <span class="s2">&quot;processes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;User_processes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;test_pipeline_1.py&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">load_pipeline</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">editor0</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span>

        <span class="c1"># Create new tab with new editor and make it current</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">new_tab</span><span class="p">()</span>
        <span class="n">editor1</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_index_by_tab_name</span><span class="p">(</span><span class="s2">&quot;test_pipeline_1.py&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_index_by_tab_name</span><span class="p">(</span><span class="s2">&quot;New Pipeline 1&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="kc">None</span><span class="p">,</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_index_by_tab_name</span><span class="p">(</span><span class="s2">&quot;dummy&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_index_by_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="kc">None</span><span class="p">,</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_index_by_filename</span><span class="p">(</span><span class="s2">&quot;dummy&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_index_by_editor</span><span class="p">(</span><span class="n">editor0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_index_by_editor</span><span class="p">(</span><span class="n">editor1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="kc">None</span><span class="p">,</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_index_by_editor</span><span class="p">(</span><span class="s2">&quot;dummy&quot;</span><span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAPipelineEditor.test_z_get_tab_name">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineEditor.test_z_get_tab_name">[docs]</a>
    <span class="k">def</span> <span class="nf">test_z_get_tab_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the tab name of the editor.</span>

<span class="sd">        - Tests:</span>
<span class="sd">            - PipelineEditorTabs.get_tab_name_by_index</span>
<span class="sd">            - PipelineEditorTabs.get_current_tab_name</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s2">&quot;New Pipeline&quot;</span><span class="p">,</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_tab_name_by_index</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_tab_name_by_index</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s2">&quot;New Pipeline&quot;</span><span class="p">,</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_tab_name</span><span class="p">()</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAPipelineEditor.test_z_load_pipeline">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineEditor.test_z_load_pipeline">[docs]</a>
    <span class="k">def</span> <span class="nf">test_z_load_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads a pipeline.&quot;&quot;&quot;</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span>
            <span class="s2">&quot;processes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;User_processes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;test_pipeline_1.py&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">load_pipeline</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestMIAPipelineEditor.test_z_open_sub_pipeline">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineEditor.test_z_open_sub_pipeline">[docs]</a>
    <span class="k">def</span> <span class="nf">test_z_open_sub_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Opens a sub_pipeline.&quot;&quot;&quot;</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>

        <span class="c1"># Adding the &quot;config.get_properties_path()/processes&quot; path to the</span>
        <span class="c1"># system path</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span> <span class="s2">&quot;processes&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Importing the &#39;User_processes&#39; package</span>
        <span class="n">package_name</span> <span class="o">=</span> <span class="s2">&quot;User_processes&quot;</span>
        <span class="nb">__import__</span><span class="p">(</span><span class="n">package_name</span><span class="p">)</span>
        <span class="n">pkg</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">package_name</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">pkg</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">())):</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Test_pipeline_1&quot;</span><span class="p">:</span>
                <span class="n">process_class</span> <span class="o">=</span> <span class="bp">cls</span>

        <span class="c1"># Adding the &quot;test_pipeline_1&quot; as a process</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
            <span class="n">process_class</span>
        <span class="p">)</span>

        <span class="c1"># Opening the sub-pipeline in a new editor</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        <span class="n">process_instance</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;test_pipeline_1_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">open_sub_pipeline</span><span class="p">(</span><span class="n">process_instance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s2">&quot;test_pipeline_1.py&quot;</span><span class="p">,</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_filename_by_index</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAPipelineEditor.test_z_set_current_editor">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineEditor.test_z_set_current_editor">[docs]</a>
    <span class="k">def</span> <span class="nf">test_z_set_current_editor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the current editor.</span>

<span class="sd">        - Tests:</span>
<span class="sd">            - PipelineEditorTabs.set_current_editor_by_tab_name</span>
<span class="sd">            - PipelineEditorTabs.set_current_editor_by_file_name</span>
<span class="sd">            - PipelineEditorTabs.set_current_editor_by_editor</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span>
            <span class="s2">&quot;processes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;User_processes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;test_pipeline_1.py&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">load_pipeline</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">editor0</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span>

        <span class="c1"># create new tab with new editor and make it current:</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">new_tab</span><span class="p">()</span>
        <span class="n">editor1</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span>

        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">set_current_editor_by_tab_name</span><span class="p">(</span>
            <span class="s2">&quot;test_pipeline_1.py&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">set_current_editor_by_tab_name</span><span class="p">(</span><span class="s2">&quot;New Pipeline 1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">set_current_editor_by_file_name</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">set_current_editor_by_editor</span><span class="p">(</span><span class="n">editor1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">set_current_editor_by_editor</span><span class="p">(</span><span class="n">editor0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAPipelineEditor.test_zz_del_pack">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineEditor.test_zz_del_pack">[docs]</a>
    <span class="k">def</span> <span class="nf">test_zz_del_pack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove the bricks created during the unit tests.</span>

<span class="sd">        Take advantage of this to cover the part of the code used to remove the</span>
<span class="sd">        packages.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pkg</span> <span class="o">=</span> <span class="n">PackageLibraryDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="p">)</span>

        <span class="c1"># The Test_pipeline brick was added in the package library</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;Test_pipeline_1&quot;</span>
            <span class="ow">in</span> <span class="n">pkg</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">package_tree</span><span class="p">[</span><span class="s2">&quot;User_processes&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">pkg</span><span class="o">.</span><span class="n">delete_package</span><span class="p">(</span>
            <span class="n">to_delete</span><span class="o">=</span><span class="s2">&quot;User_processes.Test_pipeline_1&quot;</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="c1"># The Test_pipeline brick has been removed from the package library</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span>
            <span class="s2">&quot;Test_pipeline_1&quot;</span>
            <span class="ow">in</span> <span class="n">pkg</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">package_tree</span><span class="p">[</span><span class="s2">&quot;User_processes&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># Restore the initial process library (before test_save_pipeline test)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">usr_proc_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span> <span class="s2">&quot;processes&quot;</span><span class="p">,</span> <span class="s2">&quot;User_processes&quot;</span>
        <span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">usr_proc_folder</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span>
                <span class="s2">&quot;properties&quot;</span><span class="p">,</span>
                <span class="s2">&quot;process_config.yml&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">,</span>
                <span class="s2">&quot;4UTs_TestMIAPipelineEditor&quot;</span><span class="p">,</span>
                <span class="s2">&quot;User_processes&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">usr_proc_folder</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">,</span>
                <span class="s2">&quot;4UTs_TestMIAPipelineEditor&quot;</span><span class="p">,</span>
                <span class="s2">&quot;process_config.yml&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span> <span class="s2">&quot;properties&quot;</span><span class="p">),</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestMIAPipelineManagerTab">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab">[docs]</a>
<span class="k">class</span> <span class="nc">TestMIAPipelineManagerTab</span><span class="p">(</span><span class="n">TestMIACase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests the pipeline manager tab class, part of the homonym tab.</span>

<span class="sd">    :Contains:</span>
<span class="sd">        :Method:</span>
<span class="sd">            - test_add_plug_value_to_database_list_type: adds a list type plug</span>
<span class="sd">              value to the database</span>
<span class="sd">            - test_add_plug_value_to_database_non_list_type: adds a non list</span>
<span class="sd">              type plug value to the database</span>
<span class="sd">            - test_add_plug_value_to_database_several_inputs: exports a non</span>
<span class="sd">              list type input plug and with several possible inputs</span>
<span class="sd">            - test_ask_iterated_pipeline_plugs: test the iteration</span>
<span class="sd">              dialog for each plug of a Rename process</span>
<span class="sd">            - test_build_iterated_pipeline: mocks methods and builds an</span>
<span class="sd">              iterated pipeline</span>
<span class="sd">            - test_check_requirements: checks the requirements for a given node</span>
<span class="sd">            - test_cleanup_older_init: tests the cleaning of old</span>
<span class="sd">              initialisations</span>
<span class="sd">            - test_complete_pipeline_parameters: test the pipeline</span>
<span class="sd">              parameters completion</span>
<span class="sd">            - test_delete_processes: deletes a process and makes the undo/redo</span>
<span class="sd">            - test_end_progress: creates a progress object and tries to end it</span>
<span class="sd">            - test_garbage_collect: collects the garbage of a pipeline</span>
<span class="sd">            - test_get_capsul_engine: gets the capsul engine of the pipeline</span>
<span class="sd">            - test_get_missing_mandatory_parameters: tries to initialize</span>
<span class="sd">              the pipeline with missing mandatory parameters</span>
<span class="sd">            - test_get_pipeline_or_process: gets a pipeline and a process from</span>
<span class="sd">              the pipeline_manager</span>
<span class="sd">            - test_initialize: mocks objects and initializes the workflow</span>
<span class="sd">            - test_register_completion_attributes: mocks methods of the</span>
<span class="sd">              pipeline manager and registers completion attributes</span>
<span class="sd">            - test_register_node_io_in_database: sets input and output</span>
<span class="sd">              parameters and registers them in database</span>
<span class="sd">            - test_remove_progress: removes the progress of the pipeline</span>
<span class="sd">            - test_run: creates a pipeline manager progress object and</span>
<span class="sd">              tries to run it</span>
<span class="sd">            - test_save_pipeline: saves a simple pipeline</span>
<span class="sd">            - test_savePipelineAs: saves a pipeline under another name</span>
<span class="sd">            - test_set_anim_frame: runs the &#39;rotatingBrainVISA.gif&#39; animation</span>
<span class="sd">            - test_show_status: shows the status of pipeline execution</span>
<span class="sd">            - test_stop_execution: shows the status window of the pipeline</span>
<span class="sd">              manager</span>
<span class="sd">            - test_undo_redo: tests the undo/redo feature</span>
<span class="sd">            - test_update_auto_inheritance: updates the job&#39;s auto inheritance</span>
<span class="sd">              dict</span>
<span class="sd">            - test_update_inheritance: updates the job&#39;s inheritance dict</span>
<span class="sd">            - test_update_node_list: initializes a workflow and adds a</span>
<span class="sd">              process to the &quot;pipline_manager.node_list&quot;</span>
<span class="sd">            - test_z_init_pipeline: initializes the pipeline</span>
<span class="sd">            - test_z_runPipeline: adds a processruns a pipeline</span>
<span class="sd">            - test_zz_del_pack: deletion of the brick created during UTs</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_add_plug_value_to_database_list_type">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_add_plug_value_to_database_list_type">[docs]</a>
    <span class="k">def</span> <span class="nf">test_add_plug_value_to_database_list_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Opens a project, adds a &#39;Select&#39; process, exports a list type</span>
<span class="sd">        input plug and adds it to the database.</span>

<span class="sd">        - Tests: PipelineManagerTab(QWidget).add_plug_value_to_database().</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Opens project 8 and switches to it</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_9&quot;</span><span class="p">)</span>

        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
            <span class="s2">&quot;current&quot;</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">DOCUMENT_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
            <span class="s2">&quot;current&quot;</span>
        <span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>

        <span class="c1"># Adds the process Select, creates the &quot;select_1&quot; node</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Select</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Exports the mandatory input and output plugs for &quot;select_1&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s2">&quot;select_1&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="n">pipeline_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="c1"># Initializes the workflow manually</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">workflow</span> <span class="o">=</span> <span class="n">workflow_from_pipeline</span><span class="p">(</span>
            <span class="n">pipeline</span><span class="p">,</span> <span class="n">complete_parameters</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="c1"># Gets the &#39;job&#39; and mocks adding a brick to the collection</span>
        <span class="n">job</span> <span class="o">=</span> <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">jobs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">brick_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="n">job</span><span class="o">.</span><span class="n">uuid</span> <span class="o">=</span> <span class="n">brick_id</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">brick_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">brick_id</span><span class="p">)</span>

        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_document</span><span class="p">(</span>
            <span class="n">COLLECTION_BRICK</span><span class="p">,</span> <span class="n">brick_id</span>
        <span class="p">)</span>

        <span class="c1"># Sets the mandatory plug values corresponding to &quot;inputs&quot; node</span>
        <span class="n">trait_list_inlist</span> <span class="o">=</span> <span class="n">TraitListObject</span><span class="p">(</span>
            <span class="n">InputMultiObject</span><span class="p">(),</span> <span class="n">pipeline</span><span class="p">,</span> <span class="s2">&quot;inlist&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">DOCUMENT_1</span><span class="p">,</span> <span class="n">DOCUMENT_2</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># Mocks the creation of a completion engine</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>
        <span class="n">plug_name</span> <span class="o">=</span> <span class="s2">&quot;inlist&quot;</span>
        <span class="n">trait</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">trait</span><span class="p">(</span><span class="n">plug_name</span><span class="p">)</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">get_inputs</span><span class="p">()</span>

        <span class="c1"># Mocks the attributes dict</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;not_list&quot;</span><span class="p">:</span> <span class="s2">&quot;not_list_value&quot;</span><span class="p">,</span>
            <span class="s2">&quot;small_list&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;list_item1&quot;</span><span class="p">],</span>
            <span class="s2">&quot;large_list&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;list_item1&quot;</span><span class="p">,</span> <span class="s2">&quot;list_item2&quot;</span><span class="p">,</span> <span class="s2">&quot;list_item3&quot;</span><span class="p">],</span>
        <span class="p">}</span>

        <span class="c1"># Adds plug value of type &#39;TraitListObject&#39;</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span>
            <span class="n">trait_list_inlist</span><span class="p">,</span>
            <span class="n">brick_id</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;select_1&quot;</span><span class="p">,</span>
            <span class="n">plug_name</span><span class="p">,</span>
            <span class="s2">&quot;select_1&quot;</span><span class="p">,</span>
            <span class="n">job</span><span class="p">,</span>
            <span class="n">trait</span><span class="p">,</span>
            <span class="n">inputs</span><span class="p">,</span>
            <span class="n">attributes</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Asserts that both &#39;DOCUMENT_1&#39; and &#39;DOCUMENT_2&#39; are stored in</span>
        <span class="c1"># the database</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_document</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">DOCUMENT_1</span>
        <span class="p">)</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_document</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">DOCUMENT_2</span>
        <span class="p">)</span>
        <span class="n">has_document</span> <span class="o">=</span> <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">has_document</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">has_document</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">has_document</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">DOCUMENT_2</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_add_plug_value_to_database_non_list_type">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_add_plug_value_to_database_non_list_type">[docs]</a>
    <span class="k">def</span> <span class="nf">test_add_plug_value_to_database_non_list_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Opens a project, adds a &#39;Rename&#39; process, exports a non list type</span>
<span class="sd">        input plug and adds it to the database.</span>

<span class="sd">        - Tests: PipelineManagerTab(QWidget).add_plug_value_to_database()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Opens project 8 and switches to it</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
            <span class="s2">&quot;current&quot;</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="p">)</span>

        <span class="c1"># Adds the process Rename, creates the &quot;rename_1&quot; node</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Rename</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Exports the mandatory input and output plugs for &quot;rename_1&quot;</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;rename_1&quot;</span>
        <span class="p">)</span>
        <span class="p">(</span>
            <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span>
        <span class="p">)()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="p">(</span>
            <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span>
        <span class="p">)()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="n">old_scan_name</span> <span class="o">=</span> <span class="n">DOCUMENT_1</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">new_scan_name</span> <span class="o">=</span> <span class="s2">&quot;new_name.nii&quot;</span>

        <span class="c1"># Changes the &quot;_out_file&quot; in the &quot;outputs&quot; node</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span>
            <span class="s2">&quot;_out_file&quot;</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old_scan_name</span><span class="p">,</span> <span class="n">new_scan_name</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">pipeline_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">workflow</span> <span class="o">=</span> <span class="n">workflow_from_pipeline</span><span class="p">(</span>
            <span class="n">pipeline</span><span class="p">,</span> <span class="n">complete_parameters</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="n">job</span> <span class="o">=</span> <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">jobs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">brick_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="n">job</span><span class="o">.</span><span class="n">uuid</span> <span class="o">=</span> <span class="n">brick_id</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">brick_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">brick_id</span><span class="p">)</span>

        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_document</span><span class="p">(</span>
            <span class="n">COLLECTION_BRICK</span><span class="p">,</span> <span class="n">brick_id</span>
        <span class="p">)</span>

        <span class="c1"># Sets the mandatory plug values in the &quot;inputs&quot; node</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s2">&quot;format_string&quot;</span><span class="p">,</span> <span class="n">new_scan_name</span><span class="p">)</span>

        <span class="n">process</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>
        <span class="n">plug_name</span> <span class="o">=</span> <span class="s2">&quot;in_file&quot;</span>
        <span class="n">trait</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">trait</span><span class="p">(</span><span class="n">plug_name</span><span class="p">)</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">get_inputs</span><span class="p">()</span>

        <span class="n">attributes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">completion</span> <span class="o">=</span> <span class="n">ProcessCompletionEngine</span><span class="o">.</span><span class="n">get_completion_engine</span><span class="p">(</span><span class="n">process</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">completion</span><span class="p">:</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="n">completion</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">()</span><span class="o">.</span><span class="n">export_to_dict</span><span class="p">()</span>

        <span class="n">has_document</span> <span class="o">=</span> <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">has_document</span>

        <span class="c1"># Plug value is file location outside project directory</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span>
            <span class="n">DOCUMENT_1</span><span class="p">,</span>
            <span class="n">brick_id</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rename_1&quot;</span><span class="p">,</span>
            <span class="n">plug_name</span><span class="p">,</span>
            <span class="s2">&quot;rename_1&quot;</span><span class="p">,</span>
            <span class="n">job</span><span class="p">,</span>
            <span class="n">trait</span><span class="p">,</span>
            <span class="n">inputs</span><span class="p">,</span>
            <span class="n">attributes</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_document</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">DOCUMENT_1</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">has_document</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">))</span>
        <span class="c1"># Plug values outside the directory are not registered into the</span>
        <span class="c1"># database, therefore only plug values inside the project will be used</span>
        <span class="c1"># from now on.</span>

        <span class="c1"># Plug value is file location inside project directory</span>
        <span class="n">inside_project</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span>
            <span class="n">inside_project</span><span class="p">,</span>
            <span class="n">brick_id</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rename_1&quot;</span><span class="p">,</span>
            <span class="n">plug_name</span><span class="p">,</span>
            <span class="s2">&quot;rename_1&quot;</span><span class="p">,</span>
            <span class="n">job</span><span class="p">,</span>
            <span class="n">trait</span><span class="p">,</span>
            <span class="n">inputs</span><span class="p">,</span>
            <span class="n">attributes</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Plug value that is already in the database</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span>
            <span class="n">inside_project</span><span class="p">,</span>
            <span class="n">brick_id</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rename_1&quot;</span><span class="p">,</span>
            <span class="n">plug_name</span><span class="p">,</span>
            <span class="s2">&quot;rename_1&quot;</span><span class="p">,</span>
            <span class="n">job</span><span class="p">,</span>
            <span class="n">trait</span><span class="p">,</span>
            <span class="n">inputs</span><span class="p">,</span>
            <span class="n">attributes</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Plug value is tag</span>
        <span class="n">tag_value</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="s2">&quot;tag.gz&quot;</span><span class="p">)</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span>
            <span class="n">tag_value</span><span class="p">,</span>
            <span class="n">brick_id</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rename_1&quot;</span><span class="p">,</span>
            <span class="n">plug_name</span><span class="p">,</span>
            <span class="s2">&quot;rename_1&quot;</span><span class="p">,</span>
            <span class="n">job</span><span class="p">,</span>
            <span class="n">trait</span><span class="p">,</span>
            <span class="n">inputs</span><span class="p">,</span>
            <span class="n">attributes</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Plug value is .mat</span>
        <span class="n">mat_value</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="s2">&quot;file.mat&quot;</span><span class="p">)</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span>
            <span class="n">mat_value</span><span class="p">,</span>
            <span class="n">brick_id</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rename_1&quot;</span><span class="p">,</span>
            <span class="n">plug_name</span><span class="p">,</span>
            <span class="s2">&quot;rename_1&quot;</span><span class="p">,</span>
            <span class="n">job</span><span class="p">,</span>
            <span class="n">trait</span><span class="p">,</span>
            <span class="n">inputs</span><span class="p">,</span>
            <span class="n">attributes</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Plug value is .txt</span>
        <span class="n">txt_value</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="s2">&quot;file.txt&quot;</span><span class="p">)</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span>
            <span class="n">txt_value</span><span class="p">,</span>
            <span class="n">brick_id</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rename_1&quot;</span><span class="p">,</span>
            <span class="n">plug_name</span><span class="p">,</span>
            <span class="s2">&quot;rename_1&quot;</span><span class="p">,</span>
            <span class="n">job</span><span class="p">,</span>
            <span class="n">trait</span><span class="p">,</span>
            <span class="n">inputs</span><span class="p">,</span>
            <span class="n">attributes</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># &#39;parent_files&#39; are extracted from the &#39;inheritance_dict&#39; and</span>
        <span class="c1"># &#39;auto_inheritance_dict&#39; attributes of &#39;job&#39;. They test cases are</span>
        <span class="c1"># listed below:</span>
        <span class="c1"># &#39;parent_files&#39; inside &#39;auto_inheritance_dict&#39;</span>
        <span class="n">job</span><span class="o">.</span><span class="n">auto_inheritance_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">inside_project</span><span class="p">:</span> <span class="s2">&quot;parent_files_value&quot;</span><span class="p">}</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span>
            <span class="n">inside_project</span><span class="p">,</span>
            <span class="n">brick_id</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rename_1&quot;</span><span class="p">,</span>
            <span class="n">plug_name</span><span class="p">,</span>
            <span class="s2">&quot;rename_1&quot;</span><span class="p">,</span>
            <span class="n">job</span><span class="p">,</span>
            <span class="n">trait</span><span class="p">,</span>
            <span class="n">inputs</span><span class="p">,</span>
            <span class="n">attributes</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># &#39;parent_files&#39; inside &#39;inheritance_dict&#39;</span>
        <span class="n">job</span><span class="o">.</span><span class="n">auto_inheritance_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">job</span><span class="o">.</span><span class="n">inheritance_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">inside_project</span><span class="p">:</span> <span class="s2">&quot;parent_files_value&quot;</span><span class="p">}</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span>
            <span class="n">inside_project</span><span class="p">,</span>
            <span class="n">brick_id</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rename_1&quot;</span><span class="p">,</span>
            <span class="n">plug_name</span><span class="p">,</span>
            <span class="s2">&quot;rename_1&quot;</span><span class="p">,</span>
            <span class="n">job</span><span class="p">,</span>
            <span class="n">trait</span><span class="p">,</span>
            <span class="n">inputs</span><span class="p">,</span>
            <span class="n">attributes</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># &#39;parent_files&#39; inside &#39;inheritance_dict&#39;, dict type</span>
        <span class="n">job</span><span class="o">.</span><span class="n">inheritance_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">inside_project</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;own_tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;tag_name&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;field_type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;description_content&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;visibility&quot;</span><span class="p">:</span> <span class="s2">&quot;visibility_content&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;origin_content&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;unit_content&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;value_content&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;default_value&quot;</span><span class="p">:</span> <span class="s2">&quot;default_value_content&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">],</span>
                <span class="s2">&quot;parent&quot;</span><span class="p">:</span> <span class="s2">&quot;parent_content&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span>
            <span class="n">inside_project</span><span class="p">,</span>
            <span class="n">brick_id</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rename_1&quot;</span><span class="p">,</span>
            <span class="n">plug_name</span><span class="p">,</span>
            <span class="s2">&quot;rename_1&quot;</span><span class="p">,</span>
            <span class="n">job</span><span class="p">,</span>
            <span class="n">trait</span><span class="p">,</span>
            <span class="n">inputs</span><span class="p">,</span>
            <span class="n">attributes</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># &#39;parent_files&#39; inside &#39;inheritance_dict&#39;, output is one of the inputs</span>
        <span class="n">job</span><span class="o">.</span><span class="n">inheritance_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">inside_project</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;own_tags&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;tag_name&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;field_type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;description_content&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;visibility&quot;</span><span class="p">:</span> <span class="s2">&quot;visibility_content&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;origin_content&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;unit_content&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;value_content&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;default_value&quot;</span><span class="p">:</span> <span class="s2">&quot;default_value_content&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">],</span>
                <span class="s2">&quot;parent&quot;</span><span class="p">:</span> <span class="s2">&quot;parent_content&quot;</span><span class="p">,</span>
                <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="n">inside_project</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span>
            <span class="n">inside_project</span><span class="p">,</span>
            <span class="n">brick_id</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rename_1&quot;</span><span class="p">,</span>
            <span class="n">plug_name</span><span class="p">,</span>
            <span class="s2">&quot;rename_1&quot;</span><span class="p">,</span>
            <span class="n">job</span><span class="p">,</span>
            <span class="n">trait</span><span class="p">,</span>
            <span class="n">inputs</span><span class="p">,</span>
            <span class="n">attributes</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_add_plug_value_to_database_several_inputs">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_add_plug_value_to_database_several_inputs">[docs]</a>
    <span class="k">def</span> <span class="nf">test_add_plug_value_to_database_several_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new project folder, adds a &#39;Rename&#39; process, exports a</span>
<span class="sd">        non list type input plug and with several possible inputs.</span>

<span class="sd">        Independently opens an inheritance dict pop-up.</span>

<span class="sd">        The test cases are divided into:</span>
<span class="sd">        - 1) &#39;parent_files&#39; is a dict with 2 keys and identical values</span>
<span class="sd">        - 2) &#39;parent_files&#39; is a dict with 2 keys and distinct values</span>
<span class="sd">        - 3) &#39;mock_key_2&#39; is in &#39;ppl_manager.key&#39; indexed by the node name</span>
<span class="sd">        - 4) &#39;mock_key_2&#39; is in &#39;ppl_manager.key&#39; indexed by the node name +</span>
<span class="sd">             plug value</span>

<span class="sd">        - Tests:</span>
<span class="sd">            - PipelineManagerTab.add_plug_value_to_database</span>
<span class="sd">            - PopUpInheritanceDict.</span>

<span class="sd">        - Mocks:</span>
<span class="sd">            - PopUpInheritanceDict.exec</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">mock_get_document</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">relfile</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Blabla&quot;&quot;&quot;</span>

            <span class="n">SCAN_1_</span> <span class="o">=</span> <span class="n">SCAN_1</span>

            <span class="k">if</span> <span class="n">relfile</span> <span class="o">==</span> <span class="s2">&quot;mock_val_1&quot;</span><span class="p">:</span>
                <span class="n">SCAN_1_</span><span class="o">.</span><span class="n">_values</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Exp Type 1&quot;</span>
                <span class="k">return</span> <span class="n">SCAN_1_</span>
            <span class="k">elif</span> <span class="n">relfile</span> <span class="o">==</span> <span class="s2">&quot;mock_val_2&quot;</span><span class="p">:</span>
                <span class="n">SCAN_1_</span><span class="o">.</span><span class="n">_values</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Exp Type 2&quot;</span>
                <span class="k">return</span> <span class="n">SCAN_1_</span>

            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Those methods are called prior to adding a plug to the database</span>
        <span class="k">def</span> <span class="nf">reset_inheritance_dicts</span><span class="p">():</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Blabla&quot;&quot;&quot;</span>

            <span class="n">job</span><span class="o">.</span><span class="n">inheritance_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">DOCUMENT_1</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
            <span class="n">job</span><span class="o">.</span><span class="n">auto_inheritance_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">DOCUMENT_1</span><span class="p">:</span> <span class="n">parent_files</span><span class="p">}</span>

        <span class="k">def</span> <span class="nf">reset_collections</span><span class="p">():</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Blabla&quot;&quot;&quot;</span>

            <span class="k">if</span> <span class="n">session</span><span class="o">.</span><span class="n">has_document</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">P_VALUE</span><span class="p">):</span>
                <span class="n">session</span><span class="o">.</span><span class="n">remove_document</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">P_VALUE</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">session</span><span class="o">.</span><span class="n">has_document</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">):</span>
                <span class="n">session</span><span class="o">.</span><span class="n">remove_document</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">session</span><span class="o">.</span><span class="n">has_document</span><span class="p">(</span><span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">P_VALUE</span><span class="p">):</span>
                <span class="n">session</span><span class="o">.</span><span class="n">remove_document</span><span class="p">(</span><span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">P_VALUE</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">session</span><span class="o">.</span><span class="n">has_document</span><span class="p">(</span><span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">):</span>
                <span class="n">session</span><span class="o">.</span><span class="n">remove_document</span><span class="p">(</span><span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>

        <span class="c1"># Sets shortcuts for often used objects</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">ppl_edt_tab</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span>

        <span class="c1"># Creates a new project folder and adds one document to the</span>
        <span class="c1"># project, sets the plug value that is added to the database</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span> <span class="o">=</span> <span class="n">project_8_path</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;raw_data&quot;</span><span class="p">)</span>
        <span class="n">NII_FILE_1</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Guerbet-C6-2014-Rat-K52-Tube27-2014-02-14102317-04-G3_&quot;</span>
            <span class="s2">&quot;Guerbet_MDEFT-MDEFTpvm-000940_800.nii&quot;</span>
        <span class="p">)</span>
        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">NII_FILE_1</span><span class="p">))</span>
        <span class="n">P_VALUE</span> <span class="o">=</span> <span class="n">DOCUMENT_1</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="n">session</span><span class="o">.</span><span class="n">add_document</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>

        <span class="c1"># Adds the processes Rename, creates the &quot;rename_1&quot; node</span>
        <span class="n">ppl_edt_tab</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tab</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Rename</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Exports the mandatory input and output plugs for &quot;rename_1&quot;</span>
        <span class="n">ppl_edt_tab</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s2">&quot;rename_1&quot;</span>
        <span class="n">ppl_edt_tab</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tab</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="n">old_scan_name</span> <span class="o">=</span> <span class="n">DOCUMENT_1</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">new_scan_name</span> <span class="o">=</span> <span class="s2">&quot;new_name.nii&quot;</span>

        <span class="c1"># Changes the &quot;_out_file&quot; in the &quot;outputs&quot; node</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span>
            <span class="s2">&quot;_out_file&quot;</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old_scan_name</span><span class="p">,</span> <span class="n">new_scan_name</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">workflow</span> <span class="o">=</span> <span class="n">workflow_from_pipeline</span><span class="p">(</span>
            <span class="n">pipeline</span><span class="p">,</span> <span class="n">complete_parameters</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="n">job</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">jobs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">brick_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="n">job</span><span class="o">.</span><span class="n">uuid</span> <span class="o">=</span> <span class="n">brick_id</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">brick_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">brick_id</span><span class="p">)</span>

        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_document</span><span class="p">(</span><span class="n">COLLECTION_BRICK</span><span class="p">,</span> <span class="n">brick_id</span><span class="p">)</span>

        <span class="c1"># Sets the mandatory plug values in the &quot;inputs&quot; node</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s2">&quot;format_string&quot;</span><span class="p">,</span> <span class="n">new_scan_name</span><span class="p">)</span>

        <span class="n">process</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>
        <span class="n">plug_name</span> <span class="o">=</span> <span class="s2">&quot;in_file&quot;</span>
        <span class="n">trait</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">trait</span><span class="p">(</span><span class="n">plug_name</span><span class="p">)</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">get_inputs</span><span class="p">()</span>

        <span class="n">attributes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">completion</span> <span class="o">=</span> <span class="n">ProcessCompletionEngine</span><span class="o">.</span><span class="n">get_completion_engine</span><span class="p">(</span><span class="n">process</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">completion</span><span class="p">:</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="n">completion</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">()</span><span class="o">.</span><span class="n">export_to_dict</span><span class="p">()</span>

        <span class="c1"># Mocks the document getter to always return a scan</span>
        <span class="n">SCAN_1</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get_document</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">get_document</span> <span class="o">=</span> <span class="n">mock_get_document</span>

        <span class="c1"># Mocks the value setter on the session</span>
        <span class="n">session</span><span class="o">.</span><span class="n">set_values</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>

        <span class="c1"># 1) &#39;parent_files&#39; is a dict with 2 keys and identical values</span>
        <span class="n">parent_files</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;mock_key_1&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="s2">&quot;mock_val_1&quot;</span>
            <span class="p">),</span>
            <span class="s2">&quot;mock_key_2&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="s2">&quot;mock_val_1&quot;</span>
            <span class="p">),</span>
        <span class="p">}</span>

        <span class="n">reset_inheritance_dicts</span><span class="p">()</span>
        <span class="n">reset_collections</span><span class="p">()</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">DOCUMENT_1</span><span class="p">,</span>
            <span class="n">brick_id</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rename_1&quot;</span><span class="p">,</span>
            <span class="n">plug_name</span><span class="p">,</span>
            <span class="s2">&quot;rename_1&quot;</span><span class="p">,</span>
            <span class="n">job</span><span class="p">,</span>
            <span class="n">trait</span><span class="p">,</span>
            <span class="n">inputs</span><span class="p">,</span>
            <span class="n">attributes</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

        <span class="c1"># Mocks the execution of &#39;PopUpInheritanceDict&#39; to avoid</span>
        <span class="c1"># asynchronous shot</span>
        <span class="n">PopUpInheritanceDict</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>

        <span class="c1"># 2) &#39;parent_files&#39; is a dict with 2 keys and distinct values</span>
        <span class="c1"># Triggers the execution of &#39;PopUpInheritanceDict&#39;</span>
        <span class="n">parent_files</span><span class="p">[</span><span class="s2">&quot;mock_key_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="s2">&quot;mock_val_2&quot;</span>
        <span class="p">)</span>

        <span class="n">reset_inheritance_dicts</span><span class="p">()</span>
        <span class="n">reset_collections</span><span class="p">()</span>

        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

        <span class="c1"># 3) &#39;mock_key_2&#39; is in &#39;ppl_manager.key&#39; indexed by the node name</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rename_1&quot;</span><span class="p">:</span> <span class="s2">&quot;mock_key_2&quot;</span><span class="p">}</span>

        <span class="n">reset_inheritance_dicts</span><span class="p">()</span>
        <span class="n">reset_collections</span><span class="p">()</span>

        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

        <span class="c1"># 4) &#39;mock_key_2&#39; is in &#39;ppl_manager.key&#39; indexed by the node name</span>
        <span class="c1"># + plug value</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rename_1in_file&quot;</span><span class="p">:</span> <span class="s2">&quot;mock_key_2&quot;</span><span class="p">}</span>

        <span class="n">reset_inheritance_dicts</span><span class="p">()</span>
        <span class="n">reset_collections</span><span class="p">()</span>

        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

        <span class="c1"># Independently tests &#39;PopUpInheritanceDict&#39;</span>
        <span class="n">pop_up</span> <span class="o">=</span> <span class="n">PopUpInheritanceDict</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;mock_key&quot;</span><span class="p">:</span> <span class="s2">&quot;mock_value&quot;</span><span class="p">},</span>
            <span class="s2">&quot;mock_full_name&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mock_plug_name&quot;</span><span class="p">,</span>
            <span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">pop_up</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">()</span>
        <span class="n">pop_up</span><span class="o">.</span><span class="n">okall_clicked</span><span class="p">()</span>
        <span class="n">pop_up</span><span class="o">.</span><span class="n">ignore_clicked</span><span class="p">()</span>
        <span class="n">pop_up</span><span class="o">.</span><span class="n">ignoreall_clicked</span><span class="p">()</span>
        <span class="n">pop_up</span><span class="o">.</span><span class="n">ignore_node_clicked</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_ask_iterated_pipeline_plugs">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_ask_iterated_pipeline_plugs">[docs]</a>
    <span class="k">def</span> <span class="nf">test_ask_iterated_pipeline_plugs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds the process &#39;Rename&#39;, export mandatory input and output plug</span>
<span class="sd">        and opens an iteration dialog for each plug.</span>

<span class="sd">        - Tests: PipelineManagerTab.ask_iterated_pipeline_plugs</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>

        <span class="c1"># Adds the processes Rename, creates the &quot;rename_1&quot; node</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Rename</span><span class="p">)</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        <span class="n">pipeline_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="c1"># Exports the mandatory input and output plugs for &quot;rename_1&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s2">&quot;rename_1&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="c1"># Mocks executing a dialog box and clicking close</span>
        <span class="n">QDialog</span><span class="o">.</span><span class="n">exec_</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">self_</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">self_</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>

        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">ask_iterated_pipeline_plugs</span><span class="p">(</span><span class="n">pipeline</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_build_iterated_pipeline">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_build_iterated_pipeline">[docs]</a>
    <span class="k">def</span> <span class="nf">test_build_iterated_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a &#39;Select&#39; process, exports its mandatory inputs, mocks</span>
<span class="sd">        some methods of the pipeline manager and builds an iterated pipeline.</span>

<span class="sd">        - Tests:&#39;PipelineManagerTab.build_iterated_pipeline&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="c1"># Adds the processes Select, creates the &quot;select_1&quot; node</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Select</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Exports the mandatory input and output plugs for &quot;select_1&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s2">&quot;select_1&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="c1"># Mocks &#39;parent_pipeline&#39; and returns a &#39;Process&#39; instead of a</span>
        <span class="c1"># &#39;Pipeline&#39;</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;select_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">parent_pipeline</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">get_pipeline_or_process</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">pipeline</span><span class="p">)</span>

        <span class="c1"># Mocks &#39;ask_iterated_pipeline_plugs&#39; and returns the tuple</span>
        <span class="c1"># &#39;(iterated_plugs, database_plugs)&#39;</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">ask_iterated_pipeline_plugs</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span>
            <span class="n">return_value</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="s2">&quot;inlist&quot;</span><span class="p">,</span> <span class="s2">&quot;_out&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;inlist&quot;</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="c1"># Mocks &#39;update_nodes_and_plugs_activation&#39; with no returned values</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">update_nodes_and_plugs_activation</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>

        <span class="c1"># Builds iterated pipeline</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">** An exception message is expected below</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">build_iterated_pipeline</span><span class="p">()</span>

        <span class="c1"># Asserts the mock methods were called as expected</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">get_pipeline_or_process</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">ask_iterated_pipeline_plugs</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span>
            <span class="n">pipeline</span>
        <span class="p">)</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">update_nodes_and_plugs_activation</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_check_requirements">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_check_requirements">[docs]</a>
    <span class="k">def</span> <span class="nf">test_check_requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a &#39;Select&#39; process, appends it to the nodes list and checks</span>
<span class="sd">        the requirements for the given node.</span>

<span class="sd">        - Tests: PipelineManagerTab.check_requirements</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">pipeline_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="c1"># Adds the processes Select, creates the &quot;select_1&quot; node</span>
        <span class="n">process_class</span> <span class="o">=</span> <span class="n">Select</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">process_class</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Appends a &#39;Process&#39; to &#39;pipeline_manager.node_list&#39; and checks</span>
        <span class="c1"># requirements</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">node_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;select_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">check_requirements</span><span class="p">()</span>

        <span class="c1"># Asserts the output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="nb">dict</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">config</span><span class="p">))]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;capsul_engine&quot;</span><span class="p">,</span> <span class="s2">&quot;capsul.engine.module.nipype&quot;</span><span class="p">]</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_cleanup_older_init">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_cleanup_older_init">[docs]</a>
    <span class="k">def</span> <span class="nf">test_cleanup_older_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mocks a brick list, mocks some methods from the pipeline manager</span>
<span class="sd">        and cleans up old initialization results.</span>

<span class="sd">        - Tests: PipelineManagerTab.cleanup_older_init</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="c1"># Mocks a &#39;pipeline_manager.brick_list&#39;</span>
        <span class="n">brick_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">brick_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">brick_id</span><span class="p">)</span>

        <span class="c1"># Mocks methods used in the test</span>
        <span class="p">(</span>
            <span class="n">ppl_manager</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">delete_from_brick</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">cleanup_orphan_nonexisting_files</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>

        <span class="c1"># Cleans up older init</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">cleanup_older_init</span><span class="p">()</span>

        <span class="c1"># Asserts that the mock methods were called as expected</span>
        <span class="c1"># fmt: off</span>
        <span class="p">(</span>
            <span class="n">ppl_manager</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">delete_from_brick</span><span class="o">.</span>
            <span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">brick_id</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="p">(</span>
            <span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">cleanup_orphan_nonexisting_files</span><span class="o">.</span>
            <span class="n">assert_called_once_with</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># fmt: on</span>

        <span class="c1"># Asserts that both &#39;brick_list&#39; and &#39;node_list&#39; were cleaned</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">brick_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">node_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_complete_pipeline_parameters">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_complete_pipeline_parameters">[docs]</a>
    <span class="k">def</span> <span class="nf">test_complete_pipeline_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mocks a method of pipeline manager and completes the pipeline</span>
<span class="sd">        parameters.</span>

<span class="sd">        - Tests: PipelineManagerTab.complete_pipeline_parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="c1"># Mocks method used in the test</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">get_capsul_engine</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span>
            <span class="n">return_value</span><span class="o">=</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">get_pipeline_or_process</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="c1"># Complete pipeline parameters</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">complete_pipeline_parameters</span><span class="p">()</span>

        <span class="c1"># Asserts that the mock method was called as expected</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">get_capsul_engine</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_delete_processes">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_delete_processes">[docs]</a>
    <span class="k">def</span> <span class="nf">test_delete_processes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deletes a process and makes the undo/redo action.&quot;&quot;&quot;</span>

        <span class="n">pipeline_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="p">)</span>

        <span class="c1"># Adding processes</span>
        <span class="n">process_class</span> <span class="o">=</span> <span class="n">Smooth</span>

        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="c1"># Creates a node called &quot;smooth_1&quot;</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
            <span class="n">process_class</span>
        <span class="p">)</span>
        <span class="c1"># Creates a node called &quot;smooth_2&quot;</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
            <span class="n">process_class</span>
        <span class="p">)</span>
        <span class="c1"># Creates a node called &quot;smooth_3&quot;</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
            <span class="n">process_class</span>
        <span class="p">)</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_3&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">,</span> <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">,</span> <span class="s2">&quot;in_files&quot;</span><span class="p">),</span>
            <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">weak</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">,</span> <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;smooth_3&quot;</span><span class="p">,</span> <span class="s2">&quot;in_files&quot;</span><span class="p">),</span>
            <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">weak</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_3&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;smooth_2&quot;</span>
        <span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">del_node</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_3&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_3&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">undo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_3&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_3&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">redo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_3&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_3&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_end_progress">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_end_progress">[docs]</a>
    <span class="k">def</span> <span class="nf">test_end_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a pipeline manager progress object and tries to end it.</span>

<span class="sd">        - Tests RunProgress.end_progress</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">ppl</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Creates a &#39;RunProgress&#39; object</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="n">RunProgress</span><span class="p">(</span><span class="n">ppl_manager</span><span class="p">)</span>

        <span class="c1"># &#39;ppl_manager.worker&#39; does not have a &#39;exec_id&#39;</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">end_progress</span><span class="p">()</span>

        <span class="c1"># Mocks an &#39;exec_id&#39; and an &#39;get_pipeline_or_process&#39;</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">exec_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="n">engine</span> <span class="o">=</span> <span class="n">ppl</span><span class="o">.</span><span class="n">get_study_config</span><span class="p">()</span><span class="o">.</span><span class="n">engine</span>
        <span class="n">engine</span><span class="o">.</span><span class="n">raise_for_status</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>

        <span class="c1"># Ends the progress with success</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">end_progress</span><span class="p">()</span>

        <span class="n">engine</span><span class="o">.</span><span class="n">raise_for_status</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span>
            <span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
            <span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">exec_id</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Mocks a &#39;WorkflowExecutionError&#39; exception</span>
        <span class="n">engine</span><span class="o">.</span><span class="n">raise_for_status</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span>
            <span class="n">side_effect</span><span class="o">=</span><span class="n">WorkflowExecutionError</span><span class="p">({},</span> <span class="p">{},</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="p">)</span></div>


        <span class="c1"># Raises a &#39;WorkflowExecutionError&#39; while ending progress</span>
        <span class="c1"># ppl_manager.progress.end_progress()</span>
        <span class="c1"># FIXME: the above call to the function leads to a Segmentation</span>
        <span class="c1">#        fault when the test routine is launched in AppVeyor.</span>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_garbage_collect">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_garbage_collect">[docs]</a>
    <span class="k">def</span> <span class="nf">test_garbage_collect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mocks several objects of the pipeline manager and collects the</span>
<span class="sd">        garbage of the pipeline.</span>

<span class="sd">        - Tests: PipelineManagerTab.test_garbage_collect</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="c1"># INTEGRATED TEST</span>

        <span class="c1"># Mocks the &#39;initialized&#39; object</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">initialized</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Collects the garbage</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">garbage_collect</span><span class="p">()</span>

        <span class="c1"># Asserts that the &#39;initialized&#39; object changed state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span>
            <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">initialized</span>
        <span class="p">)</span>

        <span class="c1"># ISOLATED TEST</span>

        <span class="c1"># Mocks again the &#39;initialized&#39; object</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">initialized</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Mocks the methods used in the test</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">postprocess_pipeline_execution</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">cleanup_orphan_nonexisting_files</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">cleanup_orphan_history</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
        <span class="p">(</span>
            <span class="n">ppl_manager</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">update_table</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">update_user_buttons_states</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>

        <span class="c1"># Collects the garbage</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">garbage_collect</span><span class="p">()</span>

        <span class="c1"># Asserts that the &#39;initialized&#39; object changed state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span>
            <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">initialized</span>
        <span class="p">)</span>

        <span class="c1"># Asserts that the mocked methods were called as expected</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">postprocess_pipeline_execution</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">()</span>
        <span class="c1"># fmt: off</span>
        <span class="p">(</span>
            <span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">cleanup_orphan_nonexisting_files</span><span class="o">.</span>
            <span class="n">assert_called_once_with</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># fmt: on</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">cleanup_orphan_history</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">()</span>
        <span class="c1"># fmt:off</span>
        <span class="p">(</span>
            <span class="n">ppl_manager</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">update_table</span><span class="o">.</span>
            <span class="n">assert_called_once_with</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># fmt:on</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">update_user_buttons_states</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_get_capsul_engine">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_get_capsul_engine">[docs]</a>
    <span class="k">def</span> <span class="nf">test_get_capsul_engine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mocks an object in the pipeline manager and gets the capsul engine</span>
<span class="sd">        of the pipeline.</span>

<span class="sd">        - Tests: PipelineManagerTab.get_capsul_engine</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="c1"># INTEGRATED</span>

        <span class="c1"># Gets the capsul engine</span>
        <span class="n">capsul_engine</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">get_capsul_engine</span><span class="p">()</span>

        <span class="c1"># Asserts that the &#39;capsul_engine&#39; is of class &#39;CapsulEngine&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">capsul_engine</span><span class="p">,</span> <span class="n">CapsulEngine</span><span class="p">)</span>

        <span class="c1"># ISOLATED</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_capsul_engine</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>

        <span class="c1"># Gets the capsul engine</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">get_capsul_engine</span><span class="p">()</span>

        <span class="c1"># Asserts that the mocked method was called as expected</span>
        <span class="c1"># fmt: off</span>
        <span class="p">(</span>
            <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_capsul_engine</span><span class="o">.</span>
            <span class="n">assert_called_once_with</span><span class="p">()</span>
        <span class="p">)</span></div>

        <span class="c1"># fmt: on</span>

<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_get_missing_mandatory_parameters">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_get_missing_mandatory_parameters">[docs]</a>
    <span class="k">def</span> <span class="nf">test_get_missing_mandatory_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a process, exports input and output plugs and tries to initialize</span>
<span class="sd">        the pipeline with missing mandatory parameters.</span>

<span class="sd">        -Tests: PipelineManagerTab.get_missing_mandatory_parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>

        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Rename</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Exports the mandatory inputs and outputs for &quot;rename_1&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s2">&quot;rename_1&quot;</span>
        <span class="p">(</span>
            <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span>
        <span class="p">)()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">_export_plug</span><span class="p">(</span>
            <span class="n">temp_plug_name</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;rename_1&quot;</span><span class="p">,</span> <span class="s2">&quot;_out_file&quot;</span><span class="p">),</span>
            <span class="n">pipeline_parameter</span><span class="o">=</span><span class="s2">&quot;_out_file&quot;</span><span class="p">,</span>
            <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">weak_link</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Initializes the pipeline</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">workflow</span> <span class="o">=</span> <span class="n">workflow_from_pipeline</span><span class="p">(</span>
            <span class="n">pipeline</span><span class="p">,</span> <span class="n">complete_parameters</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">update_node_list</span><span class="p">()</span>

        <span class="c1"># Asserts that 2 mandatory parameters are missing</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">update_node_list</span><span class="p">()</span>
        <span class="n">missing_inputs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">get_missing_mandatory_parameters</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">missing_inputs</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">missing_inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;rename_1.format_string&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">missing_inputs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;rename_1.in_file&quot;</span><span class="p">)</span>

        <span class="c1"># Empties the jobs list</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">jobs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Asserts that 2 mandatory parameters are still missing</span>
        <span class="n">missing_inputs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">get_missing_mandatory_parameters</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">missing_inputs</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">missing_inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;rename_1.format_string&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">missing_inputs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;rename_1.in_file&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_get_pipeline_or_process">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_get_pipeline_or_process">[docs]</a>
    <span class="k">def</span> <span class="nf">test_get_pipeline_or_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a process and gets a pipeline and a process from the pipeline</span>
<span class="sd">        manager.</span>

<span class="sd">        - Tests: PipelineManagerTab.get_pipeline_or_process</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Sets shortcuts for often used objects</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>

        <span class="c1"># Gets the pipeline</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">get_pipeline_or_process</span><span class="p">()</span>

        <span class="c1"># Asserts that the object &#39;pipeline&#39; is a &#39;Pipeline&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">)</span>

        <span class="c1"># Adds the processes Rename, creates the &quot;rename_1&quot; node</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Rename</span><span class="p">)</span>

        <span class="c1"># Gets a process</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">get_pipeline_or_process</span><span class="p">()</span>

        <span class="c1"># Asserts that the process &#39;pipeline&#39; is indeed a &#39;NipypeProcess&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="n">NipypeProcess</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_initialize">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_initialize">[docs]</a>
    <span class="k">def</span> <span class="nf">test_initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds Select process, exports its plugs, mocks objects from the</span>
<span class="sd">        pipeline manager and initializes the workflow.</span>

<span class="sd">        - Tests: the PipelineManagerTab.initialize</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Gets the paths of 2 documents</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))),</span>
            <span class="s2">&quot;miautdata&quot;</span><span class="p">,</span>
            <span class="s2">&quot;resources&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mia&quot;</span><span class="p">,</span>
            <span class="s2">&quot;project_8&quot;</span><span class="p">,</span>
            <span class="s2">&quot;data&quot;</span><span class="p">,</span>
            <span class="s2">&quot;raw_data&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">NII_FILE_1</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Guerbet-C6-2014-Rat-K52-Tube27-2014-02-14102317-04-G3_&quot;</span>
            <span class="s2">&quot;Guerbet_MDEFT-MDEFTpvm-000940_800.nii&quot;</span>
        <span class="p">)</span>

        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">NII_FILE_1</span><span class="p">))</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>

        <span class="c1"># Adds the process &#39;Rename&#39; as the node &#39;rename_1&#39;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Rename</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Exports the mandatory inputs and outputs for &#39;select_1&#39;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s2">&quot;rename_1&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="c1"># Sets mandatory parameters &#39;select_1&#39;</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s2">&quot;format_string&quot;</span><span class="p">,</span> <span class="s2">&quot;new_name.nii&quot;</span><span class="p">)</span>

        <span class="c1"># Checks that there is no workflow index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">workflow</span><span class="p">)</span>

        <span class="c1"># Mocks objects</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_clicked</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">ignore_node</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;item_value&quot;</span><span class="p">}</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">ignore</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;item_value&quot;</span><span class="p">}</span>

        <span class="c1"># Mocks methods</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
        <span class="c1"># FIXME: if the method &#39;init_pipeline&#39; is not mocked the whole</span>
        <span class="c1">#        test routine fails with a &#39;Segmentation Fault&#39;</span>

        <span class="c1"># Initializes the pipeline</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

        <span class="c1"># Asserts that a workflow has been created</span>
        <span class="c1"># self.assertIsNotNone(ppl_manager.workflow)</span>
        <span class="c1"># from soma_workflow.client_types import Workflow</span>
        <span class="c1"># self.assertIsInstance(ppl_manager.workflow, Workflow)</span>
        <span class="c1"># FiXME: the above code else leads to &#39;Segmentation Fault&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">ignore_node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">key</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">ignore</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">()</span>

        <span class="c1"># Mocks an object to induce an exception</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Induces an exception in the pipeline initialization</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">** an exception message is expected below&quot;</span><span class="p">)</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">ignore_node</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_register_completion_attributes">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_register_completion_attributes">[docs]</a>
    <span class="k">def</span> <span class="nf">test_register_completion_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mocks methods of the pipeline manager and registers completion</span>
<span class="sd">        attributes.</span>

<span class="sd">        Since a method of the ProcessCompletionEngine class is mocked,</span>
<span class="sd">        this test may render the upcoming test routine unstable.</span>

<span class="sd">        - Tests: PipelineManagerTab.register_completion_attributes</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">ppl</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Gets the path of one document</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))),</span>
            <span class="s2">&quot;miautdata&quot;</span><span class="p">,</span>
            <span class="s2">&quot;resources&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mia&quot;</span><span class="p">,</span>
            <span class="s2">&quot;project_8&quot;</span><span class="p">,</span>
            <span class="s2">&quot;data&quot;</span><span class="p">,</span>
            <span class="s2">&quot;raw_data&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">NII_FILE_1</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Guerbet-C6-2014-Rat-K52-Tube27-2014-02-14102317-01-G1_&quot;</span>
            <span class="s2">&quot;Guerbet_Anat-RAREpvm-000220_000.nii&quot;</span>
        <span class="p">)</span>
        <span class="n">NII_FILE_2</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Guerbet-C6-2014-Rat-K52-Tube27-2014-02-14102317-04-G3_&quot;</span>
            <span class="s2">&quot;Guerbet_MDEFT-MDEFTpvm-000940_800.nii&quot;</span>
        <span class="p">)</span>

        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">NII_FILE_1</span><span class="p">))</span>
        <span class="n">DOCUMENT_2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">NII_FILE_2</span><span class="p">))</span>

        <span class="c1"># Adds a Select processes, creates the &#39;select_1&#39; node</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Select</span><span class="p">)</span>

        <span class="c1"># Export plugs and sets their values</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">** an exception message is expected below</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s2">&quot;inlist&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">DOCUMENT_1</span><span class="p">,</span> <span class="n">DOCUMENT_2</span><span class="p">])</span>
        <span class="n">proj_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span><span class="p">)),</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">proj_dir</span><span class="p">,</span> <span class="s2">&quot;output_file.nii&quot;</span><span class="p">)</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s2">&quot;_out&quot;</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span>

        <span class="c1"># Register completion without &#39;attributes&#39;</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">register_completion_attributes</span><span class="p">(</span><span class="n">ppl</span><span class="p">)</span>

        <span class="c1"># Mocks &#39;get_capsul_engine&#39; for the method not to throw an error</span>
        <span class="c1"># with the insertion of the upcoming mock</span>
        <span class="n">capsul_engine</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_capsul_engine</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">get_capsul_engine</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">capsul_engine</span><span class="p">)</span>

        <span class="c1"># Mocks attributes values that are in the tags list</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Checksum&quot;</span><span class="p">:</span> <span class="s2">&quot;Checksum_value&quot;</span><span class="p">}</span>
        <span class="p">(</span>
            <span class="n">ProcessCompletionEngine</span><span class="o">.</span><span class="n">get_completion_engine</span><span class="p">(</span>
                <span class="n">ppl</span>
            <span class="p">)</span><span class="o">.</span><span class="n">get_attribute_values</span>
        <span class="p">)()</span><span class="o">.</span><span class="n">export_to_dict</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">attributes</span><span class="p">)</span>

        <span class="c1"># Register completion with mocked &#39;attributes&#39;</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">register_completion_attributes</span><span class="p">(</span><span class="n">ppl</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_register_node_io_in_database">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_register_node_io_in_database">[docs]</a>
    <span class="k">def</span> <span class="nf">test_register_node_io_in_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a process, sets input and output parameters and registers them</span>
<span class="sd">        in database.</span>

<span class="sd">        - Tests: PipelineManagerTab._register_node_io_in_database</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Opens project 8 and switches to it</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_9&quot;</span><span class="p">)</span>

        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
            <span class="s2">&quot;current&quot;</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="p">)</span>

        <span class="c1"># Adds the processes Rename, creates the &quot;rename_1&quot; node</span>
        <span class="n">process_class</span> <span class="o">=</span> <span class="n">Rename</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
            <span class="n">process_class</span>
        <span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Exports the mandatory input and output plugs for &quot;rename_1&quot;</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;rename_1&quot;</span>
        <span class="p">)</span>
        <span class="p">(</span>
            <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span>
        <span class="p">)()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="p">(</span>
            <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span>
        <span class="p">)()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="n">old_scan_name</span> <span class="o">=</span> <span class="n">DOCUMENT_1</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">new_scan_name</span> <span class="o">=</span> <span class="s2">&quot;new_name.nii&quot;</span>

        <span class="c1"># Sets the mandatory plug values in the &quot;inputs&quot; node</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s2">&quot;format_string&quot;</span><span class="p">,</span> <span class="n">new_scan_name</span><span class="p">)</span>

        <span class="c1"># Changes the &quot;_out_file&quot; in the &quot;outputs&quot; node</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span>
            <span class="s2">&quot;_out_file&quot;</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old_scan_name</span><span class="p">,</span> <span class="n">new_scan_name</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">pipeline_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">workflow</span> <span class="o">=</span> <span class="n">workflow_from_pipeline</span><span class="p">(</span>
            <span class="n">pipeline</span><span class="p">,</span> <span class="n">complete_parameters</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="n">job</span> <span class="o">=</span> <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">jobs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">brick_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="n">job</span><span class="o">.</span><span class="n">uuid</span> <span class="o">=</span> <span class="n">brick_id</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">brick_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">brick_id</span><span class="p">)</span>

        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_document</span><span class="p">(</span>
            <span class="n">COLLECTION_BRICK</span><span class="p">,</span> <span class="n">brick_id</span>
        <span class="p">)</span>

        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">_register_node_io_in_database</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">process</span><span class="p">())</span>

        <span class="c1"># Simulates a &#39;ProcessNode()&#39; as &#39;process&#39;</span>
        <span class="n">process_node</span> <span class="o">=</span> <span class="n">ProcessNode</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">process</span><span class="p">())</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">_register_node_io_in_database</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">process_node</span><span class="p">)</span>

        <span class="c1"># Simulates a &#39;PipelineNode()&#39; as &#39;process&#39;</span>
        <span class="n">pipeline_node</span> <span class="o">=</span> <span class="n">PipelineNode</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">process</span><span class="p">())</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">_register_node_io_in_database</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">pipeline_node</span><span class="p">)</span>

        <span class="c1"># Simulates a &#39;Switch()&#39; as &#39;process&#39;</span>
        <span class="n">switch</span> <span class="o">=</span> <span class="n">Switch</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">])</span>
        <span class="n">switch</span><span class="o">.</span><span class="n">completion_engine</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">_register_node_io_in_database</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">switch</span><span class="p">)</span>

        <span class="c1"># Simulates a list of outputs in &#39;process&#39;</span>
        <span class="n">job</span><span class="o">.</span><span class="n">process</span><span class="p">()</span><span class="o">.</span><span class="n">list_outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">job</span><span class="o">.</span><span class="n">process</span><span class="p">()</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">_register_node_io_in_database</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">process</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_remove_progress">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_remove_progress">[docs]</a>
    <span class="k">def</span> <span class="nf">test_remove_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mocks an object of the pipeline manager and removes its progress.</span>

<span class="sd">        - Tests: PipelineManagerTab.remove_progress</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="c1"># Mocks the &#39;progress&#39; object</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="n">RunProgress</span><span class="p">(</span><span class="n">ppl_manager</span><span class="p">)</span>

        <span class="c1"># Removes progress</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">remove_progress</span><span class="p">()</span>

        <span class="c1"># Asserts that the object &#39;progress&#39; was deleted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">ppl_manager</span><span class="p">,</span> <span class="s2">&quot;progress&quot;</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_run">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_run">[docs]</a>
    <span class="k">def</span> <span class="nf">test_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a process, creates a pipeline manager progress object and</span>
<span class="sd">        tries to run it while mocking methods of the pipeline manager.</span>

<span class="sd">        - Tests: RunWorker.run</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">ppl</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))),</span>
            <span class="s2">&quot;miautdata&quot;</span><span class="p">,</span>
            <span class="s2">&quot;resources&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mia&quot;</span><span class="p">,</span>
            <span class="s2">&quot;project_8&quot;</span><span class="p">,</span>
            <span class="s2">&quot;data&quot;</span><span class="p">,</span>
            <span class="s2">&quot;raw_data&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">NII_FILE_1</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Guerbet-C6-2014-Rat-K52-Tube27-2014-02-14102317-01-G1_&quot;</span>
            <span class="s2">&quot;Guerbet_Anat-RAREpvm-000220_000.nii&quot;</span>
        <span class="p">)</span>

        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">NII_FILE_1</span><span class="p">))</span>

        <span class="c1"># Adds a Rename processes, creates the &#39;rename_1&#39; node</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Rename</span><span class="p">)</span>

        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="c1"># Sets the mandatory parameters</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s2">&quot;format_string&quot;</span><span class="p">,</span> <span class="s2">&quot;new_name.nii&quot;</span><span class="p">)</span>

        <span class="c1"># Creates a &#39;RunProgress&#39; object</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="n">RunProgress</span><span class="p">(</span><span class="n">ppl_manager</span><span class="p">)</span>

        <span class="c1"># Mocks a node that does not have a process and a node that has</span>
        <span class="c1"># a pipeline as a process</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;switch&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Switch</span><span class="p">(</span><span class="n">ppl</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">])</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;pipeline&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ProcessNode</span><span class="p">(</span><span class="n">ppl</span><span class="p">,</span> <span class="s2">&quot;pipeline&quot;</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">())</span>

        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

        <span class="c1"># Mocks &#39;get_pipeline_or_process&#39; to return a &#39;NipypeProcess&#39; instead</span>
        <span class="c1"># of a &#39;Pipeline&#39; and &#39;postprocess_pipeline_execution&#39; to throw an</span>
        <span class="c1"># exception</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="n">RunProgress</span><span class="p">(</span><span class="n">ppl_manager</span><span class="p">)</span>
        <span class="c1"># fmt: off</span>
        <span class="p">(</span>
            <span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span>
            <span class="n">get_pipeline_or_process</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;rename_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span><span class="p">)</span>
        <span class="p">(</span>
            <span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span>
            <span class="n">postprocess_pipeline_execution</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">side_effect</span><span class="o">=</span><span class="ne">ValueError</span><span class="p">())</span>
        <span class="c1"># fmt: on</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">** an exception message is expected below</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

        <span class="c1"># Mocks an interruption request</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">interrupt_request</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_savePipeline">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_savePipeline">[docs]</a>
    <span class="k">def</span> <span class="nf">test_savePipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mocks methods of the pipeline manager and tries to save the pipeline</span>
<span class="sd">        over several conditions.</span>

<span class="sd">        -Tests: PipelineManagerTab.savePipeline</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">click_yes</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Blabla&quot;&quot;&quot;</span>

            <span class="n">close_button</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">)</span>
            <span class="n">QTest</span><span class="o">.</span><span class="n">mouseClick</span><span class="p">(</span><span class="n">close_button</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>

        <span class="c1"># Set shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">ppl_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span>
            <span class="s2">&quot;processes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;User_processes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;test_pipeline_1.py&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">_pipeline_filename</span> <span class="o">=</span> <span class="n">ppl_path</span>

        <span class="c1"># Save pipeline as with empty filename, unchecked</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">savePipeline</span><span class="p">(</span><span class="n">uncheck</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Mocks &#39;savePipeline&#39; from &#39;ppl_edt_tabs&#39;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">save_pipeline</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="s2">&quot;not_empty&quot;</span><span class="p">)</span>

        <span class="c1"># Saves pipeline as with empty filename, checked</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">savePipeline</span><span class="p">(</span><span class="n">uncheck</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Sets the path to save the pipeline</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">_pipeline_filename</span> <span class="o">=</span> <span class="n">ppl_path</span>

        <span class="c1"># Saves pipeline as with filled filename, uncheck</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">savePipeline</span><span class="p">(</span><span class="n">uncheck</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Mocks executing a dialog box and clicking close</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">self_</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">self_</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Aborts pipeline saving with filled filename</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">savePipeline</span><span class="p">()</span>

        <span class="c1"># Mocks executing a dialog box and clicking yes</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="n">click_yes</span>

        <span class="c1"># Accept pipeline saving with filled filename</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">savePipeline</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_savePipelineAs">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_savePipelineAs">[docs]</a>
    <span class="k">def</span> <span class="nf">test_savePipelineAs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mocks a method from pipeline manager and saves a pipeline under</span>
<span class="sd">        another name.</span>

<span class="sd">        - Tests: PipelineManagerTab.savePipelineAs</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Set shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>

        <span class="c1"># Saves pipeline with empty filename</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">savePipelineAs</span><span class="p">()</span>

        <span class="c1"># Mocks &#39;savePipeline&#39; from &#39;ppl_edt_tabs&#39;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">save_pipeline</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="s2">&quot;not_empty&quot;</span><span class="p">)</span>

        <span class="c1"># Saves pipeline with not empty filename</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">savePipelineAs</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_set_anim_frame">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_set_anim_frame">[docs]</a>
    <span class="k">def</span> <span class="nf">test_set_anim_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Runs the &#39;rotatingBrainVISA.gif&#39; animation.&quot;&quot;&quot;</span>

        <span class="n">pipeline_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">sources_images_dir</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getSourceImageDir</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">sources_images_dir</span><span class="p">)</span>  <span class="c1"># if the string is not empty</span>

        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">_mmovie</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMovie</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sources_images_dir</span><span class="p">,</span> <span class="s2">&quot;rotatingBrainVISA.gif&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">_set_anim_frame</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_show_status">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_show_status">[docs]</a>
    <span class="k">def</span> <span class="nf">test_show_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Shows the status of the pipeline execution.</span>

<span class="sd">        Indirectly tests StatusWidget.__init__ and</span>
<span class="sd">        StatusWidget.toggle_soma_workflow.</span>

<span class="sd">        -Tests: PipelineManagerTab.test_show_status</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Set shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="c1"># Shows the status of the pipeline&#39;s execution</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">show_status</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">status_widget</span><span class="o">.</span><span class="n">swf_widget</span><span class="p">)</span>

        <span class="c1"># Creates &#39;ppl_manager.status_widget.swf_widget&#39;, not visible by</span>
        <span class="c1"># default (the argument is irrelevant)</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">status_widget</span><span class="o">.</span><span class="n">toggle_soma_workflow</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Asserts that &#39;swf_widget&#39; has been created and is visible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">status_widget</span><span class="o">.</span><span class="n">swf_widget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">status_widget</span><span class="o">.</span><span class="n">swf_widget</span><span class="o">.</span><span class="n">isVisible</span><span class="p">())</span>

        <span class="c1"># Toggles visibility on</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">status_widget</span><span class="o">.</span><span class="n">toggle_soma_workflow</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">status_widget</span><span class="o">.</span><span class="n">swf_widget</span><span class="o">.</span><span class="n">isVisible</span><span class="p">())</span>

        <span class="c1"># Toggles visibility off</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">status_widget</span><span class="o">.</span><span class="n">toggle_soma_workflow</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">status_widget</span><span class="o">.</span><span class="n">swf_widget</span><span class="o">.</span><span class="n">isVisible</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_stop_execution">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_stop_execution">[docs]</a>
    <span class="k">def</span> <span class="nf">test_stop_execution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Shows the status window of the pipeline manager.</span>

<span class="sd">        - Tests: PipelineManagerTab.test_show_status</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Set shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="c1"># Creates a &#39;RunProgress&#39; object</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="n">RunProgress</span><span class="p">(</span><span class="n">ppl_manager</span><span class="p">)</span>

        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">stop_execution</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">interrupt_request</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_undo_redo">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_undo_redo">[docs]</a>
    <span class="k">def</span> <span class="nf">test_undo_redo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests the undo/redo action.&quot;&quot;&quot;</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>
        <span class="n">controlV1_ver</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">isControlV1</span><span class="p">()</span>

        <span class="c1"># Switch to V1 node controller GUI, if necessary</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">controlV1_ver</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">setControlV1</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restart_MIA</span><span class="p">()</span>

        <span class="c1"># Set shortcuts for objects that are often used</span>
        <span class="n">pipeline_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">pipeline_editor_tabs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="p">)</span>

        <span class="c1"># Creates a new project folder and adds one document to the</span>
        <span class="c1"># project</span>
        <span class="c1"># test_proj_path = self.get_new_test_project()</span>
        <span class="c1"># folder = os.path.join(test_proj_path, &#39;data&#39;, &#39;raw_data&#39;)</span>
        <span class="c1"># NII_FILE_1 = (&#39;Guerbet-C6-2014-Rat-K52-Tube27-2014-02-14102317-</span>
        <span class="c1">#                      &#39;04-G3_Guerbet_MDEFT-MDEFTpvm-000940_800.nii&#39;)</span>
        <span class="c1"># DOCUMENT_1 = os.path.abspath(os.path.join(folder, NII_FILE_1))</span>

        <span class="c1"># Creates a project with another project already opened</span>
        <span class="c1"># self.main_window.data_browser.table_data.add_path()</span>

        <span class="c1"># pop_up_add_path = (self.main_window.data_browser.</span>
        <span class="c1">#                                         table_data.pop_up_add_path)</span>

        <span class="c1"># pop_up_add_path.file_line_edit.setText(DOCUMENT_1)</span>
        <span class="c1"># pop_up_add_path.save_path()</span>

        <span class="c1"># self.main_window.undo()</span>

        <span class="c1"># self.main_window.redo()</span>

        <span class="c1"># Mocks not saving the pipeline</span>
        <span class="c1"># QMessageBox.exec = lambda self_, *arg: self_.buttons(</span>
        <span class="c1">#                                                  )[-1].clicked.emit()</span>

        <span class="c1"># Switches to pipeline manager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Add a Smooth process =&gt; creates a node called &quot;smooth_1&quot;,</span>
        <span class="c1"># test if Smooth_1 is a node in the current pipeline / editor</span>
        <span class="n">process_class</span> <span class="o">=</span> <span class="n">Smooth</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
            <span class="n">process_class</span>
        <span class="p">)</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Undo (remove the node), test if the node was removed</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">undo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Redo (add again the node), test if the node was added</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">redo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Delete the node, test if the node was removed</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;smooth_1&quot;</span>
        <span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">del_node</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Undo (add again the node), test if the node was added</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">undo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Redo (delete again the node), test if the node was removed</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">redo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;smooth1&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Adding a new Smooth process =&gt; creates a node called &quot;smooth_1&quot;</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
            <span class="n">process_class</span>
        <span class="p">)</span>

        <span class="c1"># Export the &quot;out_prefix&quot; plug as &quot;prefix_smooth&quot; in Input node, test</span>
        <span class="c1"># if the Input node have a prefix_smooth plug</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">_export_plug</span><span class="p">(</span>
            <span class="n">temp_plug_name</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">,</span> <span class="s2">&quot;out_prefix&quot;</span><span class="p">),</span>
            <span class="n">pipeline_parameter</span><span class="o">=</span><span class="s2">&quot;prefix_smooth&quot;</span><span class="p">,</span>
            <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">weak_link</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;prefix_smooth&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Undo (remove prefix_smooth from Input node),</span>
        <span class="c1"># test if the prefix_smooth plug was deleted from Input node</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">undo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;prefix_smooth&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># redo (export again the &quot;out_prefix&quot; plug),</span>
        <span class="c1"># test if the Input node have a prefix_smooth plug</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">redo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;prefix_smooth&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Delete the &quot;prefix_smooth&quot; plug from the Input node,</span>
        <span class="c1"># test if the Input node have not a prefix_smooth plug</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">_remove_plug</span><span class="p">(</span>
            <span class="n">_temp_plug_name</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;prefix_smooth&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;prefix_smooth&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Undo (export again the &quot;out_prefix&quot; plug),</span>
        <span class="c1"># test if the Input node have a prefix_smooth plug</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">undo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;prefix_smooth&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># redo (deleting the &quot;prefix_smooth&quot; plug from the Input node),</span>
        <span class="c1"># test if the Input node have not a prefix_smooth plug</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">redo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;prefix_smooth&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># FIXME: export_plugs (currently there is a bug if a plug is</span>
        <span class="c1">#        of type list)</span>

        <span class="c1"># Adding a new Smooth process =&gt; creates a node called &quot;smooth_2&quot;</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">550</span><span class="p">)</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span>
            <span class="n">process_class</span>
        <span class="p">)</span>

        <span class="c1"># Adding a link</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">,</span> <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">,</span> <span class="s2">&quot;in_files&quot;</span><span class="p">),</span>
            <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">weak</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># test if the 2 nodes have the good links</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Undo (remove the link), test if the 2 nodes have not the links</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">undo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Redo (add again the link), test if the 2 nodes have the good links</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">redo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Removing the link, test if the 2 nodes have not the links</span>
        <span class="n">link</span> <span class="o">=</span> <span class="s2">&quot;smooth_1._smoothed_files-&gt;smooth_2.in_files&quot;</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">_del_link</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Undo (add again the link), test if the 2 nodes have the good links</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">undo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Redo (remove the link), test if the 2 nodes have not the links</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">redo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Re-adding a link</span>
        <span class="n">pipeline_editor_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">,</span> <span class="s2">&quot;_smoothed_files&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">,</span> <span class="s2">&quot;in_files&quot;</span><span class="p">),</span>
            <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">weak</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Updating the node name</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">displayNodeParameters</span><span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">,</span> <span class="n">process</span><span class="p">)</span>
        <span class="n">node_controller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">nodeController</span>
        <span class="n">node_controller</span><span class="o">.</span><span class="n">display_parameters</span><span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">)</span>
        <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;my_smooth&quot;</span><span class="p">)</span>
        <span class="n">keyEvent</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QKeyEvent</span><span class="p">(</span>
            <span class="n">QEvent</span><span class="o">.</span><span class="n">KeyPress</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key_Return</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">NoModifier</span>
        <span class="p">)</span>
        <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">postEvent</span><span class="p">(</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="p">,</span> <span class="n">keyEvent</span>
        <span class="p">)</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

        <span class="c1"># test if the smooth_2 node has been replaced by the</span>
        <span class="c1"># my_smooth node and test the links</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;my_smooth&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;my_smooth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Undo (Updating the node name from my_smooth to smooth_2),</span>
        <span class="c1"># test if it&#39;s ok</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">undo</span><span class="p">()</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;my_smooth&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Redo (Updating the node name from smooth_2 to my_smooth),</span>
        <span class="c1"># test if it&#39;s ok</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">redo</span><span class="p">()</span>
        <span class="n">QTest</span><span class="o">.</span><span class="n">qWait</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;my_smooth&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s2">&quot;smooth_2&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;my_smooth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;in_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_from</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;smooth_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="s2">&quot;_smoothed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Updating a plug value</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node_controller</span><span class="p">,</span> <span class="s2">&quot;get_index_from_plug_name&quot;</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">node_controller</span><span class="o">.</span><span class="n">get_index_from_plug_name</span><span class="p">(</span>
                <span class="s2">&quot;out_prefix&quot;</span><span class="p">,</span> <span class="s2">&quot;in&quot;</span>
            <span class="p">)</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">line_edit_input</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;PREFIX&quot;</span><span class="p">)</span>
            <span class="n">node_controller</span><span class="o">.</span><span class="n">update_plug_value</span><span class="p">(</span>
                <span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="s2">&quot;out_prefix&quot;</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="nb">str</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                <span class="s2">&quot;PREFIX&quot;</span><span class="p">,</span>
                <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;my_smooth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_plug_value</span><span class="p">(</span><span class="s2">&quot;out_prefix&quot;</span><span class="p">),</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">undo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;my_smooth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_plug_value</span><span class="p">(</span><span class="s2">&quot;out_prefix&quot;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">redo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                <span class="s2">&quot;PREFIX&quot;</span><span class="p">,</span>
                <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;my_smooth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_plug_value</span><span class="p">(</span><span class="s2">&quot;out_prefix&quot;</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="c1"># Switches back to node controller V2, if necessary (return to initial</span>
        <span class="c1"># state)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">properties_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">controlV1_ver</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">setControlV1</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_update_auto_inheritance">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_update_auto_inheritance">[docs]</a>
    <span class="k">def</span> <span class="nf">test_update_auto_inheritance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a process and updates the job&#39;s auto inheritance dict.</span>

<span class="sd">        - Tests: PipelineManagerTab.update_auto_inheritance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">project_8_path</span><span class="p">,</span>
            <span class="s2">&quot;data&quot;</span><span class="p">,</span>
            <span class="s2">&quot;raw_data&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">NII_FILE_1</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Guerbet-C6-2014-Rat-K52-Tube27-2014-02-14102317-01-G1_&quot;</span>
            <span class="s2">&quot;Guerbet_Anat-RAREpvm-000220_000.nii&quot;</span>
        <span class="p">)</span>
        <span class="n">NII_FILE_2</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Guerbet-C6-2014-Rat-K52-Tube27-2014-02-14102317-04-G3_&quot;</span>
            <span class="s2">&quot;Guerbet_MDEFT-MDEFTpvm-000940_800.nii&quot;</span>
        <span class="p">)</span>

        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">NII_FILE_1</span><span class="p">))</span>
        <span class="n">DOCUMENT_2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">NII_FILE_2</span><span class="p">))</span>

        <span class="c1"># Set shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">ppl</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Adds a Rename processes, creates the &#39;rename_1&#39; node</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Rename</span><span class="p">)</span>

        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;rename_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;rename_1&quot;</span><span class="p">]</span>

        <span class="c1"># Initializes the workflow manually</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">workflow</span> <span class="o">=</span> <span class="n">workflow_from_pipeline</span><span class="p">(</span>
            <span class="n">ppl</span><span class="p">,</span> <span class="n">complete_parameters</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="n">job</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">jobs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Mocks the node&#39;s parameters</span>
        <span class="n">node</span><span class="o">.</span><span class="n">auto_inheritance_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">process</span>
        <span class="n">process</span><span class="o">.</span><span class="n">study_config</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
        <span class="n">process</span><span class="o">.</span><span class="n">study_config</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">)</span>
        <span class="n">process</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">process</span><span class="o">.</span><span class="n">list_outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">process</span><span class="o">.</span><span class="n">auto_inheritance_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Mocks &#39;job.param_dict&#39; to share items with both the inputs and</span>
        <span class="c1"># outputs list of the process</span>
        <span class="c1"># Note: only &#39;in_file&#39; and &#39;_out_file&#39; are file trait types</span>
        <span class="n">job</span><span class="o">.</span><span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;_out_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;_out_file_value&quot;</span>

        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">update_auto_inheritance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">job</span><span class="p">)</span>

        <span class="c1"># &#39;job.param_dict&#39; as list of objects</span>
        <span class="n">job</span><span class="o">.</span><span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;inlist&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">DOCUMENT_1</span><span class="p">,</span> <span class="n">DOCUMENT_2</span><span class="p">]</span>
        <span class="n">process</span><span class="o">.</span><span class="n">get_outputs</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;_out&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;_out_value&quot;</span><span class="p">]})</span>
        <span class="n">process</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span>
            <span class="s2">&quot;_out&quot;</span><span class="p">,</span> <span class="n">OutputMultiPath</span><span class="p">(</span><span class="n">File</span><span class="p">(</span><span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;out files&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">job</span><span class="o">.</span><span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;_out&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;_out_value&quot;</span><span class="p">]</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">update_auto_inheritance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">job</span><span class="p">)</span>

        <span class="c1"># &#39;node&#39; does not have a &#39;project&#39;</span>
        <span class="k">del</span> <span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">study_config</span><span class="o">.</span><span class="n">project</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">update_auto_inheritance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">job</span><span class="p">)</span>

        <span class="c1"># &#39;node&#39; is not a &#39;Process&#39;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">update_auto_inheritance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">job</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_update_inheritance">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_update_inheritance">[docs]</a>
    <span class="k">def</span> <span class="nf">test_update_inheritance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a process and updates the job&#39;s inheritance dict.</span>

<span class="sd">        - Tests: PipelineManagerTab.update_inheritance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">ppl</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Adds a Rename processes, creates the &#39;rename_1&#39; node</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Rename</span><span class="p">)</span>

        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="n">node</span> <span class="o">=</span> <span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;rename_1&quot;</span><span class="p">]</span>

        <span class="c1"># Initializes the workflow manually</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">workflow</span> <span class="o">=</span> <span class="n">workflow_from_pipeline</span><span class="p">(</span>
            <span class="n">ppl</span><span class="p">,</span> <span class="n">complete_parameters</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="c1"># Gets the &#39;job&#39; and mocks adding a brick to the collection</span>
        <span class="n">job</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">jobs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Node&#39;s name does not contains &#39;Pipeline&#39;</span>
        <span class="n">node</span><span class="o">.</span><span class="n">context_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">inheritance_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">}</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">node_inheritance_history</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">update_inheritance</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">inheritance_dict</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">})</span>

        <span class="c1"># Node&#39;s name contains &#39;Pipeline&#39;</span>
        <span class="n">node</span><span class="o">.</span><span class="n">context_name</span> <span class="o">=</span> <span class="s2">&quot;Pipeline.rename_1&quot;</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">update_inheritance</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">inheritance_dict</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">})</span>

        <span class="c1"># Node&#39;s name in &#39;node_inheritance_history&#39;</span>
        <span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">node_inheritance_history</span><span class="p">[</span><span class="s2">&quot;rename_1&quot;</span><span class="p">])</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;new_value&quot;</span><span class="p">}</span>
        <span class="p">]</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">update_inheritance</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">inheritance_dict</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;new_value&quot;</span><span class="p">})</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_update_node_list">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_update_node_list">[docs]</a>
    <span class="k">def</span> <span class="nf">test_update_node_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a process, exports input and output plugs, initializes a</span>
<span class="sd">        workflow and adds the process to the &quot;pipline_manager.node_list&quot;.</span>

<span class="sd">        - Tests: PipelineManagerTab.update_node_list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Set shortcuts for often used objects</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>

        <span class="n">process_class</span> <span class="o">=</span> <span class="n">Rename</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">process_class</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Exports the mandatory inputs and outputs for &quot;rename_1&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">current_node_name</span> <span class="o">=</span> <span class="s2">&quot;rename_1&quot;</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="c1"># Initializes the workflow</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">workflow</span> <span class="o">=</span> <span class="n">workflow_from_pipeline</span><span class="p">(</span>
            <span class="n">pipeline</span><span class="p">,</span> <span class="n">complete_parameters</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="c1"># Asserts that the &quot;node_list&quot; is empty by default</span>
        <span class="n">node_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">node_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_list</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Asserts that the process &quot;Rename&quot; was added to &quot;node_list&quot;</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">update_node_list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_list</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">node_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_nipype_class</span><span class="p">,</span> <span class="s2">&quot;Rename&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_z_init_pipeline">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_z_init_pipeline">[docs]</a>
    <span class="k">def</span> <span class="nf">test_z_init_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a process, mocks several parameters from the pipeline</span>
<span class="sd">        manager and initializes the pipeline.</span>

<span class="sd">        - Tests: PipelineManagerTab.init_pipeline</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">ppl</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Gets the path of one document</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))),</span>
            <span class="s2">&quot;miautdata&quot;</span><span class="p">,</span>
            <span class="s2">&quot;resources&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mia&quot;</span><span class="p">,</span>
            <span class="s2">&quot;project_8&quot;</span><span class="p">,</span>
            <span class="s2">&quot;data&quot;</span><span class="p">,</span>
            <span class="s2">&quot;raw_data&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">NII_FILE_1</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Guerbet-C6-2014-Rat-K52-Tube27-2014-02-14102317-01-G1_&quot;</span>
            <span class="s2">&quot;Guerbet_Anat-RAREpvm-000220_000.nii&quot;</span>
        <span class="p">)</span>

        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">NII_FILE_1</span><span class="p">))</span>

        <span class="c1"># Adds a Rename processes, creates the &#39;rename_1&#39; node</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Rename</span><span class="p">)</span>

        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="c1"># Verifies that all the processes were added</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;rename_1&quot;</span><span class="p">],</span> <span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Initialize the pipeline with missing mandatory parameters</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">workflow</span> <span class="o">=</span> <span class="n">workflow_from_pipeline</span><span class="p">(</span>
            <span class="n">ppl</span><span class="p">,</span> <span class="n">complete_parameters</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="c1"># Mocks executing a dialog box, instead shows it</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">self_</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">self_</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">update_node_list</span><span class="p">()</span>
        <span class="n">init_result</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">init_result</span><span class="p">)</span>

        <span class="c1"># Sets the mandatory parameters</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s2">&quot;format_string&quot;</span><span class="p">,</span> <span class="s2">&quot;new_name.nii&quot;</span><span class="p">)</span>

        <span class="c1"># Mocks an iteration pipeline</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Iteration_pipeline&quot;</span>
        <span class="n">process_it</span> <span class="o">=</span> <span class="n">ProcessIteration</span><span class="p">(</span><span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;rename_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">process</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">list_process_in_pipeline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">process_it</span><span class="p">)</span>

        <span class="c1"># Initialize the pipeline with mandatory parameters set</span>
        <span class="c1"># QTimer.singleShot(1000, self.execute_QDialogAccept)</span>
        <span class="c1"># init_result = ppl_manager.init_pipeline(pipeline=ppl)</span>
        <span class="c1"># ppl_manager.msg.accept()</span>

        <span class="c1"># Mocks requirements to {} and initializes the pipeline</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">check_requirements</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="p">{})</span>
        <span class="n">init_result</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">init_result</span><span class="p">)</span>
        <span class="c1"># ppl_manager.check_requirements.assert_called_once_with(</span>
        <span class="c1">#    &quot;global&quot;, message_list=[]</span>
        <span class="c1"># )</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">check_requirements</span><span class="o">.</span><span class="n">assert_called_once</span><span class="p">()</span>
        <span class="c1"># Mocks external packages as requirements and initializes the pipeline</span>
        <span class="n">pkgs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fsl&quot;</span><span class="p">,</span> <span class="s2">&quot;afni&quot;</span><span class="p">,</span> <span class="s2">&quot;ants&quot;</span><span class="p">,</span> <span class="s2">&quot;matlab&quot;</span><span class="p">,</span> <span class="s2">&quot;mrtrix&quot;</span><span class="p">,</span> <span class="s2">&quot;spm&quot;</span><span class="p">]</span>
        <span class="n">req</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;capsul_engine&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;uses&quot;</span><span class="p">:</span> <span class="n">Mock</span><span class="p">()}}</span>

        <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">pkgs</span><span class="p">:</span>
            <span class="n">req</span><span class="p">[</span><span class="s2">&quot;capsul.engine.module.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pkg</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

        <span class="n">req</span><span class="p">[</span><span class="s2">&quot;capsul_engine&quot;</span><span class="p">][</span><span class="s2">&quot;uses&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">proc</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
        <span class="n">proc</span><span class="o">.</span><span class="n">context_name</span> <span class="o">=</span> <span class="s2">&quot;moke_process&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="p">{</span><span class="n">proc</span><span class="p">:</span> <span class="n">req</span><span class="p">}</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">check_requirements</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">req</span><span class="p">)</span>

        <span class="c1"># QTimer.singleShot(1000, self.execute_QDialogAccept)</span>
        <span class="n">init_result</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">init_result</span><span class="p">)</span>

        <span class="c1"># Extra steps for SPM</span>
        <span class="n">req</span><span class="p">[</span><span class="n">proc</span><span class="p">][</span><span class="s2">&quot;capsul.engine.module.spm&quot;</span><span class="p">][</span><span class="s2">&quot;directory&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">req</span><span class="p">[</span><span class="n">proc</span><span class="p">][</span><span class="s2">&quot;capsul.engine.module.spm&quot;</span><span class="p">][</span><span class="s2">&quot;standalone&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">Config</span><span class="p">()</span><span class="o">.</span><span class="n">set_matlab_standalone_path</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="c1"># QTimer.singleShot(1000, self.execute_QDialogAccept)</span>
        <span class="n">init_result</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">init_result</span><span class="p">)</span>

        <span class="n">req</span><span class="p">[</span><span class="n">proc</span><span class="p">][</span><span class="s2">&quot;capsul.engine.module.spm&quot;</span><span class="p">][</span><span class="s2">&quot;standalone&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># QTimer.singleShot(1000, self.execute_QDialogAccept)</span>
        <span class="n">init_result</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">init_result</span><span class="p">)</span>

        <span class="c1"># Deletes an attribute of each package requirement</span>
        <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">pkgs</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">req</span><span class="p">[</span><span class="n">proc</span><span class="p">][</span><span class="s2">&quot;capsul.engine.module.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pkg</span><span class="p">)]</span>

        <span class="c1"># QTimer.singleShot(1000, self.execute_QDialogAccept)</span>
        <span class="n">init_result</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">init_result</span><span class="p">)</span>

        <span class="c1"># Mocks a &#39;ValueError&#39; in &#39;workflow_from_pipeline&#39;</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">find_empty_parameters</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">side_effect</span><span class="o">=</span><span class="ne">ValueError</span><span class="p">)</span>

        <span class="c1"># QTimer.singleShot(1000, self.execute_QDialogAccept)</span>
        <span class="n">init_result</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">init_pipeline</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">init_result</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_z_runPipeline">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_z_runPipeline">[docs]</a>
    <span class="k">def</span> <span class="nf">test_z_runPipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a process, export plugs and runs a pipeline.</span>

<span class="sd">        - Tests:</span>
<span class="sd">            - PipelineManagerTab.runPipeline</span>
<span class="sd">            - PipelineManagerTab.finish_execution</span>
<span class="sd">            - RunProgress</span>
<span class="sd">            - RunWorker</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Set shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_edt_tabs</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
        <span class="n">ppl</span> <span class="o">=</span> <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="c1"># Creates a new project folder and adds one document to the</span>
        <span class="c1"># project, sets the plug value that is added to the database</span>
        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span> <span class="o">=</span> <span class="n">project_8_path</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;raw_data&quot;</span><span class="p">)</span>
        <span class="n">NII_FILE_1</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Guerbet-C6-2014-Rat-K52-Tube27-2014-02-14102317-04-G3_&quot;</span>
            <span class="s2">&quot;Guerbet_MDEFT-MDEFTpvm-000940_800.nii&quot;</span>
        <span class="p">)</span>
        <span class="n">DOCUMENT_1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">NII_FILE_1</span><span class="p">))</span>

        <span class="c1"># Switches to pipeline manager tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Adds a Rename processes, creates the &#39;rename_1&#39; node</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">Rename</span><span class="p">)</span>

        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_unconnected_mandatory_inputs</span><span class="p">()</span>
        <span class="n">ppl_edt_tabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">export_all_unconnected_outputs</span><span class="p">()</span>

        <span class="c1"># Sets the mandatory parameters</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="n">DOCUMENT_1</span><span class="p">)</span>
        <span class="n">ppl</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="s2">&quot;format_string&quot;</span><span class="p">,</span> <span class="s2">&quot;new_name.nii&quot;</span><span class="p">)</span>

        <span class="c1"># Mocks the allocation of the pipeline into another thread</span>
        <span class="c1"># This function seem to require a different number of arguments</span>
        <span class="c1"># depending on the platform, therefore a &#39;Mock&#39; is used</span>
        <span class="n">QThread</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>

        <span class="c1"># Pipeline fails while running, due to capsul import error</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">runPipeline</span><span class="p">()</span>

        <span class="c1"># Directly runs the &#39;QThread&#39; object, as the only solution found</span>
        <span class="c1"># to run the pipeline during the test routine</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

        <span class="c1"># Sends the signal to finish the pipeline</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ppl_manager</span><span class="o">.</span><span class="n">last_run_pipeline</span><span class="p">,</span> <span class="n">ppl</span><span class="p">)</span>
        <span class="n">QThread</span><span class="o">.</span><span class="n">start</span><span class="o">.</span><span class="n">assert_called_once</span><span class="p">()</span>

        <span class="c1"># Pipeline is stopped by the user, the pipeline fails before running</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">runPipeline</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">stop_execution</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestMIAPipelineManagerTab.test_zz_del_pack">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.TestMIAPipelineManagerTab.test_zz_del_pack">[docs]</a>
    <span class="k">def</span> <span class="nf">test_zz_del_pack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;We remove the brick created during the unit tests, and we take</span>
<span class="sd">        advantage of this to cover the part of the code used to remove the</span>
<span class="sd">        packages&quot;&quot;&quot;</span>

        <span class="n">pkg</span> <span class="o">=</span> <span class="n">PackageLibraryDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="p">)</span>

        <span class="c1"># The Test_pipeline brick was added in the package library</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s2">&quot;Test_pipeline_1&quot;</span>
            <span class="ow">in</span> <span class="n">pkg</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">package_tree</span><span class="p">[</span><span class="s2">&quot;User_processes&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">pkg</span><span class="o">.</span><span class="n">delete_package</span><span class="p">(</span>
            <span class="n">to_delete</span><span class="o">=</span><span class="s2">&quot;User_processes.Test_pipeline_1&quot;</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="c1"># The Test_pipeline brick has been removed from the package library</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span>
            <span class="s2">&quot;Test_pipeline_1&quot;</span>
            <span class="ow">in</span> <span class="n">pkg</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">package_tree</span><span class="p">[</span><span class="s2">&quot;User_processes&quot;</span><span class="p">]</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Test_Z_MIAOthers">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.Test_Z_MIAOthers">[docs]</a>
<span class="k">class</span> <span class="nc">Test_Z_MIAOthers</span><span class="p">(</span><span class="n">TestMIACase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests for other parts of the MIA software that do not relate much</span>
<span class="sd">    with the other classes.</span>

<span class="sd">    :Contains:</span>
<span class="sd">        :Method:</span>
<span class="sd">            - test_iteration_table: plays with the iteration table</span>
<span class="sd">            - test_process_library: install the brick_test and then remove it</span>
<span class="sd">            - test_check_setup: check that Mia&#39;s configuration control is</span>
<span class="sd">                                working correctly</span>
<span class="sd">            - test_verify_processes: check that Mia&#39;s processes control is</span>
<span class="sd">                                     working correctly</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Test_Z_MIAOthers.test_iteration_table">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.Test_Z_MIAOthers.test_iteration_table">[docs]</a>
    <span class="k">def</span> <span class="nf">test_iteration_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Opens a new project, initializes the pipeline iteration and changes</span>
<span class="sd">        its parameters.</span>

<span class="sd">        - Tests: IterationTable</span>

<span class="sd">        - Mocks: the execution of a PopUpSelectTagCountTable and a QDialog</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">project_8_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_test_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">switch_project</span><span class="p">(</span><span class="n">project_8_path</span><span class="p">,</span> <span class="s2">&quot;project_8&quot;</span><span class="p">)</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">iter_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">iterationTable</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">iter_table</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_editor</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span>

        <span class="c1"># Mocks the execution of a dialog box to avoid asynchronous shot</span>
        <span class="n">QDialog</span><span class="o">.</span><span class="n">exec_</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">QDialog</span><span class="o">.</span><span class="n">Accepted</span><span class="p">)</span>

        <span class="c1"># Allows for the iteration of the pipeline</span>
        <span class="n">iter_table</span><span class="o">.</span><span class="n">check_box_iterate</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Adds a tag and asserts that a tag button was added</span>
        <span class="n">iter_table</span><span class="o">.</span><span class="n">add_tag</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iter_table</span><span class="o">.</span><span class="n">push_buttons</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">iter_table</span><span class="o">.</span><span class="n">push_buttons</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s2">&quot;Tag n°3&quot;</span><span class="p">)</span>

        <span class="c1"># Fill the &#39;values_list&#39; with the tag values in the documents</span>
        <span class="n">iter_table</span><span class="o">.</span><span class="n">push_buttons</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;BandWidth&quot;</span><span class="p">)</span>
        <span class="n">iter_table</span><span class="o">.</span><span class="n">fill_values</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iter_table</span><span class="o">.</span><span class="n">values_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">iter_table</span><span class="o">.</span><span class="n">values_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">iter_table</span><span class="o">.</span><span class="n">values_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">50000.0</span><span class="p">])</span>

        <span class="c1"># Removes a tag and asserts that a tag button was removed</span>
        <span class="n">iter_table</span><span class="o">.</span><span class="n">remove_tag</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iter_table</span><span class="o">.</span><span class="n">push_buttons</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Mocks the execution of &#39;PopUpSelectTagCountTable&#39; to avoid</span>
        <span class="c1"># asynchronous shot</span>
        <span class="n">PopUpSelectTagCountTable</span><span class="o">.</span><span class="n">exec_</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Selects a tag to iterate over, tests &#39;select_iteration_tag&#39; while</span>
        <span class="c1"># mocking a &#39;PopUpSelectTagCountTable&#39;.</span>
        <span class="c1"># Due to the above mock, &#39;iterated_tag&#39; is set as None</span>
        <span class="n">ppl_editor</span><span class="o">.</span><span class="n">iterated_tag</span> <span class="o">=</span> <span class="s2">&quot;BandWidth&quot;</span>
        <span class="n">iter_table</span><span class="o">.</span><span class="n">select_iteration_tag</span><span class="p">()</span>
        <span class="c1"># iter_table.combo_box.clear()</span>
        <span class="c1"># iter_table.combo_box.addItems([&#39;[50000.0]&#39;])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">ppl_editor</span><span class="o">.</span><span class="n">iterated_tag</span><span class="p">)</span>

        <span class="c1"># Filters the scans matching the selected  &#39;iterated_tag&#39;</span>
        <span class="c1"># Since the execution is mocked, &#39;tag_values_list&#39; becomes empty</span>
        <span class="n">iter_table</span><span class="o">.</span><span class="n">filter_values</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">ppl_editor</span><span class="o">.</span><span class="n">tag_values_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ppl_editor</span><span class="o">.</span><span class="n">tag_values_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Updates the button with the selected tag</span>
        <span class="n">iter_table</span><span class="o">.</span><span class="n">update_selected_tag</span><span class="p">(</span><span class="s2">&quot;Bandwidth&quot;</span><span class="p">)</span>

        <span class="c1"># Selects the visualized tag</span>
        <span class="n">iter_table</span><span class="o">.</span><span class="n">select_visualized_tag</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Sends the data browser scans to the pipeline manager and updates the</span>
        <span class="c1"># iterated tags</span>
        <span class="n">SCANS_LIST</span> <span class="o">=</span> <span class="n">iter_table</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span><span class="s2">&quot;current&quot;</span><span class="p">)</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">scan_list</span> <span class="o">=</span> <span class="n">SCANS_LIST</span>
        <span class="n">iter_table</span><span class="o">.</span><span class="n">update_iterated_tag</span><span class="p">()</span>

        <span class="c1"># Updates the iteration table, tests &#39;update_table&#39; while</span>
        <span class="c1"># mocking the execution of &#39;filter_documents&#39;</span>

        <span class="n">DOC_1_NAME</span> <span class="o">=</span> <span class="n">SCANS_LIST</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">DOC_1</span> <span class="o">=</span> <span class="n">iter_table</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_document</span><span class="p">(</span><span class="s2">&quot;current&quot;</span><span class="p">,</span> <span class="n">DOC_1_NAME</span><span class="p">)</span>

        <span class="n">session</span><span class="o">.</span><span class="n">filter_documents</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="p">[</span><span class="n">DOC_1</span><span class="p">])</span>
        <span class="n">ppl_editor</span><span class="o">.</span><span class="n">iterated_tag</span> <span class="o">=</span> <span class="s2">&quot;BandWidth&quot;</span>

        <span class="n">iter_table</span><span class="o">.</span><span class="n">update_table</span><span class="p">()</span>

        <span class="c1"># Asserts that the iteration table has one item</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">iter_table</span><span class="o">.</span><span class="n">iteration_table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">iter_table</span><span class="o">.</span><span class="n">iteration_table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span></div>


<div class="viewcode-block" id="Test_Z_MIAOthers.test_process_library">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.Test_Z_MIAOthers.test_process_library">[docs]</a>
    <span class="k">def</span> <span class="nf">test_process_library</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Inserts a row, mimes and changes the data and deletes it.</span>

<span class="sd">        - Tests: ProcessLibrary</span>

<span class="sd">        -Mocks:</span>
<span class="sd">            - QMessageBox.exec</span>
<span class="sd">            - QMessageBox.question</span>

<span class="sd">        The process library is located at the left corner of the pipeline</span>
<span class="sd">        manager tab, where the list of available bricks is shown.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Sets shortcuts for objects that are often used</span>
        <span class="n">ppl_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">processLibrary</span><span class="o">.</span><span class="n">process_config</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">processLibrary</span><span class="o">.</span><span class="n">packages</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;User_processes&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Tests&quot;</span><span class="p">:</span> <span class="s2">&quot;process_enabled&quot;</span><span class="p">}</span>
        <span class="p">}</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">processLibrary</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ppl_manager</span><span class="o">.</span><span class="n">processLibrary</span><span class="o">.</span><span class="n">save_config</span><span class="p">()</span>
        <span class="n">proc_lib</span> <span class="o">=</span> <span class="n">ppl_manager</span><span class="o">.</span><span class="n">processLibrary</span><span class="o">.</span><span class="n">process_library</span>

        <span class="c1"># Switches to pipeline manager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Gets the child count</span>
        <span class="n">child_count</span> <span class="o">=</span> <span class="n">proc_lib</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="n">QModelIndex</span><span class="p">())</span><span class="o">.</span><span class="n">childCount</span><span class="p">()</span>
        <span class="n">row_data</span> <span class="o">=</span> <span class="s2">&quot;untitled&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">child_count</span><span class="p">)</span>

        <span class="c1"># Adds a row to the process library</span>
        <span class="n">proc_lib</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">insertRow</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Gets its index and selects it</span>
        <span class="n">row_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_item_by_data</span><span class="p">(</span><span class="n">proc_lib</span><span class="p">,</span> <span class="n">row_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">row_index</span><span class="p">)</span>
        <span class="n">proc_lib</span><span class="o">.</span><span class="n">selectionModel</span><span class="p">()</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="n">row_index</span><span class="p">,</span> <span class="n">QItemSelectionModel</span><span class="o">.</span><span class="n">SelectCurrent</span>
        <span class="p">)</span>

        <span class="c1"># Mimes the data of the row widget</span>
        <span class="n">mime_data</span> <span class="o">=</span> <span class="n">proc_lib</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">mimeData</span><span class="p">([</span><span class="n">row_index</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">mime_data</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s2">&quot;component/name&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">(),</span>
            <span class="nb">bytes</span><span class="p">(</span><span class="n">row_data</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Changes the data of the row</span>
        <span class="n">proc_lib</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">row_index</span><span class="p">,</span> <span class="s2">&quot;untitled101&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">row_index</span><span class="o">.</span><span class="n">data</span><span class="p">(),</span> <span class="s2">&quot;untitled101&quot;</span><span class="p">)</span>

        <span class="c1"># Mocks the execution of a dialog box</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">exec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="kc">None</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span>

        <span class="c1"># Deletes the row by pressing the del key</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
        <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key_Delete</span>
        <span class="n">proc_lib</span><span class="o">.</span><span class="n">keyPressEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="c1"># Mocks a mouse press event of the first item of the process lib</span>
        <span class="n">mouse_event</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMouseEvent</span>
        <span class="n">mouse_event</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">QPoint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">mouse_event</span><span class="o">.</span><span class="n">button</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Qt</span><span class="o">.</span><span class="n">RightButton</span>

        <span class="c1"># Mocks the return value of &#39;mousePressEvent&#39;</span>
        <span class="n">QTreeView</span><span class="o">.</span><span class="n">mousePressEvent</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="kc">True</span>

        <span class="c1"># Adds a row to the process library</span>
        <span class="n">proc_lib</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">insertRow</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Mocks selecting &#39;Delete package&#39;</span>
        <span class="n">QMenu</span><span class="o">.</span><span class="n">exec_</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">proc_lib</span><span class="o">.</span><span class="n">remove</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">proc_lib</span><span class="o">.</span><span class="n">mousePressEvent</span><span class="p">(</span><span class="n">mouse_event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

        <span class="c1"># Adds a row to the process library</span>
        <span class="n">proc_lib</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">insertRow</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Mocks selecting &#39;Delete package&#39;</span>
        <span class="n">QMenu</span><span class="o">.</span><span class="n">exec_</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">proc_lib</span><span class="o">.</span><span class="n">action_delete</span>

        <span class="n">proc_lib</span><span class="o">.</span><span class="n">mousePressEvent</span><span class="p">(</span><span class="n">mouse_event</span><span class="p">)</span></div>


<div class="viewcode-block" id="Test_Z_MIAOthers.test_check_setup">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.Test_Z_MIAOthers.test_check_setup">[docs]</a>
    <span class="k">def</span> <span class="nf">test_check_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that Mia&#39;s configuration control is working correctly.</span>

<span class="sd">        - Tests: utils.verify_setup()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dot_mia_config</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">properties_path</span><span class="p">),</span> <span class="s2">&quot;configuration_path.yml&quot;</span>
        <span class="p">)</span>

        <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_QDialogAccept</span><span class="p">)</span>
        <span class="n">verify_setup</span><span class="p">(</span><span class="n">dev_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dot_mia_config</span><span class="o">=</span><span class="n">dot_mia_config</span><span class="p">)</span></div>


<div class="viewcode-block" id="Test_Z_MIAOthers.test_verify_processes">
<a class="viewcode-back" href="../../populse_mia.html#populse_mia.test.Test_Z_MIAOthers.test_verify_processes">[docs]</a>
    <span class="k">def</span> <span class="nf">test_verify_processes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that Mia&#39;s processes control is working correctly</span>

<span class="sd">        - Tests: utils.verify_processes()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">verify_processes</span><span class="p">(</span><span class="s2">&quot;toto&quot;</span><span class="p">,</span> <span class="s2">&quot;titi&quot;</span><span class="p">,</span> <span class="s2">&quot;tata&quot;</span><span class="p">)</span></div>
</div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>

      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2022, populse.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>