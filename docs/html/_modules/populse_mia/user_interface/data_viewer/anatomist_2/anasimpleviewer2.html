
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2 &#8212; populse_mia 2.2.2-dev+6103c458 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/haiku.css" />
    <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
    <script src="../../../../../_static/jquery.js"></script>
    <script src="../../../../../_static/underscore.js"></script>
    <script src="../../../../../_static/doctools.js"></script>
    <script src="https://unpkg.com/mermaid@9.4.0/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../../../../../index.html">
          <span>populse_mia 2.2.2-dev+6103c458 documentation</span></a></h1>
        <h2 class="heading"><span>populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="../../../../../index.html">Contents</a>
        </p>

      </div>
      <div class="content" role="main">
        
        
  <h1>Source code for populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;AnaSimpleViewer2&quot;&quot;&quot;</span>

<span class="c1">#  This software and supporting documentation are distributed by</span>
<span class="c1">#      Institut Federatif de Recherche 49</span>
<span class="c1">#      CEA/NeuroSpin, Batiment 145,</span>
<span class="c1">#      91191 Gif-sur-Yvette cedex</span>
<span class="c1">#      France</span>
<span class="c1">#</span>
<span class="c1"># This software is governed by the CeCILL license version 2 under</span>
<span class="c1"># French law and abiding by the rules of distribution of free software.</span>
<span class="c1"># You can  use, modify and/or redistribute the software under the</span>
<span class="c1"># terms of the CeCILL license version 2 as circulated by CEA, CNRS</span>
<span class="c1"># and INRIA at the following URL &quot;http://www.cecill.info&quot;.</span>
<span class="c1">#</span>
<span class="c1"># As a counterpart to the access to the source code and  rights to copy,</span>
<span class="c1"># modify and redistribute granted by the license, users are provided only</span>
<span class="c1"># with a limited warranty  and the software&#39;s author,  the holder of the</span>
<span class="c1"># economic rights,  and the successive licensors  have only  limited</span>
<span class="c1"># liability.</span>
<span class="c1">#</span>
<span class="c1"># In this respect, the user&#39;s attention is drawn to the risks associated</span>
<span class="c1"># with loading,  using,  modifying and/or developing or reproducing the</span>
<span class="c1"># software by the user in light of its specific status of free software,</span>
<span class="c1"># that may mean  that it is complicated to manipulate,  and  that  also</span>
<span class="c1"># therefore means  that it is reserved for developers  and  experienced</span>
<span class="c1"># professionals having in-depth computer knowledge. Users are therefore</span>
<span class="c1"># encouraged to load and test the software&#39;s suitability as regards their</span>
<span class="c1"># requirements in conditions enabling the security of their systems and/or</span>
<span class="c1"># data to be ensured and,  more generally, to use and operate it in the</span>
<span class="c1"># same conditions as regards security.</span>
<span class="c1">#</span>
<span class="c1"># The fact that you are presently reading this means that you have had</span>
<span class="c1"># knowledge of the CeCILL license version 2 and that you accept its terms.</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">PyQt5</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtGui</span> <span class="kn">import</span> <span class="n">QColor</span><span class="p">,</span> <span class="n">QIcon</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QWidget</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="n">QMessageBox</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="nb">zip</span>
<span class="kn">from</span> <span class="nn">soma</span> <span class="kn">import</span> <span class="n">aims</span>
<span class="kn">from</span> <span class="nn">soma.aims</span> <span class="kn">import</span> <span class="n">colormaphints</span>
<span class="kn">from</span> <span class="nn">soma.qt_gui</span> <span class="kn">import</span> <span class="n">qt_backend</span>
<span class="kn">from</span> <span class="nn">soma.qt_gui.qt_backend</span> <span class="kn">import</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">QtCore</span>
<span class="kn">from</span> <span class="nn">soma.qt_gui.qt_backend.uic</span> <span class="kn">import</span> <span class="n">loadUi</span>

<span class="kn">from</span> <span class="nn">populse_mia.software_properties</span> <span class="kn">import</span> <span class="n">Config</span>
<span class="kn">from</span> <span class="nn">populse_mia.user_interface.data_viewer.anatomist_2.snd_window</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">NewWindowViewer</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">anatomist.direct.api</span> <span class="k">as</span> <span class="nn">ana</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Anatomist seems not to be installed. The data_viewer anatomist &quot;</span>
        <span class="s2">&quot;and anatomist_2 will not work...</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>
<span class="c1"># the following imports have to be made after the qApp.startingUp() test</span>
<span class="c1"># since they do instantiate Anatomist for registry to work.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">anatomist.cpp.simplecontrols</span> <span class="kn">import</span> <span class="p">(</span>
        <span class="n">Simple2DControl</span><span class="p">,</span>
        <span class="n">registerSimpleControls</span><span class="p">,</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Anatomist seems not to be installed. The data_viewer anatomist &quot;</span>
        <span class="s2">&quot;and anatomist_2 will not work...</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>
<span class="c1"># determine whether we are using Qt4 or Qt5, and hack a little bit accordingly</span>
<span class="c1"># the boolean qt4 global variable will tell it for later usage</span>
<span class="n">qt_backend</span><span class="o">.</span><span class="n">set_qt_backend</span><span class="p">(</span><span class="n">compatible_qt5</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<div class="viewcode-block" id="LeftSimple3DControl"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.LeftSimple3DControl">[docs]</a><span class="k">class</span> <span class="nc">LeftSimple3DControl</span><span class="p">(</span><span class="n">Simple2DControl</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    define another control where rotation is with the left mouse button</span>
<span class="sd">    (useful for touch devices)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LeftSimple3DControl.__init__"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.LeftSimple3DControl.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prio</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;LeftSimple3DControl&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;blabla&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LeftSimple3DControl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">prio</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="LeftSimple3DControl.eventAutoSubscription"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.LeftSimple3DControl.eventAutoSubscription">[docs]</a>    <span class="k">def</span> <span class="nf">eventAutoSubscription</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pool</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;blabla&quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span>
        <span class="n">NoModifier</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">NoModifier</span>
        <span class="n">ControlModifier</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">ControlModifier</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LeftSimple3DControl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">eventAutoSubscription</span><span class="p">(</span><span class="n">pool</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouseLongEventUnsubscribe</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">,</span> <span class="n">NoModifier</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouseLongEventSubscribe</span><span class="p">(</span>
            <span class="n">key</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">,</span>
            <span class="n">NoModifier</span><span class="p">,</span>
            <span class="n">pool</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="s2">&quot;ContinuousTrackball&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">beginTrackball</span><span class="p">,</span>
            <span class="n">pool</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="s2">&quot;ContinuousTrackball&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">moveTrackball</span><span class="p">,</span>
            <span class="n">pool</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="s2">&quot;ContinuousTrackball&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">endTrackball</span><span class="p">,</span>
            <span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyPressEventSubscribe</span><span class="p">(</span>
            <span class="n">key</span><span class="o">.</span><span class="n">Key_Space</span><span class="p">,</span>
            <span class="n">ControlModifier</span><span class="p">,</span>
            <span class="n">pool</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="s2">&quot;ContinuousTrackball&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">startOrStop</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mousePressButtonEventSubscribe</span><span class="p">(</span>
            <span class="n">key</span><span class="o">.</span><span class="n">MiddleButton</span><span class="p">,</span> <span class="n">NoModifier</span><span class="p">,</span> <span class="n">pool</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="s2">&quot;LinkAction&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">execLink</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="VolRenderControl"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.VolRenderControl">[docs]</a><span class="k">class</span> <span class="nc">VolRenderControl</span><span class="p">(</span><span class="n">LeftSimple3DControl</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    define another control where cut slice rotation is with the middle mouse</span>
<span class="sd">    button</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="VolRenderControl.__init__"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.VolRenderControl.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prio</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;VolRenderControl&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;blabla&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">VolRenderControl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">prio</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="VolRenderControl.eventAutoSubscription"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.VolRenderControl.eventAutoSubscription">[docs]</a>    <span class="k">def</span> <span class="nf">eventAutoSubscription</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pool</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;blabla&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">VolRenderControl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">eventAutoSubscription</span><span class="p">(</span><span class="n">pool</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouseLongEventUnsubscribe</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">MiddleButton</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">NoModifier</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouseLongEventSubscribe</span><span class="p">(</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">MiddleButton</span><span class="p">,</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">NoModifier</span><span class="p">,</span>
            <span class="n">pool</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="s2">&quot;TrackCutAction&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">beginTrackball</span><span class="p">,</span>
            <span class="n">pool</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="s2">&quot;TrackCutAction&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">moveTrackball</span><span class="p">,</span>
            <span class="n">pool</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="s2">&quot;TrackCutAction&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">endTrackball</span><span class="p">,</span>
            <span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="AnaSimpleViewer2"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2">[docs]</a><span class="k">class</span> <span class="nc">AnaSimpleViewer2</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    AnaSimpleViewer is a &quot;simple viewer&quot; application and widget, which can be</span>
<span class="sd">    used using the &quot;anasimpleviewer.py&quot; command, or included in a custom widget</span>
<span class="sd">    as a library module.</span>

<span class="sd">    It includes an objects list and 4 3D views (anatomist windows). Objects</span>
<span class="sd">    loaded are added in all views, and can be hidden or shown using the &quot;add&quot;</span>
<span class="sd">    and &quot;remove&quot; buttons.</span>

<span class="sd">    The AnaSimpleViewer class holds methods for menu/actions callbacks, and</span>
<span class="sd">    utility functions like load/view objects, remove/delete, etc.</span>

<span class="sd">    It is a QObject, but not a QWidget. The widget can be accessed as the</span>
<span class="sd">    ``awidget`` attribute in the AnaSimpleViewer instance.</span>

<span class="sd">    As it is more intended to be used as a complete application, and it is</span>
<span class="sd">    simpler to handle in Anatomist, some global Anatomist config variables and</span>
<span class="sd">    controls may be set within AnaSimpleViewer. This is done optionally using</span>
<span class="sd">    the :meth:`init_global_handlers` method, which is called by the constructor</span>
<span class="sd">    if the argument `init_global_handlers` is not set to False when calling it.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_global_handlers_initialized</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="AnaSimpleViewer2.__init__"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_global_handlers</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;blabla&quot;&quot;&quot;</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">init_global_handlers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_global_handlers</span><span class="p">()</span>

        <span class="c1"># ui file for dataviewer anasimpleviewer_2</span>
        <span class="n">uifile</span> <span class="o">=</span> <span class="s2">&quot;mainwindow.ui&quot;</span>
        <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="n">mainwindowdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">cwd</span><span class="p">,</span> <span class="s2">&quot;user_interface/data_viewer/anatomist_2&quot;</span>
        <span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">mainwindowdir</span><span class="p">)</span>
        <span class="n">awin</span> <span class="o">=</span> <span class="n">loadUi</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mainwindowdir</span><span class="p">,</span> <span class="n">uifile</span><span class="p">))</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">awidget</span> <span class="o">=</span> <span class="n">awin</span>

        <span class="c1"># new window popup for objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newWindow</span> <span class="o">=</span> <span class="n">NewWindowViewer</span><span class="p">()</span>

        <span class="c1"># connect GUI actions callbacks</span>
        <span class="k">def</span> <span class="nf">findChild</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;blabla&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="c1"># findChild(awin,</span>
        <span class="c1">#           &#39;actionprint_view&#39;).triggered.connect(self.addNewView)</span>
        <span class="n">findChild</span><span class="p">(</span><span class="n">awin</span><span class="p">,</span> <span class="s2">&quot;actionTimeRunning&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">automaticRunning</span>
        <span class="p">)</span>
        <span class="n">findChild</span><span class="p">(</span><span class="n">awin</span><span class="p">,</span> <span class="s2">&quot;fileOpenAction&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileOpen</span><span class="p">)</span>
        <span class="n">findChild</span><span class="p">(</span><span class="n">awin</span><span class="p">,</span> <span class="s2">&quot;fileExitAction&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">closeAll</span><span class="p">)</span>
        <span class="n">findChild</span><span class="p">(</span><span class="n">awin</span><span class="p">,</span> <span class="s2">&quot;editAddAction&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editAdd</span><span class="p">)</span>
        <span class="n">findChild</span><span class="p">(</span><span class="n">awin</span><span class="p">,</span> <span class="s2">&quot;editRemoveAction&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editRemove</span><span class="p">)</span>
        <span class="n">findChild</span><span class="p">(</span><span class="n">awin</span><span class="p">,</span> <span class="s2">&quot;editDeleteAction&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editDelete</span><span class="p">)</span>
        <span class="n">findChild</span><span class="p">(</span><span class="n">awin</span><span class="p">,</span> <span class="s2">&quot;viewEnable_Volume_RenderingAction&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enableVolumeRendering</span>
        <span class="p">)</span>
        <span class="n">findChild</span><span class="p">(</span><span class="n">awin</span><span class="p">,</span> <span class="s2">&quot;viewOpen_Anatomist_main_window&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">open_anatomist_main_window</span>
        <span class="p">)</span>
        <span class="c1"># manually entered coords</span>
        <span class="n">le</span> <span class="o">=</span> <span class="n">findChild</span><span class="p">(</span><span class="n">awin</span><span class="p">,</span> <span class="s2">&quot;coordXEdit&quot;</span><span class="p">)</span>
        <span class="n">le</span><span class="o">.</span><span class="n">setValidator</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QDoubleValidator</span><span class="p">(</span><span class="n">le</span><span class="p">))</span>
        <span class="n">le</span> <span class="o">=</span> <span class="n">findChild</span><span class="p">(</span><span class="n">awin</span><span class="p">,</span> <span class="s2">&quot;coordYEdit&quot;</span><span class="p">)</span>
        <span class="n">le</span><span class="o">.</span><span class="n">setValidator</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QDoubleValidator</span><span class="p">(</span><span class="n">le</span><span class="p">))</span>
        <span class="n">le</span> <span class="o">=</span> <span class="n">findChild</span><span class="p">(</span><span class="n">awin</span><span class="p">,</span> <span class="s2">&quot;coordZEdit&quot;</span><span class="p">)</span>
        <span class="n">le</span><span class="o">.</span><span class="n">setValidator</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QDoubleValidator</span><span class="p">(</span><span class="n">le</span><span class="p">))</span>
        <span class="n">le</span> <span class="o">=</span> <span class="n">findChild</span><span class="p">(</span><span class="n">awin</span><span class="p">,</span> <span class="s2">&quot;coordTEdit&quot;</span><span class="p">)</span>
        <span class="n">le</span><span class="o">.</span><span class="n">setValidator</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QDoubleValidator</span><span class="p">(</span><span class="n">le</span><span class="p">))</span>
        <span class="k">del</span> <span class="n">le</span>
        <span class="n">findChild</span><span class="p">(</span><span class="n">awin</span><span class="p">,</span> <span class="s2">&quot;coordXEdit&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coordsChanged</span>
        <span class="p">)</span>
        <span class="n">findChild</span><span class="p">(</span><span class="n">awin</span><span class="p">,</span> <span class="s2">&quot;coordYEdit&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coordsChanged</span>
        <span class="p">)</span>
        <span class="n">findChild</span><span class="p">(</span><span class="n">awin</span><span class="p">,</span> <span class="s2">&quot;coordZEdit&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coordsChanged</span>
        <span class="p">)</span>
        <span class="n">findChild</span><span class="p">(</span><span class="n">awin</span><span class="p">,</span> <span class="s2">&quot;coordTEdit&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coordsChanged</span>
        <span class="p">)</span>

        <span class="n">objects_list</span> <span class="o">=</span> <span class="n">findChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="s2">&quot;objectslist&quot;</span><span class="p">)</span>
        <span class="n">objects_list</span><span class="o">.</span><span class="n">setContextMenuPolicy</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CustomContextMenu</span><span class="p">)</span>
        <span class="n">objects_list</span><span class="o">.</span><span class="n">customContextMenuRequested</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">popup_objects</span><span class="p">)</span>

        <span class="n">awin</span><span class="o">.</span><span class="n">dropEvent</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">awin</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropEvent</span><span class="p">(</span><span class="n">awin</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="n">awin</span><span class="o">.</span><span class="n">dragEnterEvent</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">awin</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dragEnterEvent</span><span class="p">(</span>
            <span class="n">awin</span><span class="p">,</span> <span class="n">event</span>
        <span class="p">)</span>
        <span class="n">awin</span><span class="o">.</span><span class="n">setAcceptDrops</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_vrenabled</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meshes2d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># register the function on the cursor notifier of anatomist. It will be</span>
        <span class="c1"># called when the user clicks on a window</span>
        <span class="n">a</span><span class="o">.</span><span class="n">onCursorNotifier</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clickHandler</span><span class="p">)</span>

        <span class="c1"># viewWindow: parent widget for anatomist windows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewWindow</span> <span class="o">=</span> <span class="n">findChild</span><span class="p">(</span><span class="n">awin</span><span class="p">,</span> <span class="s2">&quot;windows&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">viewgridlay</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewWindow</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">combobox</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QSlider</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fdialog</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">awindows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aobjects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volrender</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_3d_type</span> <span class="o">=</span> <span class="s2">&quot;LeftSimple3DControl&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewButtons</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">findChild</span><span class="p">(</span><span class="n">awin</span><span class="p">,</span> <span class="s2">&quot;actionAxial&quot;</span><span class="p">),</span>
            <span class="n">findChild</span><span class="p">(</span><span class="n">awin</span><span class="p">,</span> <span class="s2">&quot;actionSagittal&quot;</span><span class="p">),</span>
            <span class="n">findChild</span><span class="p">(</span><span class="n">awin</span><span class="p">,</span> <span class="s2">&quot;actionCoronal&quot;</span><span class="p">),</span>
            <span class="n">findChild</span><span class="p">(</span><span class="n">awin</span><span class="p">,</span> <span class="s2">&quot;action3D&quot;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displayedObjects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">available_palettes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;B-W LINEAR&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Yellow-red&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RAINBOW&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Yellow-Red-White-Blue-Green&quot;</span><span class="p">,</span>
            <span class="s2">&quot;blue-red-bright-dark&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewButtons</span><span class="p">:</span>
            <span class="n">action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">newDisplay</span><span class="p">)</span>
        <span class="n">findChild</span><span class="p">(</span><span class="n">awin</span><span class="p">,</span> <span class="s2">&quot;objectslist&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disableButtons</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setComboBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSlider</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">combobox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">newPalette</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changeOpacity</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.init_global_handlers"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.init_global_handlers">[docs]</a>    <span class="k">def</span> <span class="nf">init_global_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set some global controls / settings in Anatomist application object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">AnaSimpleViewer2</span><span class="o">.</span><span class="n">_global_handlers_initialized</span><span class="p">:</span>
            <span class="n">registerSimpleControls</span><span class="p">()</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">)</span>
            <span class="n">iconpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">anatomistSharedPath</span><span class="p">()),</span> <span class="s2">&quot;icons&quot;</span><span class="p">)</span>
            <span class="n">pix</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QPixmap</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">iconpath</span><span class="p">,</span> <span class="s2">&quot;simple3Dcontrol.png&quot;</span><span class="p">))</span>
            <span class="n">ana</span><span class="o">.</span><span class="n">cpp</span><span class="o">.</span><span class="n">IconDictionary</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">addIcon</span><span class="p">(</span>
                <span class="s2">&quot;LeftSimple3DControl&quot;</span><span class="p">,</span> <span class="n">pix</span>
            <span class="p">)</span>
            <span class="n">ana</span><span class="o">.</span><span class="n">cpp</span><span class="o">.</span><span class="n">IconDictionary</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">addIcon</span><span class="p">(</span><span class="s2">&quot;VolRenderControl&quot;</span><span class="p">,</span> <span class="n">pix</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">pix</span><span class="p">,</span> <span class="n">iconpath</span>
            <span class="n">cd</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">cpp</span><span class="o">.</span><span class="n">ControlDictionary</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
            <span class="n">cd</span><span class="o">.</span><span class="n">addControl</span><span class="p">(</span><span class="s2">&quot;LeftSimple3DControl&quot;</span><span class="p">,</span> <span class="n">LeftSimple3DControl</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
            <span class="n">cd</span><span class="o">.</span><span class="n">addControl</span><span class="p">(</span><span class="s2">&quot;VolRenderControl&quot;</span><span class="p">,</span> <span class="n">VolRenderControl</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>

            <span class="c1"># tweak: override some user config options</span>
            <span class="n">a</span><span class="o">.</span><span class="n">config</span><span class="p">()[</span><span class="s2">&quot;windowSizeFactor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="n">a</span><span class="o">.</span><span class="n">config</span><span class="p">()[</span><span class="s2">&quot;commonScannerBasedReferential&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1"># register controls</span>
            <span class="n">cm</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">cpp</span><span class="o">.</span><span class="n">ControlManager</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
            <span class="n">cm</span><span class="o">.</span><span class="n">addControl</span><span class="p">(</span><span class="s2">&quot;QAGLWidget3D&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Simple2DControl&quot;</span><span class="p">)</span>
            <span class="n">cm</span><span class="o">.</span><span class="n">addControl</span><span class="p">(</span><span class="s2">&quot;QAGLWidget3D&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;LeftSimple3DControl&quot;</span><span class="p">)</span>
            <span class="n">cm</span><span class="o">.</span><span class="n">addControl</span><span class="p">(</span><span class="s2">&quot;QAGLWidget3D&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;VolRenderControl&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;controls registered.&quot;</span><span class="p">)</span>

            <span class="k">del</span> <span class="n">cm</span>

            <span class="n">a</span><span class="o">.</span><span class="n">setGraphParams</span><span class="p">(</span><span class="n">label_attribute</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">)</span>

            <span class="n">AnaSimpleViewer2</span><span class="o">.</span><span class="n">_global_handlers_initialized</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.setComboBox"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.setComboBox">[docs]</a>    <span class="k">def</span> <span class="nf">setComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inserts a drop down menu in the toolbar. This menu contains defined</span>
<span class="sd">        available color palettes. The default color palettes are in</span>
<span class="sd">        self.available_palettes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">toolBar</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">,</span> <span class="s2">&quot;toolBar&quot;</span><span class="p">)</span>
        <span class="n">actionAutoRunning</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">,</span> <span class="s2">&quot;actionTimeRunning&quot;</span>
        <span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Palette: &quot;</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Change color palette of selected object&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">palette</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_palettes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">combobox</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">palette</span><span class="p">)</span>

        <span class="n">toolBar</span><span class="o">.</span><span class="n">insertWidget</span><span class="p">(</span><span class="n">actionAutoRunning</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="n">toolBar</span><span class="o">.</span><span class="n">insertWidget</span><span class="p">(</span><span class="n">actionAutoRunning</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">combobox</span><span class="p">)</span>
        <span class="n">sources_images_dir</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span><span class="o">.</span><span class="n">getSourceImageDir</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">available_palettes</span><span class="p">)):</span>
            <span class="n">icon</span> <span class="o">=</span> <span class="n">QIcon</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sources_images_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_palettes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">combobox</span><span class="o">.</span><span class="n">setItemIcon</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">icon</span><span class="p">)</span>

        <span class="n">size</span> <span class="o">=</span> <span class="n">PyQt5</span><span class="o">.</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">combobox</span><span class="o">.</span><span class="n">setIconSize</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.setSlider"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.setSlider">[docs]</a>    <span class="k">def</span> <span class="nf">setSlider</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inserts opacity slider in the toolbar</span>
<span class="sd">        Minimum returned value is 0 and maximum value is 100</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">toolBar</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">,</span> <span class="s2">&quot;toolBar&quot;</span><span class="p">)</span>
        <span class="n">actionAutoRunning</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">,</span> <span class="s2">&quot;actionTimeRunning&quot;</span>
        <span class="p">)</span>
        <span class="n">space</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Opacity: &quot;</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Change opacity of selected object&quot;</span><span class="p">)</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">PyQt5</span><span class="o">.</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">setMaximumSize</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">toolBar</span><span class="o">.</span><span class="n">insertWidget</span><span class="p">(</span><span class="n">actionAutoRunning</span><span class="p">,</span> <span class="n">space</span><span class="p">)</span>
        <span class="n">toolBar</span><span class="o">.</span><span class="n">insertWidget</span><span class="p">(</span><span class="n">actionAutoRunning</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="n">toolBar</span><span class="o">.</span><span class="n">insertWidget</span><span class="p">(</span><span class="n">actionAutoRunning</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.changeOpacity"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.changeOpacity">[docs]</a>    <span class="k">def</span> <span class="nf">changeOpacity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes opacity of selected object (to be more precise it changes the</span>
<span class="sd">        mixing rate between objects when multiple ones are displayed)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedObjects</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">displayedObjects</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">diffuse_vect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedObjects</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()[</span><span class="s2">&quot;material&quot;</span><span class="p">][</span>
                <span class="s2">&quot;diffuse&quot;</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selectedObjects</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setMaterial</span><span class="p">(</span>
                <span class="n">diffuse</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">diffuse_vect</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">diffuse_vect</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">diffuse_vect</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedObjects</span><span class="p">():</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">displayedObjects</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedObjects</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">a</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                    <span class="s2">&quot;TexturingParams&quot;</span><span class="p">,</span>
                    <span class="n">objects</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span><span class="p">,</span>
                    <span class="n">texture_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;linear_B_if_A_black&quot;</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">corrected_val</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">-</span> <span class="mi">100</span><span class="p">)</span>
                <span class="n">a</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                    <span class="s2">&quot;TexturingParams&quot;</span><span class="p">,</span>
                    <span class="n">objects</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span><span class="p">,</span>
                    <span class="n">texture_index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
                    <span class="n">rate</span><span class="o">=</span><span class="n">corrected_val</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;linear_A_if_B_black&quot;</span><span class="p">,</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.newPalette"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.newPalette">[docs]</a>    <span class="k">def</span> <span class="nf">newPalette</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets chosen color palette in the toolbar drop down menu to</span>
<span class="sd">        selected object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combobox</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedObjects</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selectedObjects</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setPalette</span><span class="p">(</span><span class="n">palette</span><span class="o">=</span><span class="n">color</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.setColorPalette"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.setColorPalette">[docs]</a>    <span class="k">def</span> <span class="nf">setColorPalette</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks color palette of a selected object, displays it in the toolbar</span>
<span class="sd">        drop-down menu and adds it if it isn&#39;t already stored in</span>
<span class="sd">        self.available_palettes. If corresponding palette image exists it is</span>
<span class="sd">        added, otherwise only the name of the palette appears.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combobox</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedObjects</span><span class="p">():</span>
            <span class="n">actual_pal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedObjects</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()[</span><span class="s2">&quot;palette&quot;</span><span class="p">][</span>
                <span class="s2">&quot;palette&quot;</span>
            <span class="p">]</span>

            <span class="k">if</span> <span class="n">actual_pal</span> <span class="o">!=</span> <span class="n">color</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">actual_pal</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_palettes</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">combobox</span><span class="o">.</span><span class="n">setCurrentText</span><span class="p">(</span><span class="n">actual_pal</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">combobox</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">actual_pal</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">combobox</span><span class="o">.</span><span class="n">setCurrentText</span><span class="p">(</span><span class="n">actual_pal</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">available_palettes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">actual_pal</span><span class="p">)</span>
                    <span class="n">sources_images_dir</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span><span class="o">.</span><span class="n">getSourceImageDir</span><span class="p">()</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combobox</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
                    <span class="n">icon</span> <span class="o">=</span> <span class="n">QIcon</span><span class="p">(</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="n">sources_images_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_palettes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">combobox</span><span class="o">.</span><span class="n">setItemIcon</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">icon</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.changeConfig"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.changeConfig">[docs]</a>    <span class="k">def</span> <span class="nf">changeConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        change config depending on user settings</span>
<span class="sd">        config : string &quot;neuro&quot; or &quot;radio&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">config</span><span class="p">()[</span><span class="s2">&quot;axialConvention&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newDisplay</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.changeRef"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.changeRef">[docs]</a>    <span class="k">def</span> <span class="nf">changeRef</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        change referential</span>
<span class="sd">        ref : Boolean</span>
<span class="sd">        0 : World coordinates</span>
<span class="sd">        1 : Image referential</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deleteObjects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aobjects</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">,</span> <span class="n">config_changed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.findChild"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.findChild">[docs]</a>    <span class="k">def</span> <span class="nf">findChild</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Blabla&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.clickHandler"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.clickHandler">[docs]</a>    <span class="k">def</span> <span class="nf">clickHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eventName</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback for linked cursor. In volume rendering mode, it will sync</span>
<span class="sd">        the VR slice to the linked cursor.</span>
<span class="sd">        It also updates the volumes values view</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span>
        <span class="n">win</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span>
        <span class="n">wref</span> <span class="o">=</span> <span class="n">win</span><span class="o">.</span><span class="n">getReferential</span><span class="p">()</span>
        <span class="c1"># display coords in MNI referential (preferably)</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">getTransformation</span><span class="p">(</span><span class="n">wref</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">mniTemplateRef</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tr</span><span class="p">:</span>
            <span class="n">pos2</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">pos</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pos2</span> <span class="o">=</span> <span class="n">pos</span>

        <span class="k">def</span> <span class="nf">findChild</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Blabla&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">findChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="s2">&quot;coordXEdit&quot;</span><span class="p">)</span>
        <span class="n">x</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%8.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">pos2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">findChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="s2">&quot;coordYEdit&quot;</span><span class="p">)</span>
        <span class="n">y</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%8.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">pos2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">findChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="s2">&quot;coordZEdit&quot;</span><span class="p">)</span>
        <span class="n">z</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%8.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">pos2</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">findChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="s2">&quot;coordTEdit&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">t</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%8.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="c1"># display volumes values at the given position</span>

        <span class="n">valbox</span> <span class="o">=</span> <span class="n">findChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="s2">&quot;volumesBox&quot;</span><span class="p">)</span>
        <span class="n">valbox</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="c1"># (we don&#39;t use the same widget type in Qt3 and Qt4)</span>

        <span class="n">valbox</span><span class="o">.</span><span class="n">setColumnCount</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">valbox</span><span class="o">.</span><span class="n">setHorizontalHeaderLabels</span><span class="p">([</span><span class="s2">&quot;Volume:&quot;</span><span class="p">,</span> <span class="s2">&quot;Value:&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">valbox</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">valbox</span><span class="o">.</span><span class="n">setVerticalHeaderLabels</span><span class="p">([</span><span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="c1"># retreive volume val&#39;radio&#39;ue in its own coords system</span>
            <span class="n">aimsv</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">cpp</span><span class="o">.</span><span class="n">AObjectConverter</span><span class="o">.</span><span class="n">aims</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">oref</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">getReferential</span><span class="p">()</span>
            <span class="n">tr</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">getTransformation</span><span class="p">(</span><span class="n">wref</span><span class="p">,</span> <span class="n">oref</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tr</span><span class="p">:</span>
                <span class="n">pos2</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">pos</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pos2</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">voxelSize</span><span class="p">()</span>
            <span class="n">pos2</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">y</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pos2</span><span class="p">,</span> <span class="n">vs</span><span class="p">)]</span>
            <span class="c1"># pos2 in in voxels, in obj coords system</span>
            <span class="n">newItem</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">valbox</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">newItem</span><span class="p">)</span>
            <span class="c1"># check bounds</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">pos2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>
                <span class="ow">and</span> <span class="n">pos2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>
                <span class="ow">and</span> <span class="n">pos2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>
                <span class="ow">and</span> <span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>
                <span class="ow">and</span> <span class="n">pos2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">aimsv</span><span class="o">.</span><span class="n">getSizeX</span><span class="p">()</span>
                <span class="ow">and</span> <span class="n">pos2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">aimsv</span><span class="o">.</span><span class="n">getSizeY</span><span class="p">()</span>
                <span class="ow">and</span> <span class="n">pos2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">aimsv</span><span class="o">.</span><span class="n">getSizeZ</span><span class="p">()</span>
                <span class="ow">and</span> <span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">aimsv</span><span class="o">.</span><span class="n">getSizeT</span><span class="p">()</span>
            <span class="p">):</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">aimsv</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="o">*</span><span class="n">pos2</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">newitem</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
            <span class="n">valbox</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">newitem</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">valbox</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span>

        <span class="c1"># update volume rendering when it is enabled</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vrenabled</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">volrender</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">clip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">volrender</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">getTransformation</span><span class="p">(</span>
                <span class="n">win</span><span class="o">.</span><span class="n">getReferential</span><span class="p">(),</span> <span class="n">clip</span><span class="o">.</span><span class="n">getReferential</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">pos</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">clip</span><span class="o">.</span><span class="n">setOffset</span><span class="p">(</span><span class="n">pos</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">clip</span><span class="o">.</span><span class="n">notifyObservers</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.automaticRunning"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.automaticRunning">[docs]</a>    <span class="k">def</span> <span class="nf">automaticRunning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable automatic running of functionnal images</span>
<span class="sd">        frame rate can be changed in preferences by the user</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">)</span>
        <span class="n">objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">im_sec</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Config</span><span class="p">()</span><span class="o">.</span><span class="n">getViewerFramerate</span><span class="p">())</span>
        <span class="n">frame_rate</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">im_sec</span>

        <span class="k">def</span> <span class="nf">findChild</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Blabla&quot;&quot;&quot;</span>

            <span class="k">return</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">findChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="s2">&quot;coordTEdit&quot;</span><span class="p">)</span>
        <span class="n">sources_images_dir</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span><span class="o">.</span><span class="n">getSourceImageDir</span><span class="p">()</span>
        <span class="n">pauseIcon</span> <span class="o">=</span> <span class="n">QIcon</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sources_images_dir</span><span class="p">,</span> <span class="s2">&quot;pause.png&quot;</span><span class="p">))</span>
        <span class="n">playIcon</span> <span class="o">=</span> <span class="n">QIcon</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sources_images_dir</span><span class="p">,</span> <span class="s2">&quot;play.png&quot;</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">displayedObjects</span><span class="p">)):</span>
            <span class="n">objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ana</span><span class="o">.</span><span class="n">cpp</span><span class="o">.</span><span class="n">AObjectConverter</span><span class="o">.</span><span class="n">aims</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">displayedObjects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">)</span><span class="o">.</span><span class="n">getSizeT</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">objects</span><span class="p">:</span>
            <span class="n">nb_images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">objects</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">list_im</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nb_images</span><span class="p">))</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">findChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="s2">&quot;coordXEdit&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">findChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="s2">&quot;coordYEdit&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">findChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="s2">&quot;coordZEdit&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
        <span class="p">]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">findChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="s2">&quot;coordTEdit&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">nb_images</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">playAction</span> <span class="o">=</span> <span class="n">findChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="s2">&quot;actionTimeRunning&quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">playAction</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_im</span><span class="p">):</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">playAction</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">pauseIcon</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%8.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">list_im</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">a</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s2">&quot;LinkedCursor&quot;</span><span class="p">,</span>
                <span class="n">window</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">awindows</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">position</span><span class="o">=</span><span class="n">pos</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">list_im</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span>
            <span class="p">)</span>
            <span class="n">PyQt5</span><span class="o">.</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
            <span class="n">running_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="k">if</span> <span class="n">running_time</span> <span class="o">&gt;</span> <span class="n">frame_rate</span><span class="p">:</span>
                <span class="c1"># If iteration takes to much time we don&#39;t want to</span>
                <span class="c1"># make it sleep any longer (happens when fusion of images)</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">frame_rate</span> <span class="o">-</span> <span class="n">running_time</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">playAction</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">playIcon</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.createWindow"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.createWindow">[docs]</a>    <span class="k">def</span> <span class="nf">createWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wintype</span><span class="o">=</span><span class="s2">&quot;Axial&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens a new window in the windows grid layout.</span>
<span class="sd">        The new window will be set in MNI referential (except 3D for now</span>
<span class="sd">        because of a buf in volume rendering in direct referentials), will be</span>
<span class="sd">        assigned the custom control, and have no menu/toolbars.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">createWindow</span><span class="p">(</span><span class="n">wintype</span><span class="p">,</span> <span class="n">no_decoration</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;hidden&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="n">w</span><span class="o">.</span><span class="n">setAcceptDrops</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># insert in grid layout</span>

        <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_winlayouts&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_winlayouts</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">freeslot</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_winlayouts</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">]:</span>
                        <span class="n">freeslot</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">freeslot</span><span class="p">:</span>
                    <span class="k">break</span>

        <span class="c1"># in Qt4, the widget must not have a parent before calling</span>
        <span class="c1"># layout.addWidget</span>
        <span class="c1"># self.viewgridlay.addWidget(w.getInternalRep(), x, y)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewgridlay</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">getInternalRep</span><span class="p">())</span>
        <span class="c1"># self.viewgridlay.addWidget(w.getInternalRep(), 0, i)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_winlayouts</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># keep it in anasimpleviewer list of windows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">awindows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
        <span class="c1"># set custom control</span>
        <span class="k">if</span> <span class="n">wintype</span> <span class="o">==</span> <span class="s2">&quot;3D&quot;</span><span class="p">:</span>
            <span class="n">a</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SetControl&quot;</span><span class="p">,</span> <span class="n">windows</span><span class="o">=</span><span class="p">[</span><span class="n">w</span><span class="p">],</span> <span class="n">control</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">control_3d_type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SetControl&quot;</span><span class="p">,</span> <span class="n">windows</span><span class="o">=</span><span class="p">[</span><span class="n">w</span><span class="p">],</span> <span class="n">control</span><span class="o">=</span><span class="s2">&quot;Simple2DControl&quot;</span><span class="p">)</span>
            <span class="n">a</span><span class="o">.</span><span class="n">assignReferential</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">mniTemplateRef</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
            <span class="c1"># force redrawing in MNI orientation</span>
            <span class="c1"># (there should be a better way to do so...)</span>
            <span class="k">if</span> <span class="n">wintype</span> <span class="o">==</span> <span class="s2">&quot;Axial&quot;</span><span class="p">:</span>
                <span class="n">w</span><span class="o">.</span><span class="n">muteAxial</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MUTEAXIAL&quot;</span><span class="p">,</span> <span class="n">w</span><span class="o">.</span><span class="n">muteAxial</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">wintype</span> <span class="o">==</span> <span class="s2">&quot;Coronal&quot;</span><span class="p">:</span>
                <span class="n">w</span><span class="o">.</span><span class="n">muteCoronal</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">wintype</span> <span class="o">==</span> <span class="s2">&quot;Sagittal&quot;</span><span class="p">:</span>
                <span class="n">w</span><span class="o">.</span><span class="n">muteSagittal</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">wintype</span> <span class="o">==</span> <span class="s2">&quot;Oblique&quot;</span><span class="p">:</span>
                <span class="n">w</span><span class="o">.</span><span class="n">muteOblique</span><span class="p">()</span>
        <span class="c1"># set a black background</span>
        <span class="n">a</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;WindowConfig&quot;</span><span class="p">,</span>
            <span class="n">windows</span><span class="o">=</span><span class="p">[</span><span class="n">w</span><span class="p">],</span>
            <span class="n">light</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;background&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]},</span>
            <span class="n">view_size</span><span class="o">=</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">600</span><span class="p">),</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.createTotalWindow"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.createTotalWindow">[docs]</a>    <span class="k">def</span> <span class="nf">createTotalWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">views</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the windows which will contain the views.</span>

<span class="sd">        views : array containing strings &quot;axial&quot;, &quot;sagittal&quot;, &quot;coronal&quot;</span>
<span class="sd">                and/or &quot;3D&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">views</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">createWindow</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;3D&quot;</span><span class="p">:</span>
                <span class="c1"># set a cool angle of view for 3D</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">)</span>
                <span class="n">a</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                    <span class="s2">&quot;Camera&quot;</span><span class="p">,</span>
                    <span class="n">windows</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">awindows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span>
                    <span class="n">view_quaternion</span><span class="o">=</span><span class="p">[</span><span class="mf">0.404603</span><span class="p">,</span> <span class="mf">0.143829</span><span class="p">,</span> <span class="mf">0.316813</span><span class="p">,</span> <span class="mf">0.845718</span><span class="p">],</span>
                <span class="p">)</span>

        <span class="c1"># Sets view buttons checked for first display</span>
        <span class="k">if</span> <span class="n">views</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;Axial&quot;</span><span class="p">,</span> <span class="s2">&quot;Sagittal&quot;</span><span class="p">,</span> <span class="s2">&quot;Coronal&quot;</span><span class="p">]:</span>
            <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">views</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">viewButtons</span><span class="p">[</span><span class="n">counter</span><span class="p">]</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.deleteTotalWindow"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.deleteTotalWindow">[docs]</a>    <span class="k">def</span> <span class="nf">deleteTotalWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clear windows and fusions in order to enable new display</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">awindows</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewgridlay</span><span class="o">.</span><span class="n">count</span><span class="p">())):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewgridlay</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.getViewsToDisplay"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.getViewsToDisplay">[docs]</a>    <span class="k">def</span> <span class="nf">getViewsToDisplay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check which views must be displayed</span>
<span class="sd">        return : array with strings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">views</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewButtons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">views</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Axial&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewButtons</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">views</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Sagittal&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewButtons</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">views</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Coronal&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewButtons</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">views</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;3D&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">views</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.viewReferential"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.viewReferential">[docs]</a>    <span class="k">def</span> <span class="nf">viewReferential</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set referential at the object center to visualize it</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">)</span>
        <span class="n">bb</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="n">boundingbox</span><span class="p">()</span>
        <span class="n">position</span> <span class="o">=</span> <span class="p">(</span><span class="n">aims</span><span class="o">.</span><span class="n">Point3df</span><span class="p">(</span><span class="n">bb</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="mi">3</span><span class="p">])</span> <span class="o">-</span> <span class="n">bb</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">wrefs</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">getReferential</span><span class="p">()</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">awindows</span><span class="p">]</span>
        <span class="n">srefs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">uuid</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">wrefs</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">srefs</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># not all windows in the same ref</span>
            <span class="k">if</span> <span class="n">aims</span><span class="o">.</span><span class="n">StandardReferentials</span><span class="o">.</span><span class="n">mniTemplateReferentialID</span><span class="p">()</span> <span class="ow">in</span> <span class="n">srefs</span><span class="p">:</span>
                <span class="n">wref_id</span> <span class="o">=</span> <span class="n">aims</span><span class="o">.</span><span class="n">StandardReferentials</span><span class="o">.</span><span class="n">mniTemplateReferentialID</span><span class="p">()</span>
                <span class="n">wref</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">wrefs</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">uuid</span><span class="p">()</span> <span class="o">==</span> <span class="n">wref_id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">aims</span><span class="o">.</span><span class="n">StandardReferentials</span><span class="o">.</span><span class="n">acPcReferentialID</span><span class="p">()</span> <span class="ow">in</span> <span class="n">srefs</span><span class="p">:</span>
                <span class="n">wref</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">centralReferential</span><span class="p">()</span>
            <span class="k">elif</span> <span class="p">(</span>
                <span class="n">aims</span><span class="o">.</span><span class="n">StandardReferentials</span><span class="o">.</span><span class="n">commonScannerBasedReferentialID</span><span class="p">()</span>
                <span class="ow">in</span> <span class="n">srefs</span>
            <span class="p">):</span>
                <span class="n">wref_id</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">aims</span><span class="o">.</span><span class="n">StandardReferentials</span><span class="o">.</span><span class="n">commonScannerBasedReferentialID</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="n">wref</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">wrefs</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">uuid</span><span class="p">()</span> <span class="o">==</span> <span class="n">wref_id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">wref</span> <span class="o">=</span> <span class="n">wrefs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">awindows</span><span class="p">:</span>
                <span class="n">w</span><span class="o">.</span><span class="n">setReferential</span><span class="p">(</span><span class="n">wref</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wref</span> <span class="o">=</span> <span class="n">wrefs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">getTransformation</span><span class="p">(</span><span class="nb">object</span><span class="o">.</span><span class="n">getReferential</span><span class="p">(),</span> <span class="n">wref</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">t</span> <span class="ow">and</span> <span class="nb">object</span><span class="o">.</span><span class="n">getReferential</span><span class="p">()</span> <span class="o">!=</span> <span class="n">wref</span><span class="p">:</span>
            <span class="c1"># try to find a scanner-based ref and connect it to MNI</span>
            <span class="n">sbref</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">r</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">getReferentials</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">uuid</span><span class="p">()</span>
                <span class="o">==</span> <span class="n">aims</span><span class="o">.</span><span class="n">StandardReferentials</span><span class="o">.</span><span class="n">commonScannerBasedReferentialID</span><span class="p">()</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="n">sbref</span><span class="p">:</span>
                <span class="n">sbref</span> <span class="o">=</span> <span class="n">sbref</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">t2</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">getTransformation</span><span class="p">(</span><span class="nb">object</span><span class="o">.</span><span class="n">getReferential</span><span class="p">(),</span> <span class="n">sbref</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">t2</span><span class="p">:</span>
                    <span class="n">a</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                        <span class="s2">&quot;LoadTransformation&quot;</span><span class="p">,</span>
                        <span class="n">origin</span><span class="o">=</span><span class="n">sbref</span><span class="p">,</span>
                        <span class="n">destination</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">mniTemplateRef</span><span class="p">,</span>
                        <span class="n">matrix</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># otherwise we will assume the object is in the central</span>
                    <span class="c1"># referential.</span>
                    <span class="n">a</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                        <span class="s2">&quot;LoadTransformation&quot;</span><span class="p">,</span>
                        <span class="n">origin</span><span class="o">=</span><span class="nb">object</span><span class="o">.</span><span class="n">getReferential</span><span class="p">(),</span>
                        <span class="n">destination</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">centralRef</span><span class="p">,</span>
                        <span class="n">matrix</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="p">)</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">getTransformation</span><span class="p">(</span>
                    <span class="nb">object</span><span class="o">.</span><span class="n">getReferential</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">awindows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getReferential</span><span class="p">()</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span><span class="p">:</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;LinkedCursor&quot;</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">awindows</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">awindows</span><span class="p">:</span>
            <span class="n">w</span><span class="o">.</span><span class="n">focusView</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.checkviews"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.checkviews">[docs]</a>    <span class="k">def</span> <span class="nf">checkviews</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prevent from closing the last view opened</span>
<span class="sd">        Checks how many views button are enabled and if only one is,</span>
<span class="sd">        it disables the button</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nb_views_checked</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewButtons</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewButtons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="n">nb_views_checked</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">nb_views_checked</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewButtons</span><span class="p">)):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewButtons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">viewButtons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewButtons</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">viewButtons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.newDisplay"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.newDisplay">[docs]</a>    <span class="k">def</span> <span class="nf">newDisplay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        New display of windows, objects and views</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkviews</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTotalWindow</span><span class="p">()</span>
        <span class="n">views</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getViewsToDisplay</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createTotalWindow</span><span class="p">(</span><span class="n">views</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">displayedObjects</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">displayedObjects</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewReferential</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">displayedObjects</span><span class="p">[</span><span class="n">i</span><span class="p">])</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.loadObject"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.loadObject">[docs]</a>    <span class="k">def</span> <span class="nf">loadObject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">config_changed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load objects in files and display</span>
<span class="sd">        Only the first object of files is displayed, the others are loaded and</span>
<span class="sd">        added to objectlist but not displayed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">config</span><span class="p">()[</span><span class="s2">&quot;setAutomaticReferential&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span><span class="o">.</span><span class="n">get_referential</span><span class="p">()</span>
        <span class="n">a</span><span class="o">.</span><span class="n">config</span><span class="p">()[</span><span class="s2">&quot;axialConvention&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span><span class="o">.</span><span class="n">getViewerConfig</span><span class="p">()</span>

        <span class="c1"># Progress indication</span>
        <span class="n">window</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QWidget</span><span class="p">()</span>
        <span class="n">window</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Loading data&quot;</span><span class="p">)</span>
        <span class="n">window</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">window</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
        <span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
            <span class="n">objectlist</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">,</span> <span class="s2">&quot;objectslist&quot;</span>
            <span class="p">)</span>
            <span class="c1"># test if object has already been imported</span>
            <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">objectlist</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="o">==</span> <span class="n">objectlist</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">config_changed</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="k">return</span>
                    <span class="n">msgBox</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
                    <span class="n">msgBox</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
                    <span class="n">msgBox</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                        <span class="s2">&quot;Some of your objects have already been imported&quot;</span>
                    <span class="p">)</span>
                    <span class="n">msgBox</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Warning&quot;</span><span class="p">)</span>
                    <span class="n">msgBox</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>

                    <span class="n">returnValue</span> <span class="o">=</span> <span class="n">msgBox</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">returnValue</span> <span class="o">==</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">:</span>
                        <span class="k">return</span>

            <span class="n">obj</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">loadObject</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">obj</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">registerObject</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">objectlist</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="c1"># keep it in the global list</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">aobjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">colorBackgroundList</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">objectType</span> <span class="o">==</span> <span class="s2">&quot;VOLUME&quot;</span><span class="p">:</span>
                        <span class="c1"># volume are checked for possible adequate colormaps</span>
                        <span class="n">hints</span> <span class="o">=</span> <span class="n">colormaphints</span><span class="o">.</span><span class="n">checkVolume</span><span class="p">(</span>
                            <span class="n">ana</span><span class="o">.</span><span class="n">cpp</span><span class="o">.</span><span class="n">AObjectConverter</span><span class="o">.</span><span class="n">aims</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">obj</span><span class="o">.</span><span class="n">attributed</span><span class="p">()[</span><span class="s2">&quot;colormaphints&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hints</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.objectLoaded"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.objectLoaded">[docs]</a>    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">Slot</span><span class="p">(</span><span class="s2">&quot;anatomist::AObject *&quot;</span><span class="p">,</span> <span class="s2">&quot;const std::string &amp;&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">objectLoaded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Blabla&quot;&quot;&quot;</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">AObject</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="n">o</span><span class="o">.</span><span class="n">releaseAppRef</span><span class="p">()</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">theProcessor</span><span class="p">()</span>
        <span class="n">resetProcExec</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">execWhileIdle</span><span class="p">():</span>
            <span class="c1"># allow recursive commands execution, otherwise the execute()</span>
            <span class="c1"># may not be done right now</span>
            <span class="n">p</span><span class="o">.</span><span class="n">allowExecWhileIdle</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">resetProcExec</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registerObject</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resetProcExec</span><span class="p">:</span>
            <span class="c1"># set back recursive execution to its previous state</span>
            <span class="n">p</span><span class="o">.</span><span class="n">allowExecWhileIdle</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.registerObject"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.registerObject">[docs]</a>    <span class="k">def</span> <span class="nf">registerObject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">views</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register an object in anasimpleviewer objects list, and display it</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ojectlist</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">,</span> <span class="s2">&quot;objectslist&quot;</span>
        <span class="p">)</span>
        <span class="n">ojectlist</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="c1"># keep it in the global list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aobjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displayedObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colorBackgroundList</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">objectType</span> <span class="o">==</span> <span class="s2">&quot;VOLUME&quot;</span><span class="p">:</span>
            <span class="c1"># volume are checked for possible adequate colormaps</span>
            <span class="c1"># prints the header of volume ana.cpp.AObjectConverter.aims(obj)</span>
            <span class="n">hints</span> <span class="o">=</span> <span class="n">colormaphints</span><span class="o">.</span><span class="n">checkVolume</span><span class="p">(</span>
                <span class="n">ana</span><span class="o">.</span><span class="n">cpp</span><span class="o">.</span><span class="n">AObjectConverter</span><span class="o">.</span><span class="n">aims</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">attributed</span><span class="p">()[</span><span class="s2">&quot;colormaphints&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hints</span>

        <span class="n">bb</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">boundingbox</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">bb</span><span class="p">:</span>
            <span class="c1"># not a viewable object</span>
            <span class="k">return</span>

        <span class="c1"># create the 4 windows if they don&#39;t exist</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">awindows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">views</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">createTotalWindow</span><span class="p">([</span><span class="s2">&quot;Axial&quot;</span><span class="p">,</span> <span class="s2">&quot;Sagittal&quot;</span><span class="p">,</span> <span class="s2">&quot;Coronal&quot;</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">createTotalWindow</span><span class="p">(</span><span class="n">views</span><span class="p">)</span>

        <span class="c1"># view obj in these views</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addObject</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="c1"># set the cursot at the center of the object (actually, overcome a bug</span>
        <span class="c1"># in anatomist...)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewReferential</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_displayVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="p">{}):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display a volume or a Fusion2D in all windows.</span>
<span class="sd">        If volume rendering is allowed, 3D views will display a clipped volume</span>
<span class="sd">        rendering of the object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vrenabled</span><span class="p">:</span>
            <span class="n">wins</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">awindows</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">subtype</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wins</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">a</span><span class="o">.</span><span class="n">addObjects</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">wins</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>
            <span class="n">wins</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">awindows</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">subtype</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wins</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">vr</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">fusionObjects</span><span class="p">([</span><span class="n">obj</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;VolumeRenderingFusionMethod&quot;</span><span class="p">)</span>
            <span class="n">vr</span><span class="o">.</span><span class="n">releaseAppRef</span><span class="p">()</span>
            <span class="n">clip</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">fusionObjects</span><span class="p">([</span><span class="n">vr</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;FusionClipMethod&quot;</span><span class="p">)</span>
            <span class="n">clip</span><span class="o">.</span><span class="n">releaseAppRef</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">volrender</span> <span class="o">=</span> <span class="p">[</span><span class="n">clip</span><span class="p">,</span> <span class="n">vr</span><span class="p">]</span>
            <span class="n">a</span><span class="o">.</span><span class="n">addObjects</span><span class="p">(</span><span class="n">clip</span><span class="p">,</span> <span class="n">wins</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span><span class="o">.</span><span class="n">addObjects</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">awindows</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>

<div class="viewcode-block" id="AnaSimpleViewer2.addVolume"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.addVolume">[docs]</a>    <span class="k">def</span> <span class="nf">addVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="p">{}):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display a volume in all windows.</span>
<span class="sd">        If several volumes are displayed, a Fusion2D will be built to wrap all</span>
<span class="sd">        of them.</span>
<span class="sd">        If volume rendering is allowed, 3D views will display a clipped volume</span>
<span class="sd">        rendering of either the single volume (if only one is present), or of</span>
<span class="sd">        the 2D fusion.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># hasvr = False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">volrender</span><span class="p">:</span>
            <span class="c1"># delete the previous volume rendering</span>
            <span class="n">a</span><span class="o">.</span><span class="n">deleteObjects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">volrender</span><span class="p">)</span>
            <span class="c1"># hasvr = True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">volrender</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># only one object</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">obj</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># several objects: fusion them</span>
            <span class="n">fusobjs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="p">[</span><span class="n">obj</span><span class="p">]</span>
            <span class="n">f2d</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">fusionObjects</span><span class="p">(</span><span class="n">fusobjs</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;Fusion2DMethod&quot;</span><span class="p">)</span>
            <span class="n">f2d</span><span class="o">.</span><span class="n">releaseAppRef</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># destroy the previous fusion</span>
                <span class="n">a</span><span class="o">.</span><span class="n">deleteObjects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">a</span><span class="o">.</span><span class="n">removeObjects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">awindows</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span> <span class="o">=</span> <span class="p">[</span><span class="n">f2d</span><span class="p">]</span> <span class="o">+</span> <span class="n">fusobjs</span>
            <span class="c1"># repalette( fusobjs )</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">f2d</span>

        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">objectType</span> <span class="o">==</span> <span class="s2">&quot;VOLUME&quot;</span><span class="p">:</span>
            <span class="c1"># choose a good colormap for a single volume</span>
            <span class="k">if</span> <span class="s2">&quot;volume_contents_likelihoods&quot;</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">attributed</span><span class="p">():</span>
                <span class="n">cmap</span> <span class="o">=</span> <span class="n">colormaphints</span><span class="o">.</span><span class="n">chooseColormaps</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">attributed</span><span class="p">()[</span><span class="s2">&quot;colormaphints&quot;</span><span class="p">],)</span>
                <span class="p">)</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">setPalette</span><span class="p">(</span><span class="n">cmap</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># choose good colormaps for the current set of volumes</span>
            <span class="n">hints</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">attributed</span><span class="p">()[</span><span class="s2">&quot;colormaphints&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">children</span><span class="p">]</span>
            <span class="n">children</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">x</span>
                <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">children</span><span class="p">,</span> <span class="n">hints</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;volume_contents_likelihoods&quot;</span> <span class="ow">in</span> <span class="n">y</span>
            <span class="p">]</span>
            <span class="n">hints</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">hints</span> <span class="k">if</span> <span class="s2">&quot;volume_contents_likelihoods&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
            <span class="n">cmaps</span> <span class="o">=</span> <span class="n">colormaphints</span><span class="o">.</span><span class="n">chooseColormaps</span><span class="p">(</span><span class="n">hints</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">children</span><span class="p">,</span> <span class="n">cmaps</span><span class="p">):</span>
                <span class="n">x</span><span class="o">.</span><span class="n">setPalette</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="c1"># call a lower-level function for display and volume rendering</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_displayVolume</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.removeVolume"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.removeVolume">[docs]</a>    <span class="k">def</span> <span class="nf">removeVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="p">{}):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hides a volume from views (low-level function: use removeObject)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span><span class="p">:</span>
            <span class="c1"># hasvr = False</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">volrender</span><span class="p">:</span>
                <span class="n">a</span><span class="o">.</span><span class="n">deleteObjects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">volrender</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">volrender</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="c1"># hasvr = True</span>

            <span class="n">fusobjs</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="n">o</span> <span class="o">!=</span> <span class="n">obj</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fusobjs</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">f2d</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">fusionObjects</span><span class="p">(</span><span class="n">fusobjs</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;Fusion2DMethod&quot;</span><span class="p">)</span>
                <span class="n">f2d</span><span class="o">.</span><span class="n">releaseAppRef</span><span class="p">()</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">f2d</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">a</span><span class="o">.</span><span class="n">deleteObjects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">a</span><span class="o">.</span><span class="n">removeObjects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">awindows</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fusobjs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span> <span class="o">=</span> <span class="p">[</span><span class="n">f2d</span><span class="p">]</span> <span class="o">+</span> <span class="n">fusobjs</span>

            <span class="c1"># repalette( fusobjs )</span>
            <span class="k">if</span> <span class="n">f2d</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">f2d</span>

            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">fusobjs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">fusobjs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_displayVolume</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.get_new_mesh2d_color"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.get_new_mesh2d_color">[docs]</a>    <span class="k">def</span> <span class="nf">get_new_mesh2d_color</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Blabla&quot;&quot;&quot;</span>

        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="n">used_cols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">col</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshes2d</span><span class="p">)])</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">used_cols</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">col</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshes2d</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.addMesh"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.addMesh">[docs]</a>    <span class="k">def</span> <span class="nf">addMesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">opts</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Blabla&quot;&quot;&quot;</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">)</span>
        <span class="n">mesh2d</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">fusionObjects</span><span class="p">(</span>
            <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">getInternalRep</span><span class="p">()],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;Fusion2DMeshMethod&quot;</span>
        <span class="p">)</span>
        <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_mesh2d_color</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meshes2d</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">getInternalRep</span><span class="p">()]</span> <span class="o">=</span> <span class="p">(</span><span class="n">mesh2d</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
        <span class="n">mesh2d</span><span class="o">.</span><span class="n">setMaterial</span><span class="p">(</span><span class="n">diffuse</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
        <span class="n">mesh2d</span><span class="o">.</span><span class="n">releaseAppRef</span><span class="p">()</span>
        <span class="n">windows_2d</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">w</span>
            <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">awindows</span>
            <span class="k">if</span> <span class="n">w</span><span class="o">.</span><span class="n">subtype</span><span class="p">()</span>
            <span class="ow">in</span> <span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">AXIAL_WINDOW</span><span class="p">,</span> <span class="n">w</span><span class="o">.</span><span class="n">CORONAL_WINDOW</span><span class="p">,</span> <span class="n">w</span><span class="o">.</span><span class="n">SAGITTAL_WINDOW</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">windows_3d</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">awindows</span> <span class="k">if</span> <span class="n">w</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">windows_2d</span><span class="p">]</span>
        <span class="n">a</span><span class="o">.</span><span class="n">addObjects</span><span class="p">(</span><span class="n">mesh2d</span><span class="p">,</span> <span class="n">windows_2d</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">addObjects</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">windows_3d</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.removeMesh"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.removeMesh">[docs]</a>    <span class="k">def</span> <span class="nf">removeMesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Blabla&quot;&quot;&quot;</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">)</span>
        <span class="n">mesh2d</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshes2d</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">getInternalRep</span><span class="p">()]</span>
        <span class="n">a</span><span class="o">.</span><span class="n">removeObjects</span><span class="p">([</span><span class="n">obj</span><span class="p">,</span> <span class="n">mesh2d</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">awindows</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshes2d</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">getInternalRep</span><span class="p">()]</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.disableButtons"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.disableButtons">[docs]</a>    <span class="k">def</span> <span class="nf">disableButtons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable plus or minus button depending on the selected object&#39;s display</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setColorPalette</span><span class="p">()</span>
        <span class="n">displayedObNames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">displayedObjects</span><span class="p">)):</span>
            <span class="n">displayedObNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">displayedObjects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">,</span> <span class="s2">&quot;objectslist&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()</span>
        <span class="c1"># There is always only one selected object</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">displayedObjects</span> <span class="o">==</span> <span class="p">[]</span> <span class="ow">or</span> <span class="n">item</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">,</span> <span class="s2">&quot;editAddAction&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="ow">in</span> <span class="n">displayedObNames</span><span class="p">:</span>
                <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">,</span> <span class="s2">&quot;editAddAction&quot;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">,</span> <span class="s2">&quot;editRemoveAction&quot;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">,</span> <span class="s2">&quot;editRemoveAction&quot;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">,</span> <span class="s2">&quot;editAddAction&quot;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.colorBackgroundList"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.colorBackgroundList">[docs]</a>    <span class="k">def</span> <span class="nf">colorBackgroundList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Color the background of displayed objects in objectlist and call</span>
<span class="sd">        changeIcon to add the right icon</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">displayedObNames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">displayedObjects</span><span class="p">)):</span>
            <span class="n">displayedObNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">displayedObjects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aobjects</span><span class="p">)):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">,</span> <span class="s2">&quot;objectslist&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="ow">in</span> <span class="n">displayedObNames</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">changeIcon</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;check&quot;</span><span class="p">)</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">,</span> <span class="s2">&quot;objectslist&quot;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">item</span><span class="o">.</span><span class="n">setBackground</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="s2">&quot;#7fc97f&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">changeIcon</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">,</span> <span class="s2">&quot;objectslist&quot;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">item</span><span class="o">.</span><span class="n">setBackground</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="s2">&quot;transparent&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.changeIcon"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.changeIcon">[docs]</a>    <span class="k">def</span> <span class="nf">changeIcon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds empty icon if object is not displayed and check icon if displayed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">objectlist</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">,</span> <span class="s2">&quot;objectslist&quot;</span>
        <span class="p">)</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">objectlist</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="c1"># remove item from objectlist</span>
        <span class="n">objectlist</span><span class="o">.</span><span class="n">takeItem</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="n">object_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aobjects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
        <span class="c1"># Add blank icon as spaceItem</span>
        <span class="n">sources_images_dir</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span><span class="o">.</span><span class="n">getSourceImageDir</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">icon</span> <span class="o">==</span> <span class="s2">&quot;check&quot;</span><span class="p">:</span>
            <span class="n">icon</span> <span class="o">=</span> <span class="n">QIcon</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sources_images_dir</span><span class="p">,</span> <span class="s2">&quot;check.png&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">icon</span> <span class="o">=</span> <span class="n">QIcon</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sources_images_dir</span><span class="p">,</span> <span class="s2">&quot;BLANK_ICON.png&quot;</span><span class="p">))</span>
        <span class="n">new_item</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QListWidgetItem</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span> <span class="n">object_name</span><span class="p">)</span>
        <span class="c1"># reinsert new item with blank icon</span>
        <span class="n">objectlist</span><span class="o">.</span><span class="n">insertItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">new_item</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.addObject"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.addObject">[docs]</a>    <span class="k">def</span> <span class="nf">addObject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display an object in all windows</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">displayedObjects</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">displayedObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disableButtons</span><span class="p">()</span>
        <span class="n">opts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">objectType</span> <span class="o">==</span> <span class="s2">&quot;VOLUME&quot;</span><span class="p">:</span>
            <span class="c1"># volumes have a specific function since several volumes have to be</span>
            <span class="c1"># fusionned, and a volume rendering may occur</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addVolume</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">objectType</span> <span class="o">==</span> <span class="s2">&quot;SURFACE&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addMesh</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">objectType</span> <span class="o">==</span> <span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span>
            <span class="n">opts</span><span class="p">[</span><span class="s2">&quot;add_graph_nodes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">a</span><span class="o">.</span><span class="n">addObjects</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">awindows</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.removeObject"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.removeObject">[docs]</a>    <span class="k">def</span> <span class="nf">removeObject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hides an object from views</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">displayedObjects</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">displayedObjects</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disableButtons</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">objectType</span> <span class="o">==</span> <span class="s2">&quot;VOLUME&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">removeVolume</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">objectType</span> <span class="o">==</span> <span class="s2">&quot;SURFACE&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">removeMesh</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span><span class="o">.</span><span class="n">removeObjects</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">awindows</span><span class="p">,</span> <span class="n">remove_children</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.fileOpen"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.fileOpen">[docs]</a>    <span class="k">def</span> <span class="nf">fileOpen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        File browser + load object(s)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fdialog</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fdialog</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QFileDialog</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fdialog</span><span class="o">.</span><span class="n">setDirectory</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fd2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fdialog</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fdialog</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QFileDialog</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fdialog</span><span class="o">.</span><span class="n">setDirectory</span><span class="p">(</span><span class="n">fd2</span><span class="o">.</span><span class="n">directory</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fdialog</span><span class="o">.</span><span class="n">setHistory</span><span class="p">(</span><span class="n">fd2</span><span class="o">.</span><span class="n">history</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fdialog</span><span class="o">.</span><span class="n">setFileMode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fdialog</span><span class="o">.</span><span class="n">ExistingFiles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fdialog</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fdialog</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">res</span><span class="p">:</span>
            <span class="n">fnames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fdialog</span><span class="o">.</span><span class="n">selectedFiles</span><span class="p">()</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">fnames</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>
                <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadObject</span><span class="p">(</span><span class="n">files</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.selectedObjects"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.selectedObjects">[docs]</a>    <span class="k">def</span> <span class="nf">selectedObjects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        list of objects selected in the list box on the upper left panel</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">,</span> <span class="s2">&quot;objectslist&quot;</span>
        <span class="p">)</span>
        <span class="n">sobjs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">olist</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">():</span>
            <span class="n">sobjs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\0</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aobjects</span> <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">sobjs</span><span class="p">]</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.editAdd"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.editAdd">[docs]</a>    <span class="k">def</span> <span class="nf">editAdd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display selected objects&quot;&quot;&quot;</span>
        <span class="n">objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedObjects</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addObject</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colorBackgroundList</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.editRemove"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.editRemove">[docs]</a>    <span class="k">def</span> <span class="nf">editRemove</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hide selected objects&quot;&quot;&quot;</span>
        <span class="n">objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedObjects</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">removeObject</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colorBackgroundList</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.editDelete"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.editDelete">[docs]</a>    <span class="k">def</span> <span class="nf">editDelete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete selected objects&quot;&quot;&quot;</span>
        <span class="n">objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedObjects</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deleteObjects</span><span class="p">(</span><span class="n">objs</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.deleteObjects"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.deleteObjects">[docs]</a>    <span class="k">def</span> <span class="nf">deleteObjects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete the given objects&quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">removeObject</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">,</span> <span class="s2">&quot;objectslist&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">:</span>
            <span class="n">olist</span><span class="o">.</span><span class="n">takeItem</span><span class="p">(</span>
                <span class="n">olist</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="n">olist</span><span class="o">.</span><span class="n">findItems</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">MatchExactly</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aobjects</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aobjects</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">]</span>
        <span class="n">a</span><span class="o">.</span><span class="n">deleteObjects</span><span class="p">(</span><span class="n">objs</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.deleteObjectsFromFiles"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.deleteObjectsFromFiles">[docs]</a>    <span class="k">def</span> <span class="nf">deleteObjectsFromFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete the given objects given by their file names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">)</span>
        <span class="n">objs</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">getObjects</span><span class="p">()</span> <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deleteObjects</span><span class="p">(</span><span class="n">objs</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.closeAll"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.closeAll">[docs]</a>    <span class="k">def</span> <span class="nf">closeAll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">close_ana</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Exit&quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exiting Ana2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newWindow</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">)</span>
        <span class="c1"># remove windows from their parent to prevent them to be brutally</span>
        <span class="c1"># deleted by Qt.</span>
        <span class="n">w</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">awindows</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">w</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># window closed by Qt ?</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">viewgridlay</span><span class="o">.</span><span class="n">removeWidget</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">internalRep</span><span class="o">.</span><span class="n">_get</span><span class="p">())</span>
            <span class="n">w</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">del</span> <span class="n">w</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">awindows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displayedObjects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewgridlay</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volrender</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh3d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aobjects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">awidget</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">fdialog</span>

        <span class="k">if</span> <span class="n">close_ana</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">()</span>
            <span class="n">a</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.stopVolumeRendering"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.stopVolumeRendering">[docs]</a>    <span class="k">def</span> <span class="nf">stopVolumeRendering</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Disable volume rendering: show a slice instead&quot;&quot;&quot;</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">volrender</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">a</span><span class="o">.</span><span class="n">deleteObjects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">volrender</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volrender</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">wins</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">awindows</span> <span class="k">if</span> <span class="n">w</span><span class="o">.</span><span class="n">subtype</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">a</span><span class="o">.</span><span class="n">addObjects</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">wins</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_3d_type</span> <span class="o">=</span> <span class="s2">&quot;LeftSimple3DControl&quot;</span>
        <span class="n">a</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SetControl&quot;</span><span class="p">,</span> <span class="n">windows</span><span class="o">=</span><span class="n">wins</span><span class="p">,</span> <span class="n">control</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">control_3d_type</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.startVolumeRendering"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.startVolumeRendering">[docs]</a>    <span class="k">def</span> <span class="nf">startVolumeRendering</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable volume rendering in 3D views&quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fusion2d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">wins</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">awindows</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">subtype</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wins</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">vr</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">fusionObjects</span><span class="p">([</span><span class="n">obj</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;VolumeRenderingFusionMethod&quot;</span><span class="p">)</span>
        <span class="n">vr</span><span class="o">.</span><span class="n">releaseAppRef</span><span class="p">()</span>
        <span class="n">clip</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">fusionObjects</span><span class="p">([</span><span class="n">vr</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;FusionClipMethod&quot;</span><span class="p">)</span>
        <span class="n">clip</span><span class="o">.</span><span class="n">releaseAppRef</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volrender</span> <span class="o">=</span> <span class="p">[</span><span class="n">clip</span><span class="p">,</span> <span class="n">vr</span><span class="p">]</span>
        <span class="n">a</span><span class="o">.</span><span class="n">removeObjects</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">wins</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">addObjects</span><span class="p">(</span><span class="n">clip</span><span class="p">,</span> <span class="n">wins</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_3d_type</span> <span class="o">=</span> <span class="s2">&quot;VolRenderControl&quot;</span>
        <span class="n">a</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SetControl&quot;</span><span class="p">,</span> <span class="n">windows</span><span class="o">=</span><span class="n">wins</span><span class="p">,</span> <span class="n">control</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">control_3d_type</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.enableVolumeRendering"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.enableVolumeRendering">[docs]</a>    <span class="k">def</span> <span class="nf">enableVolumeRendering</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">on</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable/disable volume rendering in 3D views&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vrenabled</span> <span class="o">=</span> <span class="n">on</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vrenabled</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">startVolumeRendering</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stopVolumeRendering</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.open_anatomist_main_window"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.open_anatomist_main_window">[docs]</a>    <span class="k">def</span> <span class="nf">open_anatomist_main_window</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Blabla&quot;&quot;&quot;</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">()</span>
        <span class="n">cw</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">getControlWindow</span><span class="p">()</span>
        <span class="n">a</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;CreateControlWindow&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cw</span><span class="p">:</span>
            <span class="n">anacontrolmenu</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;anacontrolmenu&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">anacontrolmenu</span><span class="p">:</span>
                <span class="n">anacontrolmenu</span><span class="o">.</span><span class="n">add_gui_menus</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.coordsChanged"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.coordsChanged">[docs]</a>    <span class="k">def</span> <span class="nf">coordsChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;set the cursor on the position entered in the coords fields&quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">awindows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">def</span> <span class="nf">findChild</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Blabla&quot;&quot;&quot;</span>

            <span class="k">return</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">findChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="s2">&quot;coordXEdit&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">findChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="s2">&quot;coordYEdit&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">findChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="s2">&quot;coordZEdit&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
        <span class="p">]</span>
        <span class="c1"># take coords transformation into account</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">getTransformation</span><span class="p">(</span>
            <span class="n">a</span><span class="o">.</span><span class="n">mniTemplateRef</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">awindows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getReferential</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">tr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">findChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">awidget</span><span class="p">,</span> <span class="s2">&quot;coordTEdit&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">a</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;LinkedCursor&quot;</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">awindows</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">position</span><span class="o">=</span><span class="n">pos</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.dragEnterEvent"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.dragEnterEvent">[docs]</a>    <span class="k">def</span> <span class="nf">dragEnterEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Blabla&quot;&quot;&quot;</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">cpp</span><span class="o">.</span><span class="n">QAObjectDrag</span><span class="o">.</span><span class="n">canDecode</span><span class="p">(</span>
            <span class="n">event</span>
        <span class="p">)</span> <span class="ow">or</span> <span class="n">ana</span><span class="o">.</span><span class="n">cpp</span><span class="o">.</span><span class="n">QAObjectDrag</span><span class="o">.</span><span class="n">canDecodeURI</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">event</span><span class="o">.</span><span class="n">reject</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.dropEvent"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.dropEvent">[docs]</a>    <span class="k">def</span> <span class="nf">dropEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Blabla&quot;&quot;&quot;</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">)</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">cpp</span><span class="o">.</span><span class="n">set_AObjectPtr</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ana</span><span class="o">.</span><span class="n">cpp</span><span class="o">.</span><span class="n">QAObjectDrag</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">o</span><span class="p">:</span>
                <span class="n">ob</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">AObject</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ob</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aobjects</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">registerObject</span><span class="p">(</span><span class="n">ob</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addObject</span><span class="p">(</span><span class="n">ob</span><span class="p">)</span>
            <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">things</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">cpp</span><span class="o">.</span><span class="n">QAObjectDrag</span><span class="o">.</span><span class="n">decodeURI</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">things</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">things</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">objnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">fileName</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aobjects</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">obj</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">objnames</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">loadObject</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">o</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aobjects</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">fileName</span><span class="p">()</span> <span class="o">==</span> <span class="n">obj</span><span class="p">][</span>
                            <span class="mi">0</span>
                        <span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">addObject</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
                <span class="c1"># TODO: things[1]: .ana scripts</span>
                <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
                <span class="k">return</span>
        <span class="n">event</span><span class="o">.</span><span class="n">reject</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.popup_objects"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.popup_objects">[docs]</a>    <span class="k">def</span> <span class="nf">popup_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Right-click popup on objects list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedObjects</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">aims</span><span class="o">.</span><span class="n">Tree</span><span class="p">()</span>
        <span class="n">osel</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">getInternalRep</span><span class="p">()</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">sel</span><span class="p">]</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">cpp</span><span class="o">.</span><span class="n">OptionMatcher</span><span class="o">.</span><span class="n">popupMenu</span><span class="p">(</span><span class="n">osel</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s2">&quot;Object properties&quot;</span><span class="p">)</span>
        <span class="n">prop</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object_properties</span><span class="p">)</span>
        <span class="n">new_view</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s2">&quot;Open in new view&quot;</span><span class="p">)</span>
        <span class="n">new_view</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNewView</span><span class="p">(</span><span class="n">sel</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">exec_</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QCursor</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.object_properties"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.object_properties">[docs]</a>    <span class="k">def</span> <span class="nf">object_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display selected objects properties in a browser window</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">ana</span><span class="o">.</span><span class="n">Anatomist</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;browser&quot;</span><span class="p">)</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">isNull</span><span class="p">()</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">isVisible</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">browser</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">createWindow</span><span class="p">(</span><span class="s2">&quot;Browser&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">removeObjects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">Objects</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">addObjects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedObjects</span><span class="p">())</span></div>

<div class="viewcode-block" id="AnaSimpleViewer2.addNewView"><a class="viewcode-back" href="../../../../../populse_mia.user_interface.data_viewer.anatomist_2.html#populse_mia.user_interface.data_viewer.anatomist_2.anasimpleviewer2.AnaSimpleViewer2.addNewView">[docs]</a>    <span class="k">def</span> <span class="nf">addNewView</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens a popup with a view of the object</span>
<span class="sd">        Default display is axial view but can be changed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newWindow</span><span class="o">.</span><span class="n">showPopup</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span></div></div>
</pre></div>

      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="../../../../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, populse.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.2.
    </div>
  </body>
</html>