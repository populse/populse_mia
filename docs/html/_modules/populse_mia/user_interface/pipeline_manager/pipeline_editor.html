<!DOCTYPE html>

<html lang="en" data-content_root="../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>populse_mia.user_interface.pipeline_manager.pipeline_editor &#8212; populse_mia 3.0.0-dev+9d1e1aff documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=47202671" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/haiku.css?v=fce32b03" />
    <script src="../../../../_static/documentation_options.js?v=4774077a"></script>
    <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
    <script type="module">import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.12.1/dist/mermaid.esm.min.mjs";





const initStyles = () => {
    const defaultStyle = document.createElement('style');
    defaultStyle.textContent = `pre.mermaid {
    /* Same as .mermaid-container > pre */
    display: block;
    width: 100%;
}

pre.mermaid > svg {
    /* Same as .mermaid-container > pre > svg */
    height: 500px;
    width: 100%;
    max-width: 100% !important;
}`;
    document.head.appendChild(defaultStyle);

    const fullscreenStyle = document.createElement('style');
    fullscreenStyle.textContent = `.mermaid-container {
    display: flex;
    flex-direction: row;
    width: 100%;
}

.mermaid-container > pre {
    display: block;
    width: 100%;
}

.mermaid-container > pre > svg {
    height: 500px;
    width: 100%;
    max-width: 100% !important;
}

.mermaid-fullscreen-btn {
    width: 28px;
    height: 28px;
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid rgba(0, 0, 0, 0.3);
    border-radius: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    font-size: 14px;
    line-height: 1;
    padding: 0;
    color: #333;
}

.mermaid-fullscreen-btn:hover {
    opacity: 100% !important;
    background: rgba(255, 255, 255, 1);
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
    transform: scale(1.1);
}

.mermaid-fullscreen-btn.dark-theme {
    background: rgba(50, 50, 50, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: #e0e0e0;
}

.mermaid-fullscreen-btn.dark-theme:hover {
    background: rgba(60, 60, 60, 1);
    box-shadow: 0 3px 10px rgba(255, 255, 255, 0.2);
}

.mermaid-fullscreen-modal {
    display: none;
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 95vw;
    height: 100vh;
    background: rgba(255, 255, 255, 0.98);
    z-index: 9999;
    padding: 20px;
    overflow: auto;
}

.mermaid-fullscreen-modal.dark-theme {
    background: rgba(0, 0, 0, 0.98);
}

.mermaid-fullscreen-modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
}

.mermaid-container-fullscreen {
    position: relative;
    width: 95vw;
    height: 90vh;
    max-width: 95vw;
    max-height: 90vh;
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    overflow: auto;
    display: flex;
    align-items: center;
    justify-content: center;
}

.mermaid-container-fullscreen.dark-theme {
    background: #1a1a1a;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);
}

.mermaid-container-fullscreen pre.mermaid {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.mermaid-container-fullscreen .mermaid svg {
    height: 100% !important;
    width: 100% !important;
    cursor: grab;
}

.mermaid-fullscreen-close {
    position: fixed !important;
    top: 20px !important;
    right: 20px !important;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid rgba(0, 0, 0, 0.2);
    border-radius: 50%;
    cursor: pointer;
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    transition: all 0.2s;
    font-size: 24px;
    line-height: 1;
    color: #333;
}

.mermaid-fullscreen-close:hover {
    background: white;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
    transform: scale(1.1);
}

.mermaid-fullscreen-close.dark-theme {
    background: rgba(50, 50, 50, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: #e0e0e0;
}

.mermaid-fullscreen-close.dark-theme:hover {
    background: rgba(60, 60, 60, 1);
    box-shadow: 0 6px 16px rgba(255, 255, 255, 0.2);
}

.mermaid-fullscreen-modal .mermaid-fullscreen-btn {
    display: none !important;
}`;
    document.head.appendChild(fullscreenStyle);
}

// Detect if page has dark background
const isDarkTheme = () => {
    // We use a set of heuristics:
    // 1. Check for common dark mode classes or attributes
    // 2. Check computed background color brightness
    if (document.documentElement.classList.contains('dark') ||
        document.documentElement.getAttribute('data-theme') === 'dark' ||
        document.body.classList.contains('dark') ||
        document.body.getAttribute('data-theme') === 'dark') {
        // console.log("Dark theme detected via class/attribute");
        return true;
    }
    if (document.documentElement.classList.contains('light') ||
        document.documentElement.getAttribute('data-theme') === 'light' ||
        document.body.classList.contains('light') ||
        document.body.getAttribute('data-theme') === 'light') {
        // console.log("Light theme detected via class/attribute");
        return false;
    }
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        // console.log("Dark theme detected via prefers-color-scheme");
        return true;
    }
    const bgColor = window.getComputedStyle(document.body).backgroundColor;
    const match = bgColor.match(/rgb\((\d+),\s*(\d+),\s*(\d+)/);
    if (match) {
        const r = parseInt(match[1]);
        const g = parseInt(match[2]);
        const b = parseInt(match[3]);
        const brightness = (r * 299 + g * 587 + b * 114) / 1000;
        // console.log("Background color brightness:", brightness);
        return brightness < 128;
    }
    // console.log("No dark or light theme detected, defaulting to light theme");
    return false;
};

let darkTheme = isDarkTheme();
let modal = null;
let modalContent = null;
let previousScrollOffset = [window.scrollX, window.scrollY];

const runMermaid = async (rerun) => {
    console.log("Running mermaid diagrams, rerun =", rerun);
    // clear all existing mermaid charts
    let all_mermaids = document.querySelectorAll(".mermaid");

    if (rerun) {
        all_mermaids.forEach((el) => {
            if(!el.hasAttribute("data-original-code")) {
                // store original code
                // console.log(`Storing original code for first run: `, el.innerHTML);
                el.setAttribute('data-original-code', el.innerHTML);
            }
            if(el.getAttribute("data-processed") === "true") {
                // remove and restore original
                el.removeAttribute("data-processed");
                // console.log(`Restoring original code for re-run: `, el.getAttribute('data-original-code'));
                el.innerHTML = el.getAttribute('data-original-code');
            } else {
                // store original code
                // console.log(`Storing original code for re-run: `, el.innerHTML);
                el.setAttribute('data-original-code', el.innerHTML);
            }
        });
        await mermaid.run();
    }

    all_mermaids = document.querySelectorAll(".mermaid");
    const mermaids_processed = document.querySelectorAll(".mermaid[data-processed='true']");

    if ("False" === "True") {
        const mermaids_to_add_zoom = -1 === -1 ? all_mermaids.length : -1;
        if(mermaids_to_add_zoom > 0) {
            var svgs = d3.selectAll("");
            if(all_mermaids.length !== mermaids_processed.length) {
                setTimeout(() => runMermaid(false), 200);
                return;
            } else if(svgs.size() !== mermaids_to_add_zoom) {
                setTimeout(() => runMermaid(false), 200);
                return;
            } else {
                svgs.each(function() {
                    var svg = d3.select(this);
                    svg.html("<g class='wrapper'>" + svg.html() + "</g>");
                    var inner = svg.select("g");
                    var zoom = d3.zoom().on("zoom", function(event) {
                        inner.attr("transform", event.transform);
                    });
                    svg.call(zoom);
                });
            }
        }
    } else if(all_mermaids.length !== mermaids_processed.length) {
        // Wait for mermaid to process all diagrams
        setTimeout(() => runMermaid(false), 200);
        return;
    }

    // Stop here if not adding fullscreen capability
    if ("True" !== "True") return;

    if (modal !== null ) {
        // Destroy existing modal
        modal.remove();
        modal = null;
        modalContent = null;
    }

    modal = document.createElement('div');
    modal.className = 'mermaid-fullscreen-modal' + (darkTheme ? ' dark-theme' : '');
    modal.setAttribute('role', 'dialog');
    modal.setAttribute('aria-modal', 'true');
    modal.setAttribute('aria-label', 'Fullscreen diagram viewer');
    modal.innerHTML = `
        <button class="mermaid-fullscreen-close${darkTheme ? ' dark-theme' : ''}" aria-label="Close fullscreen">✕</button>
        <div class="mermaid-container-fullscreen${darkTheme ? ' dark-theme' : ''}"></div>
    `;
    document.body.appendChild(modal);

    modalContent = modal.querySelector('.mermaid-container-fullscreen');
    const closeBtn = modal.querySelector('.mermaid-fullscreen-close');

    const closeModal = () => {
        modal.classList.remove('active');
        modalContent.innerHTML = '';
        document.body.style.overflow = ''
        window.scrollTo({left: previousScrollOffset[0], top: previousScrollOffset[1], behavior: 'instant'});
    };

    closeBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
    });
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modal.classList.contains('active')) {
            closeModal();
        }
    });

    document.querySelectorAll('.mermaid').forEach((mermaidDiv) => {
        if (mermaidDiv.parentNode.classList.contains('mermaid-container') ||
            mermaidDiv.closest('.mermaid-fullscreen-modal')) {
            // Already processed, adjust button class if needed
            const existingBtn = mermaidDiv.parentNode.querySelector('.mermaid-fullscreen-btn');
            if (existingBtn) {
                existingBtn.className = 'mermaid-fullscreen-btn' + (darkTheme ? ' dark-theme' : '');
            }
            return;
        }

        const container = document.createElement('div');
        container.className = 'mermaid-container';
        mermaidDiv.parentNode.insertBefore(container, mermaidDiv);
        container.appendChild(mermaidDiv);

        const fullscreenBtn = document.createElement('button');
        fullscreenBtn.className = 'mermaid-fullscreen-btn' + (darkTheme ? ' dark-theme' : '');
        fullscreenBtn.setAttribute('aria-label', 'View diagram in fullscreen');
        fullscreenBtn.textContent = '⛶';
        fullscreenBtn.style.opacity = '50%';

        // Calculate dynamic position based on diagram's margin and padding
        const diagramStyle = window.getComputedStyle(mermaidDiv);
        const marginTop = parseFloat(diagramStyle.marginTop) || 0;
        const marginRight = parseFloat(diagramStyle.marginRight) || 0;
        const paddingTop = parseFloat(diagramStyle.paddingTop) || 0;
        const paddingRight = parseFloat(diagramStyle.paddingRight) || 0;
        fullscreenBtn.style.top = `${marginTop + paddingTop + 4}px`;
        fullscreenBtn.style.right = `${marginRight + paddingRight + 4}px`;

        fullscreenBtn.addEventListener('click', () => {
            previousScrollOffset = [window.scroll, window.scrollY];
            const clone = mermaidDiv.cloneNode(true);
            modalContent.innerHTML = '';
            modalContent.appendChild(clone);

            const svg = clone.querySelector('svg');
            if (svg) {
                svg.removeAttribute('width');
                svg.removeAttribute('height');
                svg.style.width = '100%';
                svg.style.height = 'auto';
                svg.style.maxWidth = '100%';
                svg.style.sdisplay = 'block';

                if ("False" === "True") {
                    setTimeout(() => {
                        const g = svg.querySelector('g');
                        if (g) {
                            var svgD3 = d3.select(svg);
                            svgD3.html("<g class='wrapper'>" + svgD3.html() + "</g>");
                            var inner = svgD3.select("g");
                            var zoom = d3.zoom().on("zoom", function(event) {
                                inner.attr("transform", event.transform);
                            });
                            svgD3.call(zoom);
                        }
                    }, 100);
                }
            }

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        });
        container.appendChild(fullscreenBtn);
    });
};

const load = async () => {
    initStyles();

    await runMermaid(true);

    const reRunIfThemeChanges = async () => {
        const newDarkTheme = isDarkTheme();
        if (newDarkTheme !== darkTheme) {
            darkTheme = newDarkTheme;
            console.log("Theme change detected, re-running mermaid with", darkTheme ? "dark" : "default", "theme");
            await mermaid.initialize(
                {...JSON.parse(
                    `{"startOnLoad": false}`
                ),
                ...{ darkMode: darkTheme, theme: darkTheme ? 'dark' : 'default' },
                }
            );
            await runMermaid(true);
        }
    };

    // Update theme classes when theme changes
    const themeObserver = new MutationObserver(reRunIfThemeChanges);
    themeObserver.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['class', 'style', 'data-theme']
    });
    themeObserver.observe(document.body, {
        attributes: true,
        attributeFilter: ['class', 'style', 'data-theme']
    });
};





console.log("Initializing mermaid with", darkTheme ? "dark" : "default", "theme");
mermaid.initialize(
    {...JSON.parse(
        `{"startOnLoad": false}`
    ),
    ...{ darkMode: darkTheme, theme: darkTheme ? 'dark' : 'default' },
    }
);

window.addEventListener("load", load);</script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../../../../index.html">
          <span>populse_mia 3.0.0-dev+9d1e1aff documentation</span></a></h1>
        <h2 class="heading"><span>populse_mia.user_interface.pipeline_manager.pipeline_editor</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="Top">
      
        <p>
        <a class="uplink" href="../../../../index.html">Contents</a>
        </p>

      </div>
      <div class="content" role="main">
        
        
  <h1>Source code for populse_mia.user_interface.pipeline_manager.pipeline_editor</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module that executes the actions in the pipeline manager menu and allows</span>
<span class="sd">to graphically modify a pipeline.</span>


<span class="sd">Contains:</span>

<span class="sd">    Class:</span>
<span class="sd">        - PipelineEditor</span>
<span class="sd">        - PipelineEditorTabs</span>

<span class="sd">    Function:</span>
<span class="sd">        - find_filename</span>
<span class="sd">        - get_path</span>
<span class="sd">        - save_pipeline</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">##########################################################################</span>
<span class="c1"># Populse_mia - Copyright (C) IRMaGe/CEA, 2018</span>
<span class="c1"># Distributed under the terms of the CeCILL license, as published by</span>
<span class="c1"># the CEA-CNRS-INRIA. Refer to the LICENSE file or to</span>
<span class="c1"># http://www.cecill.info/licences/Licence_CeCILL_V2.1-en.html</span>
<span class="c1"># for details.</span>
<span class="c1">##########################################################################</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>

<span class="c1"># Capsul imports</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">capsul.api</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">Node</span><span class="p">,</span>
    <span class="n">PipelineNode</span><span class="p">,</span>
    <span class="n">Process</span><span class="p">,</span>
    <span class="n">Switch</span><span class="p">,</span>
    <span class="n">get_process_instance</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">capsul.attributes.completion_engine</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProcessCompletionEngine</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">capsul.pipeline.pipeline_nodes</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProcessNode</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">capsul.pipeline.python_export</span><span class="w"> </span><span class="kn">import</span> <span class="n">save_py_pipeline</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">capsul.pipeline.xml</span><span class="w"> </span><span class="kn">import</span> <span class="n">save_xml_pipeline</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">capsul.qt_gui.widgets.pipeline_developer_view</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">NodeGWidget</span><span class="p">,</span>
    <span class="n">PipelineDeveloperView</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># PyQt5 imports</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt5</span><span class="w"> </span><span class="kn">import</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtWidgets</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt5.QtWidgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">QInputDialog</span><span class="p">,</span> <span class="n">QMessageBox</span>

<span class="c1"># soma-base imports</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">soma.utils.weak_proxy</span><span class="w"> </span><span class="kn">import</span> <span class="n">weak_proxy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">traits.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">TraitError</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">populse_mia.software_properties</span><span class="w"> </span><span class="kn">import</span> <span class="n">Config</span>

<span class="c1"># Populse_mia imports</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">populse_mia.user_interface.pipeline_manager.node_controller</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">FilterWidget</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">populse_mia.user_interface.pop_ups</span><span class="w"> </span><span class="kn">import</span> <span class="n">PopUpClosePipeline</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="PipelineEditor">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditor">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PipelineEditor</span><span class="p">(</span><span class="n">PipelineDeveloperView</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Graphical editor for creating, editing, and managing pipelines.</span>

<span class="sd">    This view provides interactive tools to build pipeline graphs, connect</span>
<span class="sd">    nodes and plugs, edit node properties, and track modifications. It also</span>
<span class="sd">    handles persistence (save/export) and undo/redo history management.</span>

<span class="sd">    .. Methods:</span>
<span class="sd">        - _del_link: Deletes a link.</span>
<span class="sd">        - _export_plug: Export a plug to a pipeline global input or output.</span>
<span class="sd">        - _release_grab_link: Method called when a link is released.</span>
<span class="sd">        - _remove_plug: Removes a plug.</span>
<span class="sd">        - add_link: Add a link between two nodes.</span>
<span class="sd">        - add_named_process: Adds a process to the pipeline.</span>
<span class="sd">        - check_modifications: Checks if the nodes of the pipeline have been</span>
<span class="sd">                               modified.</span>
<span class="sd">        - del_node: Deletes a node.</span>
<span class="sd">        - export_node_plugs: Exports all the plugs of a node.</span>
<span class="sd">        - get_current_filename: Returns the relative path the pipeline was</span>
<span class="sd">                                last saved to. Empty if never saved.</span>
<span class="sd">        - save_pipeline: Saves the pipeline.</span>
<span class="sd">        - update_history: Updates the history for undos and redos/</span>
<span class="sd">        - update_node_name: Updates a node name.</span>
<span class="sd">        - update_plug_value: Updates a plug value.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># The signal emitted when the pipeline is saved</span>
    <span class="n">pipeline_saved</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="c1"># The signal emitted when the pipeline is modified</span>
    <span class="n">pipeline_modified</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="n">PipelineDeveloperView</span><span class="p">)</span>

<div class="viewcode-block" id="PipelineEditor.__init__">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditor.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">main_window</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the PipelineEditor for visual pipeline development.</span>

<span class="sd">        Sets up the pipeline editor with project context and initializes</span>
<span class="sd">        undo/redo functionality.</span>

<span class="sd">        :param project: The current project instance containing pipeline data</span>
<span class="sd">                        and configuration.</span>
<span class="sd">        :parm main_window: The main application window instance for UI</span>
<span class="sd">                           integration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">pipeline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">allow_open_controller</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">show_sub_pipelines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">enable_edition</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">engine</span> <span class="o">=</span> <span class="n">Config</span><span class="o">.</span><span class="n">get_capsul_engine</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">set_study_config</span><span class="p">(</span><span class="n">engine</span><span class="o">.</span><span class="n">study_config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span> <span class="o">=</span> <span class="n">main_window</span>
        <span class="c1"># Initialize undo/redo stacks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">undos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">userlevel</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span><span class="o">.</span><span class="n">get_user_level</span><span class="p">()</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_del_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">link</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">from_undo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">from_redo</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete a link between two pipeline nodes.</span>

<span class="sd">        Removes a connection between a source node&#39;s output plug and a</span>
<span class="sd">        destination node&#39;s input plug, updates the pipeline state, and</span>
<span class="sd">        records the action in history.</span>

<span class="sd">        :param link: Link specification string in the format</span>
<span class="sd">                     &quot;source_node.output_plug-&gt;dest_node.input_plug&quot;.If None,</span>
<span class="sd">                     uses the current link stored in self._current_link.</span>
<span class="sd">        :param from_undo: Whether this deletion is being performed as part of</span>
<span class="sd">                          an undo operation. Affects history recording.</span>
<span class="sd">        :param from_redo: Whether this deletion is being performed as part of</span>
<span class="sd">                          a redo operation. Affects history recording.</span>

<span class="sd">        Side Effects:</span>
<span class="sd">            - Updates self._current_link to the deleted link</span>
<span class="sd">            - Modifies self._current_link_def with link component references</span>
<span class="sd">            - Calls parent class&#39;s _del_link() to perform actual deletion</span>
<span class="sd">            - Records action in history unless from undo/redo</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Use provided link or fall back to current link</span>
        <span class="n">link</span> <span class="o">=</span> <span class="n">link</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_link</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_link</span> <span class="o">=</span> <span class="n">link</span>
        <span class="c1"># Parse link into its components</span>
        <span class="p">(</span>
            <span class="n">source_node_name</span><span class="p">,</span>
            <span class="n">source_plug_name</span><span class="p">,</span>
            <span class="n">source_node</span><span class="p">,</span>
            <span class="n">source_plug</span><span class="p">,</span>
            <span class="n">dest_node_name</span><span class="p">,</span>
            <span class="n">dest_plug_name</span><span class="p">,</span>
            <span class="n">dest_node</span><span class="p">,</span>
            <span class="n">dest_plug</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">parse_link</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
        <span class="c1"># Extract destination details from the source plug&#39;s first link</span>
        <span class="p">(</span>
            <span class="n">dest_node_name</span><span class="p">,</span>
            <span class="n">_</span><span class="p">,</span>
            <span class="n">dest_node</span><span class="p">,</span>
            <span class="n">dest_plug</span><span class="p">,</span>
            <span class="n">weak_link</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">source_plug</span><span class="o">.</span><span class="n">links_to</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Determine if both plugs are active</span>
        <span class="n">active</span> <span class="o">=</span> <span class="n">source_plug</span><span class="o">.</span><span class="n">activated</span> <span class="ow">and</span> <span class="n">dest_plug</span><span class="o">.</span><span class="n">activated</span>
        <span class="c1"># Store link definition for potential restoration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_link_def</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">source_node</span><span class="p">,</span>
            <span class="n">source_plug</span><span class="p">,</span>
            <span class="n">dest_node</span><span class="p">,</span>
            <span class="n">dest_plug</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Perform the actual deletion via parent class</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_del_link</span><span class="p">()</span>
        <span class="c1"># Record action in history</span>
        <span class="n">history_maker</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;delete_link&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">source_node_name</span><span class="p">,</span> <span class="n">source_plug_name</span><span class="p">),</span>
            <span class="p">(</span><span class="n">dest_node_name</span><span class="p">,</span> <span class="n">dest_plug_name</span><span class="p">),</span>
            <span class="n">active</span><span class="p">,</span>
            <span class="n">weak_link</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="n">history_maker</span><span class="p">,</span> <span class="n">from_undo</span><span class="p">,</span> <span class="n">from_redo</span><span class="p">)</span>
        <span class="c1"># Provide user feedback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Link </span><span class="si">{</span><span class="n">link</span><span class="si">}</span><span class="s2"> has been deleted.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_export_plug</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pipeline_parameter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">optional</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">weak_link</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">from_undo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">from_redo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">temp_plug_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">multi_export</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export a plug to a pipeline global input or output.</span>

<span class="sd">        This method exports a node plug to the pipeline level, making it</span>
<span class="sd">        accessible as a pipeline parameter. It handles name conflicts, creates</span>
<span class="sd">        appropriate links, and maintains operation history for undo/redo</span>
<span class="sd">        functionality.</span>

<span class="sd">        :param pipeline_parameter (str): Name for the exported pipeline</span>
<span class="sd">                                         parameter. If None, prompts user for</span>
<span class="sd">                                         a name via dialog. Defaults to None.</span>
<span class="sd">        :param optional (bool): Whether the exported plug is optional. If</span>
<span class="sd">                                None, derived from dialog checkbox or plug</span>
<span class="sd">                                configuration. Defaults to None.</span>
<span class="sd">        :param weak_link (bool): Whether to create a weak link (doesn&#39;t</span>
<span class="sd">                                 enforce execution order). If None, derived</span>
<span class="sd">                                 from dialog or defaults to False.</span>
<span class="sd">        :param from_undo (bool): True when called during an undo operation.</span>
<span class="sd">                                 Used to prevent circular history updates.</span>
<span class="sd">                                 Defaults to False.</span>
<span class="sd">        :param from_redo (bool): True when called during a redo operation.</span>
<span class="sd">                                 Used to prevent circular history updates.</span>
<span class="sd">                                 Defaults to False.</span>
<span class="sd">        :param temp_plug_name (tuple): A (node_name, plug_name) tuple</span>
<span class="sd">                                       specifying the plug to export. If None,</span>
<span class="sd">                                       uses self._temp_plug_name. Defaults to</span>
<span class="sd">                                       None.</span>
<span class="sd">        :param multi_export (bool): True when exporting multiple plugs</span>
<span class="sd">                                    simultaneously. Changes return behavior</span>
<span class="sd">                                    and error handling. Defaults to False.</span>

<span class="sd">        :return (str): When multi_export is True, returns the plug name on</span>
<span class="sd">                       success or None on failure. When multi_export is False,</span>
<span class="sd">                       returns None after updating the UI and history.</span>

<span class="sd">        :raises TraitError: Logged as warning when plug export fails due to</span>
<span class="sd">                            trait issues.</span>
<span class="sd">        :raises ValueError: Logged as warning when export fails due to invalid</span>
<span class="sd">                            values.</span>

<span class="sd">        Side Effects:</span>
<span class="sd">            - May display dialog boxes for user input</span>
<span class="sd">            - Updates pipeline structure and UI</span>
<span class="sd">            - Adds entry to operation history (unless from_undo/from_redo)</span>
<span class="sd">            - Shows status message in main window</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">temp_plug_name</span> <span class="o">=</span> <span class="n">temp_plug_name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_temp_plug_name</span>

        <span class="c1"># Get plug name from user dialog or use provided parameter</span>
        <span class="k">if</span> <span class="n">pipeline_parameter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dialog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PlugEdit</span><span class="p">()</span>
            <span class="n">dialog</span><span class="o">.</span><span class="n">name_line</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">temp_plug_name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">dialog</span><span class="o">.</span><span class="n">optional</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_temp_plug</span><span class="o">.</span><span class="n">optional</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">dialog</span><span class="o">.</span><span class="n">exec_</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="n">plug_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dialog</span><span class="o">.</span><span class="n">name_line</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">optional</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">optional</span>
                <span class="k">if</span> <span class="n">optional</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="n">dialog</span><span class="o">.</span><span class="n">optional</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">weak_link</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">weak_link</span> <span class="k">if</span> <span class="n">weak_link</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">dialog</span><span class="o">.</span><span class="n">weak</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">plug_name</span> <span class="o">=</span> <span class="n">pipeline_parameter</span>
            <span class="n">weak_link</span> <span class="o">=</span> <span class="n">weak_link</span> <span class="k">if</span> <span class="n">weak_link</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">False</span>

        <span class="c1"># Handle name conflicts interactively</span>
        <span class="n">allow_existing_plug</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">existing_plugs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">pipeline_node</span><span class="o">.</span><span class="n">plugs</span>

            <span class="k">if</span> <span class="n">plug_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">existing_plugs</span><span class="p">:</span>
                <span class="k">break</span>  <span class="c1"># Unique plug name → done</span>

            <span class="c1"># Ask user if they want to connect to the existing plug</span>
            <span class="n">msg_box</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
            <span class="n">msg_box</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
            <span class="n">msg_box</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span>
                <span class="s2">&quot;populse_mia - Warning: Duplicate pipeline plug&quot;</span>
            <span class="p">)</span>
            <span class="n">msg_box</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The &#39;</span><span class="si">{</span><span class="n">plug_name</span><span class="si">}</span><span class="s2">&#39; pipeline plug already exists.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Do you want to connect to this existing plug?&quot;</span>
            <span class="p">)</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="n">msg_box</span><span class="o">.</span><span class="n">question</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="n">msg_box</span><span class="o">.</span><span class="n">windowTitle</span><span class="p">(),</span>
                <span class="n">msg_box</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
                <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span> <span class="o">|</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">reply</span> <span class="o">==</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">reply</span> <span class="o">==</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
                <span class="n">allow_existing_plug</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>

            <span class="c1"># Otherwise (No), ask for a new name</span>
            <span class="n">new_name</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QInputDialog</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="s2">&quot;Plug name Input Dialog&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;The plug &#39;</span><span class="si">{</span><span class="n">plug_name</span><span class="si">}</span><span class="s2">&#39; already exists.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Please choose a new name:&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">new_name</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="n">plug_name</span> <span class="o">=</span> <span class="n">new_name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c1"># Attempt the export</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">export_parameter</span><span class="p">(</span>
                <span class="n">temp_plug_name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">temp_plug_name</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">plug_name</span><span class="p">,</span>
                <span class="n">weak_link</span><span class="o">=</span><span class="n">weak_link</span><span class="p">,</span>
                <span class="n">is_optional</span><span class="o">=</span><span class="n">optional</span><span class="p">,</span>
                <span class="n">allow_existing_plug</span><span class="o">=</span><span class="n">allow_existing_plug</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="n">TraitError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Cannot export </span><span class="si">{</span><span class="n">temp_plug_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">plug_name</span><span class="si">}</span><span class="s2"> plug.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># If multiple exports, only return plug name</span>
        <span class="k">if</span> <span class="n">multi_export</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">temp_plug_name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Update UI and history</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">update_pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;export_plugs&quot;</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">,</span> <span class="n">temp_plug_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
            <span class="n">from_undo</span><span class="p">,</span>
            <span class="n">from_redo</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Plug </span><span class="si">{</span><span class="n">plug_name</span><span class="si">}</span><span class="s2"> has been exported.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_release_grab_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle link release event and update pipeline history.</span>

<span class="sd">        Called when a user releases a link in the pipeline editor. This method</span>
<span class="sd">        extends the parent class behavior by recording the link addition in</span>
<span class="sd">        the history and displaying a status message.</span>

<span class="sd">        :param event: Mouse event corresponding to the link release.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Is this method still used?</span>

        <span class="c1"># Retrieve the created link from parent implementation</span>
        <span class="n">link</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_release_grab_link</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">ret</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Record link creation in history for undo/redo functionality</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span>
            <span class="n">history_maker</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;add_link&quot;</span><span class="p">,</span> <span class="n">link</span><span class="p">],</span> <span class="n">from_undo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">from_redo</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="c1"># Provide user feedback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Link </span><span class="si">{</span><span class="n">link</span><span class="si">}</span><span class="s2"> has been added.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_remove_plug</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">plug_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">from_undo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">from_redo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">from_export_plugs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove one or more plugs from the pipeline.</span>

<span class="sd">        This method removes plugs from the pipeline, tracks their connections</span>
<span class="sd">        for potential undo/redo operations, and updates the application</span>
<span class="sd">        history unless called from an export operation.</span>

<span class="sd">        :param plug_names: A tuple (node_name, plug_name) or list of such</span>
<span class="sd">                           tuples specifying the plug(s) to remove. If None,</span>
<span class="sd">                           uses self._temp_plug_name.</span>
<span class="sd">        :param from_undo: Whether this method is being called from an undo</span>
<span class="sd">                          operation.</span>
<span class="sd">        :param from_redo: Whether this method is being called from a redo</span>
<span class="sd">                          operation.</span>
<span class="sd">        :param from_export_plugs: Whether this method is being called from an</span>
<span class="sd">                                  export plugs undo/redo operation. When True,</span>
<span class="sd">                                  history is not updated.</span>

<span class="sd">        :note: For each removed plug, stores [plug_info, connected_plugs,</span>
<span class="sd">               optional_flag] in the history for potential restoration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Use provided plug names or fall back to instance variable</span>
        <span class="n">plug_names</span> <span class="o">=</span> <span class="n">plug_names</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_temp_plug_name</span>

        <span class="c1"># Normalize to list format for uniform processing</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plug_names</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">plug_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">plug_names</span><span class="p">]</span>

        <span class="n">removed_plugs_info</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">plug_name</span> <span class="ow">in</span> <span class="n">plug_names</span><span class="p">:</span>

            <span class="c1"># Only process pipeline input/output plugs</span>
            <span class="k">if</span> <span class="n">node_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;outputs&quot;</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">plug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">pipeline_node</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="n">plug_name</span><span class="p">]</span>
            <span class="c1"># Collect all connected plugs for history tracking</span>
            <span class="n">connected_plugs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">link</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="p">(</span><span class="o">*</span><span class="n">plug</span><span class="o">.</span><span class="n">links_to</span><span class="p">,</span> <span class="o">*</span><span class="n">plug</span><span class="o">.</span><span class="n">links_from</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="c1"># Fix potential &quot;_items&quot; bug by disabling has_items attribute</span>
            <span class="n">pipeline_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>
            <span class="n">source_trait</span> <span class="o">=</span> <span class="n">pipeline_node</span><span class="o">.</span><span class="n">get_trait</span><span class="p">(</span><span class="n">plug_name</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">source_trait</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">has_items</span><span class="p">:</span>
                <span class="n">source_trait</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">has_items</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># Remove the plug and update pipeline</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">remove_trait</span><span class="p">(</span><span class="n">plug_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">update_pipeline</span><span class="p">()</span>

            <span class="c1"># Store removal information for history</span>
            <span class="n">removed_plugs_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">[(</span><span class="n">node_name</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">),</span> <span class="n">connected_plugs</span><span class="p">,</span> <span class="n">plug</span><span class="o">.</span><span class="n">optional</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="c1"># Update history and status bar (unless called from export</span>
            <span class="c1"># operation)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">from_export_plugs</span> <span class="ow">and</span> <span class="n">removed_plugs_info</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span>
                    <span class="p">[</span><span class="s2">&quot;remove_plug&quot;</span><span class="p">,</span> <span class="n">removed_plugs_info</span><span class="p">],</span> <span class="n">from_undo</span><span class="p">,</span> <span class="n">from_redo</span>
                <span class="p">)</span>

                <span class="c1"># Display appropriate status message</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">removed_plugs_info</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">plug_name</span> <span class="o">=</span> <span class="n">removed_plugs_info</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">plug_name</span><span class="si">}</span><span class="s2">&#39; plug has been removed.&quot;</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plug_names_str</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                        <span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">removed_plugs_info</span>
                    <span class="p">)</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">plug_names_str</span><span class="si">}</span><span class="s2"> plugs have been removed.&quot;</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

<div class="viewcode-block" id="PipelineEditor.add_link">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditor.add_link">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_link</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">source</span><span class="p">,</span>
        <span class="n">dest</span><span class="p">,</span>
        <span class="n">active</span><span class="p">,</span>
        <span class="n">weak</span><span class="p">,</span>
        <span class="n">from_undo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">from_redo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">allow_export</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a link between two nodes in the pipeline.</span>

<span class="sd">        Creates a connection between a source node&#39;s output plug and a</span>
<span class="sd">        destination node&#39;s input plug. The link is represented as</span>
<span class="sd">        &quot;node.plug-&gt;node.plug&quot; format and added to the pipeline scene.</span>

<span class="sd">        :param source: A tuple of (node_name, plug_name) for the source</span>
<span class="sd">                       connection.</span>
<span class="sd">        :param dest: A tuple of (node_name, plug_name) for the destination</span>
<span class="sd">                     connection.</span>
<span class="sd">        :param active: Whether the link is currently active/enabled.</span>
<span class="sd">        :param weak: Whether the link is a weak reference that doesn&#39;t enforce</span>
<span class="sd">                     strict execution dependencies.</span>
<span class="sd">        :param from_undo: Whether this action originates from an undo</span>
<span class="sd">                          operation. Defaults to False.</span>
<span class="sd">        :param from_redo: Whether this action originates from a redo</span>
<span class="sd">                          operation. Defaults to False.</span>
<span class="sd">        :param allow_export: Whether to allow this link in exported pipelines.</span>
<span class="sd">                             Defaults to False.</span>

<span class="sd">        Side Effects:</span>
<span class="sd">            - Adds the link to the pipeline scene</span>
<span class="sd">            - Updates the pipeline visualization</span>
<span class="sd">            - Records the action in history (unless from undo/redo)</span>
<span class="sd">            - Displays a status message in the main window</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create link representation in &quot;node.plug-&gt;node.plug&quot; format</span>
        <span class="n">link</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">source</span><span class="p">)</span><span class="si">}</span><span class="s2">-&gt;</span><span class="si">{</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="c1"># Add link to pipeline and refresh visualization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">allow_export</span><span class="o">=</span><span class="n">allow_export</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">update_pipeline</span><span class="p">()</span>
        <span class="c1"># Record action in history for undo/redo functionality</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">([</span><span class="s2">&quot;add_link&quot;</span><span class="p">,</span> <span class="n">link</span><span class="p">],</span> <span class="n">from_undo</span><span class="p">,</span> <span class="n">from_redo</span><span class="p">)</span>
        <span class="c1"># Provide user feedback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Link </span><span class="si">{</span><span class="n">link</span><span class="si">}</span><span class="s2"> has been added.&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="PipelineEditor.add_named_process">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditor.add_named_process">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_named_process</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">class_process</span><span class="p">,</span>
        <span class="n">node_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">from_undo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">from_redo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">links</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a process to the pipeline with optional link restoration.</span>

<span class="sd">        This method adds a named process to the pipeline and configures it</span>
<span class="sd">        according to project settings. It also handles link restoration when</span>
<span class="sd">        the action is part of an undo/redo operation.</span>

<span class="sd">        :param class_process (str): The name of the process class to</span>
<span class="sd">                                    instantiate.</span>
<span class="sd">        :param node_name (str): Custom name for the node. If None, the name is</span>
<span class="sd">                                derived from the process&#39;s context_name or</span>
<span class="sd">                                name attribute. Defaults to None.</span>
<span class="sd">        :param from_undo (bool): Whether this action is part of an undo</span>
<span class="sd">                                 operation. Defaults to False.</span>
<span class="sd">        :param from_redo (bool): Whether this action is part of a redo</span>
<span class="sd">                                 operation. Defaults to False.</span>
<span class="sd">        :param links (list): List of link tuples to restore, where each tuple</span>
<span class="sd">                             contains (source, dest, active, weak). Used</span>
<span class="sd">                             during undo/redo operations. Defaults to None.</span>

<span class="sd">        Side Effects:</span>
<span class="sd">            - Adds process to the pipeline</span>
<span class="sd">            - Configures project settings if applicable</span>
<span class="sd">            - Restores links if provided</span>
<span class="sd">            - Updates history for undo/redo</span>
<span class="sd">            - Updates UI status bar and buttons</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">links</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Add the process via parent class</span>
        <span class="n">process</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add_named_process</span><span class="p">(</span><span class="n">class_process</span><span class="p">,</span> <span class="n">node_name</span><span class="p">)</span>

        <span class="c1"># Determine node name from process if not provided</span>
        <span class="k">if</span> <span class="n">node_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">context_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="s2">&quot;context_name&quot;</span><span class="p">,</span> <span class="n">process</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">node_name</span> <span class="o">=</span> <span class="n">context_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Configure project if process requires it</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="s2">&quot;use_project&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">process</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span>

        <span class="c1"># Set SPM script file user level for process and nested process</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="s2">&quot;_spm_script_file&quot;</span><span class="p">):</span>
            <span class="n">process</span><span class="o">.</span><span class="n">trait</span><span class="p">(</span><span class="s2">&quot;_spm_script_file&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">userlevel</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="s2">&quot;process&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span>
            <span class="n">process</span><span class="o">.</span><span class="n">process</span><span class="p">,</span> <span class="s2">&quot;_spm_script_file&quot;</span>
        <span class="p">):</span>
            <span class="n">process</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">trait</span><span class="p">(</span><span class="s2">&quot;_spm_script_file&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">userlevel</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Restore links if this is part of an undo operation</span>
        <span class="k">for</span> <span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">active</span><span class="p">,</span> <span class="n">weak</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
            <span class="c1"># Add link to scene</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">active</span><span class="p">,</span> <span class="n">weak</span><span class="p">)</span>
            <span class="c1"># Create string representation of link</span>
            <span class="n">link_string</span> <span class="o">=</span> <span class="s2">&quot;-&gt;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">source</span><span class="p">),</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest</span><span class="p">)])</span>
            <span class="c1"># Add link to pipeline</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">link_string</span><span class="p">)</span>

        <span class="c1"># Update pipeline once after all links are restored</span>
        <span class="k">if</span> <span class="n">links</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">update_pipeline</span><span class="p">()</span>

        <span class="c1"># Update history for undo/redo functionality</span>
        <span class="n">history_maker</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;add_process&quot;</span><span class="p">,</span> <span class="n">node_name</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">from_undo</span><span class="p">:</span>
            <span class="n">history_maker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">class_process</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="n">history_maker</span><span class="p">,</span> <span class="n">from_undo</span><span class="p">,</span> <span class="n">from_redo</span><span class="p">)</span>
        <span class="c1"># Update UI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Node </span><span class="si">{</span><span class="n">node_name</span><span class="si">}</span><span class="s2"> has been added.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">update_user_buttons_states</span><span class="p">()</span></div>


<div class="viewcode-block" id="PipelineEditor.check_modifications">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditor.check_modifications">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_modifications</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check and update pipeline nodes that have been modified.</span>

<span class="sd">        This method iterates through all pipeline nodes and detects if the</span>
<span class="sd">        underlying process definition has changed (added/removed</span>
<span class="sd">        inputs/outputs).</span>

<span class="sd">        When changes are detected, it:</span>
<span class="sd">            - Recreates the node with the updated process definition</span>
<span class="sd">            - Preserves the node&#39;s position in the scene</span>
<span class="sd">            - Attempts to restore compatible links</span>
<span class="sd">            - Removes incompatible links and notifies the user</span>

<span class="sd">        Side Effects:</span>
<span class="sd">            Modifies self.scene.gnodes, self.scene.glinks, and pipeline.nodes.</span>
<span class="sd">            Displays a warning dialog if any links are removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Import verCmp only here to prevent circular import issue</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">populse_mia.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">verCmp</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="c1"># List to store the removed links</span>
        <span class="n">removed_links</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Load process configuration once for all nodes</span>
        <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span> <span class="s2">&quot;properties&quot;</span><span class="p">,</span> <span class="s2">&quot;process_config.yml&quot;</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verCmp</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span> <span class="s2">&quot;5.1&quot;</span><span class="p">,</span> <span class="s2">&quot;sup&quot;</span><span class="p">):</span>
                    <span class="n">process_config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">process_config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load process config: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">process_config</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="c1"># Skip if the node is a pipeline node</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">node_name</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">PipelineNode</span><span class="p">)):</span>
                <span class="k">continue</span>

            <span class="n">sub_pipeline_process</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">process</span>
            <span class="n">sub_pipeline_name</span> <span class="o">=</span> <span class="n">sub_pipeline_process</span><span class="o">.</span><span class="n">name</span>
            <span class="c1"># Finding from where comes from the pipeline</span>
            <span class="n">package</span> <span class="o">=</span> <span class="n">sub_pipeline_process</span><span class="o">.</span><span class="vm">__module__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Determine search paths based on package</span>
            <span class="k">if</span> <span class="n">package</span> <span class="o">==</span> <span class="s2">&quot;mia_processes&quot;</span><span class="p">:</span>
                <span class="n">paths_list</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;mia_processes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">__path__</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">paths_list</span> <span class="o">=</span> <span class="n">process_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Paths&quot;</span><span class="p">,</span> <span class="p">[])</span>

            <span class="c1"># Locate and load the saved process</span>
            <span class="c1"># get_path returns a list that is the package path</span>
            <span class="c1"># to the sub_pipeline file</span>
            <span class="n">sub_pipeline_list</span> <span class="o">=</span> <span class="n">get_path</span><span class="p">(</span>
                <span class="n">sub_pipeline_name</span><span class="p">,</span>
                <span class="n">process_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Packages&quot;</span><span class="p">,</span> <span class="p">{}),</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="n">package</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">sub_pipeline_name</span> <span class="o">=</span> <span class="n">sub_pipeline_list</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="c1"># Finding the real sub-pipeline filename</span>
            <span class="n">sub_pipeline_filename</span> <span class="o">=</span> <span class="n">find_filename</span><span class="p">(</span>
                <span class="n">paths_list</span><span class="p">,</span> <span class="n">sub_pipeline_list</span><span class="p">,</span> <span class="n">sub_pipeline_name</span>
            <span class="p">)</span>
            <span class="n">saved_process</span> <span class="o">=</span> <span class="n">get_process_instance</span><span class="p">(</span><span class="n">sub_pipeline_filename</span><span class="p">)</span>
            <span class="c1"># Compare process signatures using set operations</span>
            <span class="n">current_inputs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">sub_pipeline_process</span><span class="o">.</span><span class="n">get_inputs</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">current_outputs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">sub_pipeline_process</span><span class="o">.</span><span class="n">get_outputs</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">saved_inputs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">saved_process</span><span class="o">.</span><span class="n">get_inputs</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">saved_outputs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">saved_process</span><span class="o">.</span><span class="n">get_outputs</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">new_inputs</span> <span class="o">=</span> <span class="n">saved_inputs</span> <span class="o">-</span> <span class="n">current_inputs</span>
            <span class="n">new_outputs</span> <span class="o">=</span> <span class="n">saved_outputs</span> <span class="o">-</span> <span class="n">current_outputs</span>
            <span class="n">removed_inputs</span> <span class="o">=</span> <span class="n">current_inputs</span> <span class="o">-</span> <span class="n">saved_inputs</span>
            <span class="n">removed_outputs</span> <span class="o">=</span> <span class="n">current_outputs</span> <span class="o">-</span> <span class="n">saved_outputs</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
                <span class="n">new_inputs</span> <span class="ow">or</span> <span class="n">new_outputs</span> <span class="ow">or</span> <span class="n">removed_inputs</span> <span class="ow">or</span> <span class="n">removed_outputs</span>
            <span class="p">):</span>
                <span class="k">continue</span>

            <span class="c1"># Remove all links connected to this node</span>
            <span class="n">links_to_restore</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">glink</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">link</span><span class="p">,</span> <span class="n">glink</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">glinks</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">link</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">node_name</span> <span class="ow">or</span> <span class="n">link</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">node_name</span>
            <span class="p">]</span>

            <span class="k">for</span> <span class="n">link</span><span class="p">,</span> <span class="n">glink</span> <span class="ow">in</span> <span class="n">links_to_restore</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="n">glink</span><span class="p">)</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">glinks</span><span class="p">[</span><span class="n">link</span><span class="p">]</span>

            <span class="c1"># Create and configure new node</span>
            <span class="n">new_node</span> <span class="o">=</span> <span class="n">saved_process</span><span class="o">.</span><span class="n">pipeline_node</span>
            <span class="n">new_node</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">node_name</span>
            <span class="n">new_node</span><span class="o">.</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline</span>
            <span class="n">saved_process</span><span class="o">.</span><span class="n">parent_pipeline</span> <span class="o">=</span> <span class="n">weak_proxy</span><span class="p">(</span><span class="n">pipeline</span><span class="p">)</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_node</span>
            <span class="c1"># Create new graphical node and preserve position</span>
            <span class="n">gnode</span> <span class="o">=</span> <span class="n">NodeGWidget</span><span class="p">(</span>
                <span class="n">node_name</span><span class="p">,</span>
                <span class="n">new_node</span><span class="o">.</span><span class="n">plugs</span><span class="p">,</span>
                <span class="n">pipeline</span><span class="p">,</span>
                <span class="n">sub_pipeline</span><span class="o">=</span><span class="n">saved_process</span><span class="p">,</span>
                <span class="n">process</span><span class="o">=</span><span class="n">saved_process</span><span class="p">,</span>
                <span class="n">colored_parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">colored_parameters</span><span class="p">,</span>
                <span class="n">logical_view</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">logical_view</span><span class="p">,</span>
                <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">gnode</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node_name</span><span class="p">))</span>
            <span class="c1"># Replace old node with new one</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">gnodes</span><span class="p">[</span><span class="n">node_name</span><span class="p">])</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">gnodes</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">gnodes</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">gnode</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">gnode</span><span class="p">)</span>

            <span class="c1"># Attempt to restore compatible links</span>
            <span class="k">for</span> <span class="n">link</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">links_to_restore</span><span class="p">:</span>
                <span class="n">source</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="n">link</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">link</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                <span class="c1"># Normalize special nodes (inputs/outputs)</span>
                <span class="k">if</span> <span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;inputs&quot;</span><span class="p">:</span>
                    <span class="n">source</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">dest</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;outputs&quot;</span><span class="p">:</span>
                    <span class="n">dest</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                <span class="c1"># Create link representation</span>
                <span class="n">pipeline_link</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">source</span><span class="p">)</span><span class="si">}</span><span class="s2">-&gt;</span><span class="si">{</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

                <span class="c1"># Skip if connected plug was removed</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">dest</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">node_name</span> <span class="ow">and</span> <span class="n">dest</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">removed_inputs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                    <span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">node_name</span> <span class="ow">and</span> <span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">removed_outputs</span>
                <span class="p">):</span>
                    <span class="n">removed_links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pipeline_link</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="c1"># Restore valid link</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">pipeline_link</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">weak</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">update_pipeline</span><span class="p">()</span>

        <span class="c1"># Notify user if any links were removed</span>
        <span class="k">if</span> <span class="n">removed_links</span><span class="p">:</span>
            <span class="n">dialog_text</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Pipeline </span><span class="si">{</span><span class="n">node_name</span><span class="si">}</span><span class="s2"> has been updated.</span><span class="se">\n</span><span class="s2">Removed links:&quot;</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">removed_link</span> <span class="ow">in</span> <span class="n">removed_links</span><span class="p">:</span>
                <span class="n">dialog_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">removed_link</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">pop_up</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="p">()</span>
            <span class="n">pop_up</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
            <span class="n">pop_up</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">dialog_text</span><span class="p">)</span>
            <span class="n">pop_up</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Warning: Links Removed During Update&quot;</span><span class="p">)</span>
            <span class="n">pop_up</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
            <span class="n">pop_up</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>


<div class="viewcode-block" id="PipelineEditor.del_node">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditor.del_node">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">del_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">from_undo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">from_redo</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes a node from the pipeline and updates the GUI and history</span>
<span class="sd">        accordingly.</span>

<span class="sd">        :param node_name (str): The name of the node to delete. If not</span>
<span class="sd">                                provided, the currently selected node is used.</span>
<span class="sd">        :param from_undo (bool): True if the deletion was triggered by an undo</span>
<span class="sd">                                 operation.</span>
<span class="sd">        :param from_redo (bool): True if the deletion was triggered by a redo</span>
<span class="sd">                                 operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span>
        <span class="n">node_name</span> <span class="o">=</span> <span class="n">node_name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_node_name</span>
        <span class="c1"># Determine the node and whether to invert input/output logic</span>
        <span class="n">invert_io</span> <span class="o">=</span> <span class="n">node_name</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;outputs&quot;</span><span class="p">)</span>
        <span class="n">node</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">pipeline_node</span> <span class="k">if</span> <span class="n">invert_io</span> <span class="k">else</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="c1"># Collect all links related to this node</span>
        <span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">plug_name</span><span class="p">,</span> <span class="n">plug</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">connected_links</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">plug</span><span class="o">.</span><span class="n">links_to</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">plug</span><span class="o">.</span><span class="n">output</span> <span class="ow">or</span> <span class="p">(</span><span class="n">invert_io</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">plug</span><span class="o">.</span><span class="n">output</span><span class="p">))</span>
                <span class="k">else</span> <span class="n">plug</span><span class="o">.</span><span class="n">links_from</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">connected_links</span><span class="p">:</span>
                <span class="p">(</span>
                    <span class="n">linked_node_name</span><span class="p">,</span>
                    <span class="n">_</span><span class="p">,</span>
                    <span class="n">linked_node</span><span class="p">,</span>
                    <span class="n">linked_plug</span><span class="p">,</span>
                    <span class="n">weak_link</span><span class="p">,</span>
                <span class="p">)</span> <span class="o">=</span> <span class="n">link</span>
                <span class="n">active</span> <span class="o">=</span> <span class="n">plug</span><span class="o">.</span><span class="n">activated</span>
                <span class="c1"># Find the plug name in the linked node</span>
                <span class="n">linked_plug_name</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">n</span>
                        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">linked_node</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">linked_plug</span>
                    <span class="p">),</span>
                    <span class="kc">None</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Build the link structure:</span>
                <span class="c1"># [</span>
                <span class="c1">#     (src_node, src_plug),</span>
                <span class="c1">#     (dst_node, dst_plug),</span>
                <span class="c1">#     active,</span>
                <span class="c1">#     weak_link</span>
                <span class="c1"># ]</span>
                <span class="k">if</span> <span class="n">plug</span><span class="o">.</span><span class="n">output</span> <span class="ow">or</span> <span class="p">(</span><span class="n">invert_io</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">plug</span><span class="o">.</span><span class="n">output</span><span class="p">):</span>
                    <span class="n">link_to_add</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="p">(</span><span class="n">node_name</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">),</span>
                        <span class="p">(</span><span class="n">linked_node_name</span><span class="p">,</span> <span class="n">linked_plug_name</span><span class="p">),</span>
                        <span class="n">active</span><span class="p">,</span>
                        <span class="n">weak_link</span><span class="p">,</span>
                    <span class="p">]</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">link_to_add</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="p">(</span><span class="n">linked_node_name</span><span class="p">,</span> <span class="n">linked_plug_name</span><span class="p">),</span>
                        <span class="p">(</span><span class="n">node_name</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">),</span>
                        <span class="n">active</span><span class="p">,</span>
                        <span class="n">weak_link</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link_to_add</span><span class="p">)</span>

        <span class="c1"># Call parent method to perform the actual deletion</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">del_node</span><span class="p">(</span><span class="n">node_name</span><span class="p">)</span>
        <span class="c1"># Update history and GUI</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">process</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ProcessNode</span><span class="p">)</span> <span class="k">else</span> <span class="n">node</span>
        <span class="n">history_entry</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;delete_process&quot;</span><span class="p">,</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="n">links</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="n">history_entry</span><span class="p">,</span> <span class="n">from_undo</span><span class="p">,</span> <span class="n">from_redo</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Node </span><span class="si">{</span><span class="n">node_name</span><span class="si">}</span><span class="s2"> has been deleted.&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Refresh parameter display for all remaining nodes</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">process</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">process</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ProcessNode</span><span class="p">)</span> <span class="k">else</span> <span class="n">node</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">displayNodeParameters</span><span class="p">(</span>
                    <span class="n">name</span><span class="p">,</span> <span class="n">process</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">update_user_buttons_states</span><span class="p">()</span></div>


<div class="viewcode-block" id="PipelineEditor.export_node_plugs">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditor.export_node_plugs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">export_node_plugs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">node_name</span><span class="p">,</span>
        <span class="n">inputs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">outputs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">from_undo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">from_redo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export plugs (parameters) from a pipeline node to make them available</span>
<span class="sd">        externally.</span>

<span class="sd">        This method identifies and exports node plugs that meet the specified</span>
<span class="sd">        criteria (input/output type, optional status, unlinked status) and are</span>
<span class="sd">        not in the pipeline&#39;s exclusion list.</span>

<span class="sd">        :param node_name: Name of the node whose plugs should be exported.</span>
<span class="sd">        :param inputs: Whether to export input plugs. Defaults to True.</span>
<span class="sd">        :param outputs: Whether to export output plugs. Defaults to True.</span>
<span class="sd">        :param optional: Whether to include optional plugs in the export.</span>
<span class="sd">                         Defaults to False.</span>
<span class="sd">        :param from_undo: Whether this call originates from an undo operation.</span>
<span class="sd">                          Defaults to False.</span>
<span class="sd">        :param from_redo: Whether this call originates from a redo operation.</span>
<span class="sd">                          Defaults to False.</span>

<span class="sd">        :note:</span>
<span class="sd">            - Only unlinked plugs are exported (outputs without links_to,</span>
<span class="sd">              inputs without links_from)</span>
<span class="sd">            - Certain system plugs are automatically excluded</span>
<span class="sd">              (nodes_activation, selection_changed, etc.)</span>
<span class="sd">            - The operation is recorded in the history for undo/redo support</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># System plugs that should never be exported</span>
        <span class="n">EXCLUDED_PLUGS</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;nodes_activation&quot;</span><span class="p">,</span>
                <span class="s2">&quot;selection_changed&quot;</span><span class="p">,</span>
                <span class="s2">&quot;output_directory&quot;</span><span class="p">,</span>
                <span class="s2">&quot;use_mcr&quot;</span><span class="p">,</span>
                <span class="s2">&quot;paths&quot;</span><span class="p">,</span>
                <span class="s2">&quot;matlab_cmd&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mfile&quot;</span><span class="p">,</span>
                <span class="s2">&quot;spm_script_file&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span>
        <span class="c1"># Collect exportable plugs</span>
        <span class="n">exported_plugs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">plug</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="c1"># Skip system plugs</span>
            <span class="k">if</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="n">EXCLUDED_PLUGS</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Skip plugs in the do-not-export list</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">node_name</span><span class="p">,</span> <span class="n">param_name</span><span class="p">)</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">do_not_export</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Check if plug meets export criteria</span>
            <span class="n">is_unlinked_output</span> <span class="o">=</span> <span class="n">outputs</span> <span class="ow">and</span> <span class="n">plug</span><span class="o">.</span><span class="n">output</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">plug</span><span class="o">.</span><span class="n">links_to</span>
            <span class="n">is_unlinked_input</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">inputs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">plug</span><span class="o">.</span><span class="n">output</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">plug</span><span class="o">.</span><span class="n">links_from</span>
            <span class="p">)</span>
            <span class="n">is_optional_allowed</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">optional</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">get_trait</span><span class="p">(</span><span class="n">param_name</span><span class="p">)</span><span class="o">.</span><span class="n">optional</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="n">is_unlinked_output</span> <span class="ow">or</span> <span class="n">is_unlinked_input</span>
            <span class="p">)</span> <span class="ow">and</span> <span class="n">is_optional_allowed</span><span class="p">:</span>
                <span class="n">exported_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_export_plug</span><span class="p">(</span>
                    <span class="n">param_name</span><span class="p">,</span>
                    <span class="n">temp_plug_name</span><span class="o">=</span><span class="p">(</span><span class="n">node_name</span><span class="p">,</span> <span class="n">param_name</span><span class="p">),</span>
                    <span class="n">multi_export</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">exported_name</span><span class="p">:</span>  <span class="c1"># Only add non-None values</span>
                    <span class="n">exported_plugs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">exported_name</span><span class="p">)</span>

        <span class="c1"># Update pipeline state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">update_pipeline</span><span class="p">()</span>
        <span class="c1"># Record in history for undo/redo</span>
        <span class="n">history_entry</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;export_plugs&quot;</span><span class="p">,</span> <span class="n">exported_plugs</span><span class="p">,</span> <span class="n">node_name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="n">history_entry</span><span class="p">,</span> <span class="n">from_undo</span><span class="p">,</span> <span class="n">from_redo</span><span class="p">)</span>
        <span class="c1"># Notify user</span>
        <span class="n">plug_list_str</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">exported_plugs</span><span class="p">)</span> <span class="k">if</span> <span class="n">exported_plugs</span> <span class="k">else</span> <span class="s2">&quot;No plugs&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">plug_list_str</span><span class="si">}</span><span class="s2"> exported from node &#39;</span><span class="si">{</span><span class="n">node_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="PipelineEditor.get_current_filename">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditor.get_current_filename">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_current_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the relative path to the last saved pipeline file.</span>

<span class="sd">        Returns the relative path from the current working directory to the</span>
<span class="sd">        file where this pipeline was most recently saved. If the pipeline has</span>
<span class="sd">        never been saved, returns an empty string.</span>

<span class="sd">        :return (str): Relative path to the pipeline file, or empty string if</span>
<span class="sd">                       never saved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_pipeline_filename&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">if</span> <span class="n">filename</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span></div>


<div class="viewcode-block" id="PipelineEditor.save_pipeline">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditor.save_pipeline">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the pipeline to a Python file.</span>

<span class="sd">        This method saves the current pipeline configuration to a file. If no</span>
<span class="sd">        filename is provided, it prompts the user with a file dialog. The</span>
<span class="sd">        method performs validation to ensure the filename is valid (doesn&#39;t</span>
<span class="sd">        start with a digit, has .py extension) and checks user permissions.</span>

<span class="sd">        :param filename (str): Path where the pipeline should be saved. If</span>
<span class="sd">                               None, a file dialog will be shown. Defaults to</span>
<span class="sd">                               None.</span>

<span class="sd">        :return (str): The absolute path of the saved pipeline file,</span>
<span class="sd">                       or None if:</span>
<span class="sd">                - The pipeline is empty (fewer than 2 nodes)</span>
<span class="sd">                - The user cancelled the save dialog</span>
<span class="sd">                - The filename is invalid</span>
<span class="sd">                - The user lacks permission to overwrite an existing file</span>

<span class="sd">        :note:</span>
<span class="sd">            - pipeline_saved: Signal emitted with the filename when save is</span>
<span class="sd">                              successful.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_show_warning</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Display a warning message box to the user.</span>

<span class="sd">            :param title (str): The title displayed in the warning dialog</span>
<span class="sd">                                window.</span>
<span class="sd">            :param message (str): The message text shown inside the warning</span>
<span class="sd">                                  dialog box.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="p">()</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check_modifications</span><span class="p">()</span>

        <span class="c1"># Don&#39;t save empty pipelines</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pipeline not saved: it is empty&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span>

        <span class="c1"># Determine filename through dialog if not provided or if it&#39;s in</span>
        <span class="c1"># mia_processes (prohibition on modifying the mia_processes library)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">filename</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;mia_processes&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;mia_processes&quot;</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span>
        <span class="p">):</span>
            <span class="n">folder</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">Path</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">())</span>
                <span class="o">/</span> <span class="s2">&quot;processes&quot;</span>
                <span class="o">/</span> <span class="s2">&quot;User_processes&quot;</span>
            <span class="p">)</span>
            <span class="n">folder</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Ensure __init__.py exists</span>
            <span class="p">(</span><span class="n">folder</span> <span class="o">/</span> <span class="s2">&quot;__init__.py&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">touch</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">filename</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;Save the pipeline&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">folder</span><span class="p">),</span>
                <span class="s2">&quot;Compatible files (*.py);; All (*)&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>  <span class="c1"># User cancelled</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

            <span class="c1"># Check if filename starts with a digit</span>
            <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">stem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                <span class="n">_show_warning</span><span class="p">(</span>
                    <span class="s2">&quot;Invalid Pipeline Name&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Python module names cannot start with a digit. &quot;</span>
                    <span class="s2">&quot;Please choose a different name.&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="c1"># Normalize to lowercase</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

            <span class="c1"># Handle file extension</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">suffix</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.py&quot;</span>

            <span class="k">elif</span> <span class="n">path</span><span class="o">.</span><span class="n">suffix</span> <span class="o">!=</span> <span class="s2">&quot;.py&quot;</span><span class="p">:</span>
                <span class="n">_show_warning</span><span class="p">(</span>
                    <span class="s2">&quot;Extension Changed&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;The pipeline will be saved with a &#39;.py&#39; extension &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;instead of &#39;</span><span class="si">{</span><span class="n">path</span><span class="o">.</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span><span class="si">}</span><span class="s2">.py&quot;</span>

            <span class="c1"># Check overwrite permissions</span>
            <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="n">config</span><span class="o">.</span><span class="n">get_user_mode</span><span class="p">():</span>
                <span class="n">_show_warning</span><span class="p">(</span>
                    <span class="s2">&quot;Permission Denied&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;This file already exists and you do not have &quot;</span>
                    <span class="s2">&quot;permission to overwrite it.&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Prepare and save pipeline with position and dimension data</span>
        <span class="n">posdict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">value</span><span class="o">.</span><span class="n">y</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">dimdict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">dim</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">node_dimension</span> <span class="o">=</span> <span class="n">dimdict</span>
        <span class="n">old_pos</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">node_position</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">node_position</span> <span class="o">=</span> <span class="n">posdict</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">save_pipeline</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pipeline_filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_saved</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">filename</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># Restore original position</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">node_position</span> <span class="o">=</span> <span class="n">old_pos</span></div>


<div class="viewcode-block" id="PipelineEditor.update_history">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditor.update_history">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">history_maker</span><span class="p">,</span> <span class="n">from_undo</span><span class="p">,</span> <span class="n">from_redo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the undo/redo history after a pipeline action.</span>

<span class="sd">        Manages the undo and redo stacks based on the action performed. When</span>
<span class="sd">        an action is undone, it&#39;s moved to the redo stack. When a new action</span>
<span class="sd">        is performed (not from undo/redo), it&#39;s added to the undo stack and</span>
<span class="sd">        complementary redo entries are cleaned up to maintain consistency.</span>

<span class="sd">        :param history_maker: A list describing the action, where</span>
<span class="sd">                              history_maker[0] is the action type</span>
<span class="sd">                              (e.g., &#39;add_process&#39;, &#39;delete_process&#39;,</span>
<span class="sd">                              &#39;update_node_name&#39;) and history_maker[1] is</span>
<span class="sd">                              typically the affected node identifier.</span>
<span class="sd">        :param from_undo (bool): Whether this update stems from an undo</span>
<span class="sd">                                 operation. Defaults to False.</span>
<span class="sd">        :param from_redo (bool): Whether this update stems from a redo</span>
<span class="sd">                                 operation. Defaults to False.</span>

<span class="sd">        :note:</span>
<span class="sd">            - &#39;update_node_name&#39; actions are not added to the undo stack</span>
<span class="sd">            - Complementary actions (add/delete for the same process) are</span>
<span class="sd">              removed from the redo stack when a new action occurs</span>
<span class="sd">            - pipeline_modified: Signal emitted indicating the pipeline has</span>
<span class="sd">              been modified.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">from_undo</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">history_maker</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">undos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">history_maker</span><span class="p">)</span>

            <span class="c1"># If the action was not triggered by a redo, adjust the redo list</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">from_redo</span><span class="p">:</span>
                <span class="n">action_map</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;add_process&quot;</span><span class="p">:</span> <span class="s2">&quot;delete_process&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;delete_process&quot;</span><span class="p">:</span> <span class="s2">&quot;add_process&quot;</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">action_type</span> <span class="o">=</span> <span class="n">history_maker</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">to_redo</span> <span class="o">=</span> <span class="n">action_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">action_type</span><span class="p">)</span>

                <span class="c1"># &quot;update_node_name&quot; actions remove the last undo entry</span>
                <span class="k">if</span> <span class="n">action_type</span> <span class="o">==</span> <span class="s2">&quot;update_node_name&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">undos</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">to_redo</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">redos</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">item</span>
                        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">redos</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
                            <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">to_redo</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">history_maker</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_modified</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="PipelineEditor.update_node_name">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditor.update_node_name">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_node_name</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">old_node</span><span class="p">,</span>
        <span class="n">old_node_name</span><span class="p">,</span>
        <span class="n">new_node_name</span><span class="p">,</span>
        <span class="n">from_undo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">from_redo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update a node&#39;s name in the pipeline, preserving all connections.</span>

<span class="sd">        This method renames a node by:</span>
<span class="sd">        1. Temporarily removing all links connected to the node</span>
<span class="sd">        2. Renaming the node in the pipeline</span>
<span class="sd">        3. Restoring all links with the updated node name</span>
<span class="sd">        4. Recording the action in the history for undo/redo support</span>

<span class="sd">        :param old_node: The node object to rename.</span>
<span class="sd">        :param old_node_name: The current name of the node.</span>
<span class="sd">        :param new_node_name: The desired new name for the node.</span>
<span class="sd">        :param from_undo: Whether this action is being performed as part of an</span>
<span class="sd">                          undo operation. Defaults to False.</span>
<span class="sd">        :param from_redo: Whether this action is being performed as part of a</span>
<span class="sd">                          redo operation. Defaults to False.</span>

<span class="sd">        Side Effects:</span>
<span class="sd">            - Updates the pipeline&#39;s node registry</span>
<span class="sd">            - Removes and recreates all links connected to the node</span>
<span class="sd">            - Updates pipeline activation states</span>
<span class="sd">            - Records action in history</span>
<span class="sd">            - Displays status message to user</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span>
        <span class="c1"># Collect all links connected to this node before removal</span>
        <span class="n">links_to_restore</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">source_param</span><span class="p">,</span> <span class="n">source_plug</span> <span class="ow">in</span> <span class="n">old_node</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="c1"># Collect outgoing links (this node -&gt; other nodes)</span>
            <span class="k">for</span> <span class="n">dest_node_name</span><span class="p">,</span> <span class="n">dest_param</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="ow">in</span> <span class="n">source_plug</span><span class="o">.</span><span class="n">links_to</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>
                <span class="n">link_spec</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">old_node_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">source_param</span><span class="si">}</span><span class="s2">-&gt;&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dest_node_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">dest_param</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="n">pipeline</span><span class="o">.</span><span class="n">remove_link</span><span class="p">(</span><span class="n">link_spec</span><span class="p">)</span>
                <span class="n">links_to_restore</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">(</span><span class="s2">&quot;outgoing&quot;</span><span class="p">,</span> <span class="n">source_param</span><span class="p">,</span> <span class="n">dest_node_name</span><span class="p">,</span> <span class="n">dest_param</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="c1"># Collect incoming links (other nodes -&gt; this node)</span>
            <span class="k">for</span> <span class="p">(</span>
                <span class="n">dest_node_name</span><span class="p">,</span>
                <span class="n">dest_param</span><span class="p">,</span>
                <span class="o">*</span><span class="n">_</span><span class="p">,</span>
            <span class="p">)</span> <span class="ow">in</span> <span class="n">source_plug</span><span class="o">.</span><span class="n">links_from</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>
                <span class="n">link_spec</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dest_node_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">dest_param</span><span class="si">}</span><span class="s2">-&gt;&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">old_node_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">source_param</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="n">pipeline</span><span class="o">.</span><span class="n">remove_link</span><span class="p">(</span><span class="n">link_spec</span><span class="p">)</span>
                <span class="n">links_to_restore</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">(</span><span class="s2">&quot;incoming&quot;</span><span class="p">,</span> <span class="n">source_param</span><span class="p">,</span> <span class="n">dest_node_name</span><span class="p">,</span> <span class="n">dest_param</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="c1"># Rename the node in the pipeline</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">new_node_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">old_node_name</span><span class="p">)</span>

        <span class="c1"># Restore all links with the new node name</span>
        <span class="k">for</span> <span class="p">(</span>
            <span class="n">direction</span><span class="p">,</span>
            <span class="n">source_param</span><span class="p">,</span>
            <span class="n">dest_node_name</span><span class="p">,</span>
            <span class="n">dest_param</span><span class="p">,</span>
        <span class="p">)</span> <span class="ow">in</span> <span class="n">links_to_restore</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;outgoing&quot;</span><span class="p">:</span>
                <span class="n">link_spec</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_node_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">source_param</span><span class="si">}</span><span class="s2">-&gt;&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dest_node_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">dest_param</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>  <span class="c1"># incoming</span>
                <span class="n">link_spec</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dest_node_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">dest_param</span><span class="si">}</span><span class="s2">-&gt;&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_node_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">source_param</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="n">pipeline</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">link_spec</span><span class="p">)</span>

        <span class="c1"># Update pipeline state</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">update_nodes_and_plugs_activation</span><span class="p">()</span>
        <span class="c1"># Record action in history for undo/redo</span>
        <span class="n">history_entry</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;update_node_name&quot;</span><span class="p">,</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">new_node_name</span><span class="p">],</span>
            <span class="n">new_node_name</span><span class="p">,</span>
            <span class="n">old_node_name</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="n">history_entry</span><span class="p">,</span> <span class="n">from_undo</span><span class="p">,</span> <span class="n">from_redo</span><span class="p">)</span>
        <span class="c1"># Notify user</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Node &#39;</span><span class="si">{</span><span class="n">old_node_name</span><span class="si">}</span><span class="s2">&#39; renamed to &#39;</span><span class="si">{</span><span class="n">new_node_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="PipelineEditor.update_plug_value">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditor.update_plug_value">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_plug_value</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">node_name</span><span class="p">,</span>
        <span class="n">new_value</span><span class="p">,</span>
        <span class="n">plug_name</span><span class="p">,</span>
        <span class="n">value_type</span><span class="p">,</span>
        <span class="n">from_undo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">from_redo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update a node&#39;s plug value and record the change in history.</span>

<span class="sd">        Updates the specified plug on the given node with a new value. The</span>
<span class="sd">        update is recorded in the history for undo/redo operations unless it&#39;s</span>
<span class="sd">        already part of an undo/redo action.</span>

<span class="sd">        :param node_name: The name of the node containing the plug.</span>
<span class="sd">        :param  new_value: The new value to assign to the plug. Will be cast</span>
<span class="sd">                           to value_type unless from_undo or from_redo is True.</span>
<span class="sd">        :param plug_name: The name of the plug to update.</span>
<span class="sd">        :param value_type: The type constructor to apply to new_value</span>
<span class="sd">                           (e.g., int, float, str). Ignored when from_undo or</span>
<span class="sd">                           from_redo is True.</span>
<span class="sd">        :param from_undo: If True, indicates this update is from an undo</span>
<span class="sd">                          operation. Defaults to False.</span>
<span class="sd">        :param from_redo: If True, indicates this update is from a redo</span>
<span class="sd">                          operation. Defaults to False.</span>

<span class="sd">        Side Effects:</span>
<span class="sd">            - Updates the plug value in the pipeline</span>
<span class="sd">            - Records the change in history (unless from undo/redo)</span>
<span class="sd">            - Displays a status message in the main window</span>
<span class="sd">            - Pops from the undo stack if from undo/redo</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span>
        <span class="n">old_value</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get_plug_value</span><span class="p">(</span><span class="n">plug_name</span><span class="p">)</span>
        <span class="c1"># Skip type conversion for undo/redo - value is already correctly typed</span>
        <span class="n">value_to_set</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">new_value</span> <span class="k">if</span> <span class="p">(</span><span class="n">from_undo</span> <span class="ow">or</span> <span class="n">from_redo</span><span class="p">)</span> <span class="k">else</span> <span class="n">value_type</span><span class="p">(</span><span class="n">new_value</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="n">plug_name</span><span class="p">,</span> <span class="n">value_to_set</span><span class="p">)</span>

        <span class="c1"># Remove from undo stack if this is an undo/redo operation</span>
        <span class="k">if</span> <span class="n">from_undo</span> <span class="ow">or</span> <span class="n">from_redo</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">undos</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="c1"># Record in history</span>
        <span class="n">history_maker</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;update_plug_value&quot;</span><span class="p">,</span>
            <span class="n">node_name</span><span class="p">,</span>
            <span class="n">old_value</span><span class="p">,</span>
            <span class="n">plug_name</span><span class="p">,</span>
            <span class="n">value_type</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="n">history_maker</span><span class="p">,</span> <span class="n">from_undo</span><span class="p">,</span> <span class="n">from_redo</span><span class="p">)</span>
        <span class="c1"># User feedback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Plug &#39;</span><span class="si">{</span><span class="n">plug_name</span><span class="si">}</span><span class="s2">&#39; of node &#39;</span><span class="si">{</span><span class="n">node_name</span><span class="si">}</span><span class="s2">&#39; changed &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;to &#39;</span><span class="si">{</span><span class="n">new_value</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="PipelineEditorTabs">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PipelineEditorTabs</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTabWidget</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tab widget for managing multiple pipeline editors.</span>

<span class="sd">    This widget provides a tabbed interface for creating, editing, and</span>
<span class="sd">    managing multiple pipeline configurations. Each tab contains a</span>
<span class="sd">    PipelineEditor instance with its own undo/redo history.</span>

<span class="sd">    .. Signals:</span>
<span class="sd">        pipeline_saved (str): Emitted when a pipeline is saved, passes</span>
<span class="sd">                              filename.</span>
<span class="sd">        node_clicked (str, Node): Emitted when a node is clicked in any editor.</span>
<span class="sd">        process_clicked (str, Process): Emitted when a process is clicked.</span>
<span class="sd">        switch_clicked (str, Switch): Emitted when a switch is clicked.</span>

<span class="sd">    .. Methods:</span>
<span class="sd">        - check_modifications: Check if the nodes of the current pipeline have</span>
<span class="sd">                               been modified.</span>
<span class="sd">        - close_tab: Close the selected tab and editor.</span>
<span class="sd">        - emit_node_clicked: Emit a signal when a node is clicked.</span>
<span class="sd">        - emit_pipeline_saved: Emit a signal when a pipeline is saved.</span>
<span class="sd">        - emit_switch_clicked: Emit a signal when a switch is clicked.</span>
<span class="sd">        - export_to_db_scans: Export the input of a filter to &#39;database_scans&#39;.</span>
<span class="sd">        - get_capsul_engine: Configure and return a CapsulEngine for the</span>
<span class="sd">                             current pipeline.</span>
<span class="sd">        - get_current_editor: Return the instance of the current editor.</span>
<span class="sd">        - get_current_filename: Return the file name of the current pipeline.</span>
<span class="sd">        - get_current_pipeline: Return the instance of the current pipeline.</span>
<span class="sd">        - get_current_tab_name: Return the tab title of the current editor.</span>
<span class="sd">        - get_editor_by_file_name: Return the editor associated with the given</span>
<span class="sd">                                   pipeline filename.</span>
<span class="sd">        - get_editor_by_index: Retrieve an editor widget by its tab index.</span>
<span class="sd">        - get_editor_by_tab_name: Retrieve the editor instance associated with</span>
<span class="sd">                                  a specific tab name.</span>
<span class="sd">        - get_filename_by_index: get the pipeline filename from its index in</span>
<span class="sd">                                 the editors.</span>
<span class="sd">        - get_index_by_editor: Find the tab index for a given editor widget.</span>
<span class="sd">        - get_index_by_filename: Get the index of the editor corresponding to</span>
<span class="sd">                                 the given pipeline filename.</span>
<span class="sd">        - get_index_by_tab_name: Get the index of the editor corresponding to</span>
<span class="sd">                                 the given tab name.</span>
<span class="sd">        - get_tab_name_by_index: Get the tab title from its index in the</span>
<span class="sd">                                 editors.</span>
<span class="sd">        - has_pipeline_nodes: Check if any of the pipelines in the editor tabs</span>
<span class="sd">                              have pipeline nodes.</span>
<span class="sd">        - load_pipeline: Load a new pipeline.</span>
<span class="sd">        - load_pipeline_parameters: Load parameters to the pipeline of the</span>
<span class="sd">                                    current editor.</span>
<span class="sd">        - new_tab: Create a new tab and a new editor.</span>
<span class="sd">        - open_filter: Open a filter widget.</span>
<span class="sd">        - open_sub_pipeline: Open a sub-pipeline in a new tab.</span>
<span class="sd">        - reset_pipeline: Reset the pipeline of the current editor.</span>
<span class="sd">        - save_pipeline: Save the pipeline of the current editor.</span>
<span class="sd">        - save_pipeline_parameters: Save the pipeline parameters of the</span>
<span class="sd">                                    current editor.</span>
<span class="sd">        - set_current_editor_by_editor: Set the specified editor as the</span>
<span class="sd">                                        currently active editor.</span>
<span class="sd">        - set_current_editor_by_file_name: Activate the editor tab containing</span>
<span class="sd">                                           the specified file.</span>
<span class="sd">        - set_current_editor_by_tab_name: Activate the editor tab with the</span>
<span class="sd">                                          specified name.</span>
<span class="sd">        - set_tab_index: Activate the tab at the specified index and update</span>
<span class="sd">                         the current node.</span>
<span class="sd">        - update_iteration_checkbox: Update the iteration checkbox state based</span>
<span class="sd">                                     on pipeline node names.</span>
<span class="sd">        - update_current_node: Update the node parameters display for the</span>
<span class="sd">                               current pipeline.</span>
<span class="sd">        - update_history: Update undo/redo history of an editor.</span>
<span class="sd">        - update_pipeline_editors: Update the pipeline editors after changes</span>
<span class="sd">                                   to the specified editor.</span>
<span class="sd">        - update_scans_list: Update the list of database scans in every editor.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pipeline_saved</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">node_clicked</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Node</span><span class="p">)</span>
    <span class="n">process_clicked</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Process</span><span class="p">)</span>
    <span class="n">switch_clicked</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Switch</span><span class="p">)</span>

<div class="viewcode-block" id="PipelineEditorTabs.__init__">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">scan_list</span><span class="p">,</span> <span class="n">main_window</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the pipeline editor tabs.</span>

<span class="sd">        :param project: Current project instance in the software.</span>
<span class="sd">        :param scan_list: List of selected database files.</span>
<span class="sd">        :param main_window: Main application window reference.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span> <span class="o">=</span> <span class="n">main_window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_list</span> <span class="o">=</span> <span class="n">scan_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">undos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previousIndex</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Configure the visual styling of the tab widget.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span>
            <span class="s2">&quot;QTabBar {&quot;</span>
            <span class="s2">&quot;    font-size: 12pt;&quot;</span>
            <span class="s2">&quot;    font-family: Arial;&quot;</span>
            <span class="s2">&quot;    text-align: center;&quot;</span>
            <span class="s2">&quot;    color: black;&quot;</span>
            <span class="s2">&quot;}&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTabsClosable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Create and configure the default pipeline editor.</span>
        <span class="n">p_e</span> <span class="o">=</span> <span class="n">PipelineEditor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="p">)</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">initialized</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">iterated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">iterated_tag</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">tag_values_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">all_tag_values_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">all_tag_values_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">node_parameters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">node_parameters_tmp</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Connect signals from a pipeline editor to this widget&#39;s handlers.</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">node_clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emit_node_clicked</span><span class="p">)</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">process_clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emit_node_clicked</span><span class="p">)</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">switch_clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emit_switch_clicked</span><span class="p">)</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">pipeline_saved</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emit_pipeline_saved</span><span class="p">)</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">pipeline_modified</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_pipeline_editors</span><span class="p">)</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">edit_sub_pipeline</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">open_sub_pipeline</span><span class="p">)</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">open_filter</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">open_filter</span><span class="p">)</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">export_to_db_scans</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">export_to_db_scans</span><span class="p">)</span>
        <span class="c1"># Setting a default editor called &quot;New Pipeline&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="n">p_e</span><span class="p">,</span> <span class="s2">&quot;New Pipeline&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">undos</span><span class="p">[</span><span class="n">p_e</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redos</span><span class="p">[</span><span class="n">p_e</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Create and configure the &#39;+&#39; button for adding new tabs.</span>
        <span class="n">add_button</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QToolButton</span><span class="p">()</span>
        <span class="n">add_button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
        <span class="n">add_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_tab</span><span class="p">)</span>
        <span class="n">placeholder_label</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Add tabs by pressing &quot;+&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="n">placeholder_label</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTabEnabled</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabBar</span><span class="p">()</span><span class="o">.</span><span class="n">setTabButton</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTabBar</span><span class="o">.</span><span class="n">RightSide</span><span class="p">,</span> <span class="n">add_button</span><span class="p">)</span>
        <span class="c1"># Connect internal widget signals to their handlers.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabCloseRequested</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">close_tab</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabBarClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_modifications</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_current_node</span><span class="p">)</span>
        <span class="c1"># Initialize the CAPSUL engine configuration.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_capsul_engine</span><span class="p">()</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.check_modifications">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.check_modifications">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_modifications</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if nodes in the current pipeline have been modified.</span>

<span class="sd">        Validates modifications when switching between pipeline tabs. Skips</span>
<span class="sd">        validation for the special &quot;add new pipeline&quot; tab (last position).</span>

<span class="sd">        :param current_index: The index of the tab being switched to.</span>

<span class="sd">        :note: The last tab (&#39;+&#39; button) may not have a widget, which is</span>
<span class="sd">               handled gracefully by catching AttributeError.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">current_index</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">previousIndex</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">previousIndex</span> <span class="o">=</span> <span class="n">current_index</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="p">(</span><span class="n">current_index</span><span class="p">)</span><span class="o">.</span><span class="n">check_modifications</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="c1"># Last tab (&#39;+&#39; button) has no widget to check</span>
            <span class="k">pass</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.close_tab">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.close_tab">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">close_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close a tab and its associated editor, prompting to save if modified.</span>

<span class="sd">        Removes the specified tab and cleans up its undo/redo history. If the</span>
<span class="sd">        tab contains unsaved changes (indicated by &quot; *&quot; suffix), prompts the</span>
<span class="sd">        user to save before closing. If all tabs are closed, creates a new</span>
<span class="sd">        default pipeline.</span>

<span class="sd">        :param idx: index of the tab to close</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_filename_by_index</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
        <span class="n">editor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_editor_by_index</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

        <span class="c1"># Check if pipeline has unsaved modifications</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tabText</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot; *&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop_up_close</span> <span class="o">=</span> <span class="n">PopUpClosePipeline</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop_up_close</span><span class="o">.</span><span class="n">save_as_signal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_pipeline</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop_up_close</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
            <span class="n">can_exit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop_up_close</span><span class="o">.</span><span class="n">can_exit</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">can_exit</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">can_exit</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Clean up undo/redo history</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">undos</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">editor</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redos</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">editor</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Adjust current tab if necessary</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_tab_index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">removeTab</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

        <span class="c1"># Create a new default pipeline if all tabs are closed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">p_e</span> <span class="o">=</span> <span class="n">PipelineEditor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="p">)</span>
            <span class="c1"># Connect signals</span>
            <span class="n">p_e</span><span class="o">.</span><span class="n">node_clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emit_node_clicked</span><span class="p">)</span>
            <span class="n">p_e</span><span class="o">.</span><span class="n">process_clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emit_node_clicked</span><span class="p">)</span>
            <span class="n">p_e</span><span class="o">.</span><span class="n">switch_clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emit_switch_clicked</span><span class="p">)</span>
            <span class="n">p_e</span><span class="o">.</span><span class="n">pipeline_saved</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emit_pipeline_saved</span><span class="p">)</span>
            <span class="n">p_e</span><span class="o">.</span><span class="n">pipeline_modified</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_pipeline_editors</span><span class="p">)</span>
            <span class="n">p_e</span><span class="o">.</span><span class="n">edit_sub_pipeline</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">open_sub_pipeline</span><span class="p">)</span>
            <span class="n">p_e</span><span class="o">.</span><span class="n">open_filter</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">open_filter</span><span class="p">)</span>
            <span class="n">p_e</span><span class="o">.</span><span class="n">export_to_db_scans</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">export_to_db_scans</span><span class="p">)</span>
            <span class="c1"># Initialize editor state</span>
            <span class="n">p_e</span><span class="o">.</span><span class="n">initialized</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">p_e</span><span class="o">.</span><span class="n">iterated</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">p_e</span><span class="o">.</span><span class="n">iterated_tag</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">p_e</span><span class="o">.</span><span class="n">tag_values_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">p_e</span><span class="o">.</span><span class="n">all_tag_values_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">p_e</span><span class="o">.</span><span class="n">node_parameters</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">p_e</span><span class="o">.</span><span class="n">node_parameters_tmp</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="c1"># # Add the new tab</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insertTab</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_e</span><span class="p">,</span> <span class="s2">&quot;New Pipeline&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_tab_index</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">undos</span><span class="p">[</span><span class="n">p_e</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redos</span><span class="p">[</span><span class="n">p_e</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_capsul_engine</span><span class="p">()</span>

        <span class="c1"># Update pipeline display (last node settings)</span>
        <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">node_name</span><span class="p">,</span> <span class="n">node_obj</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="n">process</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node_obj</span><span class="p">,</span> <span class="s2">&quot;process&quot;</span><span class="p">,</span> <span class="n">node_obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">displayNodeParameters</span><span class="p">(</span>
            <span class="n">node_name</span><span class="p">,</span> <span class="n">process</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_iteration_checkbox</span><span class="p">()</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.emit_node_clicked">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.emit_node_clicked">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">emit_node_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">process</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Emit the appropriate signal when a node is clicked.</span>

<span class="sd">        Emits either `process_clicked` or `node_clicked` signal depending on</span>
<span class="sd">        whether the process parameter is a Process instance.</span>

<span class="sd">        :param node_name: The name of the clicked node.</span>
<span class="sd">        :param process: The process associated with the node. If this is a</span>
<span class="sd">                        Process instance, emits `process_clicked`; otherwise</span>
<span class="sd">                        emits `node_clicked`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">signal</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_clicked</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="n">Process</span><span class="p">)</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_clicked</span>
        <span class="p">)</span>
        <span class="n">signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">node_name</span><span class="p">,</span> <span class="n">process</span><span class="p">)</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.emit_pipeline_saved">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.emit_pipeline_saved">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">emit_pipeline_saved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the current tab title and emit the *pipeline_saved* signal.</span>

<span class="sd">        :param filename: Path to the saved pipeline file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTabText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">(),</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_saved</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.emit_switch_clicked">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.emit_switch_clicked">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">emit_switch_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">switch</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Emit a signal when a switch is toggled.</span>

<span class="sd">        :param node_name: The name of the node whose switch was clicked.</span>
<span class="sd">        :param switch:  The Switch associated with the node.</span>

<span class="sd">        :Emits: switch_clicked: Signal containing the node name and the Switch.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switch_clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">node_name</span><span class="p">,</span> <span class="n">switch</span><span class="p">)</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.export_to_db_scans">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.export_to_db_scans">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">export_to_db_scans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export the input of a filter to &quot;database_scans&quot; plug.</span>

<span class="sd">        If database_scans already exists as a pipeline parameter, creates a</span>
<span class="sd">        link from database_scans to the node&#39;s input. Otherwise, exports the</span>
<span class="sd">        node&#39;s input parameter as database_scans at the pipeline level.</span>

<span class="sd">        :param node_name: Name of the node whose input should be exported.</span>

<span class="sd">        :note: This method automatically updates the editor scene after</span>
<span class="sd">               modification.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

        <span class="k">if</span> <span class="s2">&quot;database_scans&quot;</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">user_traits</span><span class="p">():</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;database_scans-&gt;</span><span class="si">{</span><span class="n">node_name</span><span class="si">}</span><span class="s2">.input&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">export_parameter</span><span class="p">(</span>
                <span class="n">node_name</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="n">pipeline_parameter</span><span class="o">=</span><span class="s2">&quot;database_scans&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">update_pipeline</span><span class="p">()</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.get_capsul_engine">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.get_capsul_engine">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_capsul_engine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Configure and return a CapsulEngine for the current pipeline.</span>

<span class="sd">        Retrieves a CapsulEngine instance from the MIA configuration and sets</span>
<span class="sd">        up the study configuration with project-specific directories. If the</span>
<span class="sd">        current pipeline has completion attributes, they are preserved during</span>
<span class="sd">        the engine setup process.</span>

<span class="sd">        :returns (CapsulEngine): Configured engine instance with study</span>
<span class="sd">                                 directories set to the project&#39;s raw_data</span>
<span class="sd">                                 and derived_data folders.</span>

<span class="sd">        :note: This method temporarily saves and restores completion engine</span>
<span class="sd">               attributes to prevent loss of configuration when switching</span>
<span class="sd">               between pipelines.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># save completion attributes for the current pipeline (other pipelines</span>
        <span class="c1"># will lose their values)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        <span class="n">completion</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="s2">&quot;completion_engine&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">att_values</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">completion</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">()</span><span class="o">.</span><span class="n">export_to_dict</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">completion</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="c1"># Configure engine with project directories</span>
        <span class="n">engine</span> <span class="o">=</span> <span class="n">Config</span><span class="o">.</span><span class="n">get_capsul_engine</span><span class="p">()</span>
        <span class="n">study_config</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">study_config</span>
        <span class="n">project_data_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
        <span class="n">study_config</span><span class="o">.</span><span class="n">input_directory</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">project_data_path</span> <span class="o">/</span> <span class="s2">&quot;raw_data&quot;</span><span class="p">)</span>
        <span class="n">study_config</span><span class="o">.</span><span class="n">output_directory</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">project_data_path</span> <span class="o">/</span> <span class="s2">&quot;derived_data&quot;</span><span class="p">)</span>

        <span class="c1"># Restore completion attributes if they existed</span>
        <span class="k">if</span> <span class="n">att_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">completion</span> <span class="o">=</span> <span class="n">ProcessCompletionEngine</span><span class="o">.</span><span class="n">get_completion_engine</span><span class="p">(</span>
                <span class="n">pipeline</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">completion</span><span class="p">:</span>
                <span class="n">completion</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">()</span><span class="o">.</span><span class="n">import_from_dict</span><span class="p">(</span><span class="n">att_values</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">engine</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.get_current_editor">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.get_current_editor">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_current_editor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the editor corresponding to the currently selected tab.</span>

<span class="sd">        :return: Editor instance for the active tab.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_editor_by_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">())</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.get_current_filename">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.get_current_filename">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_current_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the relative path of the file last saved in the current editor.</span>

<span class="sd">        If the pipeline has never been saved, the current tab title is</span>
<span class="sd">        returned.</span>

<span class="sd">        :return: The filename for the current editor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_filename_by_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">())</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.get_current_pipeline">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.get_current_pipeline">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_current_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the pipeline associated with the current editor.</span>

<span class="sd">        Returns None if no editor or scene is available.</span>

<span class="sd">        :return: The pipeline for the current editor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">editor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">editor</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span> <span class="k">if</span> <span class="n">editor</span> <span class="ow">and</span> <span class="n">editor</span><span class="o">.</span><span class="n">scene</span> <span class="k">else</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.get_current_tab_name">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.get_current_tab_name">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_current_tab_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the name of the currently selected tab.</span>

<span class="sd">        Trailing &quot;*&quot; and &quot;&amp;&quot; characters are stripped.</span>

<span class="sd">        :return: The current tab name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tab_name_by_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">())</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.get_editor_by_file_name">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.get_editor_by_file_name">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_editor_by_file_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the editor associated with the given pipeline filename.</span>

<span class="sd">        The filename corresponds to the last saved location of the pipeline.</span>

<span class="sd">        :param file_name: Name of the file the pipeline was last saved to.</span>

<span class="sd">        :return: The editor corresponding to the file name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_editor_by_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_index_by_filename</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.get_editor_by_index">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.get_editor_by_index">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_editor_by_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve an editor widget by its tab index.</span>

<span class="sd">        :param idx: Zero-based index of the editor tab, or None if not found.</span>

<span class="sd">        :return: The editor widget at the specified index, or None if idx is</span>
<span class="sd">                 None or if the index corresponds to the &quot;add tab&quot; button</span>
<span class="sd">                 (last tab) or if index out of range.</span>

<span class="sd">        :note: The last tab position is reserved for the &quot;add tab&quot; button and</span>
<span class="sd">               does not contain an editor widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.get_editor_by_tab_name">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.get_editor_by_tab_name">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_editor_by_tab_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tab_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the editor instance associated with a specific tab name.</span>

<span class="sd">        :param tab_name (str): The name of the tab to search for.</span>

<span class="sd">        :return: The editor instance corresponding to the specified tab name,</span>
<span class="sd">                 or None if the tab is not found.</span>

<span class="sd">        :raises:</span>
<span class="sd">            - ValueError: If tab_name is empty or None.</span>
<span class="sd">            - KeyError: If no tab exists with the given name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tab_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_index_by_tab_name</span><span class="p">(</span><span class="n">tab_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_editor_by_index</span><span class="p">(</span><span class="n">tab_index</span><span class="p">)</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.get_filename_by_index">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.get_filename_by_index">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_filename_by_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the filename for the pipeline at the specified editor index.</span>

<span class="sd">        Returns the relative path to the file where the pipeline was last</span>
<span class="sd">        saved. If the pipeline has never been saved, returns the tab title</span>
<span class="sd">        instead.</span>

<span class="sd">        :param idx: The zero-based index of the editor tab.</span>

<span class="sd">        :return: str or None. The filename or tab title if the editor exists,</span>
<span class="sd">                 None if no editor exists at the given index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">editor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_editor_by_index</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">editor</span><span class="o">.</span><span class="n">get_current_filename</span><span class="p">()</span> <span class="k">if</span> <span class="n">editor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.get_index_by_editor">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.get_index_by_editor">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_index_by_editor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">editor</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the tab index for a given editor widget.</span>

<span class="sd">        :param editor: The pipeline editor widget to locate.</span>

<span class="sd">        :return: The zero-based index of the editor&#39;s tab, or None if not</span>
<span class="sd">                 found.</span>

<span class="sd">        :note: Searches all tabs except the last one (count() - 1).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">idx</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_editor_by_index</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">==</span> <span class="n">editor</span>
            <span class="p">),</span>
            <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.get_index_by_filename">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.get_index_by_filename">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_index_by_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the index of the first tab with the specified filename.</span>

<span class="sd">        :param filename (str): The pipeline filename to search for. Can be an</span>
<span class="sd">                               absolute or relative path; will be normalized</span>
<span class="sd">                               to relative.</span>

<span class="sd">        :return (int): The zero-based index of the matching tab, or None</span>
<span class="sd">                       if no match is found.</span>

<span class="sd">        :note: Filenames are internally stored as relative paths for</span>
<span class="sd">               consistency. Only searches up to count() - 1 to exclude special</span>
<span class="sd">               tabs if any.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Normalize to relative path for consistent comparison</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">idx</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_filename_by_index</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">==</span> <span class="n">filename</span>
            <span class="p">),</span>
            <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.get_index_by_tab_name">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.get_index_by_tab_name">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_index_by_tab_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tab_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the index of a tab by its name.</span>

<span class="sd">        Searches through all tabs (excluding the last one) to find a tab</span>
<span class="sd">        matching the given name.</span>

<span class="sd">        :param tab_name (str): The name of the tab to locate.</span>

<span class="sd">        :return (int): The zero-based index of the matching tab, or None if no</span>
<span class="sd">                       match is found.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">idx</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tab_name_by_index</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">==</span> <span class="n">tab_name</span>
            <span class="p">),</span>
            <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.get_tab_name_by_index">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.get_tab_name_by_index">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_tab_name_by_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the clean tab name at the specified index.</span>

<span class="sd">        Retrieves the tab text at the given index and removes formatting</span>
<span class="sd">        characters:</span>
<span class="sd">            - Qt keyboard shortcut indicators (ampersands)</span>
<span class="sd">            - Unsaved file indicators (trailing &quot; *&quot;)</span>

<span class="sd">        :param idx: Zero-based index of the tab.</span>

<span class="sd">        :return (str): The cleaned tab name, or None if the index is invalid</span>
<span class="sd">                       or corresponds to the &quot;add tab&quot; button (last position).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Last tab position is reserved for the &quot;add tab&quot; button</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Get raw tab text and remove Qt keyboard shortcut indicator</span>
        <span class="n">tab_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tabText</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Remove trailing unsaved indicator if present</span>
        <span class="k">return</span> <span class="n">tab_name</span><span class="o">.</span><span class="n">removesuffix</span><span class="p">(</span><span class="s2">&quot; *&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.has_pipeline_nodes">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.has_pipeline_nodes">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">has_pipeline_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if any pipeline in the editor tabs contains nodes.</span>

<span class="sd">        Iterates through all tab widgets and checks if any pipeline editor</span>
<span class="sd">        contains nodes by examining the presence of plugs in the pipeline&#39;s</span>
<span class="sd">        root node.</span>

<span class="sd">        :return (bool): True if at least one pipeline contains nodes,</span>
<span class="sd">                        False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span>
            <span class="nb">hasattr</span><span class="p">(</span><span class="n">widget</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span> <span class="s2">&quot;scene&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">widget</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.load_pipeline">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.load_pipeline">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load a pipeline into the editor.</span>

<span class="sd">        Opens a pipeline file in a new or existing tab. If the pipeline is</span>
<span class="sd">        already open, switches to that tab. If the current tab is not empty,</span>
<span class="sd">        creates a new tab for the pipeline.</span>

<span class="sd">        :param filename (str): Path to the pipeline file to load. If None,</span>
<span class="sd">                               prompts the user to select a file. Defaults to</span>
<span class="sd">                               None.</span>

<span class="sd">        :return (None): Returns early on success, or cleans up and returns on</span>
<span class="sd">                        failure.</span>

<span class="sd">        :note: This method is also called from `open_sub_pipeline` with a</span>
<span class="sd">               filename.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_editor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span>
        <span class="n">current_tab_not_empty</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_editor</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="n">new_tab_opened</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">working_index</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Prompt for filename if not provided</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="c1"># Open new tab if the current PipelineEditor is not empty</span>
            <span class="k">if</span> <span class="n">current_tab_not_empty</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">new_tab</span><span class="p">()</span>
                <span class="n">working_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
                <span class="n">new_tab_opened</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">filename</span> <span class="o">=</span> <span class="n">current_editor</span><span class="o">.</span><span class="n">load_pipeline</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_capsul_engine</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>

            <span class="c1"># User cancelled or no file selected</span>
            <span class="k">if</span> <span class="n">new_tab_opened</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">close_tab</span><span class="p">(</span><span class="n">working_index</span><span class="p">)</span>

            <span class="k">return</span>

        <span class="c1"># Switch to tab if pipeline already open</span>
        <span class="n">existing_tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_index_by_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">existing_tab</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_tab_index</span><span class="p">(</span><span class="n">existing_tab</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Create new tab if needed</span>
        <span class="k">if</span> <span class="n">current_tab_not_empty</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">new_tab_opened</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_tab</span><span class="p">()</span>
            <span class="n">new_tab_opened</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">working_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="n">editor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_editor_by_index</span><span class="p">(</span><span class="n">working_index</span><span class="p">)</span>
        <span class="c1"># Load the pipeline</span>
        <span class="n">loaded_filename</span> <span class="o">=</span> <span class="n">editor</span><span class="o">.</span><span class="n">load_pipeline</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_capsul_engine</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">loaded_filename</span><span class="p">:</span>
            <span class="c1"># Success - update UI</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setTabText</span><span class="p">(</span><span class="n">working_index</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">loaded_filename</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_scans_list</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">run_pipeline_action</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span>
                <span class="kc">False</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Loading failed - clean up</span>
        <span class="k">if</span> <span class="n">new_tab_opened</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close_tab</span><span class="p">(</span><span class="n">working_index</span><span class="p">)</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.load_pipeline_parameters">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.load_pipeline_parameters">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_pipeline_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load pipeline parameters for the current editor.</span>

<span class="sd">        Opens a file dialog in the user&#39;s home directory to select a JSON</span>
<span class="sd">        file containing pipeline configuration parameters, then loads those</span>
<span class="sd">        parameters into the currently active editor&#39;s pipeline.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">load_pipeline_parameters</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">())</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.new_tab">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.new_tab">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">new_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create and initialize a new pipeline editor tab.</span>

<span class="sd">        Creates a new PipelineEditor instance, connects all necessary signals,</span>
<span class="sd">        initializes its state, generates a unique tab name, and makes it the</span>
<span class="sd">        current tab. The new tab is inserted at the last tab position.</span>

<span class="sd">        The tab name follows the pattern &quot;New Pipeline {n}&quot; where n is the</span>
<span class="sd">        first available index from 1 to 49.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create and configure new editor</span>
        <span class="n">editor</span> <span class="o">=</span> <span class="n">PipelineEditor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="p">)</span>
        <span class="c1"># Connect signals</span>
        <span class="n">signal_mappings</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;node_clicked&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">emit_node_clicked</span><span class="p">,</span>
            <span class="s2">&quot;process_clicked&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">emit_node_clicked</span><span class="p">,</span>
            <span class="s2">&quot;switch_clicked&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">emit_switch_clicked</span><span class="p">,</span>
            <span class="s2">&quot;pipeline_saved&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">emit_pipeline_saved</span><span class="p">,</span>
            <span class="s2">&quot;pipeline_modified&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_pipeline_editors</span><span class="p">,</span>
            <span class="s2">&quot;edit_sub_pipeline&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_sub_pipeline</span><span class="p">,</span>
            <span class="s2">&quot;open_filter&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_filter</span><span class="p">,</span>
            <span class="s2">&quot;export_to_db_scans&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_to_db_scans</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">signal_name</span><span class="p">,</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">signal_mappings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">editor</span><span class="p">,</span> <span class="n">signal_name</span><span class="p">)</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">slot</span><span class="p">)</span>

        <span class="c1"># Initialize state</span>
        <span class="n">editor</span><span class="o">.</span><span class="n">initialized</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">editor</span><span class="o">.</span><span class="n">iterated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">editor</span><span class="o">.</span><span class="n">iterated_tag</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">editor</span><span class="o">.</span><span class="n">tag_values_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">editor</span><span class="o">.</span><span class="n">node_parameters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">editor</span><span class="o">.</span><span class="n">node_parameters_tmp</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Generate unique tab name</span>
        <span class="n">tab_name</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;New Pipeline </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_index_by_tab_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                <span class="n">tab_name</span> <span class="o">=</span> <span class="n">name</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">tab_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Maximum number of tabs (50) reached in Pipeline Editor&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Initialize undo/redo stacks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">undos</span><span class="p">[</span><span class="n">editor</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redos</span><span class="p">[</span><span class="n">editor</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Insert tab at the last position and switch to it</span>
        <span class="n">insertion_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insertTab</span><span class="p">(</span><span class="n">insertion_index</span><span class="p">,</span> <span class="n">editor</span><span class="p">,</span> <span class="n">tab_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_tab_index</span><span class="p">(</span><span class="n">insertion_index</span><span class="p">)</span>
        <span class="c1"># Finalize setup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_capsul_engine</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_iteration_checkbox</span><span class="p">()</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.open_filter">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.open_filter">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">open_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open a filter widget for the specified pipeline node.</span>

<span class="sd">        Creates and displays a FilterWidget instance for filtering data</span>
<span class="sd">        associated with the given node in the current pipeline.</span>

<span class="sd">        :param node_name: The name of the node to apply filters to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter_widget</span> <span class="o">=</span> <span class="n">FilterWidget</span><span class="p">(</span>
            <span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span>
            <span class="n">node_name</span><span class="o">=</span><span class="n">node_name</span><span class="p">,</span>
            <span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
            <span class="n">main_window</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter_widget</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.open_sub_pipeline">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.open_sub_pipeline">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">open_sub_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sub_pipeline</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open a sub-pipeline in a new tab.</span>

<span class="sd">        This method locates and loads a sub-pipeline by:</span>
<span class="sd">            1. Reading the process configuration to find package paths</span>
<span class="sd">            2. Determining the pipeline&#39;s source package (mia_processes or</span>
<span class="sd">               custom)</span>
<span class="sd">            3. Resolving the full filesystem path to the pipeline file</span>
<span class="sd">            4. Loading the pipeline in a new tab</span>

<span class="sd">        :param sub_pipeline: The pipeline object to open. Must have a &#39;name&#39;</span>
<span class="sd">                             attribute and &#39;__module__&#39; attribute for package</span>
<span class="sd">                             resolution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Import locally to prevent circular dependencies</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">populse_mia.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">verCmp</span>

        <span class="c1"># Load process configuration</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span> <span class="s2">&quot;properties&quot;</span><span class="p">,</span> <span class="s2">&quot;process_config.yml&quot;</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">verCmp</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span> <span class="s2">&quot;5.1&quot;</span><span class="p">,</span> <span class="s2">&quot;sup&quot;</span><span class="p">):</span>
                    <span class="n">process_config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">process_config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load process configuration: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">process_config</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Determine pipeline source package</span>
        <span class="n">package_name</span> <span class="o">=</span> <span class="n">sub_pipeline</span><span class="o">.</span><span class="vm">__module__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">package_name</span> <span class="o">==</span> <span class="s2">&quot;mia_processes&quot;</span><span class="p">:</span>
            <span class="n">search_paths</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;mia_processes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">__path__</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">search_paths</span> <span class="o">=</span> <span class="n">process_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Paths&quot;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c1"># Resolve pipeline path</span>
        <span class="n">pipeline_path_components</span> <span class="o">=</span> <span class="n">get_path</span><span class="p">(</span>
            <span class="n">sub_pipeline</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">process_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Packages&quot;</span><span class="p">),</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="n">package_name</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">pipeline_name</span> <span class="o">=</span> <span class="n">pipeline_path_components</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="c1"># Locate and load the pipeline file</span>
        <span class="n">pipeline_file</span> <span class="o">=</span> <span class="n">find_filename</span><span class="p">(</span>
            <span class="n">search_paths</span><span class="p">,</span> <span class="n">pipeline_path_components</span><span class="p">,</span> <span class="n">pipeline_name</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_pipeline</span><span class="p">(</span><span class="n">pipeline_file</span><span class="p">)</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.reset_pipeline">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.reset_pipeline">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">reset_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset and refresh the currently active editor&#39;s pipeline display.</span>

<span class="sd">        This triggers an asynchronous update of the pipeline view after a</span>
<span class="sd">        short delay (20ms). The update strategy depends on the editor&#39;s view</span>
<span class="sd">        mode:</span>
<span class="sd">            - Logical view: Displays logical representations of nodes, plugs,</span>
<span class="sd">                            and links</span>
<span class="sd">            - Normal view: Displays standard representations of nodes, plugs,</span>
<span class="sd">                           and links</span>

<span class="sd">        :note: The update is performed asynchronously via a single-shot timer</span>
<span class="sd">               to allow the UI thread to remain responsive.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">_reset_pipeline</span><span class="p">()</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.save_pipeline">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.save_pipeline">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the current pipeline to a file.</span>

<span class="sd">        Performs either a &quot;Save&quot; or &quot;Save As&quot; operation depending on whether</span>
<span class="sd">        a filename is provided. Updates the tab text and emits a signal upon</span>
<span class="sd">        successful save.</span>

<span class="sd">        :param new_file_name (str): Target filename for the pipeline. If None,</span>
<span class="sd">                                    triggers a &quot;Save As&quot; dialog. Defaults to</span>
<span class="sd">                                    None.</span>

<span class="sd">        :return (str or None): The basename of the saved file if successful,</span>
<span class="sd">                               None otherwise.</span>

<span class="sd">        Side Effects:</span>
<span class="sd">            - Updates the current tab text with the new filename</span>
<span class="sd">            - Emits pipeline_saved signal (only for explicit saves)</span>
<span class="sd">            - Modifies the editor&#39;s _pipeline_filename attribute</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">editor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span>

        <span class="c1"># Handle &quot;Save As&quot; action</span>
        <span class="k">if</span> <span class="n">new_file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_file_name</span> <span class="o">=</span> <span class="n">editor</span><span class="o">.</span><span class="n">save_pipeline</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">new_file_name</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">new_file_name</span><span class="p">)</span>
            <span class="n">current_basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_current_filename</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">basename</span> <span class="o">!=</span> <span class="n">current_basename</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setTabText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">(),</span> <span class="n">basename</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">basename</span>

        <span class="c1"># Handle explicit save with provided filename</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="n">editor</span><span class="o">.</span><span class="n">scene</span>
        <span class="c1"># Extract node positions, handling both QPointF objects and tuples</span>
        <span class="n">posdict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">scene</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">posdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">value</span><span class="o">.</span><span class="n">y</span><span class="p">())</span>

            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">posdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Extract node dimensions</span>
        <span class="n">dimdict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">scene</span><span class="o">.</span><span class="n">dim</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="c1"># Update pipeline with current scene data</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">node_dimension</span> <span class="o">=</span> <span class="n">dimdict</span>
        <span class="n">old_pos</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">node_position</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">node_position</span> <span class="o">=</span> <span class="n">posdict</span>
        <span class="c1"># Save to file</span>
        <span class="n">save_pipeline</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">new_file_name</span><span class="p">)</span>
        <span class="c1"># Update editor state</span>
        <span class="n">editor</span><span class="o">.</span><span class="n">_pipeline_filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_file_name</span><span class="p">)</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">node_position</span> <span class="o">=</span> <span class="n">old_pos</span>
        <span class="c1"># Notify and update UI</span>
        <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">new_file_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_saved</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">new_file_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTabText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">(),</span> <span class="n">basename</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">basename</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.save_pipeline_parameters">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.save_pipeline_parameters">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save_pipeline_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save pipeline parameters from the currently active editor.</span>

<span class="sd">        Delegates the save operation to the current editor&#39;s save method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">save_pipeline_parameters</span><span class="p">()</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.set_current_editor_by_editor">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.set_current_editor_by_editor">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_current_editor_by_editor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">editor</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the specified editor as the currently active editor.</span>

<span class="sd">        Activates the tab containing the given editor by switching to its</span>
<span class="sd">        index.</span>

<span class="sd">        :param editor: The editor instance to make active. Must be an editor</span>
<span class="sd">                       that exists within one of the managed tabs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_tab_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_index_by_editor</span><span class="p">(</span><span class="n">editor</span><span class="p">))</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.set_current_editor_by_file_name">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.set_current_editor_by_file_name">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_current_editor_by_file_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Activate the editor tab containing the specified file.</span>

<span class="sd">        Sets the active editor tab to the one associated with the given file</span>
<span class="sd">        name, typically used when reopening a previously saved pipeline.</span>

<span class="sd">        :parame file_name: The name of the file whose editor tab should be</span>
<span class="sd">                           activated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_tab_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_index_by_filename</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.set_current_editor_by_tab_name">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.set_current_editor_by_tab_name">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_current_editor_by_tab_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tab_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Activate the editor tab with the specified name.</span>

<span class="sd">        :param tab_name: The display name of the tab to activate.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_index_by_tab_name</span><span class="p">(</span><span class="n">tab_name</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_tab_index</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No tab found with name: </span><span class="si">{</span><span class="n">tab_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.set_tab_index">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.set_tab_index">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_tab_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Activate the tab at the specified index and update the current node.</span>

<span class="sd">        Sets the active tab, stores it as the previous index for navigation</span>
<span class="sd">        history, and updates the current node state for the newly active</span>
<span class="sd">        editor.</span>

<span class="sd">        :param index: The zero-based index of the tab to activate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previousIndex</span> <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_current_node</span><span class="p">()</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.update_iteration_checkbox">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.update_iteration_checkbox">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_iteration_checkbox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the iteration checkbox state based on pipeline node names.</span>

<span class="sd">        Sets the iteration checkbox to checked if any pipeline node has</span>
<span class="sd">        &#39;iterated_&#39; in its key name, otherwise sets it to unchecked. If no</span>
<span class="sd">        valid pipeline exists or the pipeline lacks nodes, the checkbox is</span>
<span class="sd">        unchecked.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        <span class="n">checkbox</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">iterationTable</span><span class="o">.</span><span class="n">check_box_iterate</span>
        <span class="p">)</span>

        <span class="c1"># Default to unchecked if pipeline is invalid or has no nodes</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pipeline</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="s2">&quot;nodes&quot;</span><span class="p">):</span>
            <span class="n">checkbox</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Check if any node key contains &#39;iterated_&#39;</span>
        <span class="n">has_iteration</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
            <span class="s2">&quot;iterated_&quot;</span> <span class="ow">in</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sortedKeys</span>
        <span class="p">)</span>
        <span class="n">checkbox</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span> <span class="k">if</span> <span class="n">has_iteration</span> <span class="k">else</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.update_current_node">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.update_current_node">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_current_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the node parameters display for the current pipeline.</span>

<span class="sd">        Refreshes the UI to display parameters for all nodes in the current</span>
<span class="sd">        pipeline, updates user button states, iteration checkbox, and iterated</span>
<span class="sd">        tag display.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        <span class="n">pipeline_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span>

        <span class="c1"># Display parameters for all nodes in the pipeline</span>
        <span class="k">if</span> <span class="n">pipeline</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="s2">&quot;nodes&quot;</span><span class="p">):</span>

            <span class="k">for</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">displayNodeParameters</span><span class="p">(</span><span class="n">node_name</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="p">)</span>

        <span class="c1"># Update UI state</span>
        <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">update_user_buttons_states</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_iteration_checkbox</span><span class="p">()</span>
        <span class="c1"># Update iterated tag if an editor is active</span>
        <span class="n">current_editor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">current_editor</span><span class="p">:</span>
            <span class="n">pipeline_manager</span><span class="o">.</span><span class="n">iterationTable</span><span class="o">.</span><span class="n">update_iterated_tag</span><span class="p">(</span>
                <span class="n">current_editor</span><span class="o">.</span><span class="n">iterated_tag</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.update_history">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.update_history">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">editor</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the undo/redo history for the specified editor.</span>

<span class="sd">        Saves the editor&#39;s current undo and redo stacks and marks the active</span>
<span class="sd">        tab as modified by appending an asterisk to its title if not already</span>
<span class="sd">        present.</span>

<span class="sd">        :param editor: The editor instance whose history should be saved.</span>

<span class="sd">        :note: This method assumes the editor is in the currently active tab.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">undos</span><span class="p">[</span><span class="n">editor</span><span class="p">]</span> <span class="o">=</span> <span class="n">editor</span><span class="o">.</span><span class="n">undos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redos</span><span class="p">[</span><span class="n">editor</span><span class="p">]</span> <span class="o">=</span> <span class="n">editor</span><span class="o">.</span><span class="n">redos</span>
        <span class="n">current_tab_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_tab_name</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">current_tab_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot; *&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setTabText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">current_tab_name</span><span class="si">}</span><span class="s2"> *&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.update_pipeline_editors">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.update_pipeline_editors">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_pipeline_editors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">editor</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the pipeline editors after changes to the specified editor.</span>

<span class="sd">        Synchronizes the editor&#39;s undo/redo history and refreshes the scans</span>
<span class="sd">        list to reflect any modifications made in the pipeline editor.</span>

<span class="sd">        :param editor: The editor instance that was modified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="n">editor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_scans_list</span><span class="p">()</span></div>


<div class="viewcode-block" id="PipelineEditorTabs.update_scans_list">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.PipelineEditorTabs.update_scans_list">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_scans_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the list of database scans in every pipeline editor.</span>

<span class="sd">        Iterates through all editor tabs (excluding the last tab, reserved for</span>
<span class="sd">        the &quot;add tab&quot; button) and updates the database_scans attribute for</span>
<span class="sd">        each pipeline that supports it. Also refreshes the iteration checkbox</span>
<span class="sd">        state after updating.</span>

<span class="sd">        :note: Silently continues if updating a pipeline fails, logging the</span>
<span class="sd">               error without interrupting the update process for remaining</span>
<span class="sd">               pipelines.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">trait</span><span class="p">(</span><span class="s2">&quot;database_scans&quot;</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">pipeline</span><span class="o">.</span><span class="n">database_scans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_list</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Failed to update database_scans for &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;pipeline at index </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_iteration_checkbox</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="find_filename">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.find_filename">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">find_filename</span><span class="p">(</span><span class="n">paths_list</span><span class="p">,</span> <span class="n">packages_list</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Locate a pipeline file within configured paths.</span>

<span class="sd">    Searches for a file with the given name (with .py or .xml extension) by</span>
<span class="sd">    traversing through base paths combined with package subdirectories.</span>
<span class="sd">    Performs case-insensitive matching to handle filesystem sensitivity issues.</span>

<span class="sd">    :param paths_list: Base directory paths from process_config.yml</span>
<span class="sd">    :param packages_list: Ordered list of package subdirectories to traverse</span>
<span class="sd">    :param file_name: Base name of the sub-pipeline file (without extension)</span>

<span class="sd">    :return: Absolute path to the matched file, or None if not found</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">extensions</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">,</span> <span class="s2">&quot;.xml&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">base_path</span> <span class="ow">in</span> <span class="n">paths_list</span><span class="p">:</span>
        <span class="c1"># Build the target directory path</span>
        <span class="n">target_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">base_path</span><span class="p">)</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="o">*</span><span class="n">packages_list</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">target_dir</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
            <span class="k">continue</span>

        <span class="c1"># Search for matching files with case-insensitive comparison</span>
        <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">target_dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">file_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="k">continue</span>

            <span class="n">stem_lower</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">suffix_lower</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">stem_lower</span> <span class="o">==</span> <span class="n">file_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="n">suffix_lower</span> <span class="ow">in</span> <span class="n">extensions</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="get_path">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.get_path">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_path</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">dictionary</span><span class="p">,</span> <span class="n">prev_paths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pckg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Recursively search for a module name inside a nested dictionary structure</span>
<span class="sd">    and return its full path as a list of keys.</span>

<span class="sd">    The tree is assumed to be a mapping where:</span>
<span class="sd">        - Intermediate nodes are dictionaries (packages),</span>
<span class="sd">        - Leaf nodes are strings (module names).</span>

<span class="sd">    :param name (str): Name of the module to locate in the tree.</span>
<span class="sd">    :param dictionary (dict): The nested dictionary representing the tree</span>
<span class="sd">                              structure.</span>
<span class="sd">    :param prev_paths (list[str]): The accumulated path leading to the current</span>
<span class="sd">                                   dictionary. If None, a new path list is</span>
<span class="sd">                                   created.</span>
<span class="sd">    :param pckg (str): If provided, navigation starts inside that package name.</span>

<span class="sd">    :return (list[str]): A list of keys representing the path to the module, or</span>
<span class="sd">                         None if the module is not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Initialize accumulated path</span>
    <span class="k">if</span> <span class="n">prev_paths</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prev_paths</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">pckg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">prev_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pckg</span><span class="p">)</span>
            <span class="n">dictionary</span> <span class="o">=</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pckg</span><span class="p">,</span> <span class="p">{})</span>

    <span class="c1"># Copy because new_paths will be mutated</span>
    <span class="n">new_paths</span> <span class="o">=</span> <span class="n">prev_paths</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

        <span class="c1"># Leaf: module name</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">new_paths</span> <span class="o">+</span> <span class="p">[</span><span class="n">key</span><span class="p">]</span>

            <span class="k">continue</span>

        <span class="c1"># Branch: subpackage</span>
        <span class="n">new_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">get_path</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">new_paths</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="c1"># Reset new_paths when going back up</span>
        <span class="n">new_paths</span> <span class="o">=</span> <span class="n">prev_paths</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># Not found in this branch</span>
    <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="save_pipeline">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_editor.save_pipeline">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">save_pipeline</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save a pipeline to a file in the appropriate format.</span>

<span class="sd">    Automatically detects the output format based on the file extension.</span>
<span class="sd">    Supported formats are Python source (.py) and XML (.xml). If no</span>
<span class="sd">    recognized extension is provided, defaults to Python format.</span>

<span class="sd">    :param pipeline: The pipeline object to serialize and save.</span>
<span class="sd">    :param filename: Path to the output file. The extension determines</span>
<span class="sd">                     the output format (.py or .xml).</span>

<span class="sd">    :note: Unrecognized extensions will default to Python source format (.py)</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; save_pipeline(my_pipeline, &quot;model.py&quot;)</span>
<span class="sd">        &gt;&gt;&gt; save_pipeline(my_pipeline, &quot;config.xml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; save_pipeline(my_pipeline, &quot;output&quot;)  # Defaults to .py format</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">FORMATS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;.py&quot;</span><span class="p">:</span> <span class="n">save_py_pipeline</span><span class="p">,</span>
        <span class="s2">&quot;.xml&quot;</span><span class="p">:</span> <span class="n">save_xml_pipeline</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">suffix</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">FORMATS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">suffix</span><span class="p">,</span> <span class="n">save_py_pipeline</span><span class="p">)</span>
    <span class="n">writer</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></div>

</pre></div>

      </div>
      <div class="bottomnav" role="navigation" aria-label="Bottom">
      
        <p>
        <a class="uplink" href="../../../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2022, populse.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
  </body>
</html>