
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>populse_mia.user_interface.pipeline_manager.pipeline_manager_tab &#8212; populse_mia 1.4.0-dev+44a2feab documentation</title>
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/haiku.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../../../../index.html">
          <span>populse_mia 1.4.0-dev+44a2feab documentation</span></a></h1>
        <h2 class="heading"><span>populse_mia.user_interface.pipeline_manager.pipeline_manager_tab</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="../../../../index.html">Contents</a>
        </p>

      </div>
      <div class="content" role="main">
        
        
  <h1>Source code for populse_mia.user_interface.pipeline_manager.pipeline_manager_tab</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*- #</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module to define pipeline manager tab appearance, settings and methods.</span>

<span class="sd">Contains:</span>
<span class="sd">    Class:</span>
<span class="sd">        - PipelineManagerTab</span>
<span class="sd">        - RunProgress</span>
<span class="sd">        - RunWorker</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">##########################################################################</span>
<span class="c1"># Populse_mia - Copyright (C) IRMaGe/CEA, 2018</span>
<span class="c1"># Distributed under the terms of the CeCILL license, as published by</span>
<span class="c1"># the CEA-CNRS-INRIA. Refer to the LICENSE file or to</span>
<span class="c1"># http://www.cecill.info/licences/Licence_CeCILL_V2.1-en.html</span>
<span class="c1"># for details.</span>
<span class="c1">##########################################################################</span>

<span class="c1"># Populse_MIA imports</span>
<span class="kn">from</span> <span class="nn">populse_mia.user_interface.pipeline_manager.process_mia</span> <span class="kn">import</span> <span class="n">ProcessMIA</span>
<span class="kn">from</span> <span class="nn">populse_mia.user_interface.pop_ups</span> <span class="kn">import</span> <span class="p">(</span><span class="n">PopUpSelectIteration</span><span class="p">,</span>
                                                <span class="n">PopUpInheritanceDict</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">populse_mia.user_interface.pipeline_manager.iteration_table</span> <span class="kn">import</span> <span class="p">(</span>
                                                                 <span class="n">IterationTable</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">populse_mia.data_manager.project</span> <span class="kn">import</span> <span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                              <span class="n">COLLECTION_INITIAL</span><span class="p">,</span>
                                              <span class="n">COLLECTION_BRICK</span><span class="p">,</span> <span class="n">BRICK_NAME</span><span class="p">,</span>
                                              <span class="n">BRICK_OUTPUTS</span><span class="p">,</span> <span class="n">BRICK_INPUTS</span><span class="p">,</span>
                                              <span class="n">TAG_BRICKS</span><span class="p">,</span> <span class="n">BRICK_INIT</span><span class="p">,</span>
                                              <span class="n">BRICK_INIT_TIME</span><span class="p">,</span> <span class="n">TAG_TYPE</span><span class="p">,</span>
                                              <span class="n">TAG_EXP_TYPE</span><span class="p">,</span> <span class="n">TAG_FILENAME</span><span class="p">,</span>
                                              <span class="n">TAG_CHECKSUM</span><span class="p">,</span> <span class="n">TYPE_NII</span><span class="p">,</span> <span class="n">TYPE_MAT</span><span class="p">,</span>
                                              <span class="n">TYPE_TXT</span><span class="p">,</span> <span class="n">TYPE_UNKNOWN</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">populse_mia.user_interface.pipeline_manager.node_controller</span> <span class="kn">import</span> <span class="p">(</span>
                                                                 <span class="n">NodeController</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">populse_mia.user_interface.pipeline_manager.pipeline_editor</span> <span class="kn">import</span> <span class="p">(</span>
                                                             <span class="n">PipelineEditorTabs</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">populse_mia.user_interface.pipeline_manager.process_library</span> <span class="kn">import</span> <span class="p">(</span>
                                                           <span class="n">ProcessLibraryWidget</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">populse_mia.software_properties</span> <span class="kn">import</span> <span class="n">Config</span>

<span class="c1"># Capsul imports</span>
<span class="kn">from</span> <span class="nn">capsul.api</span> <span class="kn">import</span> <span class="p">(</span><span class="n">get_process_instance</span><span class="p">,</span> <span class="n">NipypeProcess</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">,</span>
                        <span class="n">PipelineNode</span><span class="p">,</span> <span class="n">StudyConfig</span><span class="p">,</span> <span class="n">Switch</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">capsul.qt_gui.widgets.pipeline_developper_view</span> <span class="kn">import</span> <span class="p">(</span>
                                                         <span class="n">PipelineDevelopperView</span><span class="p">)</span>

<span class="c1"># PyQt5 imports</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="kn">import</span> <span class="n">Signal</span><span class="p">,</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">QThread</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QMenu</span><span class="p">,</span> <span class="n">QVBoxLayout</span><span class="p">,</span> <span class="n">QWidget</span><span class="p">,</span> <span class="n">QSplitter</span><span class="p">,</span>
                             <span class="n">QApplication</span><span class="p">,</span> <span class="n">QToolBar</span><span class="p">,</span> <span class="n">QAction</span><span class="p">,</span> <span class="n">QHBoxLayout</span><span class="p">,</span>
                             <span class="n">QScrollArea</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="p">,</span> <span class="n">QProgressDialog</span><span class="p">,</span>
                             <span class="n">QPushButton</span><span class="p">)</span>

<span class="c1"># Other import</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">matplotlib.backends.qt_compat</span> <span class="kn">import</span> <span class="n">QtWidgets</span>
<span class="kn">from</span> <span class="nn">traits.api</span> <span class="kn">import</span> <span class="n">TraitListObject</span><span class="p">,</span> <span class="n">Undefined</span>
<span class="kn">from</span> <span class="nn">traits.trait_errors</span> <span class="kn">import</span> <span class="n">TraitError</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">unicode</span> <span class="o">=</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="k">else</span><span class="p">:</span>
<div class="viewcode-block" id="values"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.values">[docs]</a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">()</span></div>


<div class="viewcode-block" id="PipelineManagerTab"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.PipelineManagerTab">[docs]</a><span class="k">class</span> <span class="nc">PipelineManagerTab</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Widget that handles the Pipeline Manager tab.</span>

<span class="sd">    .. Methods:</span>
<span class="sd">        - add_plug_value_to_database: add the plug value to the database.</span>
<span class="sd">        - add_process_to_preview: add a process to the pipeline</span>
<span class="sd">        - controller_value_changed: update history when a pipeline node is</span>
<span class="sd">          changed</span>
<span class="sd">        - displayNodeParameters: display the node controller when a node is</span>
<span class="sd">          clicked</span>
<span class="sd">        - init_pipeline: initialize the current pipeline of the pipeline</span>
<span class="sd">          editor</span>
<span class="sd">        - initialize: clean previous initialization then initialize the current</span>
<span class="sd">          pipeline</span>
<span class="sd">        - layout_view : initialize layout for the pipeline manager</span>
<span class="sd">        - loadParameters: load pipeline parameters to the current pipeline of</span>
<span class="sd">          the pipeline editor</span>
<span class="sd">        - loadPipeline: load a pipeline to the pipeline editor</span>
<span class="sd">        - redo: redo the last undone action on the current pipeline editor</span>
<span class="sd">        - runPipeline: run the current pipeline of the pipeline editor</span>
<span class="sd">        - saveParameters: save the pipeline parameters of the the current</span>
<span class="sd">          pipeline of the pipeline editor</span>
<span class="sd">        - savePipeline: save the current pipeline of the pipeline editor</span>
<span class="sd">        - savePipelineAs: save the current pipeline of the pipeline editor</span>
<span class="sd">          under another name</span>
<span class="sd">        - undo: undo the last action made on the current pipeline editor</span>
<span class="sd">        - updateProcessLibrary: update the library of processes when a</span>
<span class="sd">          pipeline is saved</span>
<span class="sd">        - update_user_mode: update the visibility of widgets/actions</span>
<span class="sd">          depending of the chosen mode</span>
<span class="sd">        - update_project: update the project attribute of several objects</span>
<span class="sd">        - update_scans_list: update the user-selected list of scans</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">item_library_clicked</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

<div class="viewcode-block" id="PipelineManagerTab.__init__"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.PipelineManagerTab.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">scan_list</span><span class="p">,</span> <span class="n">main_window</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialization of the Pipeline Manager tab</span>

<span class="sd">        :param project: current project in the software</span>
<span class="sd">        :param scan_list: list of the selected database files</span>
<span class="sd">        :param main_window: main window of the software</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

        <span class="c1"># Necessary for using MIA bricks</span>
        <span class="n">ProcessMIA</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inheritance_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_clicked</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_init</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scan_list</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scan_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scan_list</span> <span class="o">=</span> <span class="n">scan_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span> <span class="o">=</span> <span class="n">main_window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_progress_bar</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># This list is the list of scans contained in the iteration table</span>
        <span class="c1"># If it is empty, the scan list in the Pipeline Manager is the scan</span>
        <span class="c1"># list from the data_browser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iteration_table_scans_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">brick_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Used for the inheritance dictionary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignore_node</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">QWidget</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">verticalLayout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processLibrary</span> <span class="o">=</span> <span class="n">ProcessLibraryWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processLibrary</span><span class="o">.</span><span class="n">process_library</span><span class="o">.</span><span class="n">item_library_clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">item_library_clicked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_library_clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_show_preview</span><span class="p">)</span>

        <span class="c1"># self.diagramScene = DiagramScene(self)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span> <span class="o">=</span> <span class="n">PipelineEditorTabs</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">node_clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">displayNodeParameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">switch_clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">displayNodeParameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">pipeline_saved</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateProcessLibrary</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodeController</span> <span class="o">=</span> <span class="n">NodeController</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_list</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodeController</span><span class="o">.</span><span class="n">visibles_tags</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_shown_tags</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">iterationTable</span> <span class="o">=</span> <span class="n">IterationTable</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iterationTable</span><span class="o">.</span><span class="n">iteration_table_updated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_scans_list</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">previewBlock</span> <span class="o">=</span> <span class="n">PipelineDevelopperView</span><span class="p">(</span>
            <span class="n">pipeline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow_open_controller</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">show_sub_pipelines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">enable_edition</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">startedConnection</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Actions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_pipeline_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Load pipeline&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_pipeline_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loadPipeline</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_pipeline_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Save pipeline&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_pipeline_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">savePipeline</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_pipeline_as_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Save pipeline as&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_pipeline_as_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">savePipelineAs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load_pipeline_parameters_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span>
            <span class="s2">&quot;Load pipeline parameters&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_pipeline_parameters_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadParameters</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_pipeline_parameters_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span>
            <span class="s2">&quot;Save pipeline parameters&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_pipeline_parameters_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveParameters</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_pipeline_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Initialize pipeline&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_pipeline_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initialize</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">run_pipeline_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Run pipeline&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_pipeline_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">runPipeline</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_pipeline_action</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># if config.get_user_mode() == True:</span>
        <span class="c1">#     self.save_pipeline_action.setDisabled(True)</span>
        <span class="c1">#     self.save_pipeline_as_action.setDisabled(True)</span>
        <span class="c1">#     self.processLibrary.setHidden(True)</span>
        <span class="c1">#     self.previewBlock.setHidden(True)</span>

        <span class="c1"># Initialize toolbar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menu_toolbar</span> <span class="o">=</span> <span class="n">QToolBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags_menu</span> <span class="o">=</span> <span class="n">QMenu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags_tool_button</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QToolButton</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scrollArea</span> <span class="o">=</span> <span class="n">QScrollArea</span><span class="p">()</span>

        <span class="c1"># Initialize Qt layout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hLayout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitterRight</span> <span class="o">=</span> <span class="n">QSplitter</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Vertical</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitter0</span> <span class="o">=</span> <span class="n">QSplitter</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Vertical</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitter1</span> <span class="o">=</span> <span class="n">QSplitter</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">layout_view</span><span class="p">()</span>

        <span class="c1"># To undo/redo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodeController</span><span class="o">.</span><span class="n">value_changed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller_value_changed</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_show_preview</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_item</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">previewBlock</span><span class="o">.</span><span class="n">centerOn</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_process</span><span class="p">(</span><span class="n">name_item</span><span class="p">)</span>

<div class="viewcode-block" id="PipelineManagerTab.add_plug_value_to_database"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.PipelineManagerTab.add_plug_value_to_database">[docs]</a>    <span class="k">def</span> <span class="nf">add_plug_value_to_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">brick</span><span class="p">,</span> <span class="n">node_name</span><span class="p">,</span>
                                   <span class="n">plug_name</span><span class="p">,</span> <span class="n">full_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add the plug value to the database.</span>

<span class="sd">        :param p_value: plug value, a file name or a list of file names</span>
<span class="sd">        :param brick: brick id</span>
<span class="sd">        :param node_name: name of the node</span>
<span class="sd">        :param plug_name: name of the plug</span>
<span class="sd">        :param full_name: full name of the node, including parent brick(s).</span>
<span class="sd">                          If there is no parent brick, full_name = node_name.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">p_value</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">TraitListObject</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="n">p_value</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span><span class="n">elt</span><span class="p">,</span> <span class="n">brick</span><span class="p">,</span> <span class="n">node_name</span><span class="p">,</span>
                                                <span class="n">plug_name</span><span class="p">,</span> <span class="n">full_name</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># This means that the value is not a filename</span>
        <span class="k">if</span> <span class="n">p_value</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&lt;undefined&gt;&quot;</span><span class="p">,</span>
                       <span class="n">Undefined</span><span class="p">,</span>
                       <span class="p">[</span><span class="n">Undefined</span><span class="p">]]</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">p_value</span><span class="p">)[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">open</span><span class="p">(</span><span class="n">p_value</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Could not open </span><span class="si">{0}</span><span class="s1"> file.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p_value</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Deleting the project&#39;s folder in the file name so it can</span>
            <span class="c1"># fit to the database&#39;s syntax</span>
            <span class="n">old_value</span> <span class="o">=</span> <span class="n">p_value</span>
            <span class="c1">#p_value = p_value.replace(self.project.folder, &quot;&quot;)</span>
            <span class="n">p_value</span> <span class="o">=</span> <span class="n">p_value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">p_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">]:</span>
                <span class="n">p_value</span> <span class="o">=</span> <span class="n">p_value</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

            <span class="c1"># If the file name is already in the database,</span>
            <span class="c1"># no exception is raised</span>
            <span class="c1"># but the user is warned</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_document</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">p_value</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Path </span><span class="si">{0}</span><span class="s2"> already in database.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p_value</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_document</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">p_value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_document</span><span class="p">(</span><span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">p_value</span><span class="p">)</span>

            <span class="c1"># Adding the new brick to the output files</span>
            <span class="n">bricks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">TAG_BRICKS</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">bricks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">bricks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">bricks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brick_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">TAG_BRICKS</span><span class="p">,</span> <span class="n">bricks</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">TAG_BRICKS</span><span class="p">,</span> <span class="n">bricks</span><span class="p">)</span>
            <span class="c1"># Type tag</span>
            <span class="n">filename</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">p_value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s2">&quot;.nii&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                    <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">TAG_TYPE</span><span class="p">,</span> <span class="n">TYPE_NII</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                    <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">TAG_TYPE</span><span class="p">,</span> <span class="n">TYPE_NII</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s2">&quot;.mat&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                    <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">TAG_TYPE</span><span class="p">,</span> <span class="n">TYPE_MAT</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                    <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">TAG_TYPE</span><span class="p">,</span> <span class="n">TYPE_MAT</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s2">&quot;.txt&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                    <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">TAG_TYPE</span><span class="p">,</span> <span class="n">TYPE_TXT</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                    <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">TAG_TYPE</span><span class="p">,</span> <span class="n">TYPE_TXT</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                    <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">TAG_TYPE</span><span class="p">,</span> <span class="n">TYPE_UNKNOWN</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                    <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">TAG_TYPE</span><span class="p">,</span> <span class="n">TYPE_UNKNOWN</span><span class="p">)</span>

            <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span>
            <span class="c1"># iterate = self.iterationTable.check_box_iterate.isChecked()</span>
            <span class="c1"># Automatically fill inheritance dictionary if empty</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_node</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">inheritance_dict</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">old_value</span> <span class="ow">not</span> <span class="ow">in</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">inheritance_dict</span><span class="p">)</span> <span class="ow">and</span>
                  <span class="p">(</span><span class="n">node_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">)</span> <span class="ow">and</span>
                  <span class="p">(</span><span class="n">node_name</span> <span class="o">+</span> <span class="n">plug_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">)):</span>
                <span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
                    <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                                <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                            <span class="n">name</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">extension</span> <span class="o">==</span> <span class="s2">&quot;.nii&quot;</span><span class="p">:</span>
                                <span class="n">values</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="n">extension</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">inheritance_dict</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span>
                        <span class="p">))[</span><span class="mi">0</span><span class="p">]]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">inheritance_dict</span><span class="p">[</span><span class="n">old_value</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">node_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">:</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">[</span><span class="n">node_name</span><span class="p">]]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">inheritance_dict</span><span class="p">[</span><span class="n">old_value</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="k">elif</span> <span class="n">node_name</span> <span class="o">+</span> <span class="n">plug_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">:</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">[</span><span class="n">node_name</span> <span class="o">+</span> <span class="n">plug_name</span><span class="p">]]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">inheritance_dict</span><span class="p">[</span><span class="n">old_value</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">pop_up</span> <span class="o">=</span> <span class="n">PopUpInheritanceDict</span><span class="p">(</span>
                             <span class="n">values</span><span class="p">,</span> <span class="n">full_name</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">iterationTable</span><span class="o">.</span><span class="n">check_box_iterate</span><span class="o">.</span><span class="n">isChecked</span><span class="p">())</span>
                            <span class="n">pop_up</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">ignore_node</span> <span class="o">=</span> <span class="n">pop_up</span><span class="o">.</span><span class="n">everything</span>
                            <span class="k">if</span> <span class="n">pop_up</span><span class="o">.</span><span class="n">ignore</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">inheritance_dict</span> <span class="o">=</span> <span class="kc">None</span>
                                <span class="k">if</span> <span class="n">pop_up</span><span class="o">.</span><span class="n">all</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">[</span><span class="n">node_name</span><span class="o">+</span><span class="n">plug_name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">value</span> <span class="o">=</span> <span class="n">pop_up</span><span class="o">.</span><span class="n">value</span>
                                <span class="k">if</span> <span class="n">pop_up</span><span class="o">.</span><span class="n">all</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pop_up</span><span class="o">.</span><span class="n">key</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">[</span><span class="n">node_name</span><span class="o">+</span><span class="n">plug_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pop_up</span><span class="o">.</span><span class="n">key</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">inheritance_dict</span><span class="p">[</span><span class="n">old_value</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="c1"># Adding inherited tags</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inheritance_dict</span><span class="p">:</span>
                <span class="n">database_parent_file</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inheritance_dict</span><span class="p">[</span><span class="n">old_value</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">parent_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inheritance_dict</span><span class="p">[</span><span class="n">old_value</span><span class="p">]</span>
                    <span class="n">own_tags</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parent_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inheritance_dict</span><span class="p">[</span><span class="n">old_value</span><span class="p">][</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span>
                    <span class="n">own_tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inheritance_dict</span><span class="p">[</span><span class="n">old_value</span><span class="p">][</span><span class="s1">&#39;own_tags&#39;</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
                        <span class="n">COLLECTION_CURRENT</span><span class="p">):</span>

                    <span class="k">if</span> <span class="n">scan</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">parent_file</span><span class="p">):</span>
                        <span class="n">database_parent_file</span> <span class="o">=</span> <span class="n">scan</span>

                <span class="n">banished_tags</span> <span class="o">=</span> <span class="p">[</span><span class="n">TAG_TYPE</span><span class="p">,</span> <span class="n">TAG_EXP_TYPE</span><span class="p">,</span> <span class="n">TAG_BRICKS</span><span class="p">,</span>
                                <span class="n">TAG_CHECKSUM</span><span class="p">,</span> <span class="n">TAG_FILENAME</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_fields_names</span><span class="p">(</span>
                        <span class="n">COLLECTION_CURRENT</span><span class="p">):</span>

                    <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">banished_tags</span> <span class="ow">and</span> <span class="n">database_parent_file</span><span class="p">:</span>
                        <span class="n">parent_current_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">database_parent_file</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                            <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span>
                            <span class="n">parent_current_value</span><span class="p">)</span>
                        <span class="n">parent_initial_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                            <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">database_parent_file</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                            <span class="n">COLLECTION_INITIAL</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span>
                            <span class="n">parent_initial_value</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">own_tags</span><span class="p">:</span>

                    <span class="k">for</span> <span class="n">tag_to_add</span> <span class="ow">in</span> <span class="n">own_tags</span><span class="p">:</span>

                        <span class="k">if</span> <span class="p">(</span><span class="n">tag_to_add</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span>
                              <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span>
                                 <span class="n">get_fields_names</span><span class="p">)(</span><span class="n">COLLECTION_CURRENT</span><span class="p">)):</span>
                            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span>
                                         <span class="n">add_field</span><span class="p">)(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                    <span class="n">tag_to_add</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                                                    <span class="n">tag_to_add</span><span class="p">[</span><span class="s1">&#39;field_type&#39;</span><span class="p">],</span>
                                                    <span class="n">tag_to_add</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span>
                                                    <span class="n">tag_to_add</span><span class="p">[</span><span class="s1">&#39;visibility&#39;</span><span class="p">],</span>
                                                    <span class="n">tag_to_add</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">],</span>
                                                    <span class="n">tag_to_add</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">],</span>
                                                    <span class="n">tag_to_add</span><span class="p">[</span><span class="s1">&#39;default_value&#39;</span><span class="p">])</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                                                       <span class="n">p_value</span><span class="p">,</span>
                                                       <span class="n">tag_to_add</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                                                       <span class="n">tag_to_add</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>

                        <span class="k">if</span> <span class="p">(</span><span class="n">tag_to_add</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span>
                              <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span>
                                 <span class="n">get_fields_names</span><span class="p">)(</span><span class="n">COLLECTION_INITIAL</span><span class="p">)):</span>
                            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span>
                                         <span class="n">add_field</span><span class="p">)(</span><span class="n">COLLECTION_INITIAL</span><span class="p">,</span>
                                                    <span class="n">tag_to_add</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                                                    <span class="n">tag_to_add</span><span class="p">[</span><span class="s1">&#39;field_type&#39;</span><span class="p">],</span>
                                                    <span class="n">tag_to_add</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span>
                                                    <span class="n">tag_to_add</span><span class="p">[</span><span class="s1">&#39;visibility&#39;</span><span class="p">],</span>
                                                    <span class="n">tag_to_add</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">],</span>
                                                    <span class="n">tag_to_add</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">],</span>
                                                    <span class="n">tag_to_add</span><span class="p">[</span><span class="s1">&#39;default_value&#39;</span><span class="p">])</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">COLLECTION_INITIAL</span><span class="p">,</span>
                                                       <span class="n">p_value</span><span class="p">,</span>
                                                       <span class="n">tag_to_add</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                                                       <span class="n">tag_to_add</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">saveModifications</span><span class="p">()</span></div>

<div class="viewcode-block" id="PipelineManagerTab.add_process_to_preview"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.PipelineManagerTab.add_process_to_preview">[docs]</a>    <span class="k">def</span> <span class="nf">add_process_to_preview</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_process</span><span class="p">,</span> <span class="n">node_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a process to the pipeline.</span>

<span class="sd">        :param class_process: process class&#39;s name (str)</span>
<span class="sd">        :param node_name: name of the corresponding node</span>
<span class="sd">           (using when undo/redo) (str)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># pipeline = self.previewBlock.scene.pipeline</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">node_name</span><span class="p">:</span>
            <span class="n">class_name</span> <span class="o">=</span> <span class="n">class_process</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="n">node_name</span> <span class="o">=</span> <span class="n">class_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

            <span class="k">while</span> <span class="n">node_name</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">node_name</span> <span class="o">=</span> <span class="n">class_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

            <span class="n">process_to_use</span> <span class="o">=</span> <span class="n">class_process</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">process_to_use</span> <span class="o">=</span> <span class="n">class_process</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">process</span> <span class="o">=</span> <span class="n">get_process_instance</span><span class="p">(</span>
                <span class="n">process_to_use</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">pipeline</span><span class="o">.</span><span class="n">add_process</span><span class="p">(</span><span class="n">node_name</span><span class="p">,</span> <span class="n">process</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previewBlock</span><span class="o">.</span><span class="n">set_pipeline</span><span class="p">(</span><span class="n">pipeline</span><span class="p">)</span>

        <span class="c1"># Capsul update</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span>
        <span class="c1"># gnode = self.scene.add_node(node_name, node)</span>

        <span class="k">return</span> <span class="n">node</span><span class="p">,</span> <span class="n">node_name</span></div>

<div class="viewcode-block" id="PipelineManagerTab.controller_value_changed"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.PipelineManagerTab.controller_value_changed">[docs]</a>    <span class="k">def</span> <span class="nf">controller_value_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update history when a pipeline node is changed</span>

<span class="sd">        :param signal_list: list of the needed parameters to update history</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">case</span> <span class="o">=</span> <span class="n">signal_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># For history</span>
        <span class="n">history_maker</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">case</span> <span class="o">==</span> <span class="s2">&quot;node_name&quot;</span><span class="p">:</span>
            <span class="n">history_maker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;update_node_name&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">signal_list</span><span class="p">:</span>
                <span class="n">history_maker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">case</span> <span class="o">==</span> <span class="s2">&quot;plug_value&quot;</span><span class="p">:</span>
            <span class="n">history_maker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;update_plug_value&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">signal_list</span><span class="p">:</span>
                <span class="n">history_maker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">undos</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">history_maker</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">redos</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">case</span> <span class="o">==</span> <span class="s2">&quot;plug_value&quot;</span><span class="p">:</span>
            <span class="n">node_name</span> <span class="o">=</span> <span class="n">signal_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">node_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;inputs&#39;</span><span class="p">,</span> <span class="s1">&#39;outputs&#39;</span><span class="p">]:</span>
                <span class="n">node_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="n">case</span> <span class="o">==</span> <span class="s2">&quot;node_name&quot;</span><span class="p">:</span>
            <span class="n">node_name</span> <span class="o">=</span> <span class="n">signal_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nodeController</span><span class="o">.</span><span class="n">update_parameters</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span>
                <span class="n">node_name</span><span class="p">]</span><span class="o">.</span><span class="n">process</span><span class="p">)</span></div>

        <span class="c1"># Cause a segmentation fault</span>
        <span class="c1"># from capsul.qt_gui.widgets.pipeline_developper_view import NodeGWidget</span>
        <span class="c1"># for item in self.pipelineEditorTabs.get_current_editor().scene.items():</span>
        <span class="c1">#     if isinstance(item, NodeGWidget):</span>
        <span class="c1">#         self.pipelineEditorTabs.get_current_editor(</span>
        <span class="c1">#</span>
        <span class="c1">#         ).scene.process_clicked.emit(item.name, item.process)</span>


<div class="viewcode-block" id="PipelineManagerTab.displayNodeParameters"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.PipelineManagerTab.displayNodeParameters">[docs]</a>    <span class="k">def</span> <span class="nf">displayNodeParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">process</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display the node controller when a node is clicked</span>

<span class="sd">        :param node_name: name of the node to display parameters</span>
<span class="sd">        :param process: process instance of the corresponding node</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="n">Switch</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodeController</span><span class="o">.</span><span class="n">display_parameters</span><span class="p">(</span>
                <span class="n">node_name</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scrollArea</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeController</span><span class="p">)</span></div>

<div class="viewcode-block" id="PipelineManagerTab.find_process"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.PipelineManagerTab.find_process">[docs]</a>    <span class="k">def</span> <span class="nf">find_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the dropped process in the system&#39;s paths</span>

<span class="sd">        :param path: class&#39;s path (e.g. &quot;nipype.interfaces.spm.Smooth&quot;) (str)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">package_name</span><span class="p">,</span> <span class="n">process_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">process_name</span> <span class="o">=</span> <span class="n">process_name</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="nb">__import__</span><span class="p">(</span><span class="n">package_name</span><span class="p">)</span>
        <span class="n">pkg</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">package_name</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">instance</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">pkg</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">())):</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">process_name</span> <span class="ow">and</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">instance</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">process</span> <span class="o">=</span> <span class="n">get_process_instance</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">node</span><span class="p">,</span> <span class="n">node_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_process_to_preview</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
                    <span class="n">gnode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previewBlock</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">gnodes</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span>
                    <span class="n">gnode</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">gnode</span><span class="o">.</span><span class="n">updateInfoActived</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="c1"># gnode.active = True</span>
                    <span class="c1"># gnode.update_node()</span>
                    <span class="n">rect</span> <span class="o">=</span> <span class="n">gnode</span><span class="o">.</span><span class="n">sceneBoundingRect</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">previewBlock</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">setSceneRect</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">previewBlock</span><span class="o">.</span><span class="n">fitInView</span><span class="p">(</span>
                        <span class="n">rect</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">rect</span><span class="o">.</span><span class="n">y</span><span class="p">(),</span> <span class="n">rect</span><span class="o">.</span><span class="n">width</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">,</span>
                                            <span class="n">rect</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">,</span>
                        <span class="n">Qt</span><span class="o">.</span><span class="n">KeepAspectRatio</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">previewBlock</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span></div>

<div class="viewcode-block" id="PipelineManagerTab.init_pipeline"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.PipelineManagerTab.init_pipeline">[docs]</a>    <span class="k">def</span> <span class="nf">init_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipeline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pipeline_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the current pipeline of the pipeline editor</span>

<span class="sd">        :param pipeline: not None if this method call a sub-pipeline</span>
<span class="sd">        :param pipeline_name: name of the parent pipeline</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Should we add a progress bar for the initialization?</span>
        <span class="c1"># self.enable_progress_bar = True</span>
        <span class="c1"># if self.enable_progress_bar:</span>
        <span class="c1">#     self.progress = InitProgress(</span>
        <span class="c1">#         self.project, self.pipelineEditorTabs, pipeline)</span>
        <span class="c1">#     self.progress.show()</span>
        <span class="c1">#     self.progress.exec()</span>
        <span class="c1">#</span>
        <span class="c1"># else:</span>
        <span class="n">init_flag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">check_init</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_filename</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;NoName&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
            <span class="s1">&#39;Pipeline &quot;</span><span class="si">{0}</span><span class="s1">&quot; is getting initialized. &#39;</span>
            <span class="s1">&#39;Please wait.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

        <span class="c1"># nodes_requir_issue is a dictionary whose keys are the names of the</span>
        <span class="c1"># nodes and whose values are the compatibility of the requirements of</span>
        <span class="c1"># this node with the current configuration of MIA.</span>
        <span class="c1"># - If no requirement defined in the process:</span>
        <span class="c1">#   nodes_requir_issue[node_name] == &#39;MISSING&#39;</span>
        <span class="c1"># - If requirement does not match the current MIA configuration:</span>
        <span class="c1">#   nodes_requir_issue[node_name] = [NameOfTheThirdPartiesWithProblem]</span>
        <span class="c1"># - If requirement matches the current MIA configuration:</span>
        <span class="c1">#   nodes_requir_issue have no key corresponding to node_name</span>
        <span class="n">nodes_requir_issue</span> <span class="o">=</span><span class="p">{}</span>

        <span class="c1"># nodes_requir_miss == [] if all processes have a defined requirement</span>
        <span class="c1"># object or is a list of node names that do not have a defined</span>
        <span class="c1"># requirement</span>
        <span class="n">nodes_requir_miss</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># nodes_requir_fail == [] if all processes have requirements</span>
        <span class="c1"># corresponding to the current mia configuration or nodes_requir_fail</span>
        <span class="c1"># is a list of node names that requirements do not match the current</span>
        <span class="c1"># mia&#39;s configuration</span>
        <span class="n">nodes_requir_fail</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># nodes_to_check contains the node names that need to be update</span>
        <span class="n">nodes_to_check</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># nodes_inputs_ratio is a dictionary whose keys are the node names</span>
        <span class="c1"># and whose values are a list of two elements: the first one being</span>
        <span class="c1"># the number of activated mandatory input plugs, the second one being</span>
        <span class="c1"># the total number of mandatory input plugs of the corresponding node</span>
        <span class="c1"># nodes_inputs_ratio = OrderedDict()</span>
        <span class="n">nodes_inputs_ratio</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># nodes_inputs_ratio_list contains the ratio between the number of</span>
        <span class="c1"># activated mandatory input plugs and the total number of mandatory</span>
        <span class="c1"># input plugs of the corresponding node (the order is the same as</span>
        <span class="c1"># nodes_to_check)</span>
        <span class="n">nodes_inputs_ratio_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># nodes_prev_init contains the nodes previously initialised</span>
        <span class="n">nodes_prev_init</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># If the initialisation is launch for the main pipeline</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pipeline</span><span class="p">:</span>
            <span class="n">pipeline</span> <span class="o">=</span> <span class="n">get_process_instance</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">())</span>
            <span class="n">main_pipeline</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">main_pipeline</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Test, if it works, comment.</span>
        <span class="c1">#if hasattr(pipeline, &#39;pipeline_steps&#39;):</span>
        <span class="c1">#    pipeline.pipeline_steps.on_trait_change(</span>
        <span class="c1">#        self.pipelineEditorTabs.get_current_editor()._reset_pipeline,</span>
        <span class="c1">#        remove=True)</span>
        <span class="c1">#pipeline.on_trait_change(</span>
        <span class="c1">#    self.pipelineEditorTabs.get_current_editor()._reset_pipeline,</span>
        <span class="c1">#    &#39;selection_changed&#39;, remove=True)</span>
        <span class="c1">#pipeline.on_trait_change(</span>
        <span class="c1">#    self.pipelineEditorTabs.get_current_editor()._reset_pipeline,</span>
        <span class="c1">#    &#39;user_traits_changed&#39;, remove=True)</span>

        <span class="k">for</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Updating the project attribute of the processes</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;process&#39;</span><span class="p">):</span>
                <span class="n">process</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">process</span>

                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="s1">&#39;use_project&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">process</span><span class="o">.</span><span class="n">use_project</span><span class="p">:</span>
                    <span class="n">process</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span>

            <span class="n">nb_plugs_from_in</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">nb_plugs</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">plug_name</span><span class="p">,</span> <span class="n">plug</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                <span class="k">if</span> <span class="p">((</span><span class="n">plug</span><span class="o">.</span><span class="n">links_from</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="p">(</span><span class="ow">not</span> <span class="n">plug</span><span class="o">.</span><span class="n">output</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="p">(</span><span class="ow">not</span> <span class="n">plug</span><span class="o">.</span><span class="n">optional</span><span class="p">)):</span>
                    <span class="n">nb_plugs</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="c1"># If the link comes from the pipeline &quot;global&quot; inputs, it is</span>
                    <span class="c1"># added to compute the ratio</span>
                    <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">plug</span><span class="o">.</span><span class="n">links_from</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">nb_plugs_from_in</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">nb_plugs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ratio</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">ratio</span> <span class="o">=</span> <span class="n">nb_plugs_from_in</span> <span class="o">/</span> <span class="n">nb_plugs</span>

            <span class="n">nodes_to_check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_name</span><span class="p">)</span>
            <span class="n">nodes_inputs_ratio</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">nb_plugs_from_in</span><span class="p">,</span> <span class="n">nb_plugs</span><span class="p">]</span>
            <span class="n">nodes_inputs_ratio_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span>

        <span class="c1"># Sorting the nodes_to_check list as the order (the nodes having</span>
        <span class="c1"># the highest ratio being at the end of the list)</span>
        <span class="n">nodes_to_check</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">nodes_inputs_ratio_list</span><span class="p">,</span>
                                                     <span class="n">nodes_to_check</span><span class="p">))]</span>

        <span class="k">while</span> <span class="n">nodes_to_check</span><span class="p">:</span>
            <span class="c1"># Finding one node that has a ratio of 1, which means that all of</span>
            <span class="c1"># its mandatory inputs plugs are &quot;connected&quot; to the Input node</span>
            <span class="n">key_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">nodes_inputs_ratio</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">]</span>

            <span class="k">if</span> <span class="n">key_name</span><span class="p">:</span>
                <span class="c1"># This node can be initialized so it is placed at the</span>
                <span class="c1"># end of the nodes_to_check list</span>
                <span class="n">nodes_to_check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key_name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                <span class="c1"># It can also be removed from the dictionary</span>
                <span class="k">del</span> <span class="n">nodes_inputs_ratio</span><span class="p">[</span><span class="n">key_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

            <span class="c1"># Reversing the list so that the node to be initialized is</span>
            <span class="c1"># at the first place. Using OrderedDict allows to remove the</span>
            <span class="c1"># duplicate in the list without losing the order. So if</span>
            <span class="c1"># key_name[0] appears twice, it will stay at the first place</span>
            <span class="n">nodes_to_check</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrderedDict</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                                              <span class="n">nodes_to_check</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">node_name</span> <span class="o">=</span> <span class="n">nodes_to_check</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">nodes_to_check</span> <span class="o">=</span> <span class="n">nodes_to_check</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># Inputs/Outputs nodes will be automatically updated with</span>
            <span class="c1"># the method update_nodes_and_plugs_activation of the</span>
            <span class="c1"># pipeline object</span>
            <span class="k">if</span> <span class="n">node_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;inputs&#39;</span><span class="p">,</span> <span class="s1">&#39;outputs&#39;</span><span class="p">]:</span>
                <span class="k">continue</span>

            <span class="c1"># If the node is a pipeline node,</span>
            <span class="c1"># each of its nodes has to be initialised</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">PipelineNode</span><span class="p">):</span>
                <span class="n">sub_pipeline</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">process</span>
                <span class="n">init_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_pipeline</span><span class="p">(</span><span class="n">sub_pipeline</span><span class="p">,</span> <span class="n">node_name</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">plug_name</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

                    <span class="c1"># If the plug is an output and is</span>
                    <span class="c1"># connected to another one</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="n">plug_name</span><span class="p">],</span> <span class="s1">&#39;links_to&#39;</span><span class="p">):</span>
                        <span class="n">list_info_link</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                            <span class="n">node</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="n">plug_name</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">)</span>

                        <span class="k">for</span> <span class="n">info_link</span> <span class="ow">in</span> <span class="n">list_info_link</span><span class="p">:</span>

                            <span class="c1"># The third element of info_link contains the</span>
                            <span class="c1"># destination node object</span>
                            <span class="k">if</span> <span class="n">info_link</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                                <span class="n">dest_node_name</span> <span class="o">=</span> <span class="n">info_link</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                                <span class="k">if</span> <span class="n">dest_node_name</span><span class="p">:</span>
                                    <span class="c1"># Adding the destination node name and</span>
                                    <span class="c1"># incrementing the input counter of the</span>
                                    <span class="c1"># latter if it is not the pipeline</span>
                                    <span class="c1"># &quot;global&quot; outputs (&#39;&#39;)</span>
                                    <span class="n">nodes_to_check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dest_node_name</span><span class="p">)</span>
                                    <span class="n">nodes_inputs_ratio</span><span class="p">[</span><span class="n">dest_node_name</span><span class="p">][</span>
                                        <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">pipeline</span><span class="o">.</span><span class="n">update_nodes_and_plugs_activation</span><span class="p">()</span>
                <span class="k">continue</span>

            <span class="c1"># Adding the brick to the bricks history</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">brick_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">brick_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brick_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_document</span><span class="p">(</span><span class="n">COLLECTION_BRICK</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">brick_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                <span class="n">COLLECTION_BRICK</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">brick_id</span><span class="p">,</span> <span class="n">BRICK_NAME</span><span class="p">,</span> <span class="n">node_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                <span class="n">COLLECTION_BRICK</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">brick_id</span><span class="p">,</span> <span class="n">BRICK_INIT_TIME</span><span class="p">,</span>
                <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                <span class="n">COLLECTION_BRICK</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">brick_id</span><span class="p">,</span> <span class="n">BRICK_INIT</span><span class="p">,</span> <span class="s2">&quot;Not Done&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">saveModifications</span><span class="p">()</span>

            <span class="n">process</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">process</span>
            <span class="n">process_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">process</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>

            <span class="k">if</span> <span class="n">process_name</span> <span class="o">!=</span> <span class="s2">&quot;capsul&quot;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Updating the launching parameters for the </span><span class="si">{0}</span><span class="s1"> &#39;</span>
                      <span class="s1">&#39;process node: </span><span class="si">{1}</span><span class="s1"> ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">process_name</span><span class="p">,</span>
                                                       <span class="n">node_name</span><span class="p">))</span>

            <span class="c1"># TODO &#39;except&#39; instead of &#39;if&#39; to test matlab launch ?</span>
            <span class="c1"># Test for matlab launch</span>
            <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">get_use_spm_standalone</span><span class="p">():</span>
                <span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">use_mcr</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_spm_standalone_path</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">matlab_cmd</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_matlab_command</span><span class="p">()</span>

            <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">get_use_spm</span><span class="p">():</span>
                <span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">use_mcr</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_spm_path</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">matlab_cmd</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_matlab_command</span><span class="p">()</span>

            <span class="c1"># Test for matlab launch</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;scripts&#39;</span><span class="p">)):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;scripts&#39;</span><span class="p">))</span>

            <span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">output_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;scripts&#39;</span><span class="p">)</span>
            <span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">mfile</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># Getting the inheritance_dict, the requirement (dict) and the node</span>
            <span class="c1"># outputs list according to its inputs: initResult_dic.</span>
            <span class="c1"># - initResult_dic[&#39;requirement&#39;]:</span>
            <span class="c1"># the requirement for the process (list)</span>
            <span class="c1"># - initResult_dic[&#39;outputs&#39;]:</span>
            <span class="c1"># a dictionary whose keys are the output plugs name and whose keys</span>
            <span class="c1"># are the correponding value</span>
            <span class="c1"># - initResult_dic[&#39;inheritance_dict&#39;]:</span>
            <span class="c1"># a dictionary whose keys are the names of the scans in the output</span>
            <span class="c1"># plugs and whose values are the names of the scans in the input</span>
            <span class="c1"># plugs from that the output scans will inherit the tags</span>
            <span class="n">initResult_dict</span> <span class="o">=</span> <span class="p">{}</span>



            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># The state, linked or not, of the plugs is passed to the</span>
                <span class="c1"># list_outputs method, only for nodes not coming from nipype</span>
                <span class="c1"># (so those coming from mia_processes and those created</span>
                <span class="c1"># by the user): is_plugged object.</span>
                <span class="n">is_plugged</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">plug</span><span class="o">.</span><span class="n">links_to</span><span class="p">)</span>
                                    <span class="ow">or</span> <span class="nb">bool</span><span class="p">(</span><span class="n">plug</span><span class="o">.</span><span class="n">links_from</span><span class="p">))</span>
                                            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">plug</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                <span class="n">initResult_dict</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">(</span><span class="n">is_plugged</span><span class="o">=</span><span class="n">is_plugged</span><span class="p">)</span>

                <span class="c1"># For debugging. To be commented if not in debugging.</span>
                <span class="c1">#print(&#39;initResult_dict after mia brick initialisaton: &#39;,  initResult_dict)</span>

                <span class="k">try</span><span class="p">:</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">initResult_dict</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">]:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Initialisation failed to determine the &quot;</span>
                               <span class="s2">&quot;outputs for the process </span><span class="si">{0}</span><span class="s2">, did you correctly &quot;</span>
                               <span class="s2">&quot;define the inputs ...?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node_name</span><span class="p">))</span>
                        <span class="n">check_init</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">check_init</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Due to &quot;</span><span class="si">{0}</span><span class="s1">&quot; error,</span><span class="se">\n</span><span class="s1">the initialisation failed to &#39;</span>
                          <span class="s1">&#39;determine the outputs for the node &#39;</span>
                          <span class="s1">&#39;</span><span class="si">{1}</span><span class="s1">...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">node_name</span><span class="p">))</span>
                    <span class="n">check_init</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">The outputs determination for the node &quot;</span><span class="si">{0}</span><span class="s1">&quot; &#39;</span>
                          <span class="s1">&#39;failed during the initialisation step, due to:</span><span class="se">\n</span><span class="s1">&#39;</span>
                          <span class="s1">&#39;&quot;</span><span class="si">{1}</span><span class="s1">&quot;...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node_name</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
                    <span class="n">check_init</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">except</span> <span class="n">TraitError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Trait error for node &quot;</span><span class="si">{0}</span><span class="s1">&quot;:</span><span class="se">\n</span><span class="s1">&#39;</span>
                      <span class="s1">&#39;&quot;</span><span class="si">{1}</span><span class="s1">&quot; ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node_name</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
                <span class="n">check_init</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># If the process has no &quot;list_outputs&quot; method,</span>
            <span class="c1"># which is the case for Nipype&#39;s</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># The Nipype Process outputs are always</span>
                    <span class="c1"># &quot;private&quot; for Capsul</span>
                    <span class="n">initResult_dict</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">process</span><span class="o">.</span><span class="n">_nipype_interface</span>
                                                  <span class="o">.</span><span class="n">_list_outputs</span><span class="p">())</span>
                    <span class="n">tmp_dict</span> <span class="o">=</span> <span class="p">{}</span>

                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">initResult_dict</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">tmp_dict</span><span class="p">[</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">initResult_dict</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>

                    <span class="n">initResult_dict</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_dict</span>

                    <span class="c1"># For debugging. To be commented if not in debugging.</span>
                    <span class="c1">#print(&#39;initResult_dict after nipype brick initialisaton: &#39;,  initResult_dict)</span>

                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Initialisation failed to determine the outputs &#39;</span>
                          <span class="s1">&#39;for the process &quot;</span><span class="si">{0}</span><span class="s1">&quot;:</span><span class="se">\n</span><span class="s1">Did you correctly defined &#39;</span>
                          <span class="s1">&#39;the inputs ...?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node_name</span><span class="p">))</span>
                    <span class="n">check_init</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Initialisation failed to determine the outputs &#39;</span>
                          <span class="s1">&#39;for the process &quot;</span><span class="si">{0}</span><span class="s1">&quot;, due to:</span><span class="se">\n</span><span class="s1">&#39;</span>
                          <span class="s1">&#39;&quot;</span><span class="si">{1}</span><span class="s1">&quot;...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node_name</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
                    <span class="n">check_init</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># Management of the requirement object in initResult_dict</span>
            <span class="k">if</span> <span class="s1">&#39;_nipype_interface&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">process</span><span class="p">):</span>

                <span class="k">if</span> <span class="s1">&#39;spm&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">process</span><span class="o">.</span><span class="n">_nipype_interface</span><span class="p">):</span>

                    <span class="k">if</span> <span class="s1">&#39;requirement&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">initResult_dict</span><span class="p">:</span>
                        <span class="n">initResult_dict</span><span class="p">[</span><span class="s1">&#39;requirement&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MATLAB&#39;</span><span class="p">,</span> <span class="s1">&#39;SPM&#39;</span><span class="p">]</span>

                <span class="k">elif</span> <span class="s1">&#39;requirement&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">initResult_dict</span><span class="p">:</span>
                    <span class="n">initResult_dict</span><span class="p">[</span><span class="s1">&#39;requirement&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="n">initResult_dict</span><span class="p">[</span><span class="s1">&#39;requirement&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">initResult_dict</span><span class="p">[</span><span class="s1">&#39;requirement&#39;</span><span class="p">]):</span>

                    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;MATLAB&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>  <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                        <span class="n">initResult_dict</span><span class="p">[</span><span class="s1">&#39;requirement&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;MATLAB&#39;</span>

                    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;SPM&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>  <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                        <span class="n">initResult_dict</span><span class="p">[</span><span class="s1">&#39;requirement&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SPM&#39;</span>

            <span class="c1"># Management of the outputs and the inheritance_dict objects</span>
            <span class="c1"># in the initResult_dict</span>
            <span class="k">if</span> <span class="s1">&#39;outputs&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">initResult_dict</span><span class="p">:</span>
                    <span class="n">initResult_dict</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">inheritance_dict</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;inheritance_dict&#39;</span> <span class="ow">in</span> <span class="n">initResult_dict</span> <span class="ow">and</span>
                <span class="n">initResult_dict</span><span class="p">[</span><span class="s1">&#39;inheritance_dict&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="p">{}):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inheritance_dict</span> <span class="o">=</span> <span class="n">initResult_dict</span><span class="p">[</span><span class="s1">&#39;inheritance_dict&#39;</span><span class="p">]</span>

            <span class="c1"># Here, third-party softwares are managed according to the</span>
            <span class="c1"># requirement defined in the bricks.</span>
            <span class="c1"># Third-party software currently managed:</span>
            <span class="c1"># Matlab - SPM - ...</span>
            <span class="k">if</span> <span class="n">initResult_dict</span><span class="p">[</span><span class="s1">&#39;requirement&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">nodes_requir_issue</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;MISSING&#39;</span>

            <span class="k">elif</span> <span class="n">initResult_dict</span><span class="p">[</span><span class="s1">&#39;requirement&#39;</span><span class="p">]:</span>

                <span class="k">if</span> <span class="p">((</span><span class="s1">&#39;MATLAB&#39;</span> <span class="ow">in</span> <span class="n">initResult_dict</span><span class="p">[</span><span class="s1">&#39;requirement&#39;</span><span class="p">])</span> <span class="ow">and</span>
                    <span class="p">(</span><span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">get_use_matlab</span><span class="p">())):</span>
                    <span class="n">nodes_requir_issue</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">node_name</span><span class="p">,</span>
                                                  <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;MATLAB&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="p">((</span><span class="s1">&#39;SPM&#39;</span> <span class="ow">in</span> <span class="n">initResult_dict</span><span class="p">[</span><span class="s1">&#39;requirement&#39;</span><span class="p">])</span> <span class="ow">and</span>
                    <span class="p">((</span><span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">get_use_spm</span><span class="p">())</span> <span class="ow">and</span>
                     <span class="p">(</span><span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">get_use_spm_standalone</span><span class="p">()))):</span>
                    <span class="n">nodes_requir_issue</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">node_name</span><span class="p">,</span>
                                                  <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;SPM&#39;</span><span class="p">)</span>

            <span class="c1"># Adding I/O to database history</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">get_inputs</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">inputs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Undefined</span><span class="p">,</span> <span class="p">[</span><span class="n">Undefined</span><span class="p">]]:</span>
                    <span class="n">inputs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&lt;undefined&gt;&quot;</span>

            <span class="c1"># Automatically fills few plugs. Only for the nipype process</span>
            <span class="k">if</span> <span class="s1">&#39;NipypeProcess&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">process</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Updating the launching parameters for the nipype &#39;</span>
                      <span class="s1">&#39;process node: </span><span class="si">{0}</span><span class="s1"> ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node_name</span><span class="p">))</span>
                <span class="c1"># plugs to be filled automatically</span>
                <span class="n">keys2consider</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;use_mcr&#39;</span><span class="p">,</span> <span class="s1">&#39;paths&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;matlab_cmd&#39;</span><span class="p">,</span> <span class="s1">&#39;output_directory&#39;</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>

                    <span class="c1"># use_mcr parameter</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="n">keys2consider</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span>
                            <span class="n">config</span><span class="o">.</span><span class="n">get_use_spm_standalone</span><span class="p">()):</span>
                        <span class="n">inputs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="k">elif</span> <span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="n">keys2consider</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span>
                            <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">get_use_spm_standalone</span><span class="p">()):</span>
                        <span class="n">inputs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

                    <span class="c1"># paths parameter</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="n">keys2consider</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span>
                            <span class="n">config</span><span class="o">.</span><span class="n">get_use_spm_standalone</span><span class="p">()):</span>
                        <span class="n">inputs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_spm_standalone_path</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

                    <span class="k">elif</span> <span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="n">keys2consider</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_use_spm</span><span class="p">()):</span>
                        <span class="n">inputs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_spm_path</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

                    <span class="c1"># matlab_cmd parameter</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="n">keys2consider</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span>
                            <span class="n">config</span><span class="o">.</span><span class="n">get_use_spm_standalone</span><span class="p">()):</span>
                        <span class="n">inputs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_matlab_command</span><span class="p">()</span>

                    <span class="k">elif</span> <span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="n">keys2consider</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span>
                            <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">get_use_spm_standalone</span><span class="p">()):</span>
                        <span class="n">inputs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_matlab_path</span><span class="p">()</span>

                    <span class="c1"># output_directory parameter</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">keys2consider</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>

                        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/scripts&#39;</span><span class="p">)):</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span>
                                                     <span class="o">+</span> <span class="s1">&#39;/scripts&#39;</span><span class="p">))</span>

                        <span class="n">inputs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span>
                                                      <span class="o">+</span> <span class="s1">&#39;/scripts&#39;</span><span class="p">)</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">node</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">inputs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

                    <span class="k">except</span> <span class="n">TraitError</span><span class="p">:</span>

                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span>
                                <span class="n">inputs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span>
                                    <span class="n">key</span><span class="p">,</span> <span class="n">inputs</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

                            <span class="k">except</span> <span class="n">TraitError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Trait error for the &quot;</span><span class="si">{0}</span><span class="s1">&quot; plug (</span><span class="si">{1}</span><span class="s1">):</span><span class="se">\n</span><span class="s1">&#39;</span>
                                      <span class="s1">&#39;</span><span class="si">{2}</span><span class="s1"> ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">inputs</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">e</span><span class="p">))</span>

            <span class="n">outputs</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">get_outputs</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Undefined</span><span class="p">,</span> <span class="p">[</span><span class="n">Undefined</span><span class="p">]]:</span>
                    <span class="n">outputs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&lt;undefined&gt;&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">saveModifications</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">COLLECTION_BRICK</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">brick_id</span><span class="p">,</span>
                                           <span class="n">BRICK_INPUTS</span><span class="p">,</span> <span class="n">inputs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">COLLECTION_BRICK</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">brick_id</span><span class="p">,</span>
                                           <span class="n">BRICK_OUTPUTS</span><span class="p">,</span> <span class="n">outputs</span><span class="p">)</span>

            <span class="c1"># Updating the database with output values obtained from</span>
            <span class="c1"># initialisation. If a plug name is in</span>
            <span class="c1"># initResult_dict[&#39;outputs&#39;][&#39;notInDb&#39;], then the corresponding</span>
            <span class="c1"># output value is not added to the database.</span>
            <span class="k">if</span> <span class="n">initResult_dict</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">]:</span>

                <span class="k">for</span> <span class="n">plug_name</span><span class="p">,</span> <span class="n">plug_value</span> <span class="ow">in</span> <span class="n">initResult_dict</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">add_plug_value_flag</span> <span class="o">=</span> <span class="kc">False</span>

                    <span class="k">if</span> <span class="n">plug_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">continue</span>

                    <span class="k">if</span> <span class="n">plug_value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&lt;undefined&gt;&quot;</span><span class="p">,</span> <span class="n">Undefined</span><span class="p">,</span> <span class="p">[</span><span class="n">Undefined</span><span class="p">]]:</span>
                        <span class="n">nodes_prev_init</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_name</span><span class="p">)</span>
                        <span class="n">nodes_prev_init</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">nodes_prev_init</span><span class="p">))</span>

                        <span class="k">if</span> <span class="n">pipeline_name</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                            <span class="n">full_name</span> <span class="o">=</span> <span class="n">pipeline_name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">node_name</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">full_name</span> <span class="o">=</span> <span class="n">node_name</span>

                        <span class="k">if</span> <span class="s1">&#39;notInDb&#39;</span> <span class="ow">in</span> <span class="n">initResult_dict</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">]:</span>

                            <span class="k">if</span> <span class="n">plug_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">initResult_dict</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">][</span><span class="s1">&#39;notInDb&#39;</span><span class="p">]:</span>
                                <span class="n">add_plug_value_flag</span> <span class="o">=</span> <span class="kc">True</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">add_plug_value_flag</span> <span class="o">=</span> <span class="kc">True</span>

                        <span class="k">if</span> <span class="n">add_plug_value_flag</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">add_plug_value_to_database</span><span class="p">(</span><span class="n">plug_value</span><span class="p">,</span>
                                                            <span class="bp">self</span><span class="o">.</span><span class="n">brick_id</span><span class="p">,</span>
                                                            <span class="n">node_name</span><span class="p">,</span>
                                                            <span class="n">plug_name</span><span class="p">,</span>
                                                            <span class="n">full_name</span><span class="p">)</span>

                    <span class="n">list_info_link</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="n">plug_name</span><span class="p">]</span><span class="o">.</span><span class="n">links_to</span><span class="p">)</span>

                    <span class="c1"># If the output is connected to another node,</span>
                    <span class="c1"># the latter is added to nodes_to_check</span>
                    <span class="k">for</span> <span class="n">info_link</span> <span class="ow">in</span> <span class="n">list_info_link</span><span class="p">:</span>
                        <span class="n">dest_node_name</span> <span class="o">=</span> <span class="n">info_link</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                        <span class="k">if</span> <span class="n">dest_node_name</span> <span class="ow">and</span> <span class="n">dest_node_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes_prev_init</span><span class="p">:</span>
                            <span class="c1"># Adding the destination node name and incrementing</span>
                            <span class="c1"># the input counter of the latter</span>
                            <span class="n">nodes_to_check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dest_node_name</span><span class="p">)</span>

                            <span class="k">if</span> <span class="n">dest_node_name</span> <span class="ow">in</span> <span class="n">nodes_inputs_ratio</span><span class="p">:</span>
                                <span class="n">nodes_inputs_ratio</span><span class="p">[</span><span class="n">dest_node_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">node</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="n">plug_name</span><span class="p">,</span> <span class="n">plug_value</span><span class="p">)</span>

                    <span class="k">except</span> <span class="n">TraitError</span><span class="p">:</span>

                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">plug_value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span>
                                <span class="n">plug_value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">node</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="n">plug_name</span><span class="p">,</span> <span class="n">plug_value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                            <span class="k">except</span> <span class="n">TraitError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Trait error for the &quot;</span><span class="si">{0}</span><span class="s1">&quot; plug of the &#39;</span>
                                      <span class="s1">&#39;&quot;</span><span class="si">{1}</span><span class="s1">&quot; node:</span><span class="se">\n</span><span class="s1">&#39;</span>
                                      <span class="s1">&#39;</span><span class="si">{2}</span><span class="s1"> ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plug_name</span><span class="p">,</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

                    <span class="n">pipeline</span><span class="o">.</span><span class="n">update_nodes_and_plugs_activation</span><span class="p">()</span>

            <span class="c1"># Adding I/O to database history again to update outputs</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">get_inputs</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Undefined</span><span class="p">,</span> <span class="p">[</span><span class="n">Undefined</span><span class="p">]]:</span>
                    <span class="n">inputs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&lt;undefined&gt;&quot;</span>

            <span class="n">outputs</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">get_outputs</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Undefined</span><span class="p">,</span> <span class="p">[</span><span class="n">Undefined</span><span class="p">]]:</span>
                    <span class="n">outputs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&lt;undefined&gt;&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">COLLECTION_BRICK</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">brick_id</span><span class="p">,</span>
                                           <span class="n">BRICK_INPUTS</span><span class="p">,</span> <span class="n">inputs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">COLLECTION_BRICK</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">brick_id</span><span class="p">,</span>
                                           <span class="n">BRICK_OUTPUTS</span><span class="p">,</span> <span class="n">outputs</span><span class="p">)</span>
            <span class="c1"># Setting brick init state if init finished correctly</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">COLLECTION_BRICK</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">brick_id</span><span class="p">,</span>
                                           <span class="n">BRICK_INIT</span><span class="p">,</span> <span class="s2">&quot;Done&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">saveModifications</span><span class="p">()</span>

        <span class="c1"># Test, if it works, comment.</span>
        <span class="c1">#pipeline.on_trait_change(</span>
        <span class="c1">#    self.pipelineEditorTabs.get_current_editor()._reset_pipeline,</span>
        <span class="c1">#    &#39;selection_changed&#39;, dispatch=&#39;ui&#39;)</span>
        <span class="c1">#pipeline.on_trait_change(</span>
        <span class="c1">#    self.pipelineEditorTabs.get_current_editor()._reset_pipeline,</span>
        <span class="c1">#    &#39;user_traits_changed&#39;, dispatch=&#39;ui&#39;)</span>
        <span class="c1">#if hasattr(pipeline, &#39;pipeline_steps&#39;):</span>
        <span class="c1">#    pipeline.pipeline_steps.on_trait_change(</span>
        <span class="c1">#        self.pipelineEditorTabs.get_current_editor()._reset_pipeline,</span>
        <span class="c1">#        dispatch=&#39;ui&#39;)</span>

        <span class="c1"># Updating the node controller</span>
        <span class="c1"># Display the updated parameters in right part of</span>
        <span class="c1"># the Pipeline Manager (controller)</span>
        <span class="k">if</span> <span class="n">main_pipeline</span><span class="p">:</span>
            <span class="n">node_controller_node_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeController</span><span class="o">.</span><span class="n">node_name</span>
            <span class="c1">#### Todo: Fix the problem of the controller that</span>
            <span class="c1">#### keeps the name of the old brick deleted until</span>
            <span class="c1">#### a click on the new one. This can cause a mia</span>
            <span class="c1">#### crash during the initialisation, for example.</span>

            <span class="k">if</span> <span class="n">node_controller_node_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;inputs&#39;</span><span class="p">,</span> <span class="s1">&#39;outputs&#39;</span><span class="p">]:</span>
                <span class="n">node_controller_node_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">nodeController</span><span class="o">.</span><span class="n">display_parameters</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodeController</span><span class="o">.</span><span class="n">node_name</span><span class="p">,</span>
                <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_controller_node_name</span><span class="p">]</span><span class="o">.</span><span class="n">process</span><span class="p">,</span>
                <span class="n">pipeline</span><span class="p">)</span>

        <span class="n">nodes_requir_miss</span> <span class="o">=</span> <span class="p">[</span><span class="n">nodeName</span> <span class="k">for</span> <span class="n">nodeName</span> <span class="ow">in</span> <span class="n">nodes_requir_issue</span>
                             <span class="k">if</span> <span class="n">nodes_requir_issue</span><span class="p">[</span><span class="n">nodeName</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;MISSING&#39;</span><span class="p">]</span>
        <span class="n">nodes_requir_fail</span> <span class="o">=</span> <span class="p">[</span><span class="n">nodeName</span> <span class="k">for</span> <span class="n">nodeName</span> <span class="ow">in</span> <span class="n">nodes_requir_issue</span>
                             <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nodes_requir_issue</span><span class="p">[</span><span class="n">nodeName</span><span class="p">],</span> <span class="nb">list</span><span class="p">)]</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">nodes_requir_miss</span> <span class="ow">or</span> <span class="n">nodes_requir_fail</span><span class="p">)</span> <span class="ow">and</span>
            <span class="ow">not</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_use_matlab</span><span class="p">()</span> <span class="ow">and</span>
                <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_use_spm</span><span class="p">()</span> <span class="ow">or</span> <span class="n">config</span><span class="o">.</span><span class="n">get_use_spm_standalone</span><span class="p">()))):</span>
            <span class="n">init_flag</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="p">((</span><span class="n">config</span><span class="o">.</span><span class="n">get_use_matlab</span><span class="p">())</span> <span class="ow">and</span>
                <span class="p">(</span><span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">get_use_matlab_standalone</span><span class="p">())):</span>

                <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">get_use_spm</span><span class="p">():</span>
                    <span class="n">message_conf</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;The current MIA configuration uses &quot;</span>
                                    <span class="s2">&quot;Matlab and SPM.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">message_conf</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;The current MIA configuration uses &quot;</span>
                                    <span class="s2">&quot;Matlab but not SPM.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="p">((</span><span class="n">config</span><span class="o">.</span><span class="n">get_use_matlab</span><span class="p">())</span> <span class="ow">and</span>
                  <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_use_matlab_standalone</span><span class="p">())):</span>

                <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">get_use_spm_standalone</span><span class="p">():</span>
                    <span class="n">message_conf</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;The current MIA configuration uses Matlab &quot;</span>
                                    <span class="s2">&quot;Compiler Runtime and SPM standalone.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">message_conf</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;The current MIA configuration uses Matlab &quot;</span>
                                    <span class="s2">&quot;Compiler Runtime but not SPM standalone.&quot;</span>
                                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">get_use_matlab</span><span class="p">():</span>
                <span class="n">message_conf</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;The current MIA configuration does not use &quot;</span>
                                <span class="s2">&quot;Matlab (including the Compiler Runtime &quot;</span>
                                <span class="s2">&quot;version) or SPM (including the standalone &quot;</span>
                                <span class="s2">&quot;version).</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">message_base1</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="k">if</span> <span class="n">nodes_requir_miss</span><span class="p">:</span> <span class="c1"># So, initResult_dict[&#39;requirement&#39;] is None</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes_requir_miss</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">message_base1</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">90</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">The required third-party &#39;</span>
                                     <span class="s1">&#39;products are not properly defined in the &#39;</span>
                                     <span class="s1">&#39;following process:</span><span class="se">\n</span><span class="s1">- </span><span class="si">{0}</span><span class="se">\n</span><span class="s1">&#39;</span>
                                     <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nodes_requir_miss</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">message_base1</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">90</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">The required third-party &#39;</span>
                                     <span class="s1">&#39;products are not properly defined in the &#39;</span>
                                     <span class="s1">&#39;following processes:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">nodeName</span> <span class="ow">in</span> <span class="n">nodes_requir_miss</span><span class="p">:</span>
                        <span class="n">message_base1</span> <span class="o">=</span> <span class="n">message_base1</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;- </span><span class="si">{0}</span><span class="se">\n</span><span class="s2">&quot;</span>
                                                         <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nodeName</span><span class="p">))</span>

                <span class="n">message_end</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Please, update your configuration in the MIA &#39;</span>
                               <span class="s1">&#39;preferences, if necessary ...&#39;</span><span class="p">)</span>

            <span class="n">mess_base2</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="k">if</span> <span class="n">nodes_requir_fail</span><span class="p">:</span>
                <span class="n">message_end</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Please, update your configuration in the MIA &#39;</span>
                               <span class="s1">&#39;preferences to meet the requirements of &#39;</span>
                               <span class="s1">&#39;the pipeline ...&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">nodes_requir_miss</span><span class="p">:</span>
                    <span class="n">mess_base2</span> <span class="o">=</span>  <span class="n">mess_base2</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">90</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">The &#39;</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mess_base2</span> <span class="o">=</span>  <span class="n">mess_base2</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">In addition, the &#39;</span>

                <span class="n">mess_base2</span> <span class="o">=</span>  <span class="n">mess_base2</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;following bricks have &#39;</span>
                                            <span class="s1">&#39;requirements that do not &#39;</span>
                                            <span class="s1">&#39;correspond to the current MIA &#39;</span>
                                            <span class="s1">&#39;configuration (problematic third-&#39;</span>
                                            <span class="s1">&#39;party software(s) is(are) &#39;</span>
                                            <span class="s1">&#39;specified):</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">nodeName</span> <span class="ow">in</span> <span class="n">nodes_requir_fail</span><span class="p">:</span>
                    <span class="n">mess_base2</span> <span class="o">=</span> <span class="n">mess_base2</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;- </span><span class="si">{0}</span><span class="s1">: </span><span class="si">{1}</span><span class="se">\n</span><span class="s1">&#39;</span>
                                               <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nodeName</span><span class="p">,</span>
                                                       <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                                           <span class="n">nodes_requir_issue</span><span class="p">[</span>
                                                               <span class="n">nodeName</span><span class="p">])))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Critical</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;MIA configuration warning!&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">message_conf</span> <span class="o">+</span> <span class="n">message_base1</span> <span class="o">+</span>
                             <span class="n">mess_base2</span> <span class="o">+</span> <span class="n">message_end</span><span class="p">)</span>

            <span class="n">yes_button</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="s2">&quot;Open MIA preferences&quot;</span><span class="p">,</span>
                                            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">YesRole</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">nodes_requir_miss</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">nodes_requir_fail</span><span class="p">):</span>
                <span class="n">ok_button</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">clickedButton</span><span class="p">()</span> <span class="o">==</span> <span class="n">yes_button</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">software_preferences_pop_up</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">nodes_requir_fail</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
                <span class="s1">&#39;Pipeline &quot;</span><span class="si">{0}</span><span class="s1">&quot; was not initialised successfully.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
                    <span class="s1">&#39;The pipeline &quot;</span><span class="si">{0}</span><span class="s1">&quot; has been initialised, but the &#39;</span>
                    <span class="s1">&#39;requirements of some bricks must be verified.&#39;</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

        <span class="k">elif</span> <span class="nb">sum</span><span class="p">(</span><span class="n">check_init</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">check_init</span><span class="p">)</span> <span class="ow">or</span> <span class="n">init_flag</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
                <span class="s1">&#39;Pipeline &quot;</span><span class="si">{0}</span><span class="s1">&quot; was not initialised successfully.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">name</span><span class="p">))</span>
            <span class="n">init_flag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">init_flag</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">main_pipeline</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_editor_by_index</span><span class="p">(</span>
                        <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">initialized</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">initialized</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
                <span class="s1">&#39;Pipeline &quot;</span><span class="si">{0}</span><span class="s1">&quot; has been initialised.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">init_flag</span></div>

<div class="viewcode-block" id="PipelineManagerTab.initialize"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.PipelineManagerTab.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clean previous initialization then initialize the current</span>
<span class="sd">        pipeline.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_clicked</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">brick</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">brick_list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">data_browser</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">delete_from_brick</span><span class="p">(</span>
                    <span class="n">brick</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ignore_node</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test_init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_pipeline</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_filename</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;NoName&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Error during initialisation of the &quot;</span><span class="si">{0}</span><span class="s1">&quot; pipeline &#39;</span>
                  <span class="s1">&#39;...!</span><span class="se">\n</span><span class="s1">Traceback:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_tb</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">__traceback__</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">: </span><span class="si">{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test_init</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
                <span class="s1">&#39;Pipeline &quot;</span><span class="si">{0}</span><span class="s1">&quot; was not initialised successfully.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">name</span><span class="p">))</span>

        <span class="c1"># If the initialization fail, the run pipeline action is disabled</span>
        <span class="c1"># The run pipeline action is enabled only when an initialization is</span>
        <span class="c1"># successful or the iterate pipeline checkbox is checked</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_init</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterationTable</span><span class="o">.</span><span class="n">check_box_iterate</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_pipeline_action</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_pipeline_action</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># When clicking on the Pipeline &gt; Initialize</span>
        <span class="c1"># pipeline in the Pipeline Manager tab,</span>
        <span class="c1"># this is the first method launched.</span>

        <span class="c1"># ** pathway from the self.init_pipeline() command (ex. for the</span>
        <span class="c1">#    User_processes Smooth brick):</span>
        <span class="c1">#      info1: self is a populse_mia.user_interface.pipeline_manager</span>
        <span class="c1">#             .pipeline_manager_tab.PipelineManagerTab object</span>
        <span class="c1">#</span>
        <span class="c1"># ** populse_mia/user_interface/pipeline_manager/pipeline_manager_tab.py</span>
        <span class="c1">#    class PipelineManagerTab(QWidget):</span>
        <span class="c1">#    method init_pipeline(self, pipeline=None, pipeline_name=&quot;&quot;):</span>
        <span class="c1">#      use: initResult_dict = process.list_outputs(</span>
        <span class="c1">#                                                 is_plugged=is_plugged)</span>
        <span class="c1">#      info1: process is the brick (node, process, etc.)</span>
        <span class="c1">#             &lt;User_processes.preprocess.spm.spatial_preprocessing</span>
        <span class="c1">#             .Smooth object at ...&gt; object</span>

        <span class="c1"># ** User_processes/preprocess/spm/spatial_preprocessing.py</span>
        <span class="c1">#    class Smooth(Process_Mia)</span>
        <span class="c1">#    list_outputs method:</span>
        <span class="c1">#      use: super(Smooth, self).list_outputs(). Using the inheritance</span>
        <span class="c1">#           to ProcessMIA class, list_outputs method.</span>
        <span class="c1">#      info1: here we are in the place where we deal with plugs.</span>
        <span class="c1">#</span>
        <span class="c1">#** Some characteristics for the pipeline object</span>
        <span class="c1">#   (for User_processes Smooth brick):</span>
        <span class="c1">#       pipeline is a capsul.pipeline.pipeline.Pipeline object</span>
        <span class="c1">#       pipeline.nodes is a dictionary</span>
        <span class="c1">#       pipeline.nodes[&quot;smooth1&quot;] is a capsul.pipeline.pipeline_nodes</span>
        <span class="c1">#         .ProcessNode object</span>
        <span class="c1">#       pipeline.nodes[&quot;smooth1&quot;].plugs is a dictionary. Each key is a</span>
        <span class="c1">#         plug displayed in the Pipeline manager tab</span>
        <span class="c1">#       pipeline.nodes[&quot;smooth1&quot;].plugs[&quot;fwhm&quot;] is a capsul.pipeline</span>
        <span class="c1">#         .pipeline_nodes.Plug object</span>
        <span class="c1">#       If the plus is not connected,  pipeline.nodes[&quot;smooth1&quot;]</span>
        <span class="c1">#         .plugs[&quot;fwhm&quot;].links_to (in case of output link) : set()</span>
        <span class="c1">#       If the plus is connected,  pipeline.nodes[&quot;smooth1&quot;]</span>
        <span class="c1">#         .plugs[&quot;fwhm&quot;].links_to (in case of output link):</span>
        <span class="c1">#         {(&#39;&#39;, &#39;fwhm&#39;, &lt;capsul.pipeline.pipeline_nodes.PipelineNode</span>
        <span class="c1">#         object at 0x7f4688109c50&gt;, &lt;capsul.pipeline.pipeline_nodes</span>
        <span class="c1">#         .Plug object at 0x7f46691e4888&gt;, False)}</span>
        <span class="c1">#       So, it is possble to check if the plug is connected with:</span>
        <span class="c1">#         if pipeline.nodes[&quot;smooth1&quot;].plugs[&quot;fwhm&quot;].links_to: etc ...</span>
        <span class="c1">#         or a  if pipeline.nodes[&quot;smooth1&quot;].plugs[&quot;fwhm&quot;].links_from:</span>
        <span class="c1">#         etc ...</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_clicked</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">update_current_node</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">node_parameters</span> \
            <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">(</span>
        <span class="p">)</span><span class="o">.</span><span class="n">node_parameters_tmp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">update_current_node</span><span class="p">()</span></div>

<div class="viewcode-block" id="PipelineManagerTab.layout_view"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.PipelineManagerTab.layout_view">[docs]</a>    <span class="k">def</span> <span class="nf">layout_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize layout for the pipeline manager tab&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Diagram editor&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scrollArea</span><span class="o">.</span><span class="n">setWidgetResizable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scrollArea</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeController</span><span class="p">)</span>

        <span class="c1"># Toolbar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_pipeline_action</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_pipeline_action</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Config</span><span class="p">()</span><span class="o">.</span><span class="n">get_user_mode</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_pipeline_action</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">(</span>
            <span class="p">)</span><span class="o">.</span><span class="n">disable_overwrite</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_pipeline_action</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">(</span>
            <span class="p">)</span><span class="o">.</span><span class="n">disable_overwrite</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_pipeline_as_action</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags_menu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_pipeline_parameters_action</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_pipeline_parameters_action</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags_menu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_pipeline_action</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_pipeline_action</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tags_tool_button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Pipeline&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags_tool_button</span><span class="o">.</span><span class="n">setPopupMode</span><span class="p">(</span>
            <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QToolButton</span><span class="o">.</span><span class="n">MenuButtonPopup</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags_tool_button</span><span class="o">.</span><span class="n">setMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tags_menu</span><span class="p">)</span>

        <span class="c1"># Layouts</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tags_tool_button</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hLayout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">splitterRight</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterationTable</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitterRight</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scrollArea</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitterRight</span><span class="o">.</span><span class="n">setSizes</span><span class="p">([</span><span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">])</span>

        <span class="c1"># previewScene = QGraphicsScene()</span>
        <span class="c1"># previewScene.setSceneRect(QtCore.QRectF())</span>
        <span class="c1"># self.previewDiagram = QGraphicsView()</span>
        <span class="c1"># self.previewDiagram.setEnabled(False)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">splitter0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">processLibrary</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitter0</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">previewBlock</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">splitter1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splitter0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitter1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitter1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splitterRight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitter1</span><span class="o">.</span><span class="n">setSizes</span><span class="p">([</span><span class="mi">200</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">200</span><span class="p">])</span>

        <span class="c1"># self.splitter2 = QSplitter(Qt.Vertical)</span>
        <span class="c1"># self.splitter2.addWidget(self.splitter1)</span>
        <span class="c1"># self.splitter2.setSizes([800, 100])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">verticalLayout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hLayout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verticalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splitter1</span><span class="p">)</span></div>

<div class="viewcode-block" id="PipelineManagerTab.loadPipeline"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.PipelineManagerTab.loadPipeline">[docs]</a>    <span class="k">def</span> <span class="nf">loadPipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load a pipeline to the pipeline editor</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">load_pipeline</span><span class="p">()</span></div>

<div class="viewcode-block" id="PipelineManagerTab.loadParameters"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.PipelineManagerTab.loadParameters">[docs]</a>    <span class="k">def</span> <span class="nf">loadParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load pipeline parameters to the current pipeline of the pipeline editor</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">load_pipeline_parameters</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nodeController</span><span class="o">.</span><span class="n">update_parameters</span><span class="p">()</span></div>

<div class="viewcode-block" id="PipelineManagerTab.redo"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.PipelineManagerTab.redo">[docs]</a>    <span class="k">def</span> <span class="nf">redo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Redo the last undone action on the current pipeline editor</span>

<span class="sd">        Actions that can be redone:</span>
<span class="sd">            - add_process</span>
<span class="sd">            - delete_process</span>
<span class="sd">            - export_plug</span>
<span class="sd">            - export_plugs</span>
<span class="sd">            - remove_plug</span>
<span class="sd">            - update_node_name</span>
<span class="sd">            - update_plug_value</span>
<span class="sd">            - add_link</span>
<span class="sd">            - delete_link</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">c_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span>

        <span class="c1"># We can redo if we have an action to make again</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">redos</span><span class="p">[</span><span class="n">c_e</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">to_redo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">redos</span><span class="p">[</span><span class="n">c_e</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="c1"># The first element of the list is the type of action made</span>
            <span class="c1"># by the user</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">to_redo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;delete_process&quot;</span><span class="p">:</span>
                <span class="n">node_name</span> <span class="o">=</span> <span class="n">to_redo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">class_process</span> <span class="o">=</span> <span class="n">to_redo</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">links</span> <span class="o">=</span> <span class="n">to_redo</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">c_e</span><span class="o">.</span><span class="n">add_process</span><span class="p">(</span>
                    <span class="n">class_process</span><span class="p">,</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">from_redo</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">links</span><span class="o">=</span><span class="n">links</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;add_process&quot;</span><span class="p">:</span>
                <span class="n">node_name</span> <span class="o">=</span> <span class="n">to_redo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">c_e</span><span class="o">.</span><span class="n">del_node</span><span class="p">(</span><span class="n">node_name</span><span class="p">,</span> <span class="n">from_redo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;export_plug&quot;</span><span class="p">:</span>
                <span class="n">temp_plug_name</span> <span class="o">=</span> <span class="n">to_redo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">c_e</span><span class="o">.</span><span class="n">_remove_plug</span><span class="p">(</span>
                    <span class="n">_temp_plug_name</span><span class="o">=</span><span class="n">temp_plug_name</span><span class="p">,</span> <span class="n">from_redo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;export_plugs&quot;</span><span class="p">:</span>
                <span class="c1"># No redo possible</span>
                <span class="k">pass</span>

            <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;remove_plug&quot;</span><span class="p">:</span>
                <span class="n">temp_plug_name</span> <span class="o">=</span> <span class="n">to_redo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">new_temp_plugs</span> <span class="o">=</span> <span class="n">to_redo</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">optional</span> <span class="o">=</span> <span class="n">to_redo</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">c_e</span><span class="o">.</span><span class="n">_export_plug</span><span class="p">(</span><span class="n">temp_plug_name</span><span class="o">=</span><span class="n">new_temp_plugs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                 <span class="n">weak_link</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                 <span class="n">optional</span><span class="o">=</span><span class="n">optional</span><span class="p">,</span>
                                 <span class="n">from_redo</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                 <span class="n">pipeline_parameter</span><span class="o">=</span><span class="n">temp_plug_name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                <span class="c1"># Connecting all the plugs that were connected</span>
                <span class="c1"># to the original plugs</span>
                <span class="k">for</span> <span class="n">plug_tuple</span> <span class="ow">in</span> <span class="n">new_temp_plugs</span><span class="p">:</span>
                    <span class="c1"># Checking if the original plug is a pipeline</span>
                    <span class="c1"># input or output to adapt</span>
                    <span class="c1"># the links to add.</span>
                    <span class="k">if</span> <span class="n">temp_plug_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;inputs&#39;</span><span class="p">:</span>
                        <span class="n">source</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">temp_plug_name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">dest</span> <span class="o">=</span> <span class="n">plug_tuple</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">source</span> <span class="o">=</span> <span class="n">plug_tuple</span>
                        <span class="n">dest</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">temp_plug_name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                    <span class="n">c_e</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">weak</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                    <span class="c1"># Writing a string to represent the link</span>
                    <span class="n">source_parameters</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
                    <span class="n">dest_parameters</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
                    <span class="n">link</span> <span class="o">=</span> <span class="s2">&quot;-&gt;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">source_parameters</span><span class="p">,</span> <span class="n">dest_parameters</span><span class="p">))</span>

                    <span class="n">c_e</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
                    <span class="n">c_e</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">update_pipeline</span><span class="p">()</span>

            <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;update_node_name&quot;</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">to_redo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">new_node_name</span> <span class="o">=</span> <span class="n">to_redo</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">old_node_name</span> <span class="o">=</span> <span class="n">to_redo</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">c_e</span><span class="o">.</span><span class="n">update_node_name</span><span class="p">(</span>
                    <span class="n">node</span><span class="p">,</span> <span class="n">new_node_name</span><span class="p">,</span> <span class="n">old_node_name</span><span class="p">,</span> <span class="n">from_redo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;update_plug_value&quot;</span><span class="p">:</span>
                <span class="n">node_name</span> <span class="o">=</span> <span class="n">to_redo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">new_value</span> <span class="o">=</span> <span class="n">to_redo</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">plug_name</span> <span class="o">=</span> <span class="n">to_redo</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">value_type</span> <span class="o">=</span> <span class="n">to_redo</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">c_e</span><span class="o">.</span><span class="n">update_plug_value</span><span class="p">(</span>
                    <span class="n">node_name</span><span class="p">,</span> <span class="n">new_value</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">,</span>
                    <span class="n">value_type</span><span class="p">,</span> <span class="n">from_redo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;add_link&quot;</span><span class="p">:</span>
                <span class="n">link</span> <span class="o">=</span> <span class="n">to_redo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">c_e</span><span class="o">.</span><span class="n">_del_link</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">from_redo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;delete_link&quot;</span><span class="p">:</span>
                <span class="n">source</span> <span class="o">=</span> <span class="n">to_redo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">dest</span> <span class="o">=</span> <span class="n">to_redo</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">active</span> <span class="o">=</span> <span class="n">to_redo</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">weak</span> <span class="o">=</span> <span class="n">to_redo</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">c_e</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">active</span><span class="p">,</span> <span class="n">weak</span><span class="p">,</span> <span class="n">from_redo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1"># link = source[0] + &quot;.&quot; + source[1]</span>
                <span class="c1"># + &quot;-&gt;&quot; + dest[0] + &quot;.&quot; + dest[1]</span>

            <span class="n">c_e</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">update_nodes_and_plugs_activation</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodeController</span><span class="o">.</span><span class="n">update_parameters</span><span class="p">()</span></div>

<div class="viewcode-block" id="PipelineManagerTab.runPipeline"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.PipelineManagerTab.runPipeline">[docs]</a>    <span class="k">def</span> <span class="nf">runPipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run the current pipeline of the pipeline editor.&quot;&quot;&quot;</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_filename</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">brick_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
            <span class="s1">&#39;Pipeline &quot;</span><span class="si">{0}</span><span class="s1">&quot; is getting run. Please wait.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignore_node</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterationTable</span><span class="o">.</span><span class="n">check_box_iterate</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">iterated_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterationTable</span><span class="o">.</span><span class="n">iterated_tag</span>
            <span class="n">tag_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterationTable</span><span class="o">.</span><span class="n">tag_values_list</span>
            <span class="n">ui_iteration</span> <span class="o">=</span> <span class="n">PopUpSelectIteration</span><span class="p">(</span><span class="n">iterated_tag</span><span class="p">,</span> <span class="n">tag_values</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ui_iteration</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="n">tag_values</span> <span class="o">=</span> <span class="n">ui_iteration</span><span class="o">.</span><span class="n">final_values</span>
                <span class="n">pipeline_progress</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                <span class="n">pipeline_progress</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tag_values</span><span class="p">)</span>
                <span class="n">pipeline_progress</span><span class="p">[</span><span class="s1">&#39;counter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">pipeline_progress</span><span class="p">[</span><span class="s1">&#39;tag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">iterated_tag</span>
                <span class="k">for</span> <span class="n">tag_value</span> <span class="ow">in</span> <span class="n">tag_values</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">brick_list</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="c1"># Status bar update</span>
                    <span class="n">pipeline_progress</span><span class="p">[</span><span class="s1">&#39;tag_value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tag_value</span>

                    <span class="n">idx_combo_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterationTable</span><span class="o">.</span><span class="n">combo_box</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span>
                        <span class="n">tag_value</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">iterationTable</span><span class="o">.</span><span class="n">combo_box</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span>
                        <span class="n">idx_combo_box</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">iterationTable</span><span class="o">.</span><span class="n">update_table</span><span class="p">()</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">init_pipeline</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
                        <span class="s1">&#39;Pipeline &quot;</span><span class="si">{0}</span><span class="s1">&quot; is getting run for </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">. &#39;</span>
                        <span class="s1">&#39;Please wait.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">iterated_tag</span><span class="p">,</span> <span class="n">tag_value</span><span class="p">))</span>
                    <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="n">RunProgress</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="p">,</span>
                                                <span class="n">pipeline_progress</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
                    <span class="n">pipeline_progress</span><span class="p">[</span><span class="s1">&#39;counter&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">init_clicked</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="c1"># # self.init_pipeline(self.pipeline)</span>
                    <span class="c1"># idx = self.progress.value()</span>
                    <span class="c1"># idx += 1</span>
                    <span class="c1"># self.progress.setValue(idx)</span>
                    <span class="c1"># QApplication.processEvents()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
                <span class="s1">&#39;Pipeline &quot;</span><span class="si">{0}</span><span class="s1">&quot; has been run for </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">. Please wait.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">name</span><span class="p">,</span> <span class="n">iterated_tag</span><span class="p">,</span> <span class="n">tag_values</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="n">RunProgress</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> When the pipeline was launched, the following &#39;</span>
                      <span class="s1">&#39;exception was raised: </span><span class="si">{0}</span><span class="s1"> ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
                    <span class="s1">&#39;Pipeline &quot;</span><span class="si">{0}</span><span class="s1">&quot; has not been correctly run.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
                    <span class="s1">&#39;Pipeline &quot;</span><span class="si">{0}</span><span class="s1">&quot; has been correctly run.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">init_clicked</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_pipeline_action</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="PipelineManagerTab.saveParameters"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.PipelineManagerTab.saveParameters">[docs]</a>    <span class="k">def</span> <span class="nf">saveParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the pipeline parameters of the the current pipeline of the</span>
<span class="sd">        pipeline editor</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">save_pipeline_parameters</span><span class="p">()</span></div>

<div class="viewcode-block" id="PipelineManagerTab.savePipeline"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.PipelineManagerTab.savePipeline">[docs]</a>    <span class="k">def</span> <span class="nf">savePipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uncheck</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the current pipeline of the pipeline editor</span>

<span class="sd">        :param uncheck: a flag to warn (False) or not (True) if a pipeline is</span>
<span class="sd">                        going to be overwritten during saving operation</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
            <span class="s1">&#39;The pipeline is getting saved. Please wait.&#39;</span><span class="p">)</span>
        <span class="c1"># QApplication.processEvents()</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_filename</span><span class="p">()</span>

        <span class="c1"># save</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">uncheck</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;populse_mia - &quot;</span>
                                   <span class="s2">&quot;Save pipeline Warning!&quot;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;The following module will be overwritten:</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                            <span class="s2">&quot;</span><span class="si">{}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                            <span class="s2">&quot;Do you agree?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)))</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Abort</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">retval</span> <span class="o">==</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">save_pipeline</span><span class="p">(</span><span class="n">new_file_name</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
                    <span class="s2">&quot;The &#39;</span><span class="si">{}</span><span class="s2">&#39; pipeline has been &quot;</span>
                    <span class="s2">&quot;saved.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
                    <span class="s2">&quot;The &#39;</span><span class="si">{}</span><span class="s2">&#39; pipeline was not &quot;</span>
                    <span class="s2">&quot;saved.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">filename</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">save_pipeline</span><span class="p">(</span><span class="n">new_file_name</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
                    <span class="s2">&quot;The &#39;</span><span class="si">{}</span><span class="s2">&#39; pipeline has been &quot;</span>
                    <span class="s2">&quot;saved.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

        <span class="c1"># save as</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">saveResult</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">save_pipeline</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">saveResult</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
                              <span class="s2">&quot;The &#39;</span><span class="si">{}</span><span class="s2">&#39; pipeline has been saved.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">saveResult</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
                             <span class="s1">&#39;The pipeline was not saved.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PipelineManagerTab.savePipelineAs"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.PipelineManagerTab.savePipelineAs">[docs]</a>    <span class="k">def</span> <span class="nf">savePipelineAs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the current pipeline of the pipeline editor under another name</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
            <span class="s1">&#39;The pipeline is getting saved. Please wait.&#39;</span><span class="p">)</span>
        <span class="n">saveResult</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">save_pipeline</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">saveResult</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
                <span class="s2">&quot;The &#39;</span><span class="si">{}</span><span class="s2">&#39; pipeline has been saved.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">saveResult</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
                <span class="s1">&#39;The pipeline was not saved.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PipelineManagerTab.undo"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.PipelineManagerTab.undo">[docs]</a>    <span class="k">def</span> <span class="nf">undo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Undo the last action made on the current pipeline editor</span>

<span class="sd">        Actions that can be undone:</span>
<span class="sd">            - add_process</span>
<span class="sd">            - delete_process</span>
<span class="sd">            - export_plug</span>
<span class="sd">            - export_plugs</span>
<span class="sd">            - remove_plug</span>
<span class="sd">            - update_node_name</span>
<span class="sd">            - update_plug_value</span>
<span class="sd">            - add_link</span>
<span class="sd">            - delete_link</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">c_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span>

        <span class="c1"># We can undo if we have an action to revert</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">undos</span><span class="p">[</span><span class="n">c_e</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">to_undo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">undos</span><span class="p">[</span><span class="n">c_e</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="c1"># The first element of the list is the type of action made</span>
            <span class="c1"># by the user</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">to_undo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;add_process&quot;</span><span class="p">:</span>
                <span class="n">node_name</span> <span class="o">=</span> <span class="n">to_undo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">c_e</span><span class="o">.</span><span class="n">del_node</span><span class="p">(</span><span class="n">node_name</span><span class="p">,</span> <span class="n">from_undo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;delete_process&quot;</span><span class="p">:</span>
                <span class="n">node_name</span> <span class="o">=</span> <span class="n">to_undo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">class_name</span> <span class="o">=</span> <span class="n">to_undo</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">links</span> <span class="o">=</span> <span class="n">to_undo</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">c_e</span><span class="o">.</span><span class="n">add_process</span><span class="p">(</span>
                    <span class="n">class_name</span><span class="p">,</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">from_undo</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">links</span><span class="o">=</span><span class="n">links</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;export_plug&quot;</span><span class="p">:</span>
                <span class="n">temp_plug_name</span> <span class="o">=</span> <span class="n">to_undo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">c_e</span><span class="o">.</span><span class="n">_remove_plug</span><span class="p">(</span>
                    <span class="n">_temp_plug_name</span><span class="o">=</span><span class="n">temp_plug_name</span><span class="p">,</span> <span class="n">from_undo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;export_plugs&quot;</span><span class="p">:</span>
                <span class="n">parameter_list</span> <span class="o">=</span> <span class="n">to_undo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">node_name</span> <span class="o">=</span> <span class="n">to_undo</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">parameter_list</span><span class="p">:</span>
                    <span class="n">temp_plug_name</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;inputs&#39;</span><span class="p">,</span> <span class="n">parameter</span><span class="p">)</span>
                    <span class="n">c_e</span><span class="o">.</span><span class="n">_remove_plug</span><span class="p">(</span>
                        <span class="n">_temp_plug_name</span><span class="o">=</span><span class="n">temp_plug_name</span><span class="p">,</span>
                        <span class="n">from_undo</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">from_export_plugs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
                    <span class="s2">&quot;Plugs </span><span class="si">{0}</span><span class="s2"> have been removed.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parameter_list</span><span class="p">)))</span>

            <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;remove_plug&quot;</span><span class="p">:</span>
                <span class="n">temp_plug_name</span> <span class="o">=</span> <span class="n">to_undo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">new_temp_plugs</span> <span class="o">=</span> <span class="n">to_undo</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">optional</span> <span class="o">=</span> <span class="n">to_undo</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">c_e</span><span class="o">.</span><span class="n">_export_plug</span><span class="p">(</span><span class="n">temp_plug_name</span><span class="o">=</span><span class="n">new_temp_plugs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                 <span class="n">weak_link</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                 <span class="n">optional</span><span class="o">=</span><span class="n">optional</span><span class="p">,</span> <span class="n">from_undo</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                 <span class="n">pipeline_parameter</span><span class="o">=</span><span class="n">temp_plug_name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                <span class="c1"># Connecting all the plugs that were connected</span>
                <span class="c1"># to the original plugs</span>
                <span class="k">for</span> <span class="n">plug_tuple</span> <span class="ow">in</span> <span class="n">new_temp_plugs</span><span class="p">:</span>
                    <span class="c1"># Checking if the original plug is a pipeline</span>
                    <span class="c1"># input or output to adapt</span>
                    <span class="c1"># the links to add.</span>
                    <span class="k">if</span> <span class="n">temp_plug_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;inputs&#39;</span><span class="p">:</span>
                        <span class="n">source</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">temp_plug_name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">dest</span> <span class="o">=</span> <span class="n">plug_tuple</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">source</span> <span class="o">=</span> <span class="n">plug_tuple</span>
                        <span class="n">dest</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">temp_plug_name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                    <span class="n">c_e</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">weak</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                    <span class="c1"># Writing a string to represent the link</span>
                    <span class="n">source_parameters</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
                    <span class="n">dest_parameters</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
                    <span class="n">link</span> <span class="o">=</span> <span class="s2">&quot;-&gt;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">source_parameters</span><span class="p">,</span> <span class="n">dest_parameters</span><span class="p">))</span>

                    <span class="n">c_e</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
                    <span class="n">c_e</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">update_pipeline</span><span class="p">()</span>

            <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;update_node_name&quot;</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">to_undo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">new_node_name</span> <span class="o">=</span> <span class="n">to_undo</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">old_node_name</span> <span class="o">=</span> <span class="n">to_undo</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">c_e</span><span class="o">.</span><span class="n">update_node_name</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">new_node_name</span><span class="p">,</span> <span class="n">old_node_name</span><span class="p">,</span>
                                     <span class="n">from_undo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;update_plug_value&quot;</span><span class="p">:</span>
                <span class="n">node_name</span> <span class="o">=</span> <span class="n">to_undo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">old_value</span> <span class="o">=</span> <span class="n">to_undo</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">plug_name</span> <span class="o">=</span> <span class="n">to_undo</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">value_type</span> <span class="o">=</span> <span class="n">to_undo</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">c_e</span><span class="o">.</span><span class="n">update_plug_value</span><span class="p">(</span><span class="n">node_name</span><span class="p">,</span> <span class="n">old_value</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">,</span>
                                      <span class="n">value_type</span><span class="p">,</span> <span class="n">from_undo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;add_link&quot;</span><span class="p">:</span>
                <span class="n">link</span> <span class="o">=</span> <span class="n">to_undo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">c_e</span><span class="o">.</span><span class="n">_del_link</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">from_undo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;delete_link&quot;</span><span class="p">:</span>
                <span class="n">source</span> <span class="o">=</span> <span class="n">to_undo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">dest</span> <span class="o">=</span> <span class="n">to_undo</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">active</span> <span class="o">=</span> <span class="n">to_undo</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">weak</span> <span class="o">=</span> <span class="n">to_undo</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">c_e</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">active</span><span class="p">,</span> <span class="n">weak</span><span class="p">,</span> <span class="n">from_undo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1"># link = source[0] + &quot;.&quot; + source[1] +</span>
                <span class="c1"># &quot;-&gt;&quot; + dest[0] + &quot;.&quot; + dest[1]</span>

            <span class="n">c_e</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">update_nodes_and_plugs_activation</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodeController</span><span class="o">.</span><span class="n">update_parameters</span><span class="p">()</span></div>

<div class="viewcode-block" id="PipelineManagerTab.update_user_mode"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.PipelineManagerTab.update_user_mode">[docs]</a>    <span class="k">def</span> <span class="nf">update_user_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the visibility of widgets/actions depending of the chosen mode</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

        <span class="c1"># If the user mode is chosen, the process library is not available</span>
        <span class="c1"># and the user cannot save a pipeline</span>
        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">get_user_mode</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_pipeline_action</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">(</span>
            <span class="p">)</span><span class="o">.</span><span class="n">disable_overwrite</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">action_delete_project</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_pipeline_action</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">(</span>
            <span class="p">)</span><span class="o">.</span><span class="n">disable_overwrite</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">action_delete_project</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

        <span class="c1"># If the user mode is chosen, the process library is not available</span>
        <span class="c1"># and the user cannot save a pipeline</span>
        <span class="c1"># if config.get_user_mode() == True:</span>
        <span class="c1">#     self.processLibrary.setHidden(True)</span>
        <span class="c1">#     self.previewBlock.setHidden(True)</span>
        <span class="c1">#     self.save_pipeline_action.setDisabled(True)</span>
        <span class="c1">#     self.save_pipeline_as_action.setDisabled(True)</span>
        <span class="c1"># else:</span>
        <span class="c1"># self.processLibrary.setHidden(False)</span>
        <span class="c1"># self.previewBlock.setHidden(False)</span>
        <span class="c1"># self.save_pipeline_action.setDisabled(False)</span>
        <span class="c1"># self.save_pipeline_as_action.setDisabled(False)</span>

<div class="viewcode-block" id="PipelineManagerTab.update_project"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.PipelineManagerTab.update_project">[docs]</a>    <span class="k">def</span> <span class="nf">update_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the project attribute of several objects</span>

<span class="sd">        :param project: current project in the software</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodeController</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodeController</span><span class="o">.</span><span class="n">visibles_tags</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_shown_tags</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iterationTable</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>

        <span class="c1"># Necessary for using MIA bricks</span>
        <span class="n">ProcessMIA</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span></div>

<div class="viewcode-block" id="PipelineManagerTab.update_scans_list"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.PipelineManagerTab.update_scans_list">[docs]</a>    <span class="k">def</span> <span class="nf">update_scans_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iteration_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the user-selected list of scans</span>

<span class="sd">        :param iteration_list: current list of scans in the iteration table</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterationTable</span><span class="o">.</span><span class="n">check_box_iterate</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iteration_table_scans_list</span> <span class="o">=</span> <span class="n">iteration_list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">scan_list</span> <span class="o">=</span> <span class="n">iteration_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iteration_table_scans_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">scan_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_list</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">scan_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">scan_list</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">update_scans_list</span><span class="p">()</span></div>

<div class="viewcode-block" id="PipelineManagerTab.updateProcessLibrary"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.PipelineManagerTab.updateProcessLibrary">[docs]</a>    <span class="k">def</span> <span class="nf">updateProcessLibrary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the library of processes when a pipeline is saved</span>

<span class="sd">        :param filename: file name of the pipeline that has been saved</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filename_folder</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">module_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">class_name</span> <span class="o">=</span> <span class="n">module_name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>

        <span class="n">tmp_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filename_folder</span><span class="p">,</span> <span class="n">module_name</span> <span class="o">+</span> <span class="s1">&#39;_tmp&#39;</span><span class="p">)</span>

        <span class="c1"># Changing the &quot;Pipeline&quot; class name to the name of file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tmp_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s1">&#39;class &#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;class </span><span class="si">{0}</span><span class="s1">(Pipeline):&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">class_name</span><span class="p">)</span>
                    <span class="n">tmp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tmp_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tmp_file</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">filename_folder</span><span class="p">)</span> <span class="o">!=</span> \
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;processes&#39;</span><span class="p">,</span> <span class="s1">&#39;User_processes&#39;</span><span class="p">)):</span>
            <span class="k">return</span>

        <span class="c1"># Updating __init__.py</span>
        <span class="n">init_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;processes&#39;</span><span class="p">,</span>
            <span class="s1">&#39;User_processes&#39;</span><span class="p">,</span> <span class="s1">&#39;__init__.py&#39;</span><span class="p">)</span>

        <span class="c1"># Checking that import line is not already in the file</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="s1">&#39;from .</span><span class="si">{0}</span><span class="s1"> import </span><span class="si">{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">module_name</span><span class="p">,</span> <span class="n">class_name</span><span class="p">)</span>
        <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">init_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">flines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">pattern</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">flines</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">init_file</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;from .</span><span class="si">{0}</span><span class="s1"> import </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">module_name</span><span class="p">,</span> <span class="n">class_name</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>

        <span class="n">package</span> <span class="o">=</span> <span class="s1">&#39;User_processes&#39;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filename_folder</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">))</span>

        <span class="c1"># If the pipeline has already been saved</span>
        <span class="k">if</span> <span class="s1">&#39;User_processes.&#39;</span> <span class="o">+</span> <span class="n">module_name</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># removing the previous version of the module</span>
            <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;User_processes.&#39;</span> <span class="o">+</span> <span class="n">module_name</span><span class="p">]</span>
            <span class="c1"># this adds the new module version to the sys.modules dictionary</span>
            <span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;User_processes&#39;</span><span class="p">)</span>

        <span class="c1"># Adding the module path to the system path</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">processLibrary</span><span class="o">.</span><span class="n">pkg_library</span><span class="o">.</span><span class="n">add_package</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">class_name</span><span class="p">,</span>
                                                    <span class="n">init_package_tree</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">processLibrary</span><span class="o">.</span><span class="n">pkg_library</span><span class="o">.</span><span class="n">paths</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">processLibrary</span><span class="o">.</span><span class="n">pkg_library</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">processLibrary</span><span class="o">.</span><span class="n">pkg_library</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="RunProgress"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.RunProgress">[docs]</a><span class="k">class</span> <span class="nc">RunProgress</span><span class="p">(</span><span class="n">QProgressDialog</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create the pipeline progress bar and launch the thread.</span>

<span class="sd">    The progress bar is closed when the thread finishes.</span>

<span class="sd">    :param diagram_view: A pipelineEditorTabs</span>
<span class="sd">    :param settings: dictionary of settings when the pipeline is iterated</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="RunProgress.__init__"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.RunProgress.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">diagram_view</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">RunProgress</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;Please wait while the pipeline is &quot;</span>
                                          <span class="s2">&quot;running...&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">settings</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span>
                <span class="s2">&quot;Pipeline is running (</span><span class="si">{0}</span><span class="s2">/</span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;counter&quot;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setLabelText</span><span class="p">(</span><span class="s1">&#39;Pipeline is running for </span><span class="si">{0}</span><span class="s1"> in </span><span class="si">{1}</span><span class="s1">. &#39;</span>
                              <span class="s1">&#39;Please wait.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;tag_value&#39;</span><span class="p">],</span>
                                                    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;tag&#39;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Pipeline running&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowFlags</span><span class="p">(</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">Window</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">WindowTitleHint</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">CustomizeWindowHint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setModal</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">diagramView</span> <span class="o">=</span> <span class="n">diagram_view</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumDuration</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">350</span><span class="p">)</span> <span class="c1"># For mac OS</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">worker</span> <span class="o">=</span> <span class="n">RunWorker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">diagramView</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div></div>

        <span class="c1">#engine \</span>
        <span class="c1">#    = self.diagramView.get_current_pipeline().get_study_config().engine</span>
        <span class="c1">#with engine.study_config.run_lock:</span>
        <span class="c1">#    engine.study_config.run_interruption_request = True</span>
<div class="viewcode-block" id="RunWorker"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.RunWorker">[docs]</a><span class="k">class</span> <span class="nc">RunWorker</span><span class="p">(</span><span class="n">QThread</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run the pipeline&quot;&quot;&quot;</span>

<div class="viewcode-block" id="RunWorker.__init__"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.RunWorker.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">diagram_view</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagramView</span> <span class="o">=</span> <span class="n">diagram_view</span></div>

<div class="viewcode-block" id="RunWorker.run"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.pipeline_manager_tab.RunWorker.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">_check_nipype_processes</span><span class="p">(</span><span class="n">pplne</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">pplne</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">node_name</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">_check_nipype_processes</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="p">,</span> <span class="n">NipypeProcess</span><span class="p">):</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">activate_copy</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">_check_nipype_processes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">diagramView</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">())</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">get_process_instance</span><span class="p">(</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">diagramView</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">())</span>

        <span class="c1"># Reading config</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">spm_standalone_path</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_spm_standalone_path</span><span class="p">()</span>
        <span class="n">spm_path</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_spm_path</span><span class="p">()</span>
        <span class="n">matlab_path</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_matlab_path</span><span class="p">()</span>
        <span class="n">matlab_standalone_path</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_matlab_standalone_path</span><span class="p">()</span>
        <span class="n">use_spm</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_use_spm</span><span class="p">()</span>
        <span class="n">use_spm_standalone</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_use_spm_standalone</span><span class="p">()</span>
        <span class="n">use_matlab</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_use_matlab</span><span class="p">()</span>

        <span class="n">study_config</span> <span class="o">=</span> <span class="n">StudyConfig</span><span class="p">(</span>
            <span class="n">modules</span><span class="o">=</span><span class="n">StudyConfig</span><span class="o">.</span><span class="n">default_modules</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;FreeSurferConfig&#39;</span><span class="p">,</span>
                                                   <span class="s1">&#39;NipypeConfig&#39;</span><span class="p">])</span>
        <span class="n">sconf</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">use_spm_standalone</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
                <span class="n">spm_standalone_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
            <span class="n">matlab_standalone_path</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">matlab_path</span><span class="p">):</span>
                <span class="n">sconf</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">use_spm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">spm_directory</span><span class="o">=</span><span class="n">spm_standalone_path</span><span class="p">,</span>
                    <span class="n">spm_exec</span><span class="o">=</span><span class="n">matlab_standalone_path</span><span class="p">,</span>
                    <span class="n">matlab_exec</span><span class="o">=</span><span class="n">matlab_path</span><span class="p">,</span>
                    <span class="n">output_directory</span><span class="o">=</span><span class="n">spm_standalone_path</span><span class="p">,</span> <span class="n">spm_standalone</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sconf</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">use_spm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">spm_directory</span><span class="o">=</span><span class="n">spm_standalone_path</span><span class="p">,</span>
                    <span class="n">spm_exec</span><span class="o">=</span><span class="n">matlab_standalone_path</span><span class="p">,</span>
                    <span class="n">output_directory</span><span class="o">=</span><span class="n">spm_standalone_path</span><span class="p">,</span> <span class="n">spm_standalone</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

        <span class="c1"># Using without SPM standalone</span>
        <span class="k">elif</span> <span class="n">use_spm</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">use_matlab</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">sconf</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">use_spm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">matlab_exec</span><span class="o">=</span><span class="n">matlab_path</span><span class="p">,</span>
                <span class="n">spm_directory</span><span class="o">=</span><span class="n">spm_path</span><span class="p">,</span> <span class="n">spm_standalone</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">use_matlab</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="n">spm_path</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sconf</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">use_spm</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

        <span class="n">study_config</span><span class="o">.</span><span class="n">import_from_dict</span><span class="p">(</span><span class="n">sconf</span><span class="p">)</span>
        <span class="n">study_config</span><span class="o">.</span><span class="n">reset_process_counter</span><span class="p">()</span>
        <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">study_config</span><span class="o">.</span><span class="n">use_soma_workflow</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">study_config</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1">#** pathway from the study_config.run(pipeline, verbose=1) command:</span>
            <span class="c1">#   (ex. for the User_processes Smooth brick):</span>
            <span class="c1">#     info1: study_config = StudyConfig(...) defined before</span>
            <span class="c1">#     info2: from capsul.api import (..., StudyConfig, ...) defined</span>
            <span class="c1">#            before</span>

            <span class="c1">#** capsul/study_config/study_config.py</span>
            <span class="c1">#   class StudyConfig(Controller)</span>
            <span class="c1">#    run method:</span>
            <span class="c1">#     use: result = self._run(process_node.process,</span>
            <span class="c1">#                             output_directory,</span>
            <span class="c1">#                             verbose) ou</span>
            <span class="c1">#          result = self._run(process_node,</span>
            <span class="c1">#                             output_directory,</span>
            <span class="c1">#                             verbose)</span>
            <span class="c1">#     info1: _run() is a private method of the</span>
            <span class="c1">#            StudyConfig(Controller) class in the</span>
            <span class="c1">#            capsul/study_config/study_config.py module</span>
            <span class="c1">#</span>
            <span class="c1">#** capsul/study_config/study_config.py</span>
            <span class="c1">#   class StudyConfig(Controller)</span>
            <span class="c1">#   run method:</span>
            <span class="c1">#     use: returncode, log_file = run_process(output_directory,</span>
            <span class="c1">#                                             process_instance,</span>
            <span class="c1">#                                             cachedir=cachedir,</span>
            <span class="c1">#                            generate_logging=self.generate_logging,</span>
            <span class="c1">#                            verbose=verbose, **kwargs)</span>
            <span class="c1">#     info1: from capsul.study_config.run import run_process defined</span>
            <span class="c1">#            in the capsul/study_config/study_config.py module</span>

            <span class="c1">#** capsul/study_config/run.py; run_process function:</span>
            <span class="c1">#     use: returncode = process_instance._run_process()</span>
            <span class="c1">#     info1: process_instance is the brick (node, process, etc.)</span>
            <span class="c1">#            object (ex.  &lt;User_processes.preprocess.spm</span>
            <span class="c1">#            .spatial_preprocessing.Smooth object at ...&gt;)</span>
            <span class="c1">#     info2: homemade bricks do not have a mandatory _run_process</span>
            <span class="c1">#            method but they inherit the Process_Mia class (module</span>
            <span class="c1">#            mia_processes/process_mia.py) that has the</span>
            <span class="c1">#            _run_process method</span>

            <span class="c1">#** mia_processes/process_mia.py</span>
            <span class="c1">#   class Process_Mia(ProcessMIA)</span>
            <span class="c1">#   _run_process method</span>
            <span class="c1">#     use: self.run_process_mia()</span>
            <span class="c1">#     info1: self is the brick (node, process, etc.) object</span>
            <span class="c1">#            &lt;User_processes.preprocess.spm.spatial_preprocessing</span>
            <span class="c1">#            .Smooth object at ...&gt;</span>

            <span class="c1">#** User_processes/preprocess/spm/spatial_preprocessing.py</span>
            <span class="c1">#   class Smooth(Process_Mia)</span>
            <span class="c1">#   run_process_mia method:</span>
            <span class="c1">#     info1: this is the method where we do what we want when</span>
            <span class="c1">#            launching a brick (node, process, etc.).</span>
            <span class="c1">#     use1: super(Smooth, self).run_process_mia()</span>
            <span class="c1">#     info2: it calls the run_process_mia method of the Process_Mia</span>
            <span class="c1">#            class inherited by the Smooth class. run_process_mia</span>
            <span class="c1">#            method of the Process_Mia class manages the hidden</span>
            <span class="c1">#            matlab parameters (use_mcr, matlab_cmd, etc)</span>
            <span class="c1">#     use2: self.process.run()</span>
            <span class="c1">#     info3: self.process is a &lt;nipype.interfaces.spm.preprocess</span>
            <span class="c1">#            .Smooth&gt; object. This object inherits from the nipype</span>
            <span class="c1">#            SPMCommand class, which itself inherits from the nipype</span>
            <span class="c1">#            BaseInterface class. The BaseInterface class</span>
            <span class="c1">#            (nipype/interfaces/base.core.py module) have the run()</span>
            <span class="c1">#            method)</span>
            <span class="c1">#     info4: from this method run(), we are outside of mia ...</span>
            <span class="c1">#</span>
            <span class="c1">#** pipeline object introspection: see initialize method in the</span>
            <span class="c1">#                                  PipelineManagerTab class, this</span>
            <span class="c1">#                                  module</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{0}</span><span class="s1"> has not been launched:</span><span class="se">\n</span><span class="si">{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                                               <span class="n">e</span><span class="p">))</span>
            <span class="kn">import</span> <span class="nn">traceback</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*** INTERRUPT ***&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># haven&#39;t yet found how to raise the exception in the try block in</span>
        <span class="c1"># PipelineManagerTab.runPipeline() above. So the</span>
        <span class="c1"># self.main_window.statusBar().showMessage() gives the</span>
        <span class="c1"># &quot;has been correctly run&quot; message even if a problem has occurred here!</span>

            <span class="c1">#self.diagramView.main_window.statusBar().showMessage(</span>
            <span class="c1">#        &#39;Pipeline &quot;{0}&quot; has not been correctly run.&#39;.format(pipeline.name))</span>

            <span class="c1">#self.msg = QMessageBox()</span>
            <span class="c1">#self.msg.setIcon(QMessageBox.Critical)</span>
            <span class="c1">#self.msg.setText(&quot;SPM standalone is not set&quot;)</span>
            <span class="c1">#self.msg.setInformativeText(</span>
            <span class="c1">#    &quot;SPM processes cannot be run with SPM standalone not set.\n&quot;</span>
            <span class="c1">#    &quot;You can activate it and set the paths in MIA preferences.&quot;)</span>
            <span class="c1">#self.msg.setWindowTitle(&quot;Error&quot;)</span>
            <span class="c1">#self.msg.setStandardButtons(QMessageBox.Ok)</span>
            <span class="c1">#self.msg.buttonClicked.connect(self.msg.close)</span>
            <span class="c1">#self.msg.show()</span>

            <span class="c1">#except ValueError as e:</span>
            <span class="c1">#    print(&quot;\n{0} has not been launched:\n{1}\n&quot;.format(pipeline.name,</span>
            <span class="c1">#                                                       e))</span>

        <span class="c1"># restore current working directory in cas it has been changed</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span></div></div>
</pre></div>

      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="../../../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, populse.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.3.1.
    </div>
  </body>
</html>