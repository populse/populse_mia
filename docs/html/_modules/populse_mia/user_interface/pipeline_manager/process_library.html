<!DOCTYPE html>

<html lang="en" data-content_root="../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>populse_mia.user_interface.pipeline_manager.process_library &#8212; populse_mia 3.0.0-dev+881d2af6 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=f63d8bfa" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/haiku.css?v=dfa0e015" />
    <script src="../../../../_static/documentation_options.js?v=a73ba755"></script>
    <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="https://unpkg.com/mermaid@10.2.0/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../../../../index.html">
          <span>populse_mia 3.0.0-dev+881d2af6 documentation</span></a></h1>
        <h2 class="heading"><span>populse_mia.user_interface.pipeline_manager.process_library</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="../../../../index.html">Contents</a>
        </p>

      </div>
      <div class="content" role="main">
        
        
  <h1>Source code for populse_mia.user_interface.pipeline_manager.process_library</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module that contains class and methods to process the different libraries of</span>
<span class="sd">the project.</span>

<span class="sd">:Contains:</span>
<span class="sd">    :Class:</span>
<span class="sd">        - DictionaryTreeModel</span>
<span class="sd">        - InstallProcesses</span>
<span class="sd">        - Node</span>
<span class="sd">        - PackageLibrary</span>
<span class="sd">        - PackageLibraryDialog</span>
<span class="sd">        - ProcessHelp</span>
<span class="sd">        - ProcessLibrary</span>
<span class="sd">        - ProcessLibraryWidget</span>

<span class="sd">    :Functions:</span>
<span class="sd">        - import_file</span>
<span class="sd">        - node_structure_from_dict</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">##########################################################################</span>
<span class="c1"># Populse_mia - Copyright (C) IRMaGe/CEA, 2018</span>
<span class="c1"># Distributed under the terms of the CeCILL license, as published by</span>
<span class="c1"># the CEA-CNRS-INRIA. Refer to the LICENSE file or to</span>
<span class="c1"># http://www.cecill.info/licences/Licence_CeCILL_V2.1-en.html</span>
<span class="c1"># for details.</span>
<span class="c1">##########################################################################</span>

<span class="c1"># Other import</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pkgutil</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span><span class="p">,</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">zipfile</span> <span class="kn">import</span> <span class="n">ZipFile</span><span class="p">,</span> <span class="n">is_zipfile</span>

<span class="kn">import</span> <span class="nn">yaml</span>

<span class="c1"># capsul import</span>
<span class="kn">from</span> <span class="nn">capsul.api</span> <span class="kn">import</span> <span class="n">get_process_instance</span>

<span class="c1"># PyQt5 import</span>
<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="kn">import</span> <span class="n">QtCore</span>

<span class="c1"># QAbstractItemView is not available from soma (see in PackageLibraryDialog)</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="n">QAbstractItemView</span>

<span class="c1"># PyQt / PySide import, via soma</span>
<span class="kn">from</span> <span class="nn">soma.qt_gui</span> <span class="kn">import</span> <span class="n">qt_backend</span>
<span class="kn">from</span> <span class="nn">soma.qt_gui.qt_backend</span> <span class="kn">import</span> <span class="n">QtGui</span>
<span class="kn">from</span> <span class="nn">soma.qt_gui.qt_backend.Qt</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">QApplication</span><span class="p">,</span>
    <span class="n">QDialog</span><span class="p">,</span>
    <span class="n">QFileDialog</span><span class="p">,</span>
    <span class="n">QHBoxLayout</span><span class="p">,</span>
    <span class="n">QLabel</span><span class="p">,</span>
    <span class="n">QLineEdit</span><span class="p">,</span>
    <span class="n">QMessageBox</span><span class="p">,</span>
    <span class="n">QPushButton</span><span class="p">,</span>
    <span class="n">QSplitter</span><span class="p">,</span>
    <span class="n">QTreeView</span><span class="p">,</span>
    <span class="n">QTreeWidget</span><span class="p">,</span>
    <span class="n">QTreeWidgetItem</span><span class="p">,</span>
    <span class="n">QVBoxLayout</span><span class="p">,</span>
    <span class="n">QWidget</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">soma.qt_gui.qt_backend.QtCore</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">QAbstractItemModel</span><span class="p">,</span>
    <span class="n">QByteArray</span><span class="p">,</span>
    <span class="n">QMimeData</span><span class="p">,</span>
    <span class="n">QModelIndex</span><span class="p">,</span>
    <span class="n">Qt</span><span class="p">,</span>
    <span class="n">Signal</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">soma.qt_gui.qt_backend.QtWidgets</span> <span class="kn">import</span> <span class="n">QGroupBox</span><span class="p">,</span> <span class="n">QListWidget</span><span class="p">,</span> <span class="n">QMenu</span>

<span class="c1"># Populse_MIA import</span>
<span class="kn">from</span> <span class="nn">populse_mia.software_properties</span> <span class="kn">import</span> <span class="n">Config</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="DictionaryTreeModel">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel">[docs]</a>
<span class="k">class</span> <span class="nc">DictionaryTreeModel</span><span class="p">(</span><span class="n">QAbstractItemModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Data model providing a tree structure for an arbitrary dictionary.</span>

<span class="sd">    This model is designed to represent a dictionary as a tree structure,</span>
<span class="sd">    enabling interaction with the data through a tree view.</span>

<span class="sd">    .. Methods:</span>
<span class="sd">        - columnCount: Return always 1.</span>
<span class="sd">        - data: Return the data requested by the view.</span>
<span class="sd">        - flags: Everything is enabled and selectable, only the leaves can be</span>
<span class="sd">                 dragged.</span>
<span class="sd">        - getNode: Return a Node() from given index.</span>
<span class="sd">        - headerData: Return the name of the requested column.</span>
<span class="sd">        - index: Return an index from given row, column and parent.</span>
<span class="sd">        - insertRows: Insert rows from starting position and number given by</span>
<span class="sd">                      rows.</span>
<span class="sd">        - mimeData: Used when the widget is dragged by the user.</span>
<span class="sd">        - mimeTypes: Return a constant.</span>
<span class="sd">        - parent: return the parent from given index.</span>
<span class="sd">        - removeRows: Remove the rows from position to position+rows.</span>
<span class="sd">        - rowCount: The number of rows is the number of children.</span>
<span class="sd">        - setData: Method called when the user changes data.</span>
<span class="sd">        - to_dict: return the root node as a dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DictionaryTreeModel.__init__">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the DictionaryTreeModel with a root node.</span>

<span class="sd">        :param root: The root node of the tree.</span>
<span class="sd">        &quot;param parent (QObject): The parent object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rootNode</span> <span class="o">=</span> <span class="n">root</span></div>


<div class="viewcode-block" id="DictionaryTreeModel.columnCount">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.columnCount">[docs]</a>
    <span class="k">def</span> <span class="nf">columnCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the number of columns, which is always 1.</span>

<span class="sd">        :param parent (QModelIndex): The parent index (unused in this</span>
<span class="sd">                                     implementation).</span>
<span class="sd">        :return (int): The number of columns.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">1</span></div>


<div class="viewcode-block" id="DictionaryTreeModel.data">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.data">[docs]</a>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">role</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the data stored under the given role for the item at the</span>
<span class="sd">        given index.</span>

<span class="sd">        :param index (QModelIndex): The index of the item.</span>
<span class="sd">        :param role (Qt.ItemDataRole): The role of the data to retrieve.</span>
<span class="sd">        :return: The data stored under the given role, or None if not</span>
<span class="sd">                 available.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">index</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">role</span> <span class="ow">in</span> <span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">EditRole</span><span class="p">):</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">internalPointer</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span>

        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="DictionaryTreeModel.flags">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.flags">[docs]</a>
    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the item flags for the specified index.</span>

<span class="sd">        :param index (QModelIndex): The model index to retrieve flags for.</span>

<span class="sd">        :return (Qt.ItemFlags): The corresponding item flags.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">internalPointer</span><span class="p">()</span>
        <span class="n">base_flags</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsSelectable</span>

        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">childCount</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">base_flags</span> <span class="o">|=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span>

        <span class="k">return</span> <span class="n">base_flags</span></div>


<div class="viewcode-block" id="DictionaryTreeModel.getNode">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.getNode">[docs]</a>
    <span class="k">def</span> <span class="nf">getNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the Node object from the given index.</span>

<span class="sd">        :param index (QModelIndex): The index of the node.</span>
<span class="sd">        :return: The Node object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">internalPointer</span><span class="p">()</span> <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">isValid</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">node</span> <span class="k">if</span> <span class="n">node</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rootNode</span></div>


<div class="viewcode-block" id="DictionaryTreeModel.headerData">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.headerData">[docs]</a>
    <span class="k">def</span> <span class="nf">headerData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">,</span> <span class="n">orientation</span><span class="p">,</span> <span class="n">role</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the data for the given role and section in the header.</span>

<span class="sd">        :param section (int): The section number.</span>
<span class="sd">        :param orientation (Qt.Orientation): The orientation of the header</span>
<span class="sd">                                             (unused in this implementation).</span>
<span class="sd">        :param role (Qt.ItemDataRole): The role of the data to retrieve.</span>

<span class="sd">        :return (str): The header data, or None if not available.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">section</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Packages&quot;</span>

            <span class="k">if</span> <span class="n">section</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Value&quot;</span>

        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="DictionaryTreeModel.index">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.index">[docs]</a>
    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an index for the given row, column, and parent.</span>

<span class="sd">        :param row (int): The row number.</span>
<span class="sd">        :param column (int): The column number.</span>
<span class="sd">        :param parent (QModelIndex): The parent index.</span>

<span class="sd">        :return (QModelIndex): The created index, or an invalid index if</span>
<span class="sd">                               not available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parentNode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">childItem</span> <span class="o">=</span> <span class="n">parentNode</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">createIndex</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">childItem</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">childItem</span>
            <span class="k">else</span> <span class="n">QModelIndex</span><span class="p">()</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="DictionaryTreeModel.insertRows">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.insertRows">[docs]</a>
    <span class="k">def</span> <span class="nf">insertRows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">QModelIndex</span><span class="p">()):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inserts rows starting from the specified position.</span>

<span class="sd">        :param position (int): The starting position to insert rows.</span>
<span class="sd">        :param rows (int): The number of rows to insert.</span>
<span class="sd">        :param parent (QModelIndex): The parent index.</span>
<span class="sd">        :return (bool): True if the rows were successfully inserted,</span>
<span class="sd">                        False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parentNode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beginInsertRows</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">position</span> <span class="o">+</span> <span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">all_inserted</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Track overall success</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
            <span class="n">childCount</span> <span class="o">=</span> <span class="n">parentNode</span><span class="o">.</span><span class="n">childCount</span><span class="p">()</span>
            <span class="n">childNode</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;untitled</span><span class="si">{</span><span class="n">childCount</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">parentNode</span><span class="o">.</span><span class="n">insertChild</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">childNode</span><span class="p">):</span>
                <span class="n">all_inserted</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Mark as failed if any insertion fails</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">endInsertRows</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">all_inserted</span>  <span class="c1"># Return final status</span></div>


<div class="viewcode-block" id="DictionaryTreeModel.mimeData">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.mimeData">[docs]</a>
    <span class="k">def</span> <span class="nf">mimeData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indexes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate MIME data for a drag-and-drop operation.</span>

<span class="sd">        :param indexes (list of QModelIndex): The list of model indexes being</span>
<span class="sd">                                              dragged.</span>
<span class="sd">        :return (QMimeData): A QMimeData object containing serialized node</span>
<span class="sd">                             information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mimedata</span> <span class="o">=</span> <span class="n">QMimeData</span><span class="p">()</span>
        <span class="n">encoded_data</span> <span class="o">=</span> <span class="n">QByteArray</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indexes</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">internalPointer</span><span class="p">()</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">())</span>
                <span class="n">encoded_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>  <span class="c1"># Accumulate all text data</span>

        <span class="n">mimedata</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="s2">&quot;component/name&quot;</span><span class="p">,</span> <span class="n">encoded_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mimedata</span></div>


<div class="viewcode-block" id="DictionaryTreeModel.mimeTypes">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.mimeTypes">[docs]</a>
    <span class="k">def</span> <span class="nf">mimeTypes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the supported MIME types.</span>

<span class="sd">        :return (list of str): A list of supported MIME types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;component/name&quot;</span><span class="p">]</span></div>


<div class="viewcode-block" id="DictionaryTreeModel.parent">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.parent">[docs]</a>
    <span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the parent index for the given index.</span>

<span class="sd">        :param index (QModelIndex): The index of the item.</span>
<span class="sd">        :return (QModelIndex): The parent index, or an invalid index if not</span>
<span class="sd">                               available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="n">parentNode</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">parentNode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rootNode</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">QModelIndex</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">createIndex</span><span class="p">(</span><span class="n">parentNode</span><span class="o">.</span><span class="n">row</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">parentNode</span><span class="p">)</span></div>


<div class="viewcode-block" id="DictionaryTreeModel.removeRows">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.removeRows">[docs]</a>
    <span class="k">def</span> <span class="nf">removeRows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">QModelIndex</span><span class="p">()):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes rows starting from the specified position to position+rows.</span>

<span class="sd">        :param position (int): The starting position to remove rows.</span>
<span class="sd">        :param rows (int): The number of rows to remove.</span>
<span class="sd">        :param parent (QModelIndex): The parent index.</span>
<span class="sd">        :return (bool): True if all rows were successfully removed,</span>
<span class="sd">                        False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parentNode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beginRemoveRows</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">position</span> <span class="o">+</span> <span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">all_removed</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Track overall success</span>

        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">parentNode</span><span class="o">.</span><span class="n">removeChild</span><span class="p">(</span><span class="n">position</span><span class="p">):</span>
                <span class="n">all_removed</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Mark as failed if any removal fails</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">endRemoveRows</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">all_removed</span>  <span class="c1"># Return final status</span></div>


<div class="viewcode-block" id="DictionaryTreeModel.rowCount">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.rowCount">[docs]</a>
    <span class="k">def</span> <span class="nf">rowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the number of rows, which corresponds to the number of</span>
<span class="sd">        children.</span>

<span class="sd">        :param parent (QModelIndex): The parent index.</span>
<span class="sd">        :return (int): The number of rows.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parentNode</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span> <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">isValid</span><span class="p">()</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rootNode</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">parentNode</span><span class="o">.</span><span class="n">childCount</span><span class="p">()</span></div>


<div class="viewcode-block" id="DictionaryTreeModel.setData">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.setData">[docs]</a>
    <span class="k">def</span> <span class="nf">setData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">EditRole</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the data when the user makes changes.</span>

<span class="sd">        :param index (QModelIndex): The index of the item.</span>
<span class="sd">        :param value: The new value to set.</span>
<span class="sd">        :param role (Qt.ItemDataRole): The role of the data to set.</span>
<span class="sd">        :return (bool): True if the data was successfully set, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">isValid</span><span class="p">()</span> <span class="ow">and</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">EditRole</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">internalPointer</span><span class="p">()</span>
            <span class="n">node</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">(),</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="DictionaryTreeModel.to_dict">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.to_dict">[docs]</a>
    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the root node to a dictionary.</span>

<span class="sd">        :return (dict): The dictionary representation of the root node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rootNode</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="InstallProcesses">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.InstallProcesses">[docs]</a>
<span class="k">class</span> <span class="nc">InstallProcesses</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dialog for installing Python packages from a folder or zip file.</span>

<span class="sd">    This widget allows users to browse and select a Python package or zip file</span>
<span class="sd">    containing packages, then install them into Populse_MIA.</span>

<span class="sd">    .. Methods:</span>
<span class="sd">        - _add_package: Add a package and its modules to the process tree.</span>
<span class="sd">        - _change_pattern_in_folder: Replace pattern in all Python files</span>
<span class="sd">                                     within a folder.</span>
<span class="sd">        - _install_new_package: Install a new package.</span>
<span class="sd">        - _load_process_config: Load the process configuration from YAML.</span>
<span class="sd">        - _rollback_changes: Roll back changes in case of installation failure.</span>
<span class="sd">        - _show_qmessagebox: Display an error message box.</span>
<span class="sd">        - _show_status_message: Update status message in the main window.</span>
<span class="sd">        - _update_existing_package: Update an existing package.</span>
<span class="sd">        - _validate_input: Validate the input file or directory.</span>
<span class="sd">        - get_filename: Opens a file dialog to get the folder or zip file to</span>
<span class="sd">                        install.</span>
<span class="sd">        - install: Installs the selected file/folder on Populse_mia.</span>

<span class="sd">    .. Signals:</span>
<span class="sd">        - process_installed: Emitted when a process is successfully installed</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">process_installed</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">()</span>

<div class="viewcode-block" id="InstallProcesses.__init__">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.InstallProcesses.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">main_window</span><span class="p">,</span> <span class="n">folder</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the installation dialog.</span>

<span class="sd">        :param main_window: The main application window</span>
<span class="sd">        :param folder (bool): If True, install from folder; if False, install</span>
<span class="sd">                              from zip file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">main_window</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span> <span class="o">=</span> <span class="n">main_window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Install processes&quot;</span><span class="p">)</span>
        <span class="c1"># Set up layout</span>
        <span class="n">v_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">v_layout</span><span class="p">)</span>
        <span class="c1"># Choose appropriate label text based on installation type</span>
        <span class="n">label_text</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Choose folder containing Python packages&quot;</span>
            <span class="k">if</span> <span class="n">folder</span>
            <span class="k">else</span> <span class="s2">&quot;Choose zip file containing Python packages&quot;</span>
        <span class="p">)</span>
        <span class="n">v_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="n">label_text</span><span class="p">))</span>
        <span class="c1"># File selection section</span>
        <span class="n">edit_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">v_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">edit_layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path_edit</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
        <span class="n">edit_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_edit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Browse&quot;</span><span class="p">)</span>
        <span class="n">edit_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">browser_button</span><span class="p">)</span>
        <span class="c1"># Bottom buttons</span>
        <span class="n">bottom_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">v_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">bottom_layout</span><span class="p">)</span>
        <span class="n">install_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Install package&quot;</span><span class="p">)</span>
        <span class="n">bottom_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">install_button</span><span class="p">)</span>
        <span class="n">quit_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Quit&quot;</span><span class="p">)</span>
        <span class="n">bottom_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">quit_button</span><span class="p">)</span>
        <span class="c1"># Connect signals</span>
        <span class="n">install_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">install</span><span class="p">)</span>
        <span class="n">quit_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">)</span>
        <span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_add_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proc_dic</span><span class="p">,</span> <span class="n">module_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a package and its modules to the process tree.</span>

<span class="sd">        :param proc_dic (dict): The process tree dictionary to update.</span>
<span class="sd">        :param module_name (str): Name of the module to add.</span>

<span class="sd">        :return (dict): The updated process tree dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">module_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">proc_dic</span>

        <span class="c1"># Reload the package if already loaded</span>
        <span class="k">if</span> <span class="n">module_name</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module_name</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="nb">__import__</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_show_qmessagebox</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;During the installation of </span><span class="si">{</span><span class="n">module_name</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;the following exception was raised:&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">err</span><span class="o">.</span><span class="vm">__class__</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;This exception may have prevented the installation.&quot;</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">result_add_package</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">module_name</span><span class="si">}</span><span class="s2"> brick may not have been installed.&quot;</span>
            <span class="p">)</span>

        <span class="n">pkg</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module_name</span><span class="p">]</span>

        <span class="c1"># Check for subpackages</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">modname</span><span class="p">,</span> <span class="n">ispkg</span> <span class="ow">in</span> <span class="n">pkgutil</span><span class="o">.</span><span class="n">iter_modules</span><span class="p">(</span><span class="n">pkg</span><span class="o">.</span><span class="n">__path__</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">ispkg</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_package</span><span class="p">(</span><span class="n">proc_dic</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">module_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">modname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Process each class in the package</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">pkg</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">())):</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Installing </span><span class="si">{</span><span class="n">module_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
                <span class="n">get_process_instance</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">module_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># Update the tree dictionary</span>
                <span class="n">path_list</span> <span class="o">=</span> <span class="n">module_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
                <span class="n">path_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="n">pkg_iter</span> <span class="o">=</span> <span class="n">proc_dic</span>

                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">path_list</span><span class="p">):</span>

                    <span class="k">if</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">pkg_iter</span><span class="p">:</span>
                        <span class="n">pkg_iter</span> <span class="o">=</span> <span class="n">pkg_iter</span><span class="p">[</span><span class="n">element</span><span class="p">]</span>

                    <span class="k">else</span><span class="p">:</span>

                        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">path_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">pkg_iter</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;process_enabled&quot;</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">pkg_iter</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                            <span class="n">pkg_iter</span> <span class="o">=</span> <span class="n">pkg_iter</span><span class="p">[</span><span class="n">element</span><span class="p">]</span>

            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Error during installation of &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;the &#39;</span><span class="si">{</span><span class="n">module_name</span><span class="si">}</span><span class="s2">&#39; module ...!&quot;</span><span class="p">,</span>
                    <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">result_add_package</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">proc_dic</span>

    <span class="k">def</span> <span class="nf">_change_pattern_in_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">old_pattern</span><span class="p">,</span> <span class="n">new_pattern</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace pattern in all Python files within a folder.</span>

<span class="sd">        :param path (str): Directory path to process.</span>
<span class="sd">        :param old_pattern (str): Pattern to search for.</span>
<span class="sd">        :param new_pattern (str): Pattern to replace with.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>

            <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">fname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">):</span>
                    <span class="k">continue</span>

                <span class="c1"># Modifying only .py files (pipelines are saved with</span>
                <span class="c1"># this extension)</span>
                <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>

                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

                <span class="c1"># Replace the pattern</span>
                <span class="n">updated_content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">old_pattern</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_pattern</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>

                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">updated_content</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_install_new_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">package_name</span><span class="p">,</span> <span class="n">processes_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Install a new package.</span>

<span class="sd">        :param filename (str): Path to zip file or directory.</span>
<span class="sd">        :param package_name (str): Name of the package to install.</span>
<span class="sd">        :param processes_path (str): Target directory for installation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">is_zipfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>

            <span class="k">with</span> <span class="n">ZipFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
                <span class="n">members_to_extract</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">member</span>
                    <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">zip_ref</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">member</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">package_name</span><span class="p">)</span>
                <span class="p">]</span>
                <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">processes_path</span><span class="p">,</span> <span class="n">members_to_extract</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
                <span class="n">filename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">processes_path</span><span class="p">,</span> <span class="n">package_name</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_process_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load the process configuration from YAML.</span>

<span class="sd">        :param config_path (str): Path to the configuration file.</span>

<span class="sd">        :return (dict): The loaded configuration or empty dict if error.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
                <span class="c1"># Import here to prevent circular import</span>
                <span class="kn">from</span> <span class="nn">populse_mia.utils</span> <span class="kn">import</span> <span class="n">verCmp</span>

                <span class="k">if</span> <span class="n">verCmp</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span> <span class="s2">&quot;5.1&quot;</span><span class="p">,</span> <span class="s2">&quot;sup&quot;</span><span class="p">):</span>
                    <span class="n">process_dic</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">process_dic</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">process_dic</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading process config: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_rollback_changes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">config_path</span><span class="p">,</span>
        <span class="n">original_config</span><span class="p">,</span>
        <span class="n">processes_path</span><span class="p">,</span>
        <span class="n">package_names</span><span class="p">,</span>
        <span class="n">mia_processes_not_found</span><span class="p">,</span>
        <span class="n">tmp_folder4MIA</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Roll back changes in case of installation failure.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        :param config_path (str): Path to configuration file.</span>
<span class="sd">        :param original_config (dict): Original configuration to restore.</span>
<span class="sd">        :param processes_path (str): Path to processes directory.</span>
<span class="sd">        :param package_names (list): Names of packages that were being</span>
<span class="sd">                                     installed.</span>
<span class="sd">        :param mia_processes_not_found (bool): Flag indicating if</span>
<span class="sd">                                               Mia processes backup was made.</span>
<span class="sd">        :param tmp_folder4MIA (str): Path to Mia processes backup.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">original_config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">original_config</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Restore original configuration</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
                <span class="n">original_config</span><span class="p">,</span>
                <span class="n">stream</span><span class="p">,</span>
                <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Remove extracted packages</span>
        <span class="k">for</span> <span class="n">package_name</span> <span class="ow">in</span> <span class="n">package_names</span> <span class="ow">or</span> <span class="p">[]:</span>
            <span class="n">package_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">processes_path</span><span class="p">,</span> <span class="n">package_name</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">package_path</span><span class="p">):</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">package_path</span><span class="p">)</span>

        <span class="c1"># Restore Mia processes if needed</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mia_processes_not_found</span> <span class="ow">and</span> <span class="n">tmp_folder4MIA</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_folder4MIA</span><span class="p">,</span> <span class="s2">&quot;mia_processes&quot;</span><span class="p">),</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">processes_path</span><span class="p">,</span> <span class="s2">&quot;mia_processes&quot;</span><span class="p">),</span>
                <span class="n">dirs_exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_show_qmessagebox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">critical</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display an error message box.</span>

<span class="sd">        :param message (str): Message to display</span>
<span class="sd">        :param critical (bool): If True, display a critical message box.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">critical</span><span class="p">:</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Critical</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Warning&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Installation completed&quot;</span><span class="p">)</span>

        <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_show_status_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update status message in the main window.</span>

<span class="sd">        :param message (str): Status message to display</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_existing_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">package_name</span><span class="p">,</span> <span class="n">processes_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update an existing package.</span>

<span class="sd">        :param filename (str): Path to zip file or directory.</span>
<span class="sd">        :param package_name (str): Name of the package to update.</span>
<span class="sd">        :param processes_path (str): Target directory for installation.</span>

<span class="sd">        :return (str): The new package name (with timestamp).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create timestamped name for the new version</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">)</span>
        <span class="n">new_package_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="n">is_zipfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>

            <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmp_dir</span><span class="p">:</span>

                <span class="k">with</span> <span class="n">ZipFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
                    <span class="n">members_to_extract</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">member</span>
                        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">zip_ref</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">member</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">package_name</span><span class="p">)</span>
                    <span class="p">]</span>
                    <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">,</span> <span class="n">members_to_extract</span><span class="p">)</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">,</span> <span class="n">package_name</span><span class="p">),</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">processes_path</span><span class="p">,</span> <span class="n">new_package_name</span><span class="p">),</span>
                    <span class="p">)</span>

        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
                <span class="n">filename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">processes_path</span><span class="p">,</span> <span class="n">new_package_name</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Replace package name references in files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_change_pattern_in_folder</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">processes_path</span><span class="p">,</span> <span class="n">new_package_name</span><span class="p">),</span>
            <span class="n">package_name</span><span class="p">,</span>
            <span class="n">new_package_name</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">new_package_name</span>

    <span class="k">def</span> <span class="nf">_validate_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate the input file or directory.</span>

<span class="sd">        :param filename (str): Path to the file or directory.</span>

<span class="sd">        :return (bool): True if valid, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_show_qmessagebox</span><span class="p">(</span>
                <span class="s2">&quot;The specified file or directory cannot be found&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_show_qmessagebox</span><span class="p">(</span><span class="s2">&quot;The specified file has to be a .zip file&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

<div class="viewcode-block" id="InstallProcesses.get_filename">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.InstallProcesses.get_filename">[docs]</a>
    <span class="k">def</span> <span class="nf">get_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open a file dialog to select the package source.</span>

<span class="sd">        :param folder (bool): If True, opens a directory selection dialog;</span>
<span class="sd">                              If False, opens a zip file selection dialog</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">folder</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getExistingDirectory</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="n">caption</span><span class="o">=</span><span class="s2">&quot;Select a directory&quot;</span><span class="p">,</span>
                <span class="n">directory</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">),</span>
                <span class="n">options</span><span class="o">=</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">ShowDirsOnly</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span>
                <span class="n">caption</span><span class="o">=</span><span class="s2">&quot;Select a zip file&quot;</span><span class="p">,</span>
                <span class="n">directory</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">),</span>
                <span class="nb">filter</span><span class="o">=</span><span class="s2">&quot;Compatible files (*.zip)&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">filename</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="InstallProcesses.install">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.InstallProcesses.install">[docs]</a>
    <span class="k">def</span> <span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Install a package from a zip file or a folder.</span>

<span class="sd">        This method handles the complete installation process:</span>
<span class="sd">        1. Extracts or copies the package to the processes directory</span>
<span class="sd">        2. Updates the process dictionary</span>
<span class="sd">        3. Registers the new package in the configuration</span>

<span class="sd">        Any exceptions during installation are caught and reported to the</span>
<span class="sd">        user, with automatic rollback of any changes made.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tmp_folder4MIA</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_show_status_message</span><span class="p">(</span><span class="s2">&quot;Package installation, please wait...&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result_add_package</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

            <span class="c1"># Validate input file/folder</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_input</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                <span class="k">return</span>

            <span class="c1"># Setup paths</span>
            <span class="n">processes_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span> <span class="s2">&quot;processes&quot;</span>
            <span class="p">)</span>
            <span class="n">config_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span>
                <span class="s2">&quot;properties&quot;</span><span class="p">,</span>
                <span class="s2">&quot;process_config.yml&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Ensure process path is in sys.path</span>
            <span class="k">if</span> <span class="n">processes_path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processes_path</span><span class="p">)</span>

            <span class="c1"># Create process config file if it doesn&#39;t exist</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">config_file_path</span><span class="p">):</span>
                <span class="nb">open</span><span class="p">(</span><span class="n">config_file_path</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="c1"># Load current process configuration</span>
            <span class="n">process_dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_process_config</span><span class="p">(</span><span class="n">config_file_path</span><span class="p">)</span>
            <span class="c1"># Copy the original process tree for rollback if needed</span>
            <span class="n">process_dic_orig</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">process_dic</span><span class="p">)</span>
            <span class="c1"># Extract package information</span>
            <span class="n">packages</span> <span class="o">=</span> <span class="n">process_dic</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Packages&quot;</span><span class="p">,</span> <span class="p">{})</span> <span class="ow">or</span> <span class="p">{}</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="n">process_dic</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Paths&quot;</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">or</span> <span class="p">[]</span>
            <span class="c1"># Get existing packages</span>
            <span class="c1"># packages_already: packages already installed in populse_</span>
            <span class="c1"># mia (populse_mia/processes)</span>
            <span class="n">packages_already</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">d</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">processes_path</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">processes_path</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span>
            <span class="p">]</span>
            <span class="c1"># Handle Mia processes special case</span>
            <span class="n">package_names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">mia_processes_not_found</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># Get packages names from zip or directory</span>
            <span class="k">if</span> <span class="n">is_zipfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>

                <span class="c1"># Extraction of the zipped content</span>
                <span class="k">with</span> <span class="n">ZipFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
                    <span class="n">packages_name</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">member</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">zip_ref</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="nb">len</span><span class="p">(</span><span class="n">member</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2</span>
                            <span class="ow">and</span> <span class="ow">not</span> <span class="n">member</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="p">]</span>

            <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                <span class="c1"># Careful: If filename is not a zip file, filename must be a</span>
                <span class="c1"># directory that contains only the package(s) to install !!!</span>
                <span class="n">packages_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">)]</span>

            <span class="c1"># Process each package</span>
            <span class="k">for</span> <span class="n">package_name</span> <span class="ow">in</span> <span class="n">packages_name</span><span class="p">:</span>

                <span class="c1"># Handle mia_processes backup</span>
                <span class="k">if</span> <span class="n">mia_processes_not_found</span> <span class="ow">and</span> <span class="n">package_name</span> <span class="o">==</span> <span class="s2">&quot;mia_processes&quot;</span><span class="p">:</span>
                    <span class="n">mia_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">processes_path</span><span class="p">,</span> <span class="s2">&quot;mia_processes&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">mia_path</span><span class="p">):</span>
                        <span class="n">mia_processes_not_found</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">tmp_folder4MIA</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
                        <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
                            <span class="n">mia_path</span><span class="p">,</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_folder4MIA</span><span class="p">,</span> <span class="s2">&quot;mia_processes&quot;</span><span class="p">),</span>
                        <span class="p">)</span>

                <span class="c1"># Install or update package</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">package_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">packages_already</span>
                    <span class="ow">or</span> <span class="n">package_name</span> <span class="o">==</span> <span class="s2">&quot;mia_processes&quot;</span>
                <span class="p">):</span>
                    <span class="c1"># Fresh install</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_install_new_package</span><span class="p">(</span>
                        <span class="n">filename</span><span class="p">,</span> <span class="n">package_name</span><span class="p">,</span> <span class="n">processes_path</span>
                    <span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Update existing package</span>
                    <span class="n">package_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_existing_package</span><span class="p">(</span>
                        <span class="n">filename</span><span class="p">,</span> <span class="n">package_name</span><span class="p">,</span> <span class="n">processes_path</span>
                    <span class="p">)</span>

                <span class="n">package_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">package_name</span><span class="p">)</span>
                <span class="c1"># package_names contains all the extracted packages</span>
                <span class="n">final_package_dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_package</span><span class="p">(</span><span class="n">packages</span><span class="p">,</span> <span class="n">package_name</span><span class="p">)</span>

            <span class="c1"># Ensure processes path is in config</span>
            <span class="k">if</span> <span class="n">processes_path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
                <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processes_path</span><span class="p">)</span>

            <span class="c1"># Update and save configuration</span>
            <span class="n">process_dic</span><span class="p">[</span><span class="s2">&quot;Packages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_package_dic</span>
            <span class="n">process_dic</span><span class="p">[</span><span class="s2">&quot;Paths&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">paths</span>
            <span class="c1"># FIXME: Should we encrypt the path ?</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
                <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
                    <span class="n">process_dic</span><span class="p">,</span>
                    <span class="n">stream</span><span class="p">,</span>
                    <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># Signal successful installation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_installed</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># Handle installation failure</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Error during installation of &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;the &#39;</span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2">&#39; library...!&quot;</span><span class="p">,</span>
                <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result_add_package</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_show_status_message</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Installation of the &#39;</span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2">&#39; library aborted!&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_show_qmessagebox</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Installation of the &#39;</span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2">&#39; library aborted!</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Please see the standard output for more details.&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="c1"># Restore original configuration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rollback_changes</span><span class="p">(</span>
                <span class="n">config_file_path</span><span class="p">,</span>
                <span class="n">process_dic_orig</span><span class="p">,</span>
                <span class="n">processes_path</span><span class="p">,</span>
                <span class="n">package_names</span><span class="p">,</span>
                <span class="n">mia_processes_not_found</span><span class="p">,</span>
                <span class="n">tmp_folder4MIA</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_add_package</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The &#39;</span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2">&#39; library has been correctly &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;installed.&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_show_status_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_show_qmessagebox</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">critical</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The &#39;</span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2">&#39; library has not been &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;correctly installed.&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_show_status_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_show_qmessagebox</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">finally</span><span class="p">:</span>

            <span class="c1"># Cleanup temporary directories</span>
            <span class="k">if</span> <span class="n">tmp_folder4MIA</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">tmp_folder4MIA</span><span class="p">):</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tmp_folder4MIA</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Node">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node">[docs]</a>
<span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A tree-like structure to manage hierarchical data with parent-child</span>
<span class="sd">    relationships.</span>

<span class="sd">    This class provides functionality to create and manipulate tree nodes,</span>
<span class="sd">    where each node can have a name, value, parent, and multiple children.</span>

<span class="sd">    .. Methods:</span>
<span class="sd">        -  __repr__: Define what should be printed by the class.</span>
<span class="sd">        - _recurse_dict: Recursively build a dictionary representation of the</span>
<span class="sd">                         node hierarchy.</span>
<span class="sd">        - addChild: Add a child to the children list.</span>
<span class="sd">        - attrs: Get attributes of this node as a dictionary.</span>
<span class="sd">        - child: Return a child from its index in the list.</span>
<span class="sd">        - childCount: return the number of children.</span>
<span class="sd">        - data: Return the name or the value of the object.</span>
<span class="sd">        - insertChild: Insert a child to a specific position.</span>
<span class="sd">        - log: Generate a formatted string representation of the node</span>
<span class="sd">               hierarchy.</span>
<span class="sd">        - name: Gets or sets the name of the node.</span>
<span class="sd">        - parent: Return the parent of the node.</span>
<span class="sd">        - removeChild:  Remove a child node at the specified position.</span>
<span class="sd">        - resource: Placeholder that always returns None.</span>
<span class="sd">        - row: Return the index of the object in its parent list of children.</span>
<span class="sd">        - setData: Update the name or the value of the object.</span>
<span class="sd">        - to_dict: Convert the node hierarchy to a dictionary.</span>
<span class="sd">        - to_list: Convert the node hierarchy to a list.</span>
<span class="sd">        - value: Gets or sets the value of the node.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Node.__init__">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a new Node instance.</span>

<span class="sd">        :param name (str): The name of the node.</span>
<span class="sd">        :param parent: The parent node. If provided, this node is</span>
<span class="sd">                       automatically added as a child to the parent.</span>
<span class="sd">                       Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="kc">None</span></div>


    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a string representation of the node hierarchy.</span>

<span class="sd">        :return (str): A formatted string showing the node hierarchy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_recurse_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recursively build a dictionary representation of the node hierarchy.</span>

<span class="sd">        :param d (dict): The dictionary to populate with the node hierarchy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
            <span class="n">child</span><span class="o">.</span><span class="n">_recurse_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>

<div class="viewcode-block" id="Node.addChild">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.addChild">[docs]</a>
    <span class="k">def</span> <span class="nf">addChild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a child node to this node.</span>

<span class="sd">        :param child: The child node to add.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span></div>


<div class="viewcode-block" id="Node.attrs">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.attrs">[docs]</a>
    <span class="k">def</span> <span class="nf">attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get attributes of this node as a dictionary.</span>

<span class="sd">        :return (dict): A dictionary of property names and their values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__mro__</span>
        <span class="n">keyvalued</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">property</span><span class="p">):</span>
                    <span class="n">keyvalued</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">fget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">keyvalued</span></div>


<div class="viewcode-block" id="Node.child">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.child">[docs]</a>
    <span class="k">def</span> <span class="nf">child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a child node by its index.</span>

<span class="sd">        :param row (int): The index of the child node in the children list.</span>

<span class="sd">        :return: The child node at the specified index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">row</span><span class="p">]</span></div>


<div class="viewcode-block" id="Node.childCount">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.childCount">[docs]</a>
    <span class="k">def</span> <span class="nf">childCount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the number of children of this node.</span>

<span class="sd">        :return (int): The number of child nodes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">)</span></div>


<div class="viewcode-block" id="Node.data">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.data">[docs]</a>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get data about this node based on the column parameter.</span>

<span class="sd">        :param column (int): 0 for the fully qualified name (including parent</span>
<span class="sd">                             names), 1 for the value of this node.</span>
<span class="sd">        :return (str): The requested data (either string path or node value).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span>
            <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

            <span class="k">while</span> <span class="n">parent</span> <span class="ow">and</span> <span class="n">parent</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;Root&quot;</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">_parent</span>

            <span class="c1"># self.name</span>
            <span class="k">return</span> <span class="n">text</span>

        <span class="k">elif</span> <span class="n">column</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span></div>


<div class="viewcode-block" id="Node.insertChild">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.insertChild">[docs]</a>
    <span class="k">def</span> <span class="nf">insertChild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert a child node at a specific position.</span>

<span class="sd">        :param position (int): The position at which to insert the child.</span>
<span class="sd">        :param child: The child node to insert.</span>

<span class="sd">        :return (bool): True if insertion was successful, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">position</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">position</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>
        <span class="n">child</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Node.log">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.log">[docs]</a>
    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tabLevel</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a formatted string representation of the node hierarchy.</span>

<span class="sd">        :param tabLevel (int): The current indentation level. Defaults to -1.</span>

<span class="sd">        :retur (str): A formatted string showing the node hierarchy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tabLevel</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">indent</span> <span class="o">=</span> <span class="s2">&quot;    &quot;</span> <span class="o">*</span> <span class="n">tabLevel</span>
        <span class="n">output</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indent</span><span class="si">}</span><span class="s2">|----</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2"> = </span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="n">child</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">tabLevel</span><span class="p">)</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the name of this node.</span>

<span class="sd">        :return (str): The name of the node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="nd">@name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the name of this node.</span>

<span class="sd">        :param value (str): The new name for the node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="Node.parent">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.parent">[docs]</a>
    <span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the parent of this node.</span>

<span class="sd">        :return: The parent node or None if this is a root node.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span></div>


<div class="viewcode-block" id="Node.removeChild">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.removeChild">[docs]</a>
    <span class="k">def</span> <span class="nf">removeChild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a child node at the specified position.</span>

<span class="sd">        :param position (int): The position of the child to remove.</span>
<span class="sd">        :param child: The child node to remove.</span>

<span class="sd">        :return (bool): True if removal was successful, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">position</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">position</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
        <span class="n">child</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Node.resource">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.resource">[docs]</a>
    <span class="k">def</span> <span class="nf">resource</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get resource information for this node.</span>

<span class="sd">        This method is a placeholder that always returns None.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="Node.row">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.row">[docs]</a>
    <span class="k">def</span> <span class="nf">row</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the index of this node in its parent&#39;s children list.</span>

<span class="sd">        :return (int): The index of this node in its parent&#39;s children list,</span>
<span class="sd">                       or None if this node has no parent.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="Node.setData">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.setData">[docs]</a>
    <span class="k">def</span> <span class="nf">setData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the name or value of this node based on the column parameter.</span>

<span class="sd">        :param column (int): 0 to set the name, 1 to set the value.</span>
<span class="sd">        :param value: The new name or value to set.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span></div>


<div class="viewcode-block" id="Node.to_dict">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.to_dict">[docs]</a>
    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert the node hierarchy to a dictionary.</span>

<span class="sd">        :param d (dict): A dictionary to populate. Defaults to empty dict.</span>

<span class="sd">        :return (dict): A dictionary representation of the node hierarchy.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">d</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
            <span class="n">child</span><span class="o">.</span><span class="n">_recurse_dict</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">d</span></div>


<div class="viewcode-block" id="Node.to_list">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.to_list">[docs]</a>
    <span class="k">def</span> <span class="nf">to_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert the node hierarchy to a list.</span>

<span class="sd">        :return (list): A list representation of the node hierarchy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">output</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the value of this node.</span>

<span class="sd">        :return: The value of the node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the value of this node.</span>

<span class="sd">        :param value: The new value for the node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span></div>



<div class="viewcode-block" id="PackageLibrary">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibrary">[docs]</a>
<span class="k">class</span> <span class="nc">PackageLibrary</span><span class="p">(</span><span class="n">QTreeWidget</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A tree widget that displays user-added packages and their modules.</span>

<span class="sd">    This widget allows users to enable or disable packages and modules by</span>
<span class="sd">    checking or unchecking them in the tree view. The tree structure</span>
<span class="sd">    reflects the hierarchical organization of packages and their modules.</span>

<span class="sd">    .. Methods:</span>
<span class="sd">        - fill_item: fills the items of the tree recursively</span>
<span class="sd">        - generate_tree: generates the package tree</span>
<span class="sd">        - recursive_checks: checks/unchecks all child items</span>
<span class="sd">        - recursive_checks_from_child: checks/unchecks all parent items</span>
<span class="sd">        - set_module_view: sets if a module has to be enabled or disabled in</span>
<span class="sd">                           the process library</span>
<span class="sd">        - update_checks: updates the checks of the tree from an item</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="PackageLibrary.__init__">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibrary.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">package_tree</span><span class="p">,</span> <span class="n">paths</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the PackageLibrary widget.</span>

<span class="sd">        :param package_tree (dict): Hierarchical representation of packages.</span>
<span class="sd">        :param paths (list): System paths for importing the packages.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_checks</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">package_tree</span> <span class="o">=</span> <span class="n">package_tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="n">paths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_tree</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setAlternatingRowColors</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setHeaderLabel</span><span class="p">(</span><span class="s2">&quot;Packages&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="PackageLibrary.fill_item">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibrary.fill_item">[docs]</a>
    <span class="k">def</span> <span class="nf">fill_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recursively populate the tree items.</span>

<span class="sd">        Traverses the package tree and creates corresponding QTreeWidgetItems</span>
<span class="sd">        with appropriate check states.</span>

<span class="sd">        :param item (QTreeWidgetItem): Current tree item to populate.</span>
<span class="sd">        :param value (dict, list, or str): Value to populate the item with.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setExpanded</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>

            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">child</span> <span class="o">=</span> <span class="n">QTreeWidgetItem</span><span class="p">()</span>
                <span class="n">child</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
                <span class="n">item</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fill_item</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>

                    <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;process_enabled&quot;</span><span class="p">:</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">recursive_checks_from_child</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;process_disabled&quot;</span><span class="p">:</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>

            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">child</span> <span class="o">=</span> <span class="n">QTreeWidgetItem</span><span class="p">()</span>
                <span class="n">item</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;[dict]&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fill_item</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;[list]&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fill_item</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>

                <span class="n">child</span><span class="o">.</span><span class="n">setExpanded</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">child</span> <span class="o">=</span> <span class="n">QTreeWidgetItem</span><span class="p">()</span>
            <span class="n">child</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="n">item</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span><span class="n">child</span><span class="p">)</span></div>


<div class="viewcode-block" id="PackageLibrary.generate_tree">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibrary.generate_tree">[docs]</a>
    <span class="k">def</span> <span class="nf">generate_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate the package tree structure.</span>

<span class="sd">        Clears the current tree and populates it with items from package_tree.</span>
<span class="sd">        Temporarily disconnects the itemChanged signal to prevent unwanted</span>
<span class="sd">        updates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">invisibleRootItem</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">package_tree</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_checks</span><span class="p">)</span></div>


<div class="viewcode-block" id="PackageLibrary.recursive_checks">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibrary.recursive_checks">[docs]</a>
    <span class="k">def</span> <span class="nf">recursive_checks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Propagate check state down to all child items.</span>

<span class="sd">        When a parent item is checked/unchecked, all its children</span>
<span class="sd">        inherit the same check state.</span>

<span class="sd">        :param parent (QTreeWidgetItem): Parent item whose check state is</span>
<span class="sd">                                         propagated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_state</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">checkState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">childCount</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_module_view</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">check_state</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">childCount</span><span class="p">()):</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">check_state</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recursive_checks</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">i</span><span class="p">))</span></div>


<div class="viewcode-block" id="PackageLibrary.recursive_checks_from_child">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibrary.recursive_checks_from_child">[docs]</a>
    <span class="k">def</span> <span class="nf">recursive_checks_from_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Propagate check state up to parent items.</span>

<span class="sd">        When a child item is checked, its parents are also checked.</span>
<span class="sd">        When a child item is unchecked, its parent is unchecked only if</span>
<span class="sd">        all siblings are also unchecked.</span>

<span class="sd">        :param child (QTreeWidgetItem): Child item whose check state affects</span>
<span class="sd">                                        parents.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_state</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">checkState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">childCount</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_module_view</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">check_state</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">parent</span><span class="p">():</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">check_state</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">checkState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">:</span>
                    <span class="n">parent</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">recursive_checks_from_child</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Check if any siblings are still checked</span>
                <span class="n">has_checked_siblings</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
                    <span class="n">parent</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">checkState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">childCount</span><span class="p">())</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">has_checked_siblings</span><span class="p">:</span>
                    <span class="n">parent</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">recursive_checks_from_child</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span></div>


<div class="viewcode-block" id="PackageLibrary.set_module_view">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibrary.set_module_view">[docs]</a>
    <span class="k">def</span> <span class="nf">set_module_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the module&#39;s enabled/disabled status in the package tree.</span>

<span class="sd">        Updates the underlying package_tree data structure when an item&#39;s</span>
<span class="sd">        check state changes in the UI.</span>

<span class="sd">        :param item (QTreeWidgetItem): Tree item corresponding to a module.</span>
<span class="sd">        :param state (Qt.CheckState): New check state, Qt.Checked or</span>
<span class="sd">                                      Qt.Unchecked.</span>
<span class="sd">                                      (Qt.Checked == 2. So if</span>
<span class="sd">                                      val == 2 -&gt; checkbox is checked, and if</span>
<span class="sd">                                      val == 0 -&gt; checkbox is not checked)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="s2">&quot;process_enabled&quot;</span> <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span> <span class="k">else</span> <span class="s2">&quot;process_disabled&quot;</span>

        <span class="c1"># Build path from item to root</span>
        <span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">item</span>

        <span class="k">while</span> <span class="n">current</span><span class="p">:</span>
            <span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">current</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>

        <span class="c1"># Update package_tree according to the path</span>
        <span class="n">pkg_iter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">package_tree</span>

        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>  <span class="c1"># Navigate to parent of target node</span>

            <span class="k">if</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">pkg_iter</span><span class="p">:</span>
                <span class="n">pkg_iter</span> <span class="o">=</span> <span class="n">pkg_iter</span><span class="p">[</span><span class="n">element</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Package &#39;</span><span class="si">{</span><span class="n">element</span><span class="si">}</span><span class="s2">&#39; not found in tree&quot;</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="c1"># Update the value of the target node</span>
        <span class="k">if</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">pkg_iter</span><span class="p">:</span>
            <span class="n">pkg_iter</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">val</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Module &#39;</span><span class="si">{</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; not found in package&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="PackageLibrary.update_checks">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibrary.update_checks">[docs]</a>
    <span class="k">def</span> <span class="nf">update_checks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;Handle check state changes and propagate them.</span>

<span class="sd">        When an item&#39;s check state changes, this method ensures the change</span>
<span class="sd">        is properly propagated to children and parent items.</span>

<span class="sd">        :param item (QTreeWidgetItem): Item whose check state changed.</span>
<span class="sd">        :param column (int): Column index of the change (should be 0).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Checked state is stored on column 0</span>
        <span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Temporarily disconnect to prevent signal recursion</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

            <span class="c1"># Propagate changes down to children</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">childCount</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">recursive_checks</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

            <span class="c1"># Propagate changes up to parents</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">recursive_checks_from_child</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

            <span class="c1"># Reconnect signal</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_checks</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="PackageLibraryDialog">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibraryDialog">[docs]</a>
<span class="k">class</span> <span class="nc">PackageLibraryDialog</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dialog for managing package library configurations.</span>

<span class="sd">    This dialog allows users to add, remove, and delete packages from the</span>
<span class="sd">    process library. It provides interfaces for installing packages, updating</span>
<span class="sd">    the package tree, and saving configurations.</span>

<span class="sd">    .. Methods:</span>
<span class="sd">        - _create_button: Create a standardized button.</span>
<span class="sd">        - _create_install_buttons: Create buttons for installing processes.</span>
<span class="sd">        - _create_line_edit: Create and configure the line edit.</span>
<span class="sd">        - _create_list_group: Create a group box for a list with reset</span>
<span class="sd">                              functionality.</span>
<span class="sd">        - _create_list_widget: Create a list widget with extended selection</span>
<span class="sd">                               mode.</span>
<span class="sd">        - _create_main_layout: Create the main layout for the dialog.</span>
<span class="sd">        - _create_package_management_buttons: Create buttons for package</span>
<span class="sd">                                              management.</span>
<span class="sd">        - _create_save_cancel_layout: Create layout for save and cancel</span>
<span class="sd">                                      buttons.</span>
<span class="sd">        - _create_status_label: Create and configure the status label.</span>
<span class="sd">        - _load_initial_configuration: Load initial package configuration.</span>
<span class="sd">        - _setup_ui: Set up the user interface components</span>
<span class="sd">        - add_package: Add a package and its modules to the package tree.</span>
<span class="sd">        - add_package_with_text: Add a package from the line edit text.</span>
<span class="sd">        - browse_package: Open a browser to select a package (commented).</span>
<span class="sd">        - delete_package: Delete a package (admin-only functionality).</span>
<span class="sd">        - delete_package_with_text: Delete a package from the line edit text.</span>
<span class="sd">        - install_processes_pop_up: Open popup for installing processes.</span>
<span class="sd">        - load_config: Load package configuration from YAML file.</span>
<span class="sd">        - load_packages: Update the process library tree.</span>
<span class="sd">        - ok_clicked: Handle applying changes to packages.</span>
<span class="sd">        - remove_package: Remove a package from the package tree.</span>
<span class="sd">        - remove_package_with_text: Remove a package from the line edit text.</span>
<span class="sd">        - reset_action: Reset previous package addition or removal actions.</span>
<span class="sd">        - save: Save package configuration to process_config.yml.</span>
<span class="sd">        - save_config: save the current config to process_config.yml</span>
<span class="sd">                       (commented).</span>
<span class="sd">        - update_config: Update package configuration and library attributes.</span>

<span class="sd">    .. Signals:</span>
<span class="sd">        - signal_save: Signal emitted when configuration is saved.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">signal_save</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">()</span>

<div class="viewcode-block" id="PackageLibraryDialog.__init__">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibraryDialog.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mia_main_window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the PackageLibraryDialog.</span>

<span class="sd">        :param mia_main_window: Reference to the main application window.</span>
<span class="sd">        :param parent (QWidget): Parent widget for the dialog.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span> <span class="o">=</span> <span class="n">mia_main_window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_initial_configuration</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_ui</span><span class="p">()</span></div>


    <span class="k">def</span> <span class="nf">_create_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">callback</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a standardized button.</span>

<span class="sd">        :param text (str): Button text.</span>
<span class="sd">        :param callback (callable): Function to call when button is clicked.</span>

<span class="sd">        :returns (QPushButton): Configured button.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">btn</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">autoDefault</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">btn</span>

    <span class="k">def</span> <span class="nf">_create_install_buttons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create buttons for installing processes.</span>

<span class="sd">        :return (QHBoxLayout): Layout with install process buttons.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Install processes from:&quot;</span><span class="p">))</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">zipfile_btn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_button</span><span class="p">(</span>
            <span class="s2">&quot;Zipfile&quot;</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">install_processes_pop_up</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">folder_btn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_button</span><span class="p">(</span>
            <span class="s2">&quot;Folder&quot;</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">install_processes_pop_up</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">zipfile_btn</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">folder_btn</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">layout</span>

    <span class="k">def</span> <span class="nf">_create_line_edit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create and configure the line edit.</span>

<span class="sd">        :return QLineEdit: Configured line edit for package input.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">line_edit</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
        <span class="n">line_edit</span><span class="o">.</span><span class="n">setPlaceholderText</span><span class="p">(</span>
            <span class="s2">&quot;Type a Python package (ex. nipype.interfaces.spm)&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">line_edit</span>

    <span class="k">def</span> <span class="nf">_create_list_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">list_widget</span><span class="p">,</span> <span class="n">reset_callback</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a group box for a list with reset functionality.</span>

<span class="sd">        :param title (str): Group box title.</span>
<span class="sd">        :param list_widget (QListWidget): List widget to add to group.</span>
<span class="sd">        :param reset_callback (callable): Callback for reset button.</span>

<span class="sd">        :return (QGroupBox): Configured group box with list and reset button.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">list_widget</span><span class="p">)</span>
        <span class="n">reset_btn</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Reset&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">autoDefault</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">reset_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">reset_callback</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">reset_btn</span><span class="p">)</span>
        <span class="n">group</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">group</span>

    <span class="k">def</span> <span class="nf">_create_list_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a list widget with extended selection mode.</span>

<span class="sd">        :return (QListWidget): Configured list widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">list_widget</span> <span class="o">=</span> <span class="n">QListWidget</span><span class="p">()</span>
        <span class="n">list_widget</span><span class="o">.</span><span class="n">setSelectionMode</span><span class="p">(</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">ExtendedSelection</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">list_widget</span>

    <span class="k">def</span> <span class="nf">_create_main_layout</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">install_layout</span><span class="p">,</span> <span class="n">management_layout</span><span class="p">,</span> <span class="n">user_mode</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the main layout for the dialog.</span>

<span class="sd">        :param install_layout (QHBoxLayout): Layout for install buttons.</span>
<span class="sd">        :param management_layout (QHBoxLayout): Layout for package management</span>
<span class="sd">                                                buttons.</span>
<span class="sd">        :param user_mode (bool): Whether the application is in user mode.</span>

<span class="sd">        :return (QHBoxLayout): Main layout of the dialog.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create package library and vertical layout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">package_library</span> <span class="o">=</span> <span class="n">PackageLibrary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">packages</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="p">)</span>
        <span class="n">v_box</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="c1"># Add various components to vertical layout</span>
        <span class="n">v_box</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">v_box</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">install_layout</span><span class="p">)</span>
        <span class="n">v_box</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">v_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="p">)</span>
        <span class="n">v_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_edit</span><span class="p">)</span>
        <span class="n">v_box</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">v_box</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">management_layout</span><span class="p">)</span>
        <span class="n">v_box</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Add list groups</span>
        <span class="n">v_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_list_group</span><span class="p">(</span>
                <span class="s2">&quot;Added packages&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_list</span><span class="p">,</span>
                <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reset_action</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_list</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">v_box</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">v_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_list_group</span><span class="p">(</span>
                <span class="s2">&quot;Removed packages&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove_list</span><span class="p">,</span>
                <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reset_action</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_list</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">v_box</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_mode</span><span class="p">:</span>
            <span class="n">v_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_create_list_group</span><span class="p">(</span>
                    <span class="s2">&quot;Deleted packages&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">del_list</span><span class="p">,</span>
                    <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reset_action</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">del_list</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">v_box</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Create save/cancel buttons</span>
        <span class="n">save_cancel_layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_save_cancel_layout</span><span class="p">()</span>
        <span class="n">v_box</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">v_box</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">save_cancel_layout</span><span class="p">)</span>
        <span class="c1"># Create main horizontal layout</span>
        <span class="n">h_box</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">h_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">package_library</span><span class="p">)</span>
        <span class="n">h_box</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">v_box</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">h_box</span>

    <span class="k">def</span> <span class="nf">_create_package_management_buttons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_mode</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create buttons for package management.</span>

<span class="sd">        :param user_mode (bool): Whether the application is in user mode.</span>

<span class="sd">        :return (QHBoxLayout): Layout with package management buttons.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">add_btn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_button</span><span class="p">(</span>
            <span class="s2">&quot;Add/Update package&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_package_with_text</span>
        <span class="p">)</span>
        <span class="n">remove_btn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_button</span><span class="p">(</span>
            <span class="s2">&quot;Remove package&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_package_with_text</span>
        <span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">add_btn</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">remove_btn</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_mode</span><span class="p">:</span>
            <span class="n">delete_btn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_button</span><span class="p">(</span>
                <span class="s2">&quot;Delete package&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_package_with_text</span>
            <span class="p">)</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">delete_btn</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">layout</span>

    <span class="k">def</span> <span class="nf">_create_save_cancel_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create layout for save and cancel buttons.</span>

<span class="sd">        :return (QHBoxLayout): Layout with save and cancel buttons.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">save_btn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_button</span><span class="p">(</span><span class="s2">&quot;Apply changes&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">)</span>
        <span class="n">cancel_btn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_button</span><span class="p">(</span><span class="s2">&quot;Cancel&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">save_btn</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">cancel_btn</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">layout</span>

    <span class="k">def</span> <span class="nf">_create_status_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create and configure the status label.</span>

<span class="sd">        :return (QLabel): Configured status label.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">()</span>
        <span class="n">label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span>
            <span class="s2">&quot;QLabel{font-size:10pt;font:italic;text-align: center}&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">label</span>

    <span class="k">def</span> <span class="nf">_load_initial_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load initial package configuration.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_path</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_config</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_packages</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pkg_config</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">packages</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setup_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up the user interface components.&quot;&quot;&quot;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">user_mode</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_user_mode</span><span class="p">()</span>
        <span class="c1"># Set window title based on user mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Package library manager [&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;user&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">user_mode</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;admin&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; mode]&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Create UI components</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_status_label</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_edit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_line_edit</span><span class="p">()</span>
        <span class="c1"># Create button layouts</span>
        <span class="n">install_layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_install_buttons</span><span class="p">()</span>
        <span class="n">package_management_layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_package_management_buttons</span><span class="p">(</span>
            <span class="n">user_mode</span>
        <span class="p">)</span>
        <span class="c1"># Create lists for tracking package changes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_list_widget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_list_widget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">del_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_list_widget</span><span class="p">()</span>
        <span class="c1"># Tracking dictionaries for package changes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_dic</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_dic</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_dic</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Create main layout</span>
        <span class="n">main_layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_main_layout</span><span class="p">(</span>
            <span class="n">install_layout</span><span class="p">,</span> <span class="n">package_management_layout</span><span class="p">,</span> <span class="n">user_mode</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">main_layout</span><span class="p">)</span>

<div class="viewcode-block" id="PackageLibraryDialog.add_package">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibraryDialog.add_package">[docs]</a>
    <span class="k">def</span> <span class="nf">add_package</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">module_name</span><span class="p">,</span>
        <span class="n">class_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">show_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">init_package_tree</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a package and its modules to the package tree with comprehensive</span>
<span class="sd">        module and class discovery.</span>

<span class="sd">        This method recursively discovers and adds packages, subpackages, and</span>
<span class="sd">        their classes to the package tree. It provides flexible options for</span>
<span class="sd">        package initialization and error handling.</span>

<span class="sd">        :param module_name (str): Fully qualified name of the module to add.</span>
<span class="sd">                                  Example: &#39;myproject.processors&#39;</span>
<span class="sd">        :param class_name (str): Specific class name to focus on during</span>
<span class="sd">                                 package addition. If provided, only this</span>
<span class="sd">                                 class or its parent packages will be</span>
<span class="sd">                                 processed.</span>
<span class="sd">        :param show_error (bool): Controls error reporting behavior. If True,</span>
<span class="sd">                                  displays error messages in a QMessageBox. If</span>
<span class="sd">                                  False, collects errors silently. Defaults</span>
<span class="sd">                                  to False.</span>
<span class="sd">        :param init_package_tree (bool): If True, reinitializes the entire</span>
<span class="sd">                                         package tree before adding the</span>
<span class="sd">                                         module. Defaults to False.</span>

<span class="sd">        :return (List[str] | str): A list of error messages encountered during</span>
<span class="sd">                                   package addition, or &quot;No package selected!&quot;</span>
<span class="sd">                                   if no module name is provided.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">init_package_tree</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_config</span><span class="p">()</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">packages</span>

        <span class="c1"># Validate module name</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">module_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;No package selected!&quot;</span>

        <span class="c1"># Ensure processes directory is in system path</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">processes_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span> <span class="s2">&quot;processes&quot;</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">processes_path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processes_path</span><span class="p">)</span>

        <span class="c1"># Track potential errors</span>
        <span class="n">error_messages</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="c1"># Remove existing module to force fresh import</span>
            <span class="k">if</span> <span class="n">module_name</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module_name</span><span class="p">]</span>

            <span class="c1"># Import the module</span>
            <span class="nb">__import__</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
            <span class="n">pkg</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module_name</span><span class="p">]</span>

            <span class="c1"># Recursively process subpackages</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pkg</span><span class="p">,</span> <span class="s2">&quot;__path__&quot;</span><span class="p">):</span>

                <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">submodule_name</span><span class="p">,</span> <span class="n">is_package</span> <span class="ow">in</span> <span class="n">pkgutil</span><span class="o">.</span><span class="n">iter_modules</span><span class="p">(</span>
                    <span class="n">pkg</span><span class="o">.</span><span class="n">__path__</span>
                <span class="p">):</span>

                    <span class="k">if</span> <span class="n">is_package</span> <span class="ow">and</span> <span class="n">submodule_name</span> <span class="o">!=</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
                        <span class="n">sub_errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_package</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">module_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">submodule_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">class_name</span><span class="p">,</span>
                            <span class="n">show_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">error_messages</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">sub_errors</span><span class="p">)</span>

            <span class="c1"># Process classes in the package</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pkg</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
                    <span class="k">continue</span>

                <span class="n">fully_qualified_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">module_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Attempt to get process instance</span>
                    <span class="c1"># (custom method, adjust as needed)</span>
                    <span class="n">get_process_instance</span><span class="p">(</span><span class="n">fully_qualified_name</span><span class="p">)</span>

                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Error during installation of &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;the &#39;</span><span class="si">{</span><span class="n">module_name</span><span class="si">}</span><span class="s2">&#39; module...!&quot;</span><span class="p">,</span>
                        <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Updating the tree&#39;s dictionary</span>
                    <span class="n">path_list</span> <span class="o">=</span> <span class="n">module_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">name</span><span class="p">]</span>
                    <span class="n">pkg_iter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">package_tree</span>
                    <span class="n">recursion_flag</span> <span class="o">=</span> <span class="kc">False</span>

                    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">path_list</span><span class="p">:</span>

                        <span class="k">if</span> <span class="n">element</span> <span class="o">==</span> <span class="n">class_name</span><span class="p">:</span>
                            <span class="n">recursion_flag</span> <span class="o">=</span> <span class="kc">True</span>

                        <span class="c1"># Navigate or create package tree structure</span>
                        <span class="k">if</span> <span class="n">element</span> <span class="o">==</span> <span class="n">path_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>

                            <span class="k">if</span> <span class="n">element</span> <span class="o">==</span> <span class="n">class_name</span> <span class="ow">or</span> <span class="n">recursion_flag</span><span class="p">:</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                                    <span class="sa">f</span><span class="s2">&quot;Adding </span><span class="si">{</span><span class="n">module_name</span><span class="si">}</span><span class="s2">.&quot;</span>
                                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">...&quot;</span>
                                <span class="p">)</span>
                                <span class="n">pkg_iter</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;process_enabled&quot;</span>

                            <span class="k">elif</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">pkg_iter</span><span class="p">:</span>
                                <span class="n">pkg_iter</span> <span class="o">=</span> <span class="n">pkg_iter</span><span class="p">[</span><span class="n">element</span><span class="p">]</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">pkg_iter</span> <span class="o">=</span> <span class="n">pkg_iter</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="p">{})</span>

            <span class="c1"># Update package library</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">generate_tree</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">error_messages</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;in </span><span class="si">{</span><span class="n">module_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">error_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>

        <span class="c1"># Show error dialog if requested and errors exist</span>
        <span class="k">if</span> <span class="n">show_error</span> <span class="ow">and</span> <span class="n">error_messages</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="n">QMessageBox</span>

            <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">error_messages</span><span class="p">))</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">error_messages</span></div>


<div class="viewcode-block" id="PackageLibraryDialog.add_package_with_text">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibraryDialog.add_package_with_text">[docs]</a>
    <span class="k">def</span> <span class="nf">add_package_with_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">package_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">update_view</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a package to the Package Library.</span>

<span class="sd">        This method attempts to add a package or module to the library based</span>
<span class="sd">        on the provided package name. It supports adding packages with or</span>
<span class="sd">        without file extensions, and handles various import scenarios.</span>

<span class="sd">        :param package_name (str | False): Name of the package to add.</span>
<span class="sd">                                           If False (default), uses the text</span>
<span class="sd">                                           from the line edit widget.</span>
<span class="sd">        :param update_view (bool): Whether to update the package list view.</span>
<span class="sd">                                   Defaults to True.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Use line edit text if no package name provided</span>
        <span class="k">if</span> <span class="n">package_name</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">package_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1"># Handle path-based package addition</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_path</span><span class="p">:</span>
            <span class="c1"># Currently, self.is_path is always False. We would have to use</span>
            <span class="c1"># the browse_package method to initialise it to True, and the</span>
            <span class="c1"># Browse button allowing we to do this has been removed. It</span>
            <span class="c1"># might be interesting to allow a backdoor to pass the absolute</span>
            <span class="c1"># path in the field to add a package, to be continued...</span>
            <span class="n">path</span><span class="p">,</span> <span class="n">package</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">package_name</span><span class="p">)</span>
            <span class="c1"># Adding the module path to the system path</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_package</span><span class="p">(</span><span class="n">package</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
            <span class="k">return</span>

        <span class="c1"># Store original status to restore if addition fails</span>
        <span class="n">original_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding </span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2">. Please wait.&quot;</span><span class="p">)</span>
        <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="c1"># Handle packages with file extensions</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">package_name</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">part</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">old_part</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">for</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">package_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
                    <span class="n">part</span> <span class="o">+=</span> <span class="n">content</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="nb">__import__</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>

                    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>

                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>

                            <span class="k">if</span> <span class="n">content</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">old_part</span><span class="p">]):</span>
                                <span class="n">errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_package</span><span class="p">(</span>
                                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">package_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">package_name</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span>
                                <span class="p">)</span>
                                <span class="k">break</span>

                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_package</span><span class="p">(</span><span class="n">package_name</span><span class="p">)</span>
                                <span class="k">break</span>

                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                            <span class="n">errors</span> <span class="o">=</span> <span class="p">[</span>
                                <span class="sa">f</span><span class="s2">&quot;No package, module or class &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;named </span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2">!&quot;</span>
                            <span class="p">]</span>
                            <span class="k">break</span>

                    <span class="n">old_part</span> <span class="o">=</span> <span class="n">part</span>
                    <span class="n">part</span> <span class="o">+=</span> <span class="s2">&quot;.&quot;</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
                    <span class="n">errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_package</span><span class="p">(</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">package_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">package_name</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span>
                    <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Handle packages without extensions</span>
                <span class="n">errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_package</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">package_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">package_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">)</span>

            <span class="c1"># Process successful package addition</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">errors</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2"> added to the Package Library.&quot;</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">update_view</span> <span class="ow">and</span> <span class="n">package_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_dic</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_list</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">package_name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_dic</span><span class="p">[</span><span class="n">package_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_list</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>

                <span class="c1"># Remove from remove list if present</span>
                <span class="k">if</span> <span class="n">package_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_dic</span><span class="p">:</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_dic</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">package_name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">remove_list</span><span class="o">.</span><span class="n">takeItem</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

                    <span class="c1"># Adjust indices for remaining items</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_dic</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                        <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">index</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">remove_dic</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>

                <span class="c1"># Remove from delete list if present</span>
                <span class="k">if</span> <span class="n">package_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_dic</span><span class="p">:</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_dic</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">package_name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">del_list</span><span class="o">.</span><span class="n">takeItem</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

                    <span class="c1"># Adjust indices for remaining items</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_dic</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                        <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">index</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">delete_dic</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">original_status</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">errors</span>
                <span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">original_status</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>


    <span class="c1"># def browse_package(self):</span>
    <span class="c1">#     &quot;&quot;&quot;Open a browser to select a package.&quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#     file_dialog = QFileDialog()</span>
    <span class="c1">#     file_dialog.setOption(QFileDialog.DontUseNativeDialog, True)</span>
    <span class="c1">#</span>
    <span class="c1">#     # To select files or directories, we should use a proxy model</span>
    <span class="c1">#     # but mine is not working yet...</span>
    <span class="c1">#</span>
    <span class="c1">#     # file_dialog.setProxyModel(FileFilterProxyModel())</span>
    <span class="c1">#     file_dialog.setFileMode(QFileDialog.Directory)</span>
    <span class="c1">#     # file_dialog.setFileMode(QFileDialog.Directory |</span>
    <span class="c1">#     # QFileDialog.ExistingFile)</span>
    <span class="c1">#     # file_dialog.setFilter(&quot;Processes (*.py *.xml)&quot;)</span>
    <span class="c1">#</span>
    <span class="c1">#     if file_dialog.exec_():</span>
    <span class="c1">#         file_name = file_dialog.selectedFiles()[0]</span>
    <span class="c1">#         file_name = os.path.abspath(file_name)</span>
    <span class="c1">#         self.is_path = True</span>
    <span class="c1">#         self.line_edit.setText(file_name)</span>

<div class="viewcode-block" id="PackageLibraryDialog.delete_package">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibraryDialog.delete_package">[docs]</a>
    <span class="k">def</span> <span class="nf">delete_package</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">to_delete</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">loop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">from_pipeline_manager</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete a package from the library (admin-only functionality).</span>

<span class="sd">        This method removes the package from the package library tree,</span>
<span class="sd">        updates the `__init__.py` file, and deletes the package directory</span>
<span class="sd">        and files if they are empty.</span>

<span class="sd">        :param index (int): Recursive index for navigating modules.</span>
<span class="sd">                            Defaults to 1.</span>
<span class="sd">        :param to_delete (str): The package/brick to delete</span>
<span class="sd">                                (e.g., &#39;test.Test&#39;). Defaults to None.</span>
<span class="sd">        :param remove (bool): Whether to remove the brick from the package</span>
<span class="sd">                              tree. Defaults to True.</span>
<span class="sd">        :param loop (bool): Whether to delete silently without confirmation.</span>
<span class="sd">                            Defaults to False.</span>
<span class="sd">        :param from_pipeline_manager (bool): Whether deletion is initiated</span>
<span class="sd">                                             from pipeline manager. Defaults</span>
<span class="sd">                                             to False.</span>

<span class="sd">        :return (list[str]): A list of deleted packages/bricks.(classes).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">deleted_packages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">packages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">package_tree</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

        <span class="n">to_delete</span> <span class="o">=</span> <span class="n">to_delete</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">to_delete</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Critical</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Package not found.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">setInformativeText</span><span class="p">(</span>
                <span class="s2">&quot;Please write the python path to the package you want to &quot;</span>
                <span class="s2">&quot;delete.&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Warning&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">deleted_packages</span>

        <span class="n">module_split</span> <span class="o">=</span> <span class="n">to_delete</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">module_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;nipype&quot;</span><span class="p">,</span> <span class="s2">&quot;mia_processes&quot;</span><span class="p">,</span> <span class="s2">&quot;capsul&quot;</span><span class="p">]:</span>

            <span class="k">if</span> <span class="n">from_pipeline_manager</span><span class="p">:</span>

                <span class="n">inform_text</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;This package belongs to </span><span class="si">{</span><span class="n">module_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> which &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;is required by populse mia.</span><span class="se">\n</span><span class="s2"> You can still hide it in &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;the package library manager.&quot;</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">inform_text</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;This package belongs to </span><span class="si">{</span><span class="n">module_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> which &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;is required by populse_mia.</span><span class="se">\n</span><span class="s2">Therefore, it has only &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;been hidden (removed).&quot;</span>
                <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Critical</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;This package can not be deleted.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">setInformativeText</span><span class="p">(</span><span class="n">inform_text</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">deleted_packages</span>

        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">loop</span><span class="p">:</span>
            <span class="n">msgtext</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Do you really want to delete the package </span><span class="si">{</span><span class="n">to_delete</span><span class="si">}</span><span class="s2">?&quot;</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;populse_mia - Warning: Delete package&quot;</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">question</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">msgtext</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span>

        <span class="k">if</span> <span class="n">reply</span> <span class="o">==</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
            <span class="n">pkg_list</span> <span class="o">=</span> <span class="n">module_split</span>

            <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pkg_list</span><span class="p">):</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span>
                    <span class="s2">&quot;processes&quot;</span><span class="p">,</span>
                    <span class="o">*</span><span class="n">pkg_list</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">index</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">sub_deleted_packages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_package</span><span class="p">(</span>
                    <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">to_delete</span><span class="p">,</span>
                    <span class="n">from_pipeline_manager</span><span class="o">=</span><span class="n">from_pipeline_manager</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="k">for</span> <span class="n">sub_pkg</span> <span class="ow">in</span> <span class="n">sub_deleted_packages</span><span class="p">:</span>

                    <span class="k">if</span> <span class="n">sub_pkg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">deleted_packages</span><span class="p">:</span>
                        <span class="n">deleted_packages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_pkg</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                    <span class="n">del_path</span> <span class="o">=</span> <span class="kc">False</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                        <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">pkg_list</span><span class="p">)</span>
                    <span class="p">):</span>
                        <span class="n">del_path</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">is_import</span> <span class="o">=</span> <span class="kc">False</span>

                        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>

                            <span class="k">if</span> <span class="s2">&quot;__init__.py&quot;</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>

                                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
                                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;__init__.py&quot;</span><span class="p">)</span>
                                <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                                    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

                                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>

                                    <span class="k">if</span> <span class="p">(</span>
                                        <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
                                        <span class="ow">and</span> <span class="s2">&quot;import&quot;</span> <span class="ow">in</span> <span class="n">line</span>
                                    <span class="p">):</span>
                                        <span class="n">is_import</span> <span class="o">=</span> <span class="kc">True</span>

                        <span class="k">if</span> <span class="p">(</span>
                            <span class="ow">not</span> <span class="n">is_import</span>
                            <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;User_processes&quot;</span>
                        <span class="p">):</span>
                            <span class="n">del_path</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="k">if</span> <span class="n">del_path</span><span class="p">:</span>
                        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> was deleted &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> library)...&quot;</span>
                        <span class="p">)</span>
                        <span class="n">path_split</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
                        <span class="n">proc_idx</span> <span class="o">=</span> <span class="n">path_split</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;processes&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Deleting </span><span class="si">{</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_split</span><span class="p">[</span><span class="n">proc_idx</span><span class="p">:])</span><span class="si">}</span><span class="s2">...&quot;</span>
                        <span class="p">)</span>

                        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">remove</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">remove_package_with_text</span><span class="p">(</span>
                                <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pkg_list</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">index</span><span class="p">]),</span> <span class="kc">False</span>
                            <span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">init</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span>
                        <span class="s2">&quot;processes&quot;</span><span class="p">,</span>
                        <span class="o">*</span><span class="n">pkg_list</span><span class="p">[:</span> <span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="s2">&quot;__init__.py&quot;</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">init</span><span class="p">):</span>

                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">init</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

                        <span class="n">import_line</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">imports_in_init</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                        <span class="n">imports_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

                        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>

                            <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                                <span class="s2">&quot;import&quot;</span> <span class="ow">in</span> <span class="n">line</span>
                            <span class="p">):</span>
                                <span class="n">from_package</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                                <span class="n">from_package</span> <span class="o">=</span> <span class="n">from_package</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                                <span class="n">imports_in_init</span><span class="p">[</span><span class="n">from_package</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

                        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>

                            <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                                <span class="p">(</span><span class="s2">&quot;import&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">import_line</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">)</span>
                            <span class="p">):</span>

                                <span class="k">if</span> <span class="s2">&quot;from&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                                    <span class="n">from_package</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                                    <span class="n">from_package</span> <span class="o">=</span> <span class="n">from_package</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                                    <span class="n">imports_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                        <span class="p">[</span>
                                            <span class="n">imports_string</span><span class="p">,</span>
                                            <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;import&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                                        <span class="p">]</span>
                                    <span class="p">)</span>

                                <span class="k">elif</span> <span class="n">import_line</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                                    <span class="n">imports_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">imports_string</span><span class="si">}{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span>

                                <span class="k">if</span> <span class="s2">&quot;(&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                                    <span class="n">import_line</span> <span class="o">=</span> <span class="kc">True</span>

                                <span class="k">if</span> <span class="s2">&quot;)&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                                    <span class="n">import_line</span> <span class="o">=</span> <span class="kc">False</span>

                                <span class="k">if</span> <span class="n">import_line</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                                    <span class="n">imports</span> <span class="o">=</span> <span class="n">imports_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                                    <span class="n">imports</span> <span class="o">=</span> <span class="p">[</span>
                                        <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">imports</span>
                                    <span class="p">]</span>

                                    <span class="k">for</span> <span class="n">imp</span> <span class="ow">in</span> <span class="n">imports</span><span class="p">:</span>
                                        <span class="n">imports_in_init</span><span class="p">[</span><span class="n">from_package</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                            <span class="n">imp</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                                                <span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
                                            <span class="p">)</span>
                                        <span class="p">)</span>

                                    <span class="n">imports_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

                        <span class="k">if</span> <span class="ow">not</span> <span class="n">imports_in_init</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">to_delete</span><span class="si">}</span><span class="s2"> brick seems to be corrupted &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;and is not accessible...&quot;</span>
                            <span class="p">)</span>

                        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">imports_in_init</span><span class="p">:</span>

                            <span class="k">if</span> <span class="n">pkg_list</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">imports_in_init</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                                <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">.py&quot;</span>
                                <span class="n">delete_all</span> <span class="o">=</span> <span class="kc">True</span>

                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">imports_in_init</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                                    <span class="n">module</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                        <span class="n">pkg_list</span><span class="p">[:</span> <span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">key</span><span class="p">]</span>
                                    <span class="p">)</span>
                                    <span class="n">msgtext</span> <span class="o">=</span> <span class="p">(</span>
                                        <span class="sa">f</span><span class="s2">&quot;The brick (class) &quot;</span>
                                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pkg_list</span><span class="p">[</span><span class="n">index</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> alone cannot &quot;</span>
                                        <span class="sa">f</span><span class="s2">&quot;be deleted because it belongs to &quot;</span>
                                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">module</span><span class="si">}</span><span class="s2"> module that contains &quot;</span>
                                        <span class="sa">f</span><span class="s2">&quot;following brick(s):&quot;</span>
                                    <span class="p">)</span>
                                    <span class="n">msgtext</span> <span class="o">+=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  - </span><span class="si">{</span><span class="n">brick</span><span class="si">}</span><span class="s2">&quot;</span>
                                        <span class="k">for</span> <span class="n">brick</span> <span class="ow">in</span> <span class="n">imports_in_init</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                                    <span class="p">)</span>
                                    <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
                                    <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">msgtext</span><span class="p">)</span>
                                    <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
                                    <span class="n">title</span> <span class="o">=</span> <span class="p">(</span>
                                        <span class="s2">&quot;populse_mia - Warning: &quot;</span>
                                        <span class="s2">&quot;Delete package&quot;</span>
                                    <span class="p">)</span>
                                    <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
                                    <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span>
                                        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span>
                                    <span class="p">)</span>
                                    <span class="n">button_delete</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">button</span><span class="p">(</span>
                                        <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span>
                                    <span class="p">)</span>
                                    <span class="n">button_delete</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Delete all&quot;</span><span class="p">)</span>
                                    <span class="n">button_cancel</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">button</span><span class="p">(</span>
                                        <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span>
                                    <span class="p">)</span>
                                    <span class="n">button_cancel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Cancel&quot;</span><span class="p">)</span>
                                    <span class="n">returnValue</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

                                    <span class="k">if</span> <span class="n">returnValue</span> <span class="o">==</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">:</span>
                                        <span class="n">delete_all</span> <span class="o">=</span> <span class="kc">False</span>

                                <span class="k">if</span> <span class="n">delete_all</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                                    <span class="n">dir_init</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">init</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                                    <span class="n">file2del</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_init</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

                                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file2del</span><span class="p">):</span>
                                        <span class="n">path_parts</span> <span class="o">=</span> <span class="n">file2del</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
                                        <span class="n">process_index</span> <span class="o">=</span> <span class="p">(</span>
                                            <span class="n">path_parts</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;processes&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                                        <span class="p">)</span>
                                        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                            <span class="n">path_parts</span><span class="p">[</span><span class="n">process_index</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                                        <span class="p">)</span>

                                        <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">imports_in_init</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                                            <span class="n">deleted_packages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                                <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">name</span><span class="p">,</span> <span class="n">pkg</span><span class="p">])</span>
                                            <span class="p">)</span>

                                        <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">deleted_packages</span><span class="p">:</span>
                                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleting </span><span class="si">{</span><span class="n">pkg</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

                                        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file2del</span><span class="p">)</span>
                                        <span class="n">brick</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">imports_in_init</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                                        <span class="p">(</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span>
                                        <span class="p">)()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
                                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file2del</span><span class="si">}</span><span class="s2"> was deleted (&quot;</span>
                                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">brick</span><span class="si">}</span><span class="s2"> brick(s))...&quot;</span>
                                        <span class="p">)</span>

                                    <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>

                                        <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">deleted_packages</span><span class="p">:</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">remove_package_with_text</span><span class="p">(</span>
                                                <span class="n">pkg</span><span class="p">,</span> <span class="kc">False</span>
                                            <span class="p">)</span>

                                    <span class="c1"># Rewrite __init_.py to wipe module</span>
                                    <span class="n">import_line</span> <span class="o">=</span> <span class="kc">False</span>

                                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

                                        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>

                                            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>

                                                <span class="k">if</span> <span class="s2">&quot;(&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                                                    <span class="n">import_line</span> <span class="o">=</span> <span class="kc">True</span>

                                            <span class="k">elif</span> <span class="n">import_line</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>

                                                <span class="k">if</span> <span class="s2">&quot;)&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                                                    <span class="n">import_line</span> <span class="o">=</span> <span class="kc">False</span>

                                            <span class="k">elif</span> <span class="n">import_line</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                                                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

                                    <span class="c1"># If all packages have been deleted,</span>
                                    <span class="c1"># cleaning up empty files</span>
                                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">init</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                                        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

                                    <span class="n">is_import</span> <span class="o">=</span> <span class="kc">False</span>

                                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>

                                        <span class="k">if</span> <span class="p">(</span>
                                            <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
                                            <span class="ow">and</span> <span class="s2">&quot;import&quot;</span> <span class="ow">in</span> <span class="n">line</span>
                                        <span class="p">):</span>
                                            <span class="n">is_import</span> <span class="o">=</span> <span class="kc">True</span>

                                    <span class="k">if</span> <span class="p">(</span>
                                        <span class="ow">not</span> <span class="n">is_import</span>
                                        <span class="ow">and</span> <span class="n">pkg_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;User_processes&quot;</span>
                                    <span class="p">):</span>
                                        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>

                                        <span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dir_init</span><span class="p">):</span>

                                            <span class="k">if</span> <span class="n">elt</span> <span class="o">==</span> <span class="s2">&quot;__pycache__&quot;</span><span class="p">:</span>
                                                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span>
                                                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                                        <span class="n">dir_init</span><span class="p">,</span> <span class="n">elt</span>
                                                    <span class="p">),</span>
                                                    <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                <span class="p">)</span>

                                            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span>
                                                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_init</span><span class="p">,</span> <span class="n">elt</span><span class="p">)</span>
                                            <span class="p">):</span>
                                                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span>
                                                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_init</span><span class="p">,</span> <span class="n">elt</span><span class="p">)</span>
                                                <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">package_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">packages</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">generate_tree</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">deleted_packages</span></div>


<div class="viewcode-block" id="PackageLibraryDialog.delete_package_with_text">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibraryDialog.delete_package_with_text">[docs]</a>
    <span class="k">def</span> <span class="nf">delete_package_with_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">package_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">update_view</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete a package from the line edit&#39;s text.</span>

<span class="sd">        :param package_name (str): The name of the package to delete. Defaults</span>
<span class="sd">                                   to the text in the line edit.</span>
<span class="sd">        :param update_view (bool): Whether to update the QListWidget after</span>
<span class="sd">                                   deletion. Defaults to True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">old_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">package_name</span> <span class="o">=</span> <span class="n">package_name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">package_name</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleting </span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2">. Please wait...&quot;</span><span class="p">)</span>
        <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
        <span class="n">package_removed</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">package_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_dic</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_package</span><span class="p">(</span><span class="n">package_name</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">package_removed</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">update_view</span> <span class="ow">and</span> <span class="n">package_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_dic</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">del_list</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">package_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_dic</span><span class="p">[</span><span class="n">package_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">del_list</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="k">for</span> <span class="n">package_dict</span><span class="p">,</span> <span class="n">package_list</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_dic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_list</span><span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_dic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_list</span><span class="p">),</span>
            <span class="p">]:</span>

                <span class="k">if</span> <span class="n">package_name</span> <span class="ow">in</span> <span class="n">package_dict</span><span class="p">:</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">package_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">package_name</span><span class="p">)</span>
                    <span class="n">package_list</span><span class="o">.</span><span class="n">takeItem</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">package_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                        <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">index</span><span class="p">:</span>
                            <span class="n">package_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2"> deleted from Package Library.&quot;</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">old_status</span><span class="p">)</span></div>


<div class="viewcode-block" id="PackageLibraryDialog.install_processes_pop_up">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibraryDialog.install_processes_pop_up">[docs]</a>
    <span class="k">def</span> <span class="nf">install_processes_pop_up</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_folder</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display the install processes pop-up.</span>

<span class="sd">        :param from_folder (bool): Whether the installation is from a folder.</span>
<span class="sd">                                   Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_up_install_processes</span> <span class="o">=</span> <span class="n">InstallProcesses</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">from_folder</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_up_install_processes</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_up_install_processes</span><span class="o">.</span><span class="n">process_installed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_config</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="PackageLibraryDialog.load_config">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibraryDialog.load_config">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">load_config</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads and returns the configuration from &#39;process_config.yml&#39;.</span>

<span class="sd">        :return (dict | {}): The configuration dictionary if successfully</span>
<span class="sd">                               loaded, otherwise None in case of an error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># import verCmp only here to prevent circular import issue</span>
        <span class="kn">from</span> <span class="nn">populse_mia.utils</span> <span class="kn">import</span> <span class="n">verCmp</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span> <span class="s2">&quot;properties&quot;</span><span class="p">,</span> <span class="s2">&quot;process_config.yml&quot;</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">verCmp</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span> <span class="s2">&quot;5.1&quot;</span><span class="p">,</span> <span class="s2">&quot;sup&quot;</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="k">except</span> <span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load config: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{}</span></div>


<div class="viewcode-block" id="PackageLibraryDialog.load_packages">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibraryDialog.load_packages">[docs]</a>
    <span class="k">def</span> <span class="nf">load_packages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the tree of the process library.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process_config</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">packages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Packages&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Paths&quot;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">packages</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="PackageLibraryDialog.ok_clicked">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibraryDialog.ok_clicked">[docs]</a>
    <span class="k">def</span> <span class="nf">ok_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the click event when the &#39;Apply Changes&#39; button is clicked.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pkg_to_delete</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delete_dic</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">deleted_packages</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">pkg_to_delete</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">deleted_packages</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">reply</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">msgtext</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Do you really want to delete the &#39;</span><span class="si">{</span><span class="n">pkg</span><span class="si">}</span><span class="s2">&#39; package?&quot;</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;populse_mia - Warning: Delete package&quot;</span>
                <span class="n">reply</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">question</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span>
                    <span class="n">title</span><span class="p">,</span>
                    <span class="n">msgtext</span><span class="p">,</span>
                    <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span>
                    <span class="o">|</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span>
                    <span class="o">|</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">YesToAll</span>
                    <span class="o">|</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">NoToAll</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">reply</span> <span class="ow">in</span> <span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">YesToAll</span><span class="p">):</span>
                    <span class="n">sub_deleted_packages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_package</span><span class="p">(</span>
                        <span class="n">to_delete</span><span class="o">=</span><span class="n">pkg</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="kc">True</span>
                    <span class="p">)</span>
                    <span class="n">deleted_packages</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sub_deleted_packages</span><span class="p">)</span>

                <span class="c1"># TODO Do we want to reinitialize the initial state ?</span>
                <span class="k">elif</span> <span class="n">reply</span> <span class="ow">in</span> <span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">NoToAll</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_package_with_text</span><span class="p">(</span><span class="n">pkg</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">reply</span> <span class="ow">in</span> <span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">):</span>
                    <span class="n">reply</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></div>


<div class="viewcode-block" id="PackageLibraryDialog.remove_package">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibraryDialog.remove_package">[docs]</a>
    <span class="k">def</span> <span class="nf">remove_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">package</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a package from the package tree.</span>

<span class="sd">        This method attempts to remove the specified package from the package</span>
<span class="sd">        library. If the package is not found, a warning message is displayed.</span>
<span class="sd">        The package tree is updated after a successful removal.</span>

<span class="sd">        :param package (str): The fully qualified module name (e.g.,</span>
<span class="sd">                              &#39;nipype.interfaces.spm&#39;).</span>
<span class="sd">        :returns (bool): True if the package was successfully removed,</span>
<span class="sd">                         False if the package was not found or no package was</span>
<span class="sd">                         provided.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">package</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Warning: Package not found in Package Library&quot;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;No package selected!&quot;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">processes_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">())</span> <span class="o">/</span> <span class="s2">&quot;processes&quot;</span>

        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">processes_path</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">processes_path</span><span class="p">))</span>

        <span class="n">path_list</span> <span class="o">=</span> <span class="n">package</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="n">pkg_iter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">package_tree</span>
        <span class="c1"># Check if package exists in removal dictionaries</span>
        <span class="n">check_flag</span> <span class="o">=</span> <span class="n">package</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_dic</span> <span class="ow">or</span> <span class="n">package</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_dic</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">path_list</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">element</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pkg_iter</span><span class="p">:</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">check_flag</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span>
                        <span class="s2">&quot;Warning: Package not found in Package Library&quot;</span>
                    <span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Package </span><span class="si">{</span><span class="n">package</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
                    <span class="k">return</span> <span class="kc">False</span>

                <span class="k">break</span>

            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">path_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Last element</span>
                <span class="k">del</span> <span class="n">pkg_iter</span><span class="p">[</span><span class="n">element</span><span class="p">]</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing </span><span class="si">{</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_list</span><span class="p">)</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">pkg_iter</span> <span class="o">=</span> <span class="n">pkg_iter</span><span class="p">[</span><span class="n">element</span><span class="p">]</span>

        <span class="c1"># Update package tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">generate_tree</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="PackageLibraryDialog.remove_package_with_text">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibraryDialog.remove_package_with_text">[docs]</a>
    <span class="k">def</span> <span class="nf">remove_package_with_text</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">package_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">update_view</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tree_remove</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes the specified package from the package tree and updates the</span>
<span class="sd">        view accordingly.</span>

<span class="sd">        :param package_name (str): The name of the package to remove. If not</span>
<span class="sd">                                   provided, the package name is taken from</span>
<span class="sd">                                   the line edit.</span>
<span class="sd">        :param update_view (bool): Whether to update the QListWidget view after</span>
<span class="sd">                                   removal. Defaults to True.</span>
<span class="sd">        :param tree_remove (bool): Whether to remove the package from the</span>
<span class="sd">                                   tree. Defaults to True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">old_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">package_name</span> <span class="o">=</span> <span class="n">package_name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">package_name</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing </span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2">. Please wait.&quot;</span><span class="p">)</span>
        <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">package_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_dic</span> <span class="ow">and</span> <span class="n">tree_remove</span><span class="p">:</span>
            <span class="n">package_removed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_package</span><span class="p">(</span><span class="n">package_name</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">package_removed</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">package_removed</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">update_view</span> <span class="ow">and</span> <span class="n">package_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_dic</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove_list</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">package_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove_dic</span><span class="p">[</span><span class="n">package_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_list</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="k">for</span> <span class="n">package_dict</span><span class="p">,</span> <span class="n">package_list</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_dic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_list</span><span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delete_dic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">del_list</span><span class="p">),</span>
            <span class="p">]:</span>

                <span class="k">if</span> <span class="n">package_name</span> <span class="ow">in</span> <span class="n">package_dict</span><span class="p">:</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">package_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">package_name</span><span class="p">)</span>
                    <span class="n">package_list</span><span class="o">.</span><span class="n">takeItem</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">package_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">index</span><span class="p">:</span>
                            <span class="n">package_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2"> removed from Package Library.&quot;</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">old_status</span><span class="p">)</span></div>


<div class="viewcode-block" id="PackageLibraryDialog.reset_action">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibraryDialog.reset_action">[docs]</a>
    <span class="k">def</span> <span class="nf">reset_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemlist</span><span class="p">,</span> <span class="n">add</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets a previous package addition or removal action.</span>

<span class="sd">        :param itemlist (QListWidget): The list widget containing items to</span>
<span class="sd">                                       reset.</span>
<span class="sd">        :param add (bool): If True, resets an addition by removing the</span>
<span class="sd">                           package if it exists in the configuration.</span>
<span class="sd">                           If False, re-adds the package.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">itemlist</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">():</span>
            <span class="n">package_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">add</span><span class="p">:</span>
                <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pkg_config</span>

                <span class="c1"># Suppress Flake8 warning for unused &#39;config&#39; variable</span>
                <span class="c1"># in the comprehension</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">config</span> <span class="o">:=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pkg</span><span class="p">))</span>  <span class="c1"># noqa: F841</span>
                    <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">package_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
                <span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">remove_package_with_text</span><span class="p">(</span>
                        <span class="n">package_name</span><span class="p">,</span> <span class="n">update_view</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tree_remove</span><span class="o">=</span><span class="kc">False</span>
                    <span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">remove_package_with_text</span><span class="p">(</span>
                        <span class="n">package_name</span><span class="p">,</span> <span class="n">update_view</span><span class="o">=</span><span class="kc">False</span>
                    <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_package_with_text</span><span class="p">(</span><span class="n">package_name</span><span class="p">,</span> <span class="n">update_view</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="PackageLibraryDialog.save">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibraryDialog.save">[docs]</a>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">close</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves the package library configuration to `process_config.yml`.</span>

<span class="sd">        This method updates the package information from the package library</span>
<span class="sd">        tree and writes it to the configuration file. Optionally, it can</span>
<span class="sd">        close the dialog after saving.</span>

<span class="sd">        :param close (bool): If True, closes the dialog after saving.</span>
<span class="sd">                             Defaults to True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="c1"># Updating the packages and the paths according to the</span>
        <span class="c1"># package library tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span><span class="p">[</span><span class="s2">&quot;Packages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">package_tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span><span class="p">[</span><span class="s2">&quot;Paths&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">({</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">paths</span><span class="p">})</span>
        <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span> <span class="s2">&quot;properties&quot;</span><span class="p">,</span> <span class="s2">&quot;process_config.yml&quot;</span>
        <span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">configfile</span><span class="p">:</span>
            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span><span class="p">,</span>
                <span class="n">configfile</span><span class="p">,</span>
                <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">signal_save</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">close</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


    <span class="c1"># TODO: It seems that this method is not used. If this is the case,</span>
    <span class="c1">#       it should be removed during the next clean-up.</span>
    <span class="c1"># def save_config(self):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     Save the current configuration to &#39;process_config.yml&#39;.</span>

    <span class="c1">#     This method writes the current package and path settings to a YAML</span>
    <span class="c1">#     file located at &#39;properties/process_config.yml&#39; within the properties</span>
    <span class="c1">#     directory of the project.</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     config = Config()</span>
    <span class="c1">#     self.process_config.update(</span>
    <span class="c1">#         {&quot;Packages&quot;: self.packages, &quot;Paths&quot;: self.paths}</span>
    <span class="c1">#     )</span>
    <span class="c1">#     config_path = os.path.join(</span>
    <span class="c1">#         config.get_properties_path(), &quot;properties&quot;, &quot;process_config.yml&quot;</span>
    <span class="c1">#     )</span>

    <span class="c1">#     with open(config_path, &quot;w&quot;, encoding=&quot;utf8&quot;) as stream:</span>
    <span class="c1">#         yaml.dump(</span>
    <span class="c1">#             self.process_config,</span>
    <span class="c1">#             stream,</span>
    <span class="c1">#             default_flow_style=False,</span>
    <span class="c1">#             allow_unicode=True,</span>
    <span class="c1">#         )</span>

<div class="viewcode-block" id="PackageLibraryDialog.update_config">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibraryDialog.update_config">[docs]</a>
    <span class="k">def</span> <span class="nf">update_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Refreshes the process configuration and updates the package library.</span>

<span class="sd">        This method reloads the configuration from &#39;process_config.yml&#39;,</span>
<span class="sd">        updates the package library attributes, and regenerates the package</span>
<span class="sd">        tree.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_config</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_packages</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">package_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">packages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">generate_tree</span><span class="p">()</span></div>
</div>



<span class="c1"># TODO: It seems that this class is never used, so it may be an old piece of</span>
<span class="c1">#       code. We are commenting on it until we delete it completely if there&#39;s</span>
<span class="c1">#       no problem.</span>
<span class="c1"># class ProcessHelp(QWidget):</span>
<span class="c1">#     &quot;&quot;&quot;A widget that displays information about the selected process.&quot;&quot;&quot;</span>

<span class="c1">#     def __init__(self, process):</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         Initialize the ProcessHelp widget with the selected process.</span>

<span class="c1">#         :param process: The selected process for which help information is</span>
<span class="c1">#                         displayed.</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         super().__init__()</span>
<span class="c1">#         label = QLabel(process.help(), self)</span>


<div class="viewcode-block" id="ProcessLibrary">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessLibrary">[docs]</a>
<span class="k">class</span> <span class="nc">ProcessLibrary</span><span class="p">(</span><span class="n">QTreeView</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A tree view to display available Capsul&#39;s processes.</span>


<span class="sd">    :param d: dictionary corresponding to the tree (dict)</span>

<span class="sd">    .. Methods:</span>
<span class="sd">        - keyPressEvent: Event when the delete key is pressed.</span>
<span class="sd">        - load_dictionary: Loads a dictionary to the tree.</span>
<span class="sd">        - mousePressEvent: Event when the mouse is pressed.</span>
<span class="sd">        - to_dict: Returns a dictionary from the current tree.</span>

<span class="sd">    .. Signals:</span>
<span class="sd">        - item_library_clicked: Signal emitted when an item in the library is</span>
<span class="sd">                                clicked.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">item_library_clicked</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

<div class="viewcode-block" id="ProcessLibrary.__init__">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessLibrary.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">pkg_lib</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the ProcessLibrary class.</span>

<span class="sd">        :param d (dict): Dictionary corresponding to the tree.</span>
<span class="sd">        :param pkg_lib: An instance of the PackageLibraryDialog class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_dictionary</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pkg_library</span> <span class="o">=</span> <span class="n">pkg_lib</span></div>


<div class="viewcode-block" id="ProcessLibrary.keyPressEvent">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessLibrary.keyPressEvent">[docs]</a>
    <span class="k">def</span> <span class="nf">keyPressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles key press events, specifically the Delete key.</span>

<span class="sd">        If the Delete key is pressed and the user is not in user mode, the</span>
<span class="sd">        selected package(s) will be deleted from the package library.</span>

<span class="sd">        :param event (QKeyEvent): The key event triggering this handler.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Delete</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">get_user_mode</span><span class="p">():</span>

            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndexes</span><span class="p">():</span>

                <span class="k">if</span> <span class="n">idx</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">sibling</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">row</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">node</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">internalPointer</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">node</span><span class="p">:</span>
                        <span class="n">txt</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">column</span><span class="p">())</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pkg_library</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">package_tree</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pkg_library</span><span class="o">.</span><span class="n">load_config</span><span class="p">()[</span><span class="s2">&quot;Packages&quot;</span><span class="p">]</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pkg_library</span><span class="o">.</span><span class="n">delete_package</span><span class="p">(</span>
                            <span class="n">to_delete</span><span class="o">=</span><span class="n">txt</span><span class="p">,</span> <span class="n">from_pipeline_manager</span><span class="o">=</span><span class="kc">True</span>
                        <span class="p">)</span></div>


<div class="viewcode-block" id="ProcessLibrary.load_dictionary">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessLibrary.load_dictionary">[docs]</a>
    <span class="k">def</span> <span class="nf">load_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load a dictionary into the tree.</span>

<span class="sd">        :param d (dict): Dictionary to load. See the packages attribute in the</span>
<span class="sd">                         ProcessLibraryWidget class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dictionary</span> <span class="o">=</span> <span class="n">d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span> <span class="o">=</span> <span class="n">node_structure_from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">DictionaryTreeModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">)</span></div>


<div class="viewcode-block" id="ProcessLibrary.mousePressEvent">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessLibrary.mousePressEvent">[docs]</a>
    <span class="k">def</span> <span class="nf">mousePressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles mouse press events on the tree view.</span>

<span class="sd">        If a valid item is clicked, it sets the current index and emits a</span>
<span class="sd">        signal with the selected item&#39;s text. If the right mouse button is</span>
<span class="sd">        pressed, a context menu is displayed, allowing the user to remove or</span>
<span class="sd">        delete a package.</span>

<span class="sd">        :param event (QMouseEvent): The mouse event triggering this handler.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexAt</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">idx</span><span class="o">.</span><span class="n">isValid</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">sibling</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">row</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">internalPointer</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">node</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">column</span><span class="p">())</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">item_library_clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">RightButton</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">menu</span> <span class="o">=</span> <span class="n">QMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">remove</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s2">&quot;Remove package&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">action_delete</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s2">&quot;Delete package&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">get_user_mode</span><span class="p">()</span>
                        <span class="k">else</span> <span class="kc">None</span>
                    <span class="p">)</span>
                    <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">exec_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapToGlobal</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">pos</span><span class="p">()))</span>

                    <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pkg_library</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">package_tree</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pkg_library</span><span class="o">.</span><span class="n">load_config</span><span class="p">()[</span><span class="s2">&quot;Packages&quot;</span><span class="p">]</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pkg_library</span><span class="o">.</span><span class="n">remove_package</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pkg_library</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

                    <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_delete</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pkg_library</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">package_tree</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pkg_library</span><span class="o">.</span><span class="n">load_config</span><span class="p">()[</span><span class="s2">&quot;Packages&quot;</span><span class="p">]</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pkg_library</span><span class="o">.</span><span class="n">delete_package</span><span class="p">(</span>
                            <span class="n">to_delete</span><span class="o">=</span><span class="n">txt</span><span class="p">,</span> <span class="n">from_pipeline_manager</span><span class="o">=</span><span class="kc">True</span>
                        <span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">mousePressEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div>


<div class="viewcode-block" id="ProcessLibrary.to_dict">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessLibrary.to_dict">[docs]</a>
    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a dictionary representation of the current tree.</span>

<span class="sd">        :return: The dictionary of the tree.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="ProcessLibraryWidget">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessLibraryWidget">[docs]</a>
<span class="k">class</span> <span class="nc">ProcessLibraryWidget</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Widget that manages the available Capsul&#39;s processes in the software.</span>

<span class="sd">    .. Methods:</span>
<span class="sd">        - _configure_process_library: Configure the process library settings.</span>
<span class="sd">        - _setup_layout: Setup the layout for the widget.</span>
<span class="sd">        - load_config: Read the config in process_config.yml and return it as</span>
<span class="sd">                       a dictionary.</span>
<span class="sd">        - load_packages: Set packages and paths to the widget and to the</span>
<span class="sd">                         system paths.</span>
<span class="sd">        - open_pkg_lib: Open the package library.</span>
<span class="sd">        - save_config: Save the current config to process_config.yml.</span>
<span class="sd">                       (commented)</span>
<span class="sd">        - update_config: Update the config and loads the corresponding</span>
<span class="sd">                         packages.</span>
<span class="sd">        - update_process_library: Update the tree of the process library.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ProcessLibraryWidget.__init__">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessLibraryWidget.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">main_window</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the ProcessLibraryWidget.</span>

<span class="sd">        :param main_window: The current main window.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">main_window</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Process Library&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span> <span class="o">=</span> <span class="n">main_window</span>
        <span class="c1"># Load and update configuration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_config</span><span class="p">()</span>
        <span class="c1"># Initialize package library</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pkg_library</span> <span class="o">=</span> <span class="n">PackageLibraryDialog</span><span class="p">(</span>
            <span class="n">mia_main_window</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pkg_library</span><span class="o">.</span><span class="n">signal_save</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_process_library</span><span class="p">)</span>
        <span class="c1"># Initialize process library</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_library</span> <span class="o">=</span> <span class="n">ProcessLibrary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">packages</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pkg_library</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configure_process_library</span><span class="p">()</span>
        <span class="c1"># Test label to see the inputs/outputs of a process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_test</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">()</span>
        <span class="c1"># Setup layout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_layout</span><span class="p">()</span></div>


    <span class="k">def</span> <span class="nf">_configure_process_library</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Configure the process library settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_library</span><span class="o">.</span><span class="n">setDragDropMode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process_library</span><span class="o">.</span><span class="n">DragOnly</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_library</span><span class="o">.</span><span class="n">setAcceptDrops</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_library</span><span class="o">.</span><span class="n">setDragEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_library</span><span class="o">.</span><span class="n">setSelectionMode</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_library</span><span class="o">.</span><span class="n">SingleSelection</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_library</span><span class="o">.</span><span class="n">collapseAll</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_library</span><span class="o">.</span><span class="n">expandToDepth</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setup_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setup the layout for the widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitter</span> <span class="o">=</span> <span class="n">QSplitter</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitter</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_test</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitter</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process_library</span><span class="p">)</span>
        <span class="c1"># Layout</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splitter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>

<div class="viewcode-block" id="ProcessLibraryWidget.load_config">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessLibraryWidget.load_config">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">load_config</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read the configuration from process_config.yml and return it as a</span>
<span class="sd">        dictionary.</span>
<span class="sd">        .</span>
<span class="sd">        :return: The configuration as a dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># import verCmp only here to prevent circular import issue</span>
        <span class="kn">from</span> <span class="nn">populse_mia.utils</span> <span class="kn">import</span> <span class="n">verCmp</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">get_properties_path</span><span class="p">(),</span> <span class="s2">&quot;properties&quot;</span><span class="p">,</span> <span class="s2">&quot;process_config.yml&quot;</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config_path</span><span class="p">):</span>
            <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>

            <span class="k">try</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">verCmp</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span> <span class="s2">&quot;5.1&quot;</span><span class="p">,</span> <span class="s2">&quot;sup&quot;</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>

            <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">{}</span></div>


<div class="viewcode-block" id="ProcessLibraryWidget.load_packages">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessLibraryWidget.load_packages">[docs]</a>
    <span class="k">def</span> <span class="nf">load_packages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set packages and paths to the widget and to the system paths.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">packages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Packages&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Paths&quot;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>


<div class="viewcode-block" id="ProcessLibraryWidget.open_pkg_lib">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessLibraryWidget.open_pkg_lib">[docs]</a>
    <span class="k">def</span> <span class="nf">open_pkg_lib</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Open the package library.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pkg_library</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


    <span class="c1"># TODO: It seems that this method is not used. If this is the case,</span>
    <span class="c1">#       it should be removed during the next clean-up.</span>
    <span class="c1"># def save_config(self):</span>
    <span class="c1">#     &quot;&quot;&quot;Save the current configuration to process_config.yml.&quot;&quot;&quot;</span>
    <span class="c1">#     config = Config()</span>
    <span class="c1">#     config_path = os.path.join(</span>
    <span class="c1">#         config.get_properties_path(), &quot;properties&quot;, &quot;process_config.yml&quot;</span>
    <span class="c1">#     )</span>
    <span class="c1">#     self.process_config[&quot;Packages&quot;] = self.packages</span>
    <span class="c1">#     self.process_config[&quot;Paths&quot;] = self.paths</span>

    <span class="c1">#     with open(config_path, &quot;w&quot;, encoding=&quot;utf8&quot;) as stream:</span>
    <span class="c1">#         yaml.dump(</span>
    <span class="c1">#             self.process_config,</span>
    <span class="c1">#             stream,</span>
    <span class="c1">#             default_flow_style=False,</span>
    <span class="c1">#             allow_unicode=True,</span>
    <span class="c1">#         )</span>

<div class="viewcode-block" id="ProcessLibraryWidget.update_config">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessLibraryWidget.update_config">[docs]</a>
    <span class="k">def</span> <span class="nf">update_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the configuration and load the corresponding packages.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_config</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_packages</span><span class="p">()</span></div>


<div class="viewcode-block" id="ProcessLibraryWidget.update_process_library">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessLibraryWidget.update_process_library">[docs]</a>
    <span class="k">def</span> <span class="nf">update_process_library</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the tree of the process library.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_config</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_library</span><span class="o">.</span><span class="n">package_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">packages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_library</span><span class="o">.</span><span class="n">load_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">packages</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="import_file">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.import_file">[docs]</a>
<span class="k">def</span> <span class="nf">import_file</span><span class="p">(</span><span class="n">full_name</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Import a Python module from a specified file path.</span>

<span class="sd">    This function dynamically imports a module from a given file path and</span>
<span class="sd">    returns the module object. It does not modify `sys.modules`.</span>

<span class="sd">    :param full_name (str): The name of the module to import.</span>
<span class="sd">    :param path (str): The file path of the module.</span>
<span class="sd">    :return: The imported module.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">util</span>

    <span class="n">spec</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">spec_from_file_location</span><span class="p">(</span><span class="n">full_name</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">module_from_spec</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
    <span class="n">spec</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">exec_module</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">module</span></div>



<div class="viewcode-block" id="node_structure_from_dict">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.node_structure_from_dict">[docs]</a>
<span class="k">def</span> <span class="nf">node_structure_from_dict</span><span class="p">(</span><span class="n">datadict</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">root_node</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Construct a hierarchical node structure from a dictionary.</span>

<span class="sd">    This function converts a nested dictionary into a tree structure suitable</span>
<span class="sd">    for a TreeModel. It processes nodes based on specific conditions and</span>
<span class="sd">    recursively builds the tree.</span>

<span class="sd">    :param datadict (dict): The dictionary to convert into a node structure.</span>
<span class="sd">    :param parent: The parent node of the current node. Defaults to None.</span>
<span class="sd">    :param root_node: The root node of the tree. Defaults to None.</span>

<span class="sd">    :return: The root node of the constructed tree.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">root_node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="s2">&quot;Root&quot;</span><span class="p">)</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">root_node</span>

    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">datadict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">list_name</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">value</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;process_enabled&quot;</span>
            <span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">list_name</span><span class="p">:</span>
                <span class="n">list_name</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">list_values</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">value</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
                <span class="p">]</span>

                <span class="k">while</span> <span class="n">list_values</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">list_values</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="n">list_name</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                        <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">list_values</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                        <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
                    <span class="p">)</span>

            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;process_disabled&quot;</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">list_name</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
            <span class="n">node_structure_from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">root_node</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;process_enabled&quot;</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
            <span class="n">node</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">data</span>

    <span class="k">return</span> <span class="n">root_node</span></div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using Qt backend:&quot;</span><span class="p">,</span> <span class="n">qt_backend</span><span class="o">.</span><span class="n">get_qt_backend</span><span class="p">())</span>
    <span class="n">plw</span> <span class="o">=</span> <span class="n">ProcessLibraryWidget</span><span class="p">()</span>
    <span class="n">plw</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span>
</pre></div>

      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="../../../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2022, populse.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    </div>
  </body>
</html>