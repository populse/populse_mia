<!DOCTYPE html>

<html lang="en" data-content_root="../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>populse_mia.user_interface.pipeline_manager.node_controller &#8212; populse_mia 3.0.0-dev+9d1e1aff documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=47202671" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/haiku.css?v=fce32b03" />
    <script src="../../../../_static/documentation_options.js?v=4774077a"></script>
    <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
    <script type="module">import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.12.1/dist/mermaid.esm.min.mjs";





const initStyles = () => {
    const defaultStyle = document.createElement('style');
    defaultStyle.textContent = `pre.mermaid {
    /* Same as .mermaid-container > pre */
    display: block;
    width: 100%;
}

pre.mermaid > svg {
    /* Same as .mermaid-container > pre > svg */
    height: 500px;
    width: 100%;
    max-width: 100% !important;
}`;
    document.head.appendChild(defaultStyle);

    const fullscreenStyle = document.createElement('style');
    fullscreenStyle.textContent = `.mermaid-container {
    display: flex;
    flex-direction: row;
    width: 100%;
}

.mermaid-container > pre {
    display: block;
    width: 100%;
}

.mermaid-container > pre > svg {
    height: 500px;
    width: 100%;
    max-width: 100% !important;
}

.mermaid-fullscreen-btn {
    width: 28px;
    height: 28px;
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid rgba(0, 0, 0, 0.3);
    border-radius: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    font-size: 14px;
    line-height: 1;
    padding: 0;
    color: #333;
}

.mermaid-fullscreen-btn:hover {
    opacity: 100% !important;
    background: rgba(255, 255, 255, 1);
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
    transform: scale(1.1);
}

.mermaid-fullscreen-btn.dark-theme {
    background: rgba(50, 50, 50, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: #e0e0e0;
}

.mermaid-fullscreen-btn.dark-theme:hover {
    background: rgba(60, 60, 60, 1);
    box-shadow: 0 3px 10px rgba(255, 255, 255, 0.2);
}

.mermaid-fullscreen-modal {
    display: none;
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 95vw;
    height: 100vh;
    background: rgba(255, 255, 255, 0.98);
    z-index: 9999;
    padding: 20px;
    overflow: auto;
}

.mermaid-fullscreen-modal.dark-theme {
    background: rgba(0, 0, 0, 0.98);
}

.mermaid-fullscreen-modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
}

.mermaid-container-fullscreen {
    position: relative;
    width: 95vw;
    height: 90vh;
    max-width: 95vw;
    max-height: 90vh;
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    overflow: auto;
    display: flex;
    align-items: center;
    justify-content: center;
}

.mermaid-container-fullscreen.dark-theme {
    background: #1a1a1a;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);
}

.mermaid-container-fullscreen pre.mermaid {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.mermaid-container-fullscreen .mermaid svg {
    height: 100% !important;
    width: 100% !important;
    cursor: grab;
}

.mermaid-fullscreen-close {
    position: fixed !important;
    top: 20px !important;
    right: 20px !important;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid rgba(0, 0, 0, 0.2);
    border-radius: 50%;
    cursor: pointer;
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    transition: all 0.2s;
    font-size: 24px;
    line-height: 1;
    color: #333;
}

.mermaid-fullscreen-close:hover {
    background: white;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
    transform: scale(1.1);
}

.mermaid-fullscreen-close.dark-theme {
    background: rgba(50, 50, 50, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: #e0e0e0;
}

.mermaid-fullscreen-close.dark-theme:hover {
    background: rgba(60, 60, 60, 1);
    box-shadow: 0 6px 16px rgba(255, 255, 255, 0.2);
}

.mermaid-fullscreen-modal .mermaid-fullscreen-btn {
    display: none !important;
}`;
    document.head.appendChild(fullscreenStyle);
}

// Detect if page has dark background
const isDarkTheme = () => {
    // We use a set of heuristics:
    // 1. Check for common dark mode classes or attributes
    // 2. Check computed background color brightness
    if (document.documentElement.classList.contains('dark') ||
        document.documentElement.getAttribute('data-theme') === 'dark' ||
        document.body.classList.contains('dark') ||
        document.body.getAttribute('data-theme') === 'dark') {
        // console.log("Dark theme detected via class/attribute");
        return true;
    }
    if (document.documentElement.classList.contains('light') ||
        document.documentElement.getAttribute('data-theme') === 'light' ||
        document.body.classList.contains('light') ||
        document.body.getAttribute('data-theme') === 'light') {
        // console.log("Light theme detected via class/attribute");
        return false;
    }
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        // console.log("Dark theme detected via prefers-color-scheme");
        return true;
    }
    const bgColor = window.getComputedStyle(document.body).backgroundColor;
    const match = bgColor.match(/rgb\((\d+),\s*(\d+),\s*(\d+)/);
    if (match) {
        const r = parseInt(match[1]);
        const g = parseInt(match[2]);
        const b = parseInt(match[3]);
        const brightness = (r * 299 + g * 587 + b * 114) / 1000;
        // console.log("Background color brightness:", brightness);
        return brightness < 128;
    }
    // console.log("No dark or light theme detected, defaulting to light theme");
    return false;
};

let darkTheme = isDarkTheme();
let modal = null;
let modalContent = null;
let previousScrollOffset = [window.scrollX, window.scrollY];

const runMermaid = async (rerun) => {
    console.log("Running mermaid diagrams, rerun =", rerun);
    // clear all existing mermaid charts
    let all_mermaids = document.querySelectorAll(".mermaid");

    if (rerun) {
        all_mermaids.forEach((el) => {
            if(!el.hasAttribute("data-original-code")) {
                // store original code
                // console.log(`Storing original code for first run: `, el.innerHTML);
                el.setAttribute('data-original-code', el.innerHTML);
            }
            if(el.getAttribute("data-processed") === "true") {
                // remove and restore original
                el.removeAttribute("data-processed");
                // console.log(`Restoring original code for re-run: `, el.getAttribute('data-original-code'));
                el.innerHTML = el.getAttribute('data-original-code');
            } else {
                // store original code
                // console.log(`Storing original code for re-run: `, el.innerHTML);
                el.setAttribute('data-original-code', el.innerHTML);
            }
        });
        await mermaid.run();
    }

    all_mermaids = document.querySelectorAll(".mermaid");
    const mermaids_processed = document.querySelectorAll(".mermaid[data-processed='true']");

    if ("False" === "True") {
        const mermaids_to_add_zoom = -1 === -1 ? all_mermaids.length : -1;
        if(mermaids_to_add_zoom > 0) {
            var svgs = d3.selectAll("");
            if(all_mermaids.length !== mermaids_processed.length) {
                setTimeout(() => runMermaid(false), 200);
                return;
            } else if(svgs.size() !== mermaids_to_add_zoom) {
                setTimeout(() => runMermaid(false), 200);
                return;
            } else {
                svgs.each(function() {
                    var svg = d3.select(this);
                    svg.html("<g class='wrapper'>" + svg.html() + "</g>");
                    var inner = svg.select("g");
                    var zoom = d3.zoom().on("zoom", function(event) {
                        inner.attr("transform", event.transform);
                    });
                    svg.call(zoom);
                });
            }
        }
    } else if(all_mermaids.length !== mermaids_processed.length) {
        // Wait for mermaid to process all diagrams
        setTimeout(() => runMermaid(false), 200);
        return;
    }

    // Stop here if not adding fullscreen capability
    if ("True" !== "True") return;

    if (modal !== null ) {
        // Destroy existing modal
        modal.remove();
        modal = null;
        modalContent = null;
    }

    modal = document.createElement('div');
    modal.className = 'mermaid-fullscreen-modal' + (darkTheme ? ' dark-theme' : '');
    modal.setAttribute('role', 'dialog');
    modal.setAttribute('aria-modal', 'true');
    modal.setAttribute('aria-label', 'Fullscreen diagram viewer');
    modal.innerHTML = `
        <button class="mermaid-fullscreen-close${darkTheme ? ' dark-theme' : ''}" aria-label="Close fullscreen">✕</button>
        <div class="mermaid-container-fullscreen${darkTheme ? ' dark-theme' : ''}"></div>
    `;
    document.body.appendChild(modal);

    modalContent = modal.querySelector('.mermaid-container-fullscreen');
    const closeBtn = modal.querySelector('.mermaid-fullscreen-close');

    const closeModal = () => {
        modal.classList.remove('active');
        modalContent.innerHTML = '';
        document.body.style.overflow = ''
        window.scrollTo({left: previousScrollOffset[0], top: previousScrollOffset[1], behavior: 'instant'});
    };

    closeBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
    });
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modal.classList.contains('active')) {
            closeModal();
        }
    });

    document.querySelectorAll('.mermaid').forEach((mermaidDiv) => {
        if (mermaidDiv.parentNode.classList.contains('mermaid-container') ||
            mermaidDiv.closest('.mermaid-fullscreen-modal')) {
            // Already processed, adjust button class if needed
            const existingBtn = mermaidDiv.parentNode.querySelector('.mermaid-fullscreen-btn');
            if (existingBtn) {
                existingBtn.className = 'mermaid-fullscreen-btn' + (darkTheme ? ' dark-theme' : '');
            }
            return;
        }

        const container = document.createElement('div');
        container.className = 'mermaid-container';
        mermaidDiv.parentNode.insertBefore(container, mermaidDiv);
        container.appendChild(mermaidDiv);

        const fullscreenBtn = document.createElement('button');
        fullscreenBtn.className = 'mermaid-fullscreen-btn' + (darkTheme ? ' dark-theme' : '');
        fullscreenBtn.setAttribute('aria-label', 'View diagram in fullscreen');
        fullscreenBtn.textContent = '⛶';
        fullscreenBtn.style.opacity = '50%';

        // Calculate dynamic position based on diagram's margin and padding
        const diagramStyle = window.getComputedStyle(mermaidDiv);
        const marginTop = parseFloat(diagramStyle.marginTop) || 0;
        const marginRight = parseFloat(diagramStyle.marginRight) || 0;
        const paddingTop = parseFloat(diagramStyle.paddingTop) || 0;
        const paddingRight = parseFloat(diagramStyle.paddingRight) || 0;
        fullscreenBtn.style.top = `${marginTop + paddingTop + 4}px`;
        fullscreenBtn.style.right = `${marginRight + paddingRight + 4}px`;

        fullscreenBtn.addEventListener('click', () => {
            previousScrollOffset = [window.scroll, window.scrollY];
            const clone = mermaidDiv.cloneNode(true);
            modalContent.innerHTML = '';
            modalContent.appendChild(clone);

            const svg = clone.querySelector('svg');
            if (svg) {
                svg.removeAttribute('width');
                svg.removeAttribute('height');
                svg.style.width = '100%';
                svg.style.height = 'auto';
                svg.style.maxWidth = '100%';
                svg.style.sdisplay = 'block';

                if ("False" === "True") {
                    setTimeout(() => {
                        const g = svg.querySelector('g');
                        if (g) {
                            var svgD3 = d3.select(svg);
                            svgD3.html("<g class='wrapper'>" + svgD3.html() + "</g>");
                            var inner = svgD3.select("g");
                            var zoom = d3.zoom().on("zoom", function(event) {
                                inner.attr("transform", event.transform);
                            });
                            svgD3.call(zoom);
                        }
                    }, 100);
                }
            }

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        });
        container.appendChild(fullscreenBtn);
    });
};

const load = async () => {
    initStyles();

    await runMermaid(true);

    const reRunIfThemeChanges = async () => {
        const newDarkTheme = isDarkTheme();
        if (newDarkTheme !== darkTheme) {
            darkTheme = newDarkTheme;
            console.log("Theme change detected, re-running mermaid with", darkTheme ? "dark" : "default", "theme");
            await mermaid.initialize(
                {...JSON.parse(
                    `{"startOnLoad": false}`
                ),
                ...{ darkMode: darkTheme, theme: darkTheme ? 'dark' : 'default' },
                }
            );
            await runMermaid(true);
        }
    };

    // Update theme classes when theme changes
    const themeObserver = new MutationObserver(reRunIfThemeChanges);
    themeObserver.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['class', 'style', 'data-theme']
    });
    themeObserver.observe(document.body, {
        attributes: true,
        attributeFilter: ['class', 'style', 'data-theme']
    });
};





console.log("Initializing mermaid with", darkTheme ? "dark" : "default", "theme");
mermaid.initialize(
    {...JSON.parse(
        `{"startOnLoad": false}`
    ),
    ...{ darkMode: darkTheme, theme: darkTheme ? 'dark' : 'default' },
    }
);

window.addEventListener("load", load);</script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../../../../index.html">
          <span>populse_mia 3.0.0-dev+9d1e1aff documentation</span></a></h1>
        <h2 class="heading"><span>populse_mia.user_interface.pipeline_manager.node_controller</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="Top">
      
        <p>
        <a class="uplink" href="../../../../index.html">Contents</a>
        </p>

      </div>
      <div class="content" role="main">
        
        
  <h1>Source code for populse_mia.user_interface.pipeline_manager.node_controller</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Pipeline Node Management and Filtering Module</span>

<span class="sd">This module provides a collection of Qt-based widgets and controllers for</span>
<span class="sd">managing pipeline nodes, filtering database entries, and assigning values to</span>
<span class="sd">node plugs in a data processing workflow. It is designed to integrate with a</span>
<span class="sd">pipeline editor, enabling users to:</span>

<span class="sd">    - View and edit node parameters, including inputs, outputs, and attributes.</span>
<span class="sd">    - Filter and select database entries (e.g., scans, files) for assignment</span>
<span class="sd">      to pipeline nodes.</span>
<span class="sd">    - Apply advanced search and tag-based filtering to refine selections.</span>
<span class="sd">    - Handle undo/redo operations for parameter changes and node renaming.</span>
<span class="sd">    - Manage subprocesses and context names for hierarchical pipelines.</span>

<span class="sd">The module is built on top of Qt and Capsul, leveraging custom widgets like</span>
<span class="sd">`AttributedProcessWidget` and `TableDataBrowser` to provide a user-friendly</span>
<span class="sd">interface for complex pipeline interactions.</span>

<span class="sd">:Contains:</span>

<span class="sd">    Class:</span>
<span class="sd">        - PlugFilter (must be declared before AttributesFilter)</span>
<span class="sd">        - AttributesFilter</span>
<span class="sd">        - CapsulNodeController</span>
<span class="sd">        - FilterWidget</span>
<span class="sd">        - NodeController</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">##########################################################################</span>
<span class="c1"># Populse_mia - Copyright (C) IRMaGe/CEA, 2018</span>
<span class="c1"># Distributed under the terms of the CeCILL license, as published by</span>
<span class="c1"># the CEA-CNRS-INRIA. Refer to the LICENSE file or to</span>
<span class="c1"># http://www.cecill.info/licences/Licence_CeCILL_V2.1-en.html</span>
<span class="c1"># for details.</span>
<span class="c1">##########################################################################</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">partial</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">sip</span>

<span class="c1"># capsul imports</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">capsul.attributes.completion_engine</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProcessCompletionEngine</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">capsul.pipeline.pipeline_nodes</span><span class="w"> </span><span class="kn">import</span> <span class="n">PipelineNode</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">capsul.pipeline.process_iteration</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProcessIteration</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">capsul.qt_gui.widgets.attributed_process_widget</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">AttributedProcessWidget</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># PyQt5 imports</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt5</span><span class="w"> </span><span class="kn">import</span> <span class="n">Qt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt5.QtCore</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyqtSignal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt5.QtGui</span><span class="w"> </span><span class="kn">import</span> <span class="n">QIcon</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt5.QtWidgets</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">QApplication</span><span class="p">,</span>
    <span class="n">QDialog</span><span class="p">,</span>
    <span class="n">QDialogButtonBox</span><span class="p">,</span>
    <span class="n">QGroupBox</span><span class="p">,</span>
    <span class="n">QHBoxLayout</span><span class="p">,</span>
    <span class="n">QLabel</span><span class="p">,</span>
    <span class="n">QLineEdit</span><span class="p">,</span>
    <span class="n">QMessageBox</span><span class="p">,</span>
    <span class="n">QPushButton</span><span class="p">,</span>
    <span class="n">QToolButton</span><span class="p">,</span>
    <span class="n">QVBoxLayout</span><span class="p">,</span>
    <span class="n">QWidget</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># soma-base imports</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">soma.controller</span><span class="w"> </span><span class="kn">import</span> <span class="n">trait_ids</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">traits.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">TraitError</span><span class="p">,</span> <span class="n">Undefined</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">populse_mia.data_manager</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">BRICK_OUTPUTS</span><span class="p">,</span>
    <span class="n">COLLECTION_BRICK</span><span class="p">,</span>
    <span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
    <span class="n">NOT_DEFINED_VALUE</span><span class="p">,</span>
    <span class="n">TAG_FILENAME</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Populse_MIA imports</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">populse_mia.data_manager.filter</span><span class="w"> </span><span class="kn">import</span> <span class="n">Filter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">populse_mia.software_properties</span><span class="w"> </span><span class="kn">import</span> <span class="n">Config</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">populse_mia.user_interface.data_browser.advanced_search</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">AdvancedSearch</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">populse_mia.user_interface.data_browser.data_browser</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">TableDataBrowser</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">populse_mia.user_interface.data_browser.rapid_search</span><span class="w"> </span><span class="kn">import</span> <span class="n">RapidSearch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">populse_mia.user_interface.pipeline_manager.process_mia</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProcessMIA</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">populse_mia.user_interface.pop_ups</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">PopUpSelectTagCountTable</span><span class="p">,</span>
    <span class="n">PopUpVisualizedTags</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">type_editors</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="PlugFilter">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.PlugFilter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PlugFilter</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A PyQt widget for interactively filtering and selecting database scans to</span>
<span class="sd">    assign to a pipeline node plug.</span>

<span class="sd">    This widget provides a powerful interface for browsing, searching, and</span>
<span class="sd">    filtering files from the project database. It features:</span>
<span class="sd">        - A customizable data browser with tag columns.</span>
<span class="sd">        - Rapid text search for quick filtering.</span>
<span class="sd">        - Advanced multi-criteria filtering for precise selection.</span>
<span class="sd">        - Tag visibility controls to customize the displayed information.</span>
<span class="sd">        - Automatic exclusion of files that are outputs from existing pipeline</span>
<span class="sd">          bricks to prevent circular dependencies.</span>

<span class="sd">    The widget is designed to integrate seamlessly with a pipeline editor,</span>
<span class="sd">    allowing users to select and assign files to a specific node plug. When</span>
<span class="sd">    the selection is confirmed, the chosen files are emitted as a list via</span>
<span class="sd">    the `plug_value_changed` signal.</span>


<span class="sd">    .. Methods:</span>
<span class="sd">        - ok_clicked: Applies the selected files to the node plug and closes</span>
<span class="sd">                      the widget.</span>
<span class="sd">        - reset_search_bar: Resets the search interface to its initial state,</span>
<span class="sd">                            clearing all filters.</span>
<span class="sd">        - search_str: Filters and updates the displayed scans based on the</span>
<span class="sd">                      provided search string.</span>
<span class="sd">        - set_plug_value: Extracts the selected or filtered scan values and</span>
<span class="sd">                          emits them via the `plug_value_changed` signal.</span>
<span class="sd">        - update_tag_to_filter: Opens a dialog to select a tag for filtering</span>
<span class="sd">                                and updates the filter button text.</span>
<span class="sd">        - update_tags: Opens a dialog to update the list of visualized tags</span>
<span class="sd">                       and refreshes the table view.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Signal emitted when the user confirms their selection. The signal carries</span>
    <span class="c1"># a list of selected file paths or attribute values.</span>
    <span class="n">plug_value_changed</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

<div class="viewcode-block" id="PlugFilter.__init__">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.PlugFilter.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project</span><span class="p">,</span>
        <span class="n">scans_list</span><span class="p">,</span>
        <span class="n">process</span><span class="p">,</span>
        <span class="n">node_name</span><span class="p">,</span>
        <span class="n">plug_name</span><span class="p">,</span>
        <span class="n">node_controller</span><span class="p">,</span>
        <span class="n">main_window</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the PlugFilter widget for filtering database scans.</span>

<span class="sd">        Creates a filterable data browser interface with search capabilities,</span>
<span class="sd">        tag visualization controls, and scan selection. Automatically excludes</span>
<span class="sd">        scans that are outputs from existing pipeline bricks.</span>

<span class="sd">        :param project: Current project instance containing database and</span>
<span class="sd">                        folder paths</span>
<span class="sd">        :param scans_list: Initial list of database file paths to filter. If</span>
<span class="sd">                           empty, all scans from COLLECTION_CURRENT are</span>
<span class="sd">                           included</span>
<span class="sd">        :param process: Process instance associated with the selected pipeline</span>
<span class="sd">                        node</span>
<span class="sd">        :param node_name: Display name of the current pipeline node</span>
<span class="sd">        :param plug_name: Name of the selected node plug/connection point</span>
<span class="sd">        :param node_controller: Parent controller managing node visibility and</span>
<span class="sd">                                tags</span>
<span class="sd">        :param main_window: Main application window containing the pipeline</span>
<span class="sd">                            manager</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_controller</span> <span class="o">=</span> <span class="n">node_controller</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span> <span class="o">=</span> <span class="n">main_window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span> <span class="o">=</span> <span class="n">process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plug_name</span> <span class="o">=</span> <span class="n">plug_name</span>
        <span class="c1"># Collect all brick output paths to exclude from scan list</span>
        <span class="n">brick_outputs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">data</span><span class="p">()</span> <span class="k">as</span> <span class="n">database_data</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">brick</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">brick_list</span><span class="p">:</span>
                <span class="n">doc</span> <span class="o">=</span> <span class="n">database_data</span><span class="o">.</span><span class="n">get_document</span><span class="p">(</span>
                    <span class="n">collection_name</span><span class="o">=</span><span class="n">COLLECTION_BRICK</span><span class="p">,</span> <span class="n">primary_keys</span><span class="o">=</span><span class="n">brick</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">doc</span> <span class="ow">and</span> <span class="n">BRICK_OUTPUTS</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="c1"># Extract non-empty string outputs as relative paths</span>
                    <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">BRICK_OUTPUTS</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span>
                    <span class="p">)</span>
                    <span class="n">brick_outputs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>

            <span class="c1"># Filter scans or use all current collection documents</span>
            <span class="k">if</span> <span class="n">scans_list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scans_list</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">scan</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">/&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="n">scans_list</span>
                    <span class="k">if</span> <span class="n">scan</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">/&quot;</span><span class="p">)</span>
                    <span class="ow">not</span> <span class="ow">in</span> <span class="n">brick_outputs</span>
                <span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scans_list</span> <span class="o">=</span> <span class="n">database_data</span><span class="o">.</span><span class="n">get_document_names</span><span class="p">(</span>
                    <span class="n">COLLECTION_CURRENT</span>
                <span class="p">)</span>

        <span class="c1"># Configure window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Filter - </span><span class="si">{</span><span class="n">node_name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">plug_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Create main table browser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span> <span class="o">=</span> <span class="n">TableDataBrowser</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node_controller</span><span class="o">.</span><span class="n">visibles_tags</span><span class="p">,</span>
            <span class="kc">False</span><span class="p">,</span>
            <span class="kc">True</span><span class="p">,</span>
            <span class="n">link_viewer</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Reducing the list of scans to selection</span>
        <span class="n">all_scans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_visualize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_visualize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scans_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_search</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scans_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">update_visualized_rows</span><span class="p">(</span><span class="n">all_scans</span><span class="p">)</span>
        <span class="c1"># Create search bar with clear button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rapid_search</span> <span class="o">=</span> <span class="n">RapidSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rapid_search</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">search_str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_cross</span> <span class="o">=</span> <span class="n">QToolButton</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_cross</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color:rgb(255, 255, 255);&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_cross</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span>
            <span class="n">QIcon</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Config</span><span class="p">()</span><span class="o">.</span><span class="n">getSourceImageDir</span><span class="p">(),</span> <span class="s2">&quot;gray_cross.png&quot;</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_cross</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reset_search_bar</span><span class="p">)</span>
        <span class="n">search_bar_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">search_bar_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rapid_search</span><span class="p">)</span>
        <span class="n">search_bar_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">button_cross</span><span class="p">)</span>
        <span class="c1"># Create advanced search</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span> <span class="o">=</span> <span class="n">AdvancedSearch</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scans_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node_controller</span><span class="o">.</span><span class="n">visibles_tags</span><span class="p">,</span>
            <span class="n">from_pipeline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">show_search</span><span class="p">()</span>
        <span class="c1"># Create control buttons</span>
        <span class="n">push_button_tags</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Visualized tags&quot;</span><span class="p">)</span>
        <span class="n">push_button_tags</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_tags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_button_tag_filter</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="n">TAG_FILENAME</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_button_tag_filter</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_tag_to_filter</span><span class="p">)</span>
        <span class="n">push_button_ok</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;OK&quot;</span><span class="p">)</span>
        <span class="n">push_button_ok</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">)</span>
        <span class="n">push_button_cancel</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Cancel&quot;</span><span class="p">)</span>
        <span class="n">push_button_cancel</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
        <span class="c1"># Assemble layouts</span>
        <span class="n">buttons_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">buttons_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">push_button_tags</span><span class="p">)</span>
        <span class="n">buttons_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">push_button_tag_filter</span><span class="p">)</span>
        <span class="n">buttons_layout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">buttons_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">push_button_ok</span><span class="p">)</span>
        <span class="n">buttons_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">push_button_cancel</span><span class="p">)</span>
        <span class="n">main_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">main_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">search_bar_layout</span><span class="p">)</span>
        <span class="n">main_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span><span class="p">)</span>
        <span class="n">main_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="p">)</span>
        <span class="n">main_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">buttons_layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">main_layout</span><span class="p">)</span>
        <span class="c1"># Set window size based on screen resolution</span>
        <span class="n">screen_resolution</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">desktop</span><span class="p">()</span><span class="o">.</span><span class="n">screenGeometry</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">0.6</span> <span class="o">*</span> <span class="n">screen_resolution</span><span class="o">.</span><span class="n">width</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">0.8</span> <span class="o">*</span> <span class="n">screen_resolution</span><span class="o">.</span><span class="n">height</span><span class="p">()))</span></div>


<div class="viewcode-block" id="PlugFilter.ok_clicked">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.PlugFilter.ok_clicked">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">ok_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle OK button click by applying changes and closing the dialog.</span>

<span class="sd">        Commits the current widget value to the associated node plug, then</span>
<span class="sd">        closes the widget dialog.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="PlugFilter.reset_search_bar">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.PlugFilter.reset_search_bar">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">reset_search_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset search interface to initial state and restore all scan rows.</span>

<span class="sd">        Clears the rapid search text field, resets advanced search rows,</span>
<span class="sd">        and restores the full scan list to the table view, updating the</span>
<span class="sd">        display to reflect all available scans.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Clear search UI components</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rapid_search</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">show_search</span><span class="p">()</span>
        <span class="c1"># Restore full scan list</span>
        <span class="n">old_scan_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_visualize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_visualize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scans_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_search</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scans_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">update_visualized_rows</span><span class="p">(</span><span class="n">old_scan_list</span><span class="p">)</span></div>


<div class="viewcode-block" id="PlugFilter.search_str">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.PlugFilter.search_str">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">search_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">str_search</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filter and update the list of scans displayed in the browser based on</span>
<span class="sd">        search criteria.</span>

<span class="sd">        This method updates `scans_to_visualize` by applying either a rapid</span>
<span class="sd">        search filter or showing all available scans when the search is empty.</span>
<span class="sd">        Special handling is provided for the NOT_DEFINED_VALUE constant to</span>
<span class="sd">        filter scans with undefined tag values.</span>

<span class="sd">        :parm str_search (str): The search string entered by the user. An</span>
<span class="sd">                                empty string shows all scans, NOT_DEFINED_VALUE</span>
<span class="sd">                                filters for scans with undefined tags, and any</span>
<span class="sd">                                other value performs a rapid search filter.</span>

<span class="sd">        Side Effects:</span>
<span class="sd">            - Updates self.table_data.scans_to_visualize with filtered scan</span>
<span class="sd">              list</span>
<span class="sd">            - Updates self.advanced_search.scans_list with the same filtered</span>
<span class="sd">              list</span>
<span class="sd">            - Triggers UI update via self.table_data.update_visualized_rows()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">old_scan_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_visualize</span>

        <span class="c1"># Return all scans if search is empty</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">str_search</span><span class="p">:</span>
            <span class="n">filtered_scans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_search</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">data</span><span class="p">()</span> <span class="k">as</span> <span class="n">database_data</span><span class="p">:</span>
                <span class="n">shown_tags</span> <span class="o">=</span> <span class="n">database_data</span><span class="o">.</span><span class="n">get_shown_tags</span><span class="p">()</span>
                <span class="c1"># Determine filter based on search type</span>
                <span class="n">filter_func</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prepare_not_defined_filter</span><span class="p">(</span><span class="n">shown_tags</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">str_search</span> <span class="o">==</span> <span class="n">NOT_DEFINED_VALUE</span>
                    <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">rapid_search</span><span class="o">.</span><span class="n">prepare_filter</span><span class="p">(</span>
                        <span class="n">str_search</span><span class="p">,</span> <span class="n">shown_tags</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_search</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">scans</span> <span class="o">=</span> <span class="n">database_data</span><span class="o">.</span><span class="n">filter_documents</span><span class="p">(</span>
                    <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">filter_func</span>
                <span class="p">)</span>

            <span class="c1"># Extract filenames from filtered scans</span>
            <span class="n">filtered_scans</span> <span class="o">=</span> <span class="p">[</span><span class="n">scan</span><span class="p">[</span><span class="n">TAG_FILENAME</span><span class="p">]</span> <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="n">scans</span><span class="p">]</span>

        <span class="c1"># Update state with filtered results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_visualize</span> <span class="o">=</span> <span class="n">filtered_scans</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">scans_list</span> <span class="o">=</span> <span class="n">filtered_scans</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">update_visualized_rows</span><span class="p">(</span><span class="n">old_scan_list</span><span class="p">)</span></div>


<div class="viewcode-block" id="PlugFilter.set_plug_value">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.PlugFilter.set_plug_value">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_plug_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract selected or filtered scan values and emit to node plug.</span>

<span class="sd">        Retrieves values from the database for the currently filtered tag.</span>
<span class="sd">        If items are selected in the table, only those values are extracted.</span>
<span class="sd">        Otherwise, all filtered items are processed. For filename tags,</span>
<span class="sd">        paths are converted to absolute paths within the project folder.</span>

<span class="sd">        :Emits: plug_value_changed: Signal with list of extracted values.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_get_scan_value</span><span class="p">(</span><span class="n">database_data</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Retrieve and process a single scan value from the database.</span>

<span class="sd">            :param database_data: Database connection object.</span>
<span class="sd">            :param scan_name: Primary key identifying the scan.</span>
<span class="sd">            :param tag_name: Field name to retrieve.</span>

<span class="sd">            :return: The field value, with absolute path conversion for</span>
<span class="sd">                     filename tags.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">database_data</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                <span class="n">collection_name</span><span class="o">=</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                <span class="n">primary_key</span><span class="o">=</span><span class="n">scan_name</span><span class="p">,</span>
                <span class="n">field</span><span class="o">=</span><span class="n">tag_name</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">tag_name</span> <span class="o">==</span> <span class="n">TAG_FILENAME</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="n">value</span>

        <span class="n">tag_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_button_tag_filter</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">data</span><span class="p">()</span> <span class="k">as</span> <span class="n">database_data</span><span class="p">:</span>

            <span class="c1"># Determine which scans to process</span>
            <span class="k">if</span> <span class="n">selected_points</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">selectedIndexes</span><span class="p">():</span>
                <span class="n">scan_names</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">row</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">selected_points</span>
                <span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">scan_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_current_filter</span><span class="p">()</span>

            <span class="c1"># Extract values for each scan</span>
            <span class="n">result_names</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">_get_scan_value</span><span class="p">(</span><span class="n">database_data</span><span class="p">,</span> <span class="n">scan_name</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">scan_name</span> <span class="ow">in</span> <span class="n">scan_names</span>
            <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plug_value_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">result_names</span><span class="p">)</span></div>


<div class="viewcode-block" id="PlugFilter.update_tag_to_filter">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.PlugFilter.update_tag_to_filter">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_tag_to_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open a dialog to select a tag filter and update the button text.</span>

<span class="sd">        Displays a popup dialog allowing the user to select a tag from the</span>
<span class="sd">        available visible tags. If a tag is selected (dialog accepted), updates</span>
<span class="sd">        the filter button&#39;s text to reflect the chosen tag.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">popup</span> <span class="o">=</span> <span class="n">PopUpSelectTagCountTable</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node_controller</span><span class="o">.</span><span class="n">visibles_tags</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_button_tag_filter</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_button_tag_filter</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">popup</span><span class="o">.</span><span class="n">selected_tag</span><span class="p">)</span></div>


<div class="viewcode-block" id="PlugFilter.update_tags">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.PlugFilter.update_tags">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open a dialog to update the list of visualized tags.</span>

<span class="sd">        Displays a modal dialog allowing users to select which tags should be</span>
<span class="sd">        visualized in the table. If accepted, updates the visible columns in</span>
<span class="sd">        the data table, refreshes the node controller&#39;s visible tags list, and</span>
<span class="sd">        updates all advanced search field dropdowns with the new tag selection.</span>

<span class="sd">        The &#39;Filename&#39; tag is always included in the visible tags list.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Clean up existing dialog if present</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;dialog&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dialog</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dialog</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Create and configure dialog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dialog</span> <span class="o">=</span> <span class="n">QDialog</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dialog</span><span class="o">.</span><span class="n">setMinimumSize</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span>
        <span class="c1"># Set up dialog content</span>
        <span class="n">visualized_tags</span> <span class="o">=</span> <span class="n">PopUpVisualizedTags</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_controller</span><span class="o">.</span><span class="n">visibles_tags</span>
        <span class="p">)</span>
        <span class="c1"># Create dialog buttons</span>
        <span class="n">buttons</span> <span class="o">=</span> <span class="n">QDialogButtonBox</span><span class="p">(</span>
            <span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Cancel</span>
        <span class="p">)</span>
        <span class="n">buttons</span><span class="o">.</span><span class="n">accepted</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dialog</span><span class="o">.</span><span class="n">accept</span><span class="p">)</span>
        <span class="n">buttons</span><span class="o">.</span><span class="n">rejected</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dialog</span><span class="o">.</span><span class="n">reject</span><span class="p">)</span>
        <span class="c1"># Build dialog layout</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">visualized_tags</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">buttons</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dialog</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
        <span class="c1"># Show dialog and process result</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dialog</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
            <span class="c1"># Extract selected tags from list widget</span>
            <span class="n">new_visibilities</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">visualized_tags</span><span class="o">.</span><span class="n">list_widget_selected_tags</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                    <span class="n">visualized_tags</span><span class="o">.</span><span class="n">list_widget_selected_tags</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="p">]</span>
            <span class="n">new_visibilities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TAG_FILENAME</span><span class="p">)</span>
            <span class="c1"># Update table columns and node controller</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">update_visualized_columns</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">node_controller</span><span class="o">.</span><span class="n">visibles_tags</span><span class="p">,</span> <span class="n">new_visibilities</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node_controller</span><span class="o">.</span><span class="n">visibles_tags</span> <span class="o">=</span> <span class="n">new_visibilities</span>

            <span class="c1"># Update all advanced search field dropdowns</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

                <span class="k">for</span> <span class="n">visible_tag</span> <span class="ow">in</span> <span class="n">new_visibilities</span><span class="p">:</span>
                    <span class="n">fields</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">visible_tag</span><span class="p">)</span>

                <span class="n">fields</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s2">&quot;All visualized tags&quot;</span><span class="p">)</span>

        <span class="c1"># Clean up dialog reference</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dialog</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dialog</span> <span class="o">=</span> <span class="kc">None</span></div>
</div>



<div class="viewcode-block" id="AttributesFilter">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.AttributesFilter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AttributesFilter</span><span class="p">(</span><span class="n">PlugFilter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A specialized widget for filtering database entries and collecting their</span>
<span class="sd">    attributes.</span>

<span class="sd">    This widget extends `PlugFilter` to provide a user-friendly interface for</span>
<span class="sd">    filtering files using both rapid and advanced search tools. It allows</span>
<span class="sd">    users to:</span>
<span class="sd">        - Filter database entries based on customizable criteria.</span>
<span class="sd">        - Select specific rows or use the entire filtered dataset.</span>
<span class="sd">        - Collect attributes from the selected or filtered entries.</span>
<span class="sd">        - Emit the collected attributes as a structured dictionary for further</span>
<span class="sd">          processing.</span>

<span class="sd">    The collected attributes are organized into a dictionary where each key</span>
<span class="sd">    represents an attribute name, and the corresponding value is a list of all</span>
<span class="sd">    values for that attribute across the selected or filtered entries.</span>

<span class="sd">    .. Methods:</span>
<span class="sd">        - ok_clicked: Closes the widget and emits the collected attributes. If</span>
<span class="sd">                      rows are selected, only those rows&#39; attributes are</span>
<span class="sd">                      collected; otherwise, attributes are collected from all</span>
<span class="sd">                      entries matching the current filter.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Signal emitted when the user validates the selection. The signal carries</span>
    <span class="c1"># a dictionary mapping attribute names to lists of values extracted from</span>
    <span class="c1"># the database.</span>
    <span class="n">attributes_selected</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>

<div class="viewcode-block" id="AttributesFilter.ok_clicked">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.AttributesFilter.ok_clicked">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">ok_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close the widget and emit the collected attributes.</span>

<span class="sd">        If rows are selected in the table, attributes are collected only from</span>
<span class="sd">        those rows. Otherwise, attributes are collected from all entries</span>
<span class="sd">        matching the current filter. The resulting attributes are grouped by</span>
<span class="sd">        field name and emitted via the ``attributes_selected`` signal.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">selected_indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">selectedIndexes</span><span class="p">()</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">data</span><span class="p">()</span> <span class="k">as</span> <span class="n">database_data</span><span class="p">:</span>
            <span class="n">field_names</span> <span class="o">=</span> <span class="n">database_data</span><span class="o">.</span><span class="n">get_field_names</span><span class="p">(</span><span class="n">COLLECTION_CURRENT</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">selected_indexes</span><span class="p">:</span>
                <span class="c1"># Collect scan names from selected rows</span>
                <span class="n">scan_names</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">row</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">selected_indexes</span>
                <span class="p">}</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Collect scan names from the current filter</span>
                <span class="n">scan_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">get_current_filter</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">scan_name</span> <span class="ow">in</span> <span class="n">scan_names</span><span class="p">:</span>

                <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">field_names</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">database_data</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                        <span class="n">collection_name</span><span class="o">=</span><span class="n">COLLECTION_CURRENT</span><span class="p">,</span>
                        <span class="n">primary_key</span><span class="o">=</span><span class="n">scan_name</span><span class="p">,</span>
                        <span class="n">field</span><span class="o">=</span><span class="n">field</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">attributes</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">attributes_selected</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span></div>
</div>



<span class="c1"># Node controller V2 style</span>
<div class="viewcode-block" id="CapsulNodeController">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.CapsulNodeController">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CapsulNodeController</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A PyQt widget for managing and editing pipeline node parameters using</span>
<span class="sd">    Capsul&#39;s AttributedProcessWidget.</span>

<span class="sd">    This controller provides a user interface for interacting with pipeline</span>
<span class="sd">    nodes, enabling users to:</span>
<span class="sd">        - View and modify node parameters using Capsul&#39;s</span>
<span class="sd">          AttributedProcessWidget.</span>
<span class="sd">        - Rename nodes and update the pipeline accordingly.</span>
<span class="sd">        - Filter and manage node attributes.</span>
<span class="sd">        - Handle undo/redo operations for parameter changes.</span>
<span class="sd">        - Recursively rename subprocesses and adjust context names.</span>

<span class="sd">    The widget is designed to integrate with a pipeline editor, providing</span>
<span class="sd">    real-time updates and synchronization between the UI and the underlying</span>
<span class="sd">    pipeline state.</span>

<span class="sd">    .. Methods:</span>
<span class="sd">        - display_parameters: Displays the parameters of the selected node and</span>
<span class="sd">                              configures the UI.</span>
<span class="sd">        - filter_attributes: Opens a dialog for filtering node attributes.</span>
<span class="sd">        - release_process: Cleans up process notifications and signals.</span>
<span class="sd">        - rename_subprocesses: Recursively renames subprocesses and updates</span>
<span class="sd">                               context names.</span>
<span class="sd">        - static_release: Removes trait change notifications from a process.</span>
<span class="sd">        - parameters_changed: Handles parameter value changes and emits a</span>
<span class="sd">                              signal.</span>
<span class="sd">        - update_attributes_from_filter: Applies selected attributes from the</span>
<span class="sd">                                         filter widget.</span>
<span class="sd">        - update_node_name: Renames the selected node and updates the pipeline.</span>
<span class="sd">        - update_parameters: Placeholder for backward compatibility (no</span>
<span class="sd">                             operation).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Signal emitted when a node or parameter value is changed. Used for</span>
    <span class="c1"># undo/redo functionality.</span>
    <span class="n">value_changed</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

<div class="viewcode-block" id="CapsulNodeController.__init__">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.CapsulNodeController.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">scan_list</span><span class="p">,</span> <span class="n">pipeline_manager_tab</span><span class="p">,</span> <span class="n">main_window</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the node controller.</span>

<span class="sd">        :param project: Current project instance.</span>
<span class="sd">        :param scan_list: List of available scans.</span>
<span class="sd">        :param pipeline_manager_tab: Parent pipeline manager tab.</span>
<span class="sd">        :parammain_window: Main application window.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_list</span> <span class="o">=</span> <span class="n">scan_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span> <span class="o">=</span> <span class="n">main_window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visibles_tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">pipeline_manager_tab</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># Set up the user interface layout</span>
        <span class="n">v_box_final</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">v_box_final</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_widget</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Node name editor</span>
        <span class="n">hlayout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">label_node_name</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Node name:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_node_name</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
        <span class="n">hlayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">label_node_name</span><span class="p">)</span>
        <span class="n">hlayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="p">)</span>
        <span class="n">v_box_final</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">hlayout</span><span class="p">)</span></div>


<div class="viewcode-block" id="CapsulNodeController.display_parameters">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.CapsulNodeController.display_parameters">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">display_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display the parameters of the selected node.</span>

<span class="sd">        Creates and displays widgets for all node parameters, including line</span>
<span class="sd">        edits, labels, and control buttons. Handles special cases for pipeline</span>
<span class="sd">        inputs/outputs nodes.</span>

<span class="sd">        :param node_name (str): Name of the node to display.</span>
<span class="sd">        :param process: Process instance associated with the node.</span>
<span class="sd">        :param pipeline: Current pipeline containing the node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_name</span> <span class="o">=</span> <span class="n">node_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline</span>

        <span class="c1"># Configure the node name editor based on whether it&#39;s editable</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;outputs&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_node_name</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Pipeline inputs/outputs&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Remove and clean up the existing process widget</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_widget</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">static_release</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process_widget</span><span class="o">.</span><span class="n">attributed_process</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters_changed</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_widget</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_widget</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Get connected inputs to disable their filter buttons</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">connected_inputs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">connected_inputs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">plug_name</span>
                <span class="k">for</span> <span class="n">plug_name</span><span class="p">,</span> <span class="n">plug</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">plug</span><span class="o">.</span><span class="n">output</span> <span class="ow">and</span> <span class="n">plug</span><span class="o">.</span><span class="n">links_from</span>
            <span class="p">}</span>

        <span class="c1"># Create the attributed process widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span> <span class="o">=</span> <span class="n">process</span>
        <span class="n">ProcessCompletionEngine</span><span class="o">.</span><span class="n">get_completion_engine</span><span class="p">(</span><span class="n">process</span><span class="p">)</span>
        <span class="n">userlevel</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span><span class="o">.</span><span class="n">get_user_level</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_widget</span> <span class="o">=</span> <span class="n">AttributedProcessWidget</span><span class="p">(</span>
            <span class="n">process</span><span class="p">,</span>
            <span class="n">override_control_types</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;File&quot;</span><span class="p">:</span> <span class="n">type_editors</span><span class="o">.</span><span class="n">PopulseFileControlWidget</span><span class="p">,</span>
                <span class="s2">&quot;Directory&quot;</span><span class="p">:</span> <span class="n">type_editors</span><span class="o">.</span><span class="n">PopulseDirectoryControlWidget</span><span class="p">,</span>
                <span class="s2">&quot;List_File&quot;</span><span class="p">:</span> <span class="p">(</span>
                    <span class="n">type_editors</span><span class="o">.</span><span class="n">PopulseOffscreenListFileControlWidget</span>
                <span class="p">),</span>
                <span class="s2">&quot;Undefined&quot;</span><span class="p">:</span> <span class="n">type_editors</span><span class="o">.</span><span class="n">PopulseUndefinedControlWidget</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">separate_outputs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">user_data</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;project&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span>
                <span class="s2">&quot;scan_list&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_list</span><span class="p">,</span>
                <span class="s2">&quot;main_window&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="p">,</span>
                <span class="s2">&quot;node_controller&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="p">,</span>
                <span class="s2">&quot;connected_inputs&quot;</span><span class="p">:</span> <span class="n">connected_inputs</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">scroll</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">userlevel</span><span class="o">=</span><span class="n">userlevel</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Add filter button if the process has user attributes</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="s2">&quot;completion_engine&quot;</span><span class="p">):</span>
            <span class="n">compl</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">completion_engine</span>
            <span class="n">atts</span> <span class="o">=</span> <span class="n">compl</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">atts</span><span class="o">.</span><span class="n">user_traits</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">btn</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Filter&quot;</span><span class="p">)</span>
                <span class="n">btn</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
                <span class="n">btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter_attributes</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process_widget</span><span class="o">.</span><span class="n">attrib_widget</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">insertWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">btn</span><span class="p">)</span>

        <span class="c1"># Add widget to layout and connect signals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process_widget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters_changed</span><span class="p">,</span> <span class="n">dispatch</span><span class="o">=</span><span class="s2">&quot;ui&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="CapsulNodeController.filter_attributes">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.CapsulNodeController.filter_attributes">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">filter_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display the attributes filter dialog.</span>

<span class="sd">        Opens a popup widget that allows users to filter and select attributes</span>
<span class="sd">        for the current process node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_up</span> <span class="o">=</span> <span class="n">AttributesFilter</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scan_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node_name</span><span class="p">,</span>
            <span class="s2">&quot;attributes&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_up</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_up</span><span class="o">.</span><span class="n">attributes_selected</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_attributes_from_filter</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="CapsulNodeController.release_process">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.CapsulNodeController.release_process">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">release_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clean up process notifications and signals.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;process&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters_changed</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">sip</span><span class="o">.</span><span class="n">isdeleted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value_changed</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># Signal was not connected</span></div>


<div class="viewcode-block" id="CapsulNodeController.rename_subprocesses">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.CapsulNodeController.rename_subprocesses">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">rename_subprocesses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">parent_node_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recursively rename subprocesses within the pipeline, adjusting the</span>
<span class="sd">        context name.</span>

<span class="sd">        This method checks if the process is part of a pipeline and modifies</span>
<span class="sd">        its context name accordingly. If the process name contains a</span>
<span class="sd">        hierarchy of at least three levels, the context name is updated with</span>
<span class="sd">        the parent node name and the remaining parts of the context name. If</span>
<span class="sd">        the process is a pipeline node, the method is called recursively for</span>
<span class="sd">        each subprocess.</span>

<span class="sd">        :param node: The current node being processed.</span>
<span class="sd">        :param parent_node_name (str): The name of the parent node to be</span>
<span class="sd">                                       included in the context name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get the context name or process name and split by &quot;.&quot;</span>
        <span class="n">context_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
            <span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="p">,</span> <span class="s2">&quot;context_name&quot;</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">name</span>
        <span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>

        <span class="c1"># Check if the process belongs to a pipeline</span>
        <span class="k">if</span> <span class="n">context_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Pipeline&quot;</span><span class="p">:</span>

            <span class="c1"># If the context name has more than two parts, update the context</span>
            <span class="c1"># name</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">context_name</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">context_name</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Pipeline.</span><span class="si">{</span><span class="n">parent_node_name</span><span class="si">}</span><span class="s2">.&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">context_name</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">context_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Pipeline.</span><span class="si">{</span><span class="n">parent_node_name</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If not part of a pipeline, just set the context name to the</span>
            <span class="c1"># parent node name</span>
            <span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">context_name</span> <span class="o">=</span> <span class="n">parent_node_name</span>

        <span class="c1"># Recursively rename subprocesses for pipeline nodes</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">PipelineNode</span><span class="p">):</span>

            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">subnode</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rename_subprocesses</span><span class="p">(</span><span class="n">subnode</span><span class="p">,</span> <span class="n">parent_node_name</span><span class="p">)</span></div>


<div class="viewcode-block" id="CapsulNodeController.static_release">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.CapsulNodeController.static_release">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">static_release</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="n">param_changed</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove trait change notification from process.</span>

<span class="sd">        :param process: Process instance to remove notification from.</span>
<span class="sd">        :param param_changed: Callback function to remove.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">process</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span><span class="n">param_changed</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="CapsulNodeController.parameters_changed">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.CapsulNodeController.parameters_changed">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parameters_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">,</span> <span class="n">old_value</span><span class="p">,</span> <span class="n">new_value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle parameter value changes and emit signal.</span>

<span class="sd">        :param _: Unused parameter (object instance).</span>
<span class="sd">        :param plug_name (str): Name of the changed parameter.</span>
<span class="sd">        :param old_value: Previous parameter value.</span>
<span class="sd">        :param new_value: New parameter value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plug_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">new_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;plug_value&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">node_name</span><span class="p">,</span>
                <span class="n">old_value</span><span class="p">,</span>
                <span class="n">plug_name</span><span class="p">,</span>
                <span class="n">plug_type</span><span class="p">,</span>
                <span class="n">new_value</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="CapsulNodeController.update_attributes_from_filter">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.CapsulNodeController.update_attributes_from_filter">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_attributes_from_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply selected attributes from the filter widget.</span>

<span class="sd">        Updates the process completion engine attributes based on user</span>
<span class="sd">        selection from the filter dialog. Shows a warning if no matching</span>
<span class="sd">        attributes are found.</span>

<span class="sd">        :param attributes (dict): Dictionary of attribute names and values to</span>
<span class="sd">                                  apply.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">compl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">completion_engine</span>
        <span class="n">atts</span> <span class="o">=</span> <span class="n">compl</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">()</span>
        <span class="n">num_set</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">atts</span><span class="o">.</span><span class="n">trait</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="c1"># Handle list vs scalar attributes</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">atts</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="nb">list</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">atts</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">atts</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">num_set</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Handle list vs scalar attributes</span>
        <span class="k">if</span> <span class="n">num_set</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">attributes</span><span class="p">:</span>
            <span class="n">mbox_icon</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Information</span>
            <span class="n">mbox_title</span> <span class="o">=</span> <span class="s2">&quot;Unmatching tags / attributes&quot;</span>
            <span class="n">mbox_text</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;The selected data tags do not match the expected &quot;</span>
                <span class="s2">&quot;attributes set for process parameters completion&quot;</span>
            <span class="p">)</span>
            <span class="n">mbox</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">(</span><span class="n">mbox_icon</span><span class="p">,</span> <span class="n">mbox_title</span><span class="p">,</span> <span class="n">mbox_text</span><span class="p">)</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="n">mbox</span><span class="o">.</span><span class="n">accept</span><span class="p">)</span>
            <span class="n">mbox</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span></div>


<div class="viewcode-block" id="CapsulNodeController.update_node_name">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.CapsulNodeController.update_node_name">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_node_name</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">new_node_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">old_node_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">from_undo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">from_redo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change the name of the selected node and update the pipeline.</span>

<span class="sd">        Renames the node in the pipeline dictionary and updates all associated</span>
<span class="sd">        links. For iterated processes, ensures the name starts</span>
<span class="sd">        with &quot;iterated_&quot;.</span>

<span class="sd">        :param new_node_name (str): New name for the node. If None (when this</span>
<span class="sd">                                    method is not called from an undo/redo),</span>
<span class="sd">                                    reads from the line edit widget.</span>
<span class="sd">        :param old_node_name (str): Current node name. If None (when this</span>
<span class="sd">                                    method is not called from an undo/redo),</span>
<span class="sd">                                    uses self.node_name.</span>
<span class="sd">        :param from_undo (bool): True if this action is from an undo operation.</span>
<span class="sd">        :param from_redo (bool): True ifthis action is from a redo operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_node_name</span> <span class="o">=</span> <span class="n">new_node_name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">old_node_name</span> <span class="o">=</span> <span class="n">old_node_name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_name</span>

        <span class="c1"># Handle iterated process naming convention</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">,</span> <span class="n">ProcessIteration</span><span class="p">):</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">new_node_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;iterated_&quot;</span><span class="p">):</span>
                <span class="n">new_node_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;iterated_</span><span class="si">{</span><span class="n">new_node_name</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">new_node_name</span><span class="p">)</span>

        <span class="c1"># Check for name conflicts</span>
        <span class="k">if</span> <span class="n">new_node_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Cannot rename node &#39;</span><span class="si">{</span><span class="n">old_node_name</span><span class="si">}</span><span class="s2">&#39; to &#39;</span><span class="si">{</span><span class="n">new_node_name</span><span class="si">}</span><span class="s2">&#39;: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;node &#39;</span><span class="si">{</span><span class="n">new_node_name</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Perform rename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">rename_node</span><span class="p">(</span><span class="n">old_node_name</span><span class="p">,</span> <span class="n">new_node_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rename_subprocesses</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">new_node_name</span><span class="p">],</span> <span class="n">new_node_name</span>
        <span class="p">)</span>
        <span class="c1"># Update internal state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_name</span> <span class="o">=</span> <span class="n">new_node_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">update_nodes_and_plugs_activation</span><span class="p">()</span>
        <span class="c1"># Emit change signal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;node_name&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">new_node_name</span><span class="p">],</span>
                <span class="n">new_node_name</span><span class="p">,</span>
                <span class="n">old_node_name</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="c1"># Update history</span>
        <span class="n">history_maker</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;update_node_name&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">from_undo</span><span class="p">:</span>
            <span class="n">history_maker</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">new_node_name</span><span class="p">],</span>
                    <span class="n">new_node_name</span><span class="p">,</span>
                    <span class="n">old_node_name</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># fmt: off</span>
        <span class="n">editor</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">pipelineEditorTabs</span>
            <span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># fmt: on</span>
        <span class="n">editor</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="n">history_maker</span><span class="p">,</span> <span class="n">from_undo</span><span class="p">,</span> <span class="n">from_redo</span><span class="p">)</span>

        <span class="c1"># Display status message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Brick name &#39;</span><span class="si">{</span><span class="n">old_node_name</span><span class="si">}</span><span class="s2"> changed to &#39;</span><span class="si">{</span><span class="n">new_node_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="CapsulNodeController.update_parameters">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.CapsulNodeController.update_parameters">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update parameter values.</span>

<span class="sd">        This method is maintained for backward compatibility but does nothing,</span>
<span class="sd">        as the controller widget already reacts to process parameter changes.</span>

<span class="sd">        :param process: Process instance (unused).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>
</div>



<div class="viewcode-block" id="FilterWidget">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.FilterWidget">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FilterWidget</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A PyQt widget for filtering and selecting files in a pipeline&#39;s</span>
<span class="sd">    Input_Filter process.</span>

<span class="sd">    This widget provides a user-friendly interface for filtering database files</span>
<span class="sd">    using both rapid and advanced search functionalities. It allows users to:</span>
<span class="sd">        - Browse and select files from the project database.</span>
<span class="sd">        - Perform rapid searches using a text-based search bar.</span>
<span class="sd">        - Apply advanced filters using a customizable search interface.</span>
<span class="sd">        - Visualize and update tags associated with the files.</span>
<span class="sd">        - Save the configured filter to the process for further use in the</span>
<span class="sd">          pipeline.</span>

<span class="sd">    The widget is designed to integrate seamlessly with the pipeline editor,</span>
<span class="sd">    providing real-time feedback and updates as filters are applied.</span>

<span class="sd">    .. Methods:</span>
<span class="sd">        - layout_view: Configures and initializes the main widget layout,</span>
<span class="sd">                       including search bars, data tables, and action buttons.</span>
<span class="sd">        - ok_clicked: Applies the configured filter to the process and closes</span>
<span class="sd">                      the widget.</span>
<span class="sd">        - reset_search_bar: Resets the search interface to its default state,</span>
<span class="sd">                            clearing all filters.</span>
<span class="sd">        - search_str: Filters and updates the displayed scans based on the</span>
<span class="sd">                      provided search string.</span>
<span class="sd">        - update_tag_to_filter: Opens a dialog for selecting tags to filter and</span>
<span class="sd">                                updates the filter button text.</span>
<span class="sd">        - update_tags: Updates the list of visualized tags through a user</span>
<span class="sd">                       dialog and refreshes the table view.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FilterWidget.__init__">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.FilterWidget.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">main_window</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the Filter Widget for pipeline node filtering.</span>

<span class="sd">        :param project: Current project instance containing database and</span>
<span class="sd">                        configuration.</span>
<span class="sd">        :param node_name: Display name of the filter node.</span>
<span class="sd">        :param node: Input_Filter node instance containing the filter process.</span>
<span class="sd">        :param main_window: Parent main window for UI hierarchy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Filter - </span><span class="si">{</span><span class="n">node_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span> <span class="o">=</span> <span class="n">main_window</span>

        <span class="c1"># Retrieve visible tags from database</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">data</span><span class="p">()</span> <span class="k">as</span> <span class="n">database_data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visible_tags</span> <span class="o">=</span> <span class="n">database_data</span><span class="o">.</span><span class="n">get_shown_tags</span><span class="p">()</span>

        <span class="c1"># Build scan list from node input</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_list</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">[</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">input</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">input</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">input</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Undefined</span>
            <span class="k">else</span> <span class="p">[]</span>
        <span class="p">)</span>
        <span class="c1"># Initialize table data browser with filtered scans</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span> <span class="o">=</span> <span class="n">TableDataBrowser</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">visible_tags</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
        <span class="p">)</span>
        <span class="c1"># Configure table data browser to display only filtered scans</span>
        <span class="n">all_scans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_visualize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_visualize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_search</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">update_visualized_rows</span><span class="p">(</span><span class="n">all_scans</span><span class="p">)</span>
        <span class="c1"># Initialize search components with existing filter</span>
        <span class="n">filter_to_apply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">filter</span>
        <span class="c1"># Rapid search setup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rapid_search</span> <span class="o">=</span> <span class="n">RapidSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">filter_to_apply</span><span class="o">.</span><span class="n">search_bar</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rapid_search</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">filter_to_apply</span><span class="o">.</span><span class="n">search_bar</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rapid_search</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">search_str</span><span class="p">)</span>
        <span class="c1"># Advanced search setup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span> <span class="o">=</span> <span class="n">AdvancedSearch</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scan_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visible_tags</span><span class="p">,</span>
            <span class="n">from_pipeline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">show_search</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">apply_filter</span><span class="p">(</span><span class="n">filter_to_apply</span><span class="p">)</span>
        <span class="c1"># Initialize UI components</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_cross</span> <span class="o">=</span> <span class="n">QToolButton</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_button_tag_filter</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="n">TAG_FILENAME</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout_view</span><span class="p">()</span></div>


<div class="viewcode-block" id="FilterWidget.layout_view">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.FilterWidget.layout_view">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">layout_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Configure and initialize the main widget layout.</span>

<span class="sd">        Sets up a vertical layout containing:</span>
<span class="sd">            - Search bar with reset button</span>
<span class="sd">            - Advanced search widget</span>
<span class="sd">            - Data table</span>
<span class="sd">            - Action buttons (visualize tags, filter, OK, Cancel)</span>

<span class="sd">        The window is sized to 60% width and 80% height of the screen</span>
<span class="sd">        resolution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Configure search reset button</span>
        <span class="n">sources_images_dir</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span><span class="o">.</span><span class="n">getSourceImageDir</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_cross</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color:rgb(255, 255, 255);&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_cross</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span>
            <span class="n">QIcon</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sources_images_dir</span><span class="p">,</span> <span class="s2">&quot;gray_cross.png&quot;</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_cross</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reset_search_bar</span><span class="p">)</span>
        <span class="c1"># Create search bar layout</span>
        <span class="n">search_bar_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">search_bar_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rapid_search</span><span class="p">)</span>
        <span class="n">search_bar_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">button_cross</span><span class="p">)</span>
        <span class="c1"># Create and configure action buttons</span>
        <span class="n">push_button_tags</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Visualized tags&quot;</span><span class="p">)</span>
        <span class="n">push_button_tags</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_tags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_button_tag_filter</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_tag_to_filter</span><span class="p">)</span>
        <span class="n">push_button_ok</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;OK&quot;</span><span class="p">)</span>
        <span class="n">push_button_ok</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ok_clicked</span><span class="p">)</span>
        <span class="n">push_button_cancel</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Cancel&quot;</span><span class="p">)</span>
        <span class="n">push_button_cancel</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
        <span class="c1"># Create bottom button layout</span>
        <span class="n">buttons_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">buttons_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">push_button_tags</span><span class="p">)</span>
        <span class="n">buttons_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">push_button_tag_filter</span><span class="p">)</span>
        <span class="n">buttons_layout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">buttons_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">push_button_ok</span><span class="p">)</span>
        <span class="n">buttons_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">push_button_cancel</span><span class="p">)</span>
        <span class="c1"># Assemble main layout</span>
        <span class="n">main_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">main_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">search_bar_layout</span><span class="p">)</span>
        <span class="n">main_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span><span class="p">)</span>
        <span class="n">main_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="p">)</span>
        <span class="n">main_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">buttons_layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">main_layout</span><span class="p">)</span>
        <span class="c1"># Set window size as percentage of screen resolution</span>
        <span class="n">screen_resolution</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">desktop</span><span class="p">()</span><span class="o">.</span><span class="n">screenGeometry</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">screen_resolution</span><span class="o">.</span><span class="n">width</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">screen_resolution</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">))</span></div>


<div class="viewcode-block" id="FilterWidget.ok_clicked">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.FilterWidget.ok_clicked">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">ok_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply the configured filter to the process and close the dialog.</span>

<span class="sd">        Collects filter parameters from the advanced search interface and rapid</span>
<span class="sd">        search text field, creates a Filter object, and applies it to the</span>
<span class="sd">        process if it&#39;s a ProcessMIA instance. The dialog is then closed</span>
<span class="sd">        regardless of process type.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">,</span> <span class="n">ProcessMIA</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="p">(</span>
            <span class="n">fields</span><span class="p">,</span>
            <span class="n">conditions</span><span class="p">,</span>
            <span class="n">values</span><span class="p">,</span>
            <span class="n">links</span><span class="p">,</span>
            <span class="n">nots</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">filter_object</span> <span class="o">=</span> <span class="n">Filter</span><span class="p">(</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="n">nots</span><span class="p">,</span>
            <span class="n">values</span><span class="p">,</span>
            <span class="n">fields</span><span class="p">,</span>
            <span class="n">links</span><span class="p">,</span>
            <span class="n">conditions</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rapid_search</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">filter_object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="FilterWidget.reset_search_bar">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.FilterWidget.reset_search_bar">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">reset_search_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset search interface to default state.</span>

<span class="sd">        Clears the rapid search text field, resets advanced search rows, and</span>
<span class="sd">        restores the table to display all available scans. The table is</span>
<span class="sd">        updated efficiently by tracking the previous visualization state.</span>

<span class="sd">        Side effects:</span>
<span class="sd">            - Clears rapid_search text field</span>
<span class="sd">            - Resets advanced_search rows to empty list</span>
<span class="sd">            - Updates advanced_search display</span>
<span class="sd">            - Restores table_data to show all scans from scan_list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Clear search inputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rapid_search</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">show_search</span><span class="p">()</span>
        <span class="c1"># Restore full scan list and update table</span>
        <span class="n">previous_scans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_visualize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_visualize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_search</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">update_visualized_rows</span><span class="p">(</span><span class="n">previous_scans</span><span class="p">)</span></div>


<div class="viewcode-block" id="FilterWidget.search_str">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.FilterWidget.search_str">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">search_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">str_search</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filter and update the displayed scans based on a search string.</span>

<span class="sd">        Performs a rapid search to filter scans in the browser view. An empty</span>
<span class="sd">        search string displays all available scans. Special handling is</span>
<span class="sd">        provided for undefined values and custom search filters.</span>

<span class="sd">        :param str_search: Search query string. Use empty string to show all</span>
<span class="sd">                           scans, or NOT_DEFINED_VALUE constant to filter scans</span>
<span class="sd">                           with undefined fields.</span>

<span class="sd">        Side Effects:</span>
<span class="sd">            - Updates self.table_data.scans_to_visualize with filtered results</span>
<span class="sd">            - Updates self.advanced_search.scans_list with filtered results</span>
<span class="sd">            - Triggers table row update via</span>
<span class="sd">              self.table_data.update_visualized_rows()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">old_scan_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_visualize</span>

        <span class="c1"># Return all scans if search is empty</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">str_search</span><span class="p">:</span>
            <span class="n">return_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_search</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">data</span><span class="p">()</span> <span class="k">as</span> <span class="n">database_data</span><span class="p">:</span>
                <span class="n">shown_tags</span> <span class="o">=</span> <span class="n">database_data</span><span class="o">.</span><span class="n">get_shown_tags</span><span class="p">()</span>

                <span class="c1"># Build appropriate filter based on search type</span>
                <span class="k">if</span> <span class="n">str_search</span> <span class="o">==</span> <span class="n">NOT_DEFINED_VALUE</span><span class="p">:</span>
                    <span class="n">scan_filter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_not_defined_filter</span><span class="p">(</span><span class="n">shown_tags</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">scan_filter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rapid_search</span><span class="o">.</span><span class="n">prepare_filter</span><span class="p">(</span>
                        <span class="n">str_search</span><span class="p">,</span>
                        <span class="n">shown_tags</span><span class="p">,</span>
                        <span class="n">old_scan_list</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="c1"># Execute filter and extract filenames</span>
                <span class="n">scans</span> <span class="o">=</span> <span class="n">database_data</span><span class="o">.</span><span class="n">filter_documents</span><span class="p">(</span>
                    <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan_filter</span>
                <span class="p">)</span>
                <span class="n">return_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">scan</span><span class="p">[</span><span class="n">TAG_FILENAME</span><span class="p">]</span> <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="n">scans</span><span class="p">]</span>

        <span class="c1"># Update display lists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">scans_to_visualize</span> <span class="o">=</span> <span class="n">return_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">scans_list</span> <span class="o">=</span> <span class="n">return_list</span>
        <span class="c1"># Refresh table rows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">update_visualized_rows</span><span class="p">(</span><span class="n">old_scan_list</span><span class="p">)</span></div>


<div class="viewcode-block" id="FilterWidget.update_tag_to_filter">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.FilterWidget.update_tag_to_filter">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_tag_to_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display a tag selection dialog and update the filter button text.</span>

<span class="sd">        Opens a popup dialog allowing the user to select from visible project</span>
<span class="sd">        tags. If a tag is selected (dialog accepted), updates the filter</span>
<span class="sd">        button&#39;s text to reflect the chosen tag.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pop_up</span> <span class="o">=</span> <span class="n">PopUpSelectTagCountTable</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">visible_tags</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_button_tag_filter</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">pop_up</span><span class="o">.</span><span class="n">exec_</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_button_tag_filter</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">pop_up</span><span class="o">.</span><span class="n">selected_tag</span><span class="p">)</span></div>


<div class="viewcode-block" id="FilterWidget.update_tags">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.FilterWidget.update_tags">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the list of visualized tags through a user dialog.</span>

<span class="sd">        Opens a modal dialog that allows users to select which tags should be</span>
<span class="sd">        displayed in the table view. Upon confirmation, the method:</span>
<span class="sd">            - Updates table columns to show only selected tags</span>
<span class="sd">            - Refreshes advanced search field options</span>
<span class="sd">            - Ensures TAG_FILENAME is always included in visible tags</span>

<span class="sd">        The dialog is automatically cleaned up after use, whether the user</span>
<span class="sd">        confirms or cancels the operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Clean up any existing dialog</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;dialog&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dialog</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dialog</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Create and configure dialog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dialog</span> <span class="o">=</span> <span class="n">QDialog</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dialog</span><span class="o">.</span><span class="n">setMinimumSize</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span>
        <span class="c1"># Set up dialog content</span>
        <span class="n">visualized_tags</span> <span class="o">=</span> <span class="n">PopUpVisualizedTags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">visible_tags</span><span class="p">)</span>
        <span class="n">buttons</span> <span class="o">=</span> <span class="n">QDialogButtonBox</span><span class="p">(</span>
            <span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Cancel</span>
        <span class="p">)</span>
        <span class="n">buttons</span><span class="o">.</span><span class="n">accepted</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dialog</span><span class="o">.</span><span class="n">accept</span><span class="p">)</span>
        <span class="n">buttons</span><span class="o">.</span><span class="n">rejected</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dialog</span><span class="o">.</span><span class="n">reject</span><span class="p">)</span>
        <span class="c1"># Build layout</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">visualized_tags</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">buttons</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dialog</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>

        <span class="c1"># Show dialog and process result</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
            <span class="c1"># Apply the selected tag visibility changes to table and</span>
            <span class="c1"># search fields</span>
            <span class="n">new_visibilities</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">visualized_tags</span><span class="o">.</span><span class="n">list_widget_selected_tags</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                    <span class="n">visualized_tags</span><span class="o">.</span><span class="n">list_widget_selected_tags</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="p">]</span>

            <span class="c1"># Ensure TAG_FILENAME is always included</span>
            <span class="k">if</span> <span class="n">TAG_FILENAME</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_visibilities</span><span class="p">:</span>
                <span class="n">new_visibilities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TAG_FILENAME</span><span class="p">)</span>

            <span class="c1"># Update table columns</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">update_visualized_columns</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">visible_tags</span><span class="p">,</span> <span class="n">new_visibilities</span>
            <span class="p">)</span>
            <span class="c1"># Resize columns to fit content</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visible_tags</span> <span class="o">=</span> <span class="n">new_visibilities</span>

            <span class="c1"># Update advanced search fields</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">advanced_search</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="n">new_visibilities</span><span class="p">)</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s2">&quot;All visualized tags&quot;</span><span class="p">)</span>

        <span class="c1"># Clean up the dialog reference at the end</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;dialog&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dialog</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dialog</span> <span class="o">=</span> <span class="kc">None</span></div>
</div>



<span class="c1"># Node controller V1 style</span>
<div class="viewcode-block" id="NodeController">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.NodeController">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">NodeController</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A PyQt widget for managing and editing the input/output values and</span>
<span class="sd">    parameters of a pipeline node.</span>

<span class="sd">    This controller provides a user interface to interact with pipeline nodes,</span>
<span class="sd">    allowing users to:</span>
<span class="sd">        - View and edit node names and parameters</span>
<span class="sd">        - Filter and update plug values</span>
<span class="sd">        - Handle undo/redo operations for parameter changes</span>
<span class="sd">        - Manage subprocesses and context names</span>

<span class="sd">    The widget is designed to integrate with a pipeline editor, providing</span>
<span class="sd">    real-time updates and synchronization between the UI and the underlying</span>
<span class="sd">    pipeline state.</span>

<span class="sd">    .. Methods:</span>
<span class="sd">        - clearLayout: Clears and deletes all items from a widget&#39;s layout,</span>
<span class="sd">                       including nested layouts.</span>
<span class="sd">        - display_filter: Displays a filter dialog for a plug.</span>
<span class="sd">        - display_parameters: Renders the parameters UI for a selected node.</span>
<span class="sd">        - get_index_from_plug_name: Returns the index of a plug label in the</span>
<span class="sd">                                    UI.</span>
<span class="sd">        - update_node_name: Updates the name of the selected node in the</span>
<span class="sd">                            pipeline.</span>
<span class="sd">        - rename_subprocesses: Recursively updates context names for</span>
<span class="sd">                               subprocesses.</span>
<span class="sd">        - update_parameters: Synchronizes UI parameter values with the process</span>
<span class="sd">                             traits.</span>
<span class="sd">        - update_plug_value: Updates a plug value.</span>
<span class="sd">        - update_plug_value_from_filter: Updates a plug value from filter</span>
<span class="sd">                                         results.</span>
<span class="sd">        - release_process: Placeholder for process release logic (to be</span>
<span class="sd">                           overridden by subclasses).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">value_changed</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

<div class="viewcode-block" id="NodeController.__init__">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.NodeController.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">scan_list</span><span class="p">,</span> <span class="n">pipeline_manager_tab</span><span class="p">,</span> <span class="n">main_window</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the node controller widget.</span>

<span class="sd">        This controller manages the interaction between the current project,</span>
<span class="sd">        the selected scans, and the active pipeline within the pipeline manager</span>
<span class="sd">        interface.</span>

<span class="sd">        :param project: The current project instance.</span>
<span class="sd">        :param scan_list: lThe list of selected database files (scans).</span>
<span class="sd">        :param pipeline_manager_tab: The parent pipeline manager tab widget.</span>
<span class="sd">        :param main_window: The main application window.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">pipeline_manager_tab</span><span class="p">)</span>
        <span class="c1"># Core context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_list</span> <span class="o">=</span> <span class="n">scan_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span> <span class="o">=</span> <span class="n">main_window</span>
        <span class="c1"># Pipeline state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">pipeline_manager_tab</span><span class="o">.</span><span class="n">pipelineEditorTabs</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># Layouts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_box_final</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_box_node_name</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span></div>


<div class="viewcode-block" id="NodeController.clearLayout">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.NodeController.clearLayout">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">clearLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove and delete all items from a widget&#39;s layout.</span>

<span class="sd">        This method recursively clears the layout attached to the given widget:</span>
<span class="sd">            - QWidget items are detached from their parent.</span>
<span class="sd">            - Nested layouts are emptied and scheduled for deletion.</span>
<span class="sd">            - The layout itself is deleted once cleared.</span>

<span class="sd">        :param widget (QtWidgets.QWidget): The widget whose layout should be</span>
<span class="sd">                                           cleared.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">layout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">while</span> <span class="n">layout</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">layout</span><span class="o">.</span><span class="n">takeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">item</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                <span class="c1"># Recursively clear nested layouts</span>
                <span class="k">while</span> <span class="n">item</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
                    <span class="n">sub_item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">takeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">sub_item</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">sub_item</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

                <span class="n">item</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>

        <span class="n">sip</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span></div>


<div class="viewcode-block" id="NodeController.display_filter">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.NodeController.display_filter">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">display_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">process</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display an interactive filter widget for modifying plug values.</span>

<span class="sd">        Creates and shows a PlugFilter dialog that allows users to filter and</span>
<span class="sd">        modify the value of a specific plug. The dialog&#39;s value changes are</span>
<span class="sd">        automatically propagated back to update the plug through a signal</span>
<span class="sd">        connection.</span>

<span class="sd">        :param node_name: The name of the pipeline node containing the plug.</span>
<span class="sd">        :param plug_name: The name of the plug to filter.</span>
<span class="sd">        :param parameters: A tuple containing (plug_index, pipeline_instance,</span>
<span class="sd">                           plug_value_type) that provides context for the plug</span>
<span class="sd">                           being filtered.</span>
<span class="sd">        :param process: The process instance associated with the node.</span>

<span class="sd">        Note:</span>
<span class="sd">            The created PlugFilter is stored in self.pop_up and remains</span>
<span class="sd">            accessible until another filter is displayed or the instance is</span>
<span class="sd">            destroyed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_up</span> <span class="o">=</span> <span class="n">PlugFilter</span><span class="p">(</span>
            <span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span>
            <span class="n">scans_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_list</span><span class="p">,</span>
            <span class="n">process</span><span class="o">=</span><span class="n">process</span><span class="p">,</span>
            <span class="n">node_name</span><span class="o">=</span><span class="n">node_name</span><span class="p">,</span>
            <span class="n">plug_name</span><span class="o">=</span><span class="n">plug_name</span><span class="p">,</span>
            <span class="n">node_controller</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">main_window</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_up</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="c1"># Connect the filter&#39;s value changes to the plug update handler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_up</span><span class="o">.</span><span class="n">plug_value_changed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_plug_value_from_filter</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="NodeController.display_parameters">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.NodeController.display_parameters">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">display_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display and configure parameters for the selected pipeline node.</span>

<span class="sd">        Creates an interactive interface showing the node&#39;s input and output</span>
<span class="sd">        parameters with editable fields. For pipeline global inputs (except</span>
<span class="sd">        &#39;database_scans&#39;), adds filter buttons for File/List_File/Any trait</span>
<span class="sd">        types.</span>

<span class="sd">        Special handling:</span>
<span class="sd">            - &#39;inputs&#39;/&#39;outputs&#39; nodes: Name field is read-only, displays</span>
<span class="sd">                                        &quot;Pipeline inputs/outputs&quot;</span>
<span class="sd">            - Other nodes: Name field is editable and updates on Enter</span>
<span class="sd">            - Parameters with userlevel &gt; 0 are hidden from the interface</span>

<span class="sd">        :param node_name: Identifier for the node being displayed</span>
<span class="sd">        :param process: Node&#39;s process object containing traits and their</span>
<span class="sd">                        values</span>
<span class="sd">        :param pipeline: Parent pipeline instance containing this node</span>

<span class="sd">        Side effects:</span>
<span class="sd">            - Clears and rebuilds the widget layout</span>
<span class="sd">            - Updates node_parameters_tmp in the current pipeline editor</span>
<span class="sd">            - Enables the run_pipeline_action</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_name</span> <span class="o">=</span> <span class="n">node_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_process</span> <span class="o">=</span> <span class="n">process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_input</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels_input</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels_output</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Clear existing layout</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clearLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">v_box_final</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="c1"># Node name section</span>
        <span class="n">label_node_name</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Node name:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_node_name</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>

        <span class="c1"># The pipeline global inputs and outputs node name cannot be modified</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_name</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;outputs&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Pipeline inputs/outputs&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_node_name</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">h_box_node_name</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_box_node_name</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">label_node_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_box_node_name</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="p">)</span>
        <span class="c1"># Input parameters section</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_group_inputs</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s2">&quot;Inputs&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_box_inputs</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">trait</span> <span class="ow">in</span> <span class="n">process</span><span class="o">.</span><span class="n">user_traits</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;nodes_activation&quot;</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="n">trait</span><span class="o">.</span><span class="n">userlevel</span> <span class="ow">and</span> <span class="n">trait</span><span class="o">.</span><span class="n">userlevel</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">trait</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_edit_input</span><span class="p">)</span>
                <span class="c1"># Create label and get value</span>
                <span class="n">label_input</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">labels_input</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label_input</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

                <span class="k">except</span> <span class="n">TraitError</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">Undefined</span>

                <span class="c1"># Create input field</span>
                <span class="n">line_edit</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                <span class="n">line_edit</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                    <span class="n">partial</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">update_plug_value</span><span class="p">,</span>
                        <span class="s2">&quot;in&quot;</span><span class="p">,</span>
                        <span class="n">name</span><span class="p">,</span>
                        <span class="n">pipeline</span><span class="p">,</span>
                        <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_input</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_edit</span><span class="p">)</span>
                <span class="c1"># Assemble row</span>
                <span class="n">h_box</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
                <span class="n">h_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">label_input</span><span class="p">)</span>
                <span class="n">h_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">line_edit</span><span class="p">)</span>

                <span class="c1"># Add filter button for eligible pipeline inputs (except if</span>
                <span class="c1"># the input is &quot;database_scans&quot; which means that the scans</span>
                <span class="c1"># will be filtered with InputFilter)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_name</span> <span class="o">==</span> <span class="s2">&quot;inputs&quot;</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;database_scans&quot;</span><span class="p">:</span>
                    <span class="n">trait_type</span> <span class="o">=</span> <span class="n">trait_ids</span><span class="p">(</span><span class="n">process</span><span class="o">.</span><span class="n">trait</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                        <span class="n">t</span> <span class="ow">in</span> <span class="n">trait_type</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;File&quot;</span><span class="p">,</span> <span class="s2">&quot;List_File&quot;</span><span class="p">,</span> <span class="s2">&quot;Any&quot;</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="n">parameters</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                        <span class="n">push_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Filter&quot;</span><span class="p">)</span>
                        <span class="n">push_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                            <span class="n">partial</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">display_filter</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">node_name</span><span class="p">,</span>
                                <span class="n">name</span><span class="p">,</span>
                                <span class="n">parameters</span><span class="p">,</span>
                                <span class="n">process</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">h_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">push_button</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">v_box_inputs</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">h_box</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">button_group_inputs</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_box_inputs</span><span class="p">)</span>
        <span class="c1"># Output parameters section</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_group_outputs</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s2">&quot;Outputs&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_box_outputs</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">trait</span> <span class="ow">in</span> <span class="n">process</span><span class="o">.</span><span class="n">traits</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="k">if</span> <span class="n">trait</span><span class="o">.</span><span class="n">userlevel</span> <span class="ow">and</span> <span class="n">trait</span><span class="o">.</span><span class="n">userlevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_edit_output</span><span class="p">)</span>
            <span class="c1"># Create label and get value</span>
            <span class="n">label_output</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label_output</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="c1"># Create input field</span>
            <span class="n">line_edit</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="n">line_edit</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="n">partial</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_plug_value</span><span class="p">,</span> <span class="s2">&quot;out&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_edit</span><span class="p">)</span>
            <span class="c1"># Assemble row</span>
            <span class="n">h_box</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
            <span class="n">h_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">label_output</span><span class="p">)</span>
            <span class="n">h_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">line_edit</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v_box_outputs</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">h_box</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">button_group_outputs</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_box_outputs</span><span class="p">)</span>
        <span class="c1"># Assemble final layout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_box_final</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_box_node_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_box_final</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">button_group_inputs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_box_final</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">button_group_outputs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_box_final</span><span class="p">)</span>
        <span class="c1"># Update editor state</span>
        <span class="c1"># fmt: off</span>
        <span class="n">current_editor</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span>
                <span class="o">.</span><span class="n">pipeline_manager</span>
                <span class="o">.</span><span class="n">pipelineEditorTabs</span>
                <span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># fmt: on</span>
        <span class="n">current_editor</span><span class="o">.</span><span class="n">node_parameters_tmp</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="k">for</span> <span class="n">line_edit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_input</span><span class="p">],</span>
            <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="k">for</span> <span class="n">line_edit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_output</span>
            <span class="p">],</span>
        <span class="p">}</span>
        <span class="n">current_editor</span><span class="o">.</span><span class="n">node_parameters_tmp</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;outputs&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">pipeline_manager</span><span class="o">.</span><span class="n">run_pipeline_action</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span>
            <span class="kc">False</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="NodeController.get_index_from_plug_name">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.NodeController.get_index_from_plug_name">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_index_from_plug_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">,</span> <span class="n">in_or_out</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the index of a plug by its name.</span>

<span class="sd">        :param plug_name (str): The name of the plug to find.</span>
<span class="sd">        :param in_or_out (str): Direction of the plug ; &quot;in&quot; for input,</span>
<span class="sd">                                &quot;out&quot; for output.</span>

<span class="sd">        :return: The zero-based index of the plug if found, None otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels_input</span> <span class="k">if</span> <span class="n">in_or_out</span> <span class="o">==</span> <span class="s2">&quot;in&quot;</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels_output</span>

        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">idx</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">label</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="n">plug_name</span>
            <span class="p">),</span>
            <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="NodeController.update_node_name">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.NodeController.update_node_name">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_node_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_node_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the name of the currently selected node in the pipeline.</span>

<span class="sd">        Renames a node in the pipeline dictionary, preserving all its</span>
<span class="sd">        properties and connections. If the pipeline contains a</span>
<span class="sd">        ProcessIteration, ensures the name is prefixed with &#39;iterated_&#39;.</span>

<span class="sd">        :param new_node_name: The new name for the node. If None, retrieves the</span>
<span class="sd">                              name from the UI line edit widget. Is not None</span>
<span class="sd">                              only when this method is called from an</span>
<span class="sd">                              &quot;undo/redo&quot;)</span>

<span class="sd">        :Emits: value_changed: Signal with node rename details for undo/redo</span>
<span class="sd">                               tracking.</span>

<span class="sd">        Note:</span>
<span class="sd">            Does nothing if the new name already exists in the pipeline.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">old_node_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_name</span>
        <span class="n">new_node_name</span> <span class="o">=</span> <span class="n">new_node_name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1"># Ensure ProcessIteration nodes have the correct prefix</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">list_process_in_pipeline</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ProcessIteration</span>
        <span class="p">):</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">new_node_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;iterated_&quot;</span><span class="p">):</span>
                <span class="n">new_node_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;iterated_</span><span class="si">{</span><span class="n">new_node_name</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_node_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">new_node_name</span><span class="p">)</span>

        <span class="c1"># Check for name conflicts</span>
        <span class="k">if</span> <span class="n">new_node_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Node name &#39;</span><span class="si">{</span><span class="n">new_node_name</span><span class="si">}</span><span class="s2">&#39; already exists in pipeline&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Perform the rename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">rename_node</span><span class="p">(</span><span class="n">old_node_name</span><span class="p">,</span> <span class="n">new_node_name</span><span class="p">)</span>
        <span class="n">renamed_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">new_node_name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rename_subprocesses</span><span class="p">(</span><span class="n">renamed_node</span><span class="p">,</span> <span class="n">new_node_name</span><span class="p">)</span>
        <span class="c1"># Update local state and emit change signal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_name</span> <span class="o">=</span> <span class="n">new_node_name</span>
        <span class="c1"># For undo/redo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;node_name&quot;</span><span class="p">,</span> <span class="n">renamed_node</span><span class="p">,</span> <span class="n">new_node_name</span><span class="p">,</span> <span class="n">old_node_name</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Brick name &#39;</span><span class="si">{</span><span class="n">old_node_name</span><span class="si">}</span><span class="s2">&#39; has been &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;changed to &#39;</span><span class="si">{</span><span class="n">new_node_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="NodeController.rename_subprocesses">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.NodeController.rename_subprocesses">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">rename_subprocesses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">parent_node_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recursively update context names for a node and its subprocesses.</span>

<span class="sd">        This method updates the `context_name` attribute throughout a node</span>
<span class="sd">        hierarchy, ensuring consistent naming based on the parent context. For</span>
<span class="sd">        pipeline processes, it preserves the hierarchical structure while</span>
<span class="sd">        incorporating the parent node name.</span>

<span class="sd">        The context name follows these rules:</span>
<span class="sd">        - Pipeline processes:&quot;Pipeline.{parent_node_name}.{additional_parts}&quot;</span>
<span class="sd">        - Non-pipeline processes: &quot;{parent_node_name}&quot;</span>
<span class="sd">        - Nested subprocesses are updated recursively</span>

<span class="sd">        :param node (Node): The node whose context name will be updated, along</span>
<span class="sd">                            with all its subprocesses.</span>
<span class="sd">        :param parent_node_name (str): The parent node&#39;s name to incorporate</span>
<span class="sd">                                       into the context naming hierarchy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get the current context name, falling back to process name if not set</span>
        <span class="n">context_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="p">,</span> <span class="s2">&quot;context_name&quot;</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">context_parts</span> <span class="o">=</span> <span class="n">context_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>

        <span class="c1"># Update context name based on whether it&#39;s a pipeline process</span>
        <span class="k">if</span> <span class="n">context_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Pipeline&quot;</span><span class="p">:</span>
            <span class="c1"># Preserve nested structure beyond the parent level</span>
            <span class="n">additional_parts</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">context_parts</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">context_parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="k">else</span> <span class="p">[]</span>
            <span class="p">)</span>
            <span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">context_name</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;Pipeline&quot;</span><span class="p">,</span> <span class="n">parent_node_name</span><span class="p">,</span> <span class="o">*</span><span class="n">additional_parts</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">context_name</span> <span class="o">=</span> <span class="n">parent_node_name</span>

        <span class="c1"># Recursively update all subprocesses in pipeline nodes</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">PipelineNode</span><span class="p">):</span>

            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">subnode</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                <span class="k">if</span> <span class="n">name</span><span class="p">:</span>  <span class="c1"># Skip empty names</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rename_subprocesses</span><span class="p">(</span><span class="n">subnode</span><span class="p">,</span> <span class="n">parent_node_name</span><span class="p">)</span></div>


<div class="viewcode-block" id="NodeController.update_parameters">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.NodeController.update_parameters">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update parameter values in the UI from the process traits.</span>

<span class="sd">        Synchronizes input and output line edit widgets with the current values</span>
<span class="sd">        of the process traits. If no process is provided, uses the current</span>
<span class="sd">        process if available. The &#39;nodes_activation&#39; trait is ignored.</span>
<span class="sd">        Undefined trait values are handled gracefully.</span>

<span class="sd">        :param process: Optional process node whose parameters should be</span>
<span class="sd">                        displayed. If None, uses self.current_process.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Resolve process</span>
        <span class="k">if</span> <span class="n">process</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">process</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;current_process&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">process</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># No node has been clicked, no need to update the widget</span>
                <span class="k">return</span>

        <span class="c1"># Update input parameter widgets</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">trait</span> <span class="ow">in</span> <span class="n">process</span><span class="o">.</span><span class="n">user_traits</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;nodes_activation&quot;</span> <span class="ow">or</span> <span class="n">trait</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_edit_input</span><span class="p">):</span>
                <span class="k">break</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

            <span class="k">except</span> <span class="n">TraitError</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">Undefined</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_input</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Update output parameter widgets</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">trait</span> <span class="ow">in</span> <span class="n">process</span><span class="o">.</span><span class="n">traits</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_edit_output</span><span class="p">):</span>
                <span class="k">break</span>

            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_output</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span></div>


<div class="viewcode-block" id="NodeController.update_plug_value">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.NodeController.update_plug_value">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_plug_value</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">in_or_out</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="n">value_type</span><span class="p">,</span> <span class="n">new_value</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the value of a node plug and propagate changes through the</span>
<span class="sd">        pipeline.</span>

<span class="sd">        The new value is either explicitly provided (typically during</span>
<span class="sd">        undo/redo) or read from the corresponding line edit widget and</span>
<span class="sd">        evaluated. If the update fails, the previous value is restored in the</span>
<span class="sd">        UI and a warning dialog is shown.</span>

<span class="sd">        :param in_or_out (str): Direction of the plug - &quot;in&quot; for input plugs,</span>
<span class="sd">                                &quot;out&quot; for output plugs.</span>
<span class="sd">        :param plug_name (str): Name of the plug to update.</span>
<span class="sd">        :param pipeline: The current pipeline instance.</span>
<span class="sd">        :param value_type (type): Expected type of the plug value.</span>
<span class="sd">        :param new_value (optional): New value for the plug. If None, reads</span>
<span class="sd">                                     from the line edit widget (is None except</span>
<span class="sd">                                     when this method is called from an</span>
<span class="sd">                                     undo/redo)</span>

<span class="sd">        Side Effects:</span>
<span class="sd">            - Updates the plug value in the pipeline node</span>
<span class="sd">            - Updates the corresponding line edit widget text</span>
<span class="sd">            - Triggers pipeline node and plug activation updates</span>
<span class="sd">            - Emits value_changed signal for undo/redo tracking</span>
<span class="sd">            - Displays status message in the main window</span>
<span class="sd">            - Shows error dialog on TraitError or OSError</span>

<span class="sd">        Note:</span>
<span class="sd">            The method uses eval() to parse string input, which handles</span>
<span class="sd">            lists, dicts, and other Python literals. Special handling is</span>
<span class="sd">            included for &#39;&lt;undefined&gt;&#39; values in dictionaries, which are</span>
<span class="sd">            converted to Undefined objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_index_from_plug_name</span><span class="p">(</span><span class="n">plug_name</span><span class="p">,</span> <span class="n">in_or_out</span><span class="p">)</span>

        <span class="c1"># Read and evaluate the value from the UI if not explicitly provided</span>
        <span class="k">if</span> <span class="n">new_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">in_or_out</span> <span class="o">==</span> <span class="s2">&quot;in&quot;</span><span class="p">:</span>
                <span class="n">new_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_input</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">elif</span> <span class="n">in_or_out</span> <span class="o">==</span> <span class="s2">&quot;out&quot;</span><span class="p">:</span>
                <span class="n">new_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_output</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_value</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">new_value</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">new_value</span><span class="p">)</span>

            <span class="c1"># Handle &quot;&lt;undefined&gt;&quot; textual values that break eval()</span>
            <span class="c1"># See FIXME below.</span>
            <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
                <span class="n">new_value</span> <span class="o">=</span> <span class="n">new_value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;undefined&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;&lt;undefined&gt;&#39;&quot;</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">new_value</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">new_value</span><span class="p">)</span>

                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Problem reading the </span><span class="si">{</span><span class="n">plug_name</span><span class="si">}</span><span class="s2"> value&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span>
                    <span class="p">)</span>

            <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
                <span class="c1"># Keep the original value if evaluation fails due to undefined</span>
                <span class="c1"># names</span>
                <span class="k">pass</span>

            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Problem reading the </span><span class="si">{</span><span class="n">plug_name</span><span class="si">}</span><span class="s2"> value&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">value_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">value_type</span> <span class="o">=</span> <span class="nb">str</span>

        <span class="n">node_name</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_name</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;outputs&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_name</span>
        <span class="p">)</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span>
        <span class="n">old_value</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get_plug_value</span><span class="p">(</span><span class="n">plug_name</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="c1"># Convert &#39;&lt;undefined&gt;&#39; strings to Undefined objects in</span>
            <span class="c1"># dictionaries</span>
            <span class="c1"># FIXME: This should be expanded to handle all data types, not</span>
            <span class="c1">#        just dicts</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">new_value</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">k</span><span class="p">:</span> <span class="n">Undefined</span> <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="s2">&quot;&lt;undefined&gt;&quot;</span> <span class="k">else</span> <span class="n">v</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">new_value</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">}</span>

            <span class="n">node</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="n">plug_name</span><span class="p">,</span> <span class="n">new_value</span><span class="p">)</span>

        <span class="k">except</span> <span class="p">(</span><span class="n">TraitError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">in_or_out</span> <span class="o">==</span> <span class="s2">&quot;in&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_input</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">old_value</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">in_or_out</span> <span class="o">==</span> <span class="s2">&quot;out&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_output</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">old_value</span><span class="p">))</span>

            <span class="k">return</span>

        <span class="c1"># Propagate the change through the pipeline</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">update_nodes_and_plugs_activation</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">in_or_out</span> <span class="o">==</span> <span class="s2">&quot;in&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_input</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">new_value</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">in_or_out</span> <span class="o">==</span> <span class="s2">&quot;out&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_output</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">new_value</span><span class="p">))</span>

        <span class="c1"># Emit undo/redo information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;plug_value&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">node_name</span><span class="p">,</span>
                <span class="n">old_value</span><span class="p">,</span>
                <span class="n">plug_name</span><span class="p">,</span>
                <span class="n">value_type</span><span class="p">,</span>
                <span class="n">new_value</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Plug &#39;</span><span class="si">{</span><span class="n">plug_name</span><span class="si">}</span><span class="s2">&#39; of brick &#39;</span><span class="si">{</span><span class="n">node_name</span><span class="si">}</span><span class="s2">&#39; has &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;been changed to &#39;</span><span class="si">{</span><span class="n">new_value</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="NodeController.update_plug_value_from_filter">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.NodeController.update_plug_value_from_filter">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_plug_value_from_filter</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">filter_res_list</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update a plug&#39;s value based on filtered results.</span>

<span class="sd">        Automatically unwraps single-item lists for convenience, setting the</span>
<span class="sd">        plug value to the item itself rather than a list containing one item.</span>

<span class="sd">        :param plug_name: Name of the plug to update.</span>
<span class="sd">        :param parameters: Tuple of (plug_index, pipeline_instance,</span>
<span class="sd">                           value_type).</span>
<span class="sd">        :param filter_res_list: Filtered file list to set as the plug value.</span>

<span class="sd">        Note:</span>
<span class="sd">            - Empty lists are preserved as empty lists</span>
<span class="sd">            - Single-item lists are unwrapped to the item itself</span>
<span class="sd">            - Multi-item lists are kept as lists</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="n">value_type</span> <span class="o">=</span> <span class="n">parameters</span>

        <span class="c1"># Unwrap single-item lists; preserve empty and multi-item lists</span>
        <span class="k">match</span> <span class="nb">len</span><span class="p">(</span><span class="n">filter_res_list</span><span class="p">):</span>

            <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">filter_res_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">filter_res_list</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_plug_value</span><span class="p">(</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="n">value_type</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span></div>


<div class="viewcode-block" id="NodeController.release_process">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.node_controller.NodeController.release_process">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">release_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Release the process from notification tracking.</span>

<span class="sd">        This method is intended to be overridden by subclasses that need</span>
<span class="sd">        to implement process release logic. The base implementation is a no-op.</span>

<span class="sd">        Note:</span>
<span class="sd">            Currently only implemented in CapsuleNodeController.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>
</div>

</pre></div>

      </div>
      <div class="bottomnav" role="navigation" aria-label="Bottom">
      
        <p>
        <a class="uplink" href="../../../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2022, populse.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
  </body>
</html>